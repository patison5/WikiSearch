<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Компиляция. 7: назначение регистров / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/99595\/"},"headline":"Компиляция. 7: назначение регистров","datePublished":"2010-07-23T06:40:13+04:00","dateModified":"2010-07-23T06:40:13+04:00","author":{"@type":"Person","name":"Artyom Skrobov"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"File names are infinite in length, where infinity is set to 255 characters. --Peter Collinson: The Unix File System Итак, у нас есть программа на п-коде, и в её...","url":"https:\/\/habr.com\/ru\/post\/99595\/#post-content-body","about":["h_programming","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/99595\/4d13f5ce93437f5263b41d1b58873bed\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Компиляция. 7: назначение регистров" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Компиляция. 7: назначение регистров" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Компиляция. 7: назначение регистров" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="File names are infinite in length, where infinity is set to 255 characters.
--Peter Collinson: The Unix File System
Итак, у нас есть программа на п-коде, и в её распоряжении неограниченное..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="File names are infinite in length, where infinity is set to 255 characters.
--Peter Collinson: The Unix File System
Итак, у нас есть программа на п-коде, и в её распоряжении неограниченное..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="File names are infinite in length, where infinity is set to 255 characters.
--Peter Collinson: The Unix File System
Итак, у нас есть программа на п-коде, и в её распоряжении неограниченное..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="File names are infinite in length, where infinity is set to 255 characters.
--Peter Collinson: The Unix File System
Итак, у нас есть программа на п-коде, и в её распоряжении неограниченное..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="File names are infinite in length, where infinity is set to 255 characters.
--Peter Collinson: The Unix File System
Итак, у нас есть программа на п-коде, и в её распоряжении неограниченное..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/99595/4d13f5ce93437f5263b41d1b58873bed/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/99595/4d13f5ce93437f5263b41d1b58873bed/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/99595/4d13f5ce93437f5263b41d1b58873bed/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/99595/4d13f5ce93437f5263b41d1b58873bed/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/99595/4d13f5ce93437f5263b41d1b58873bed/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="99595" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2010-07-23T02:40:13.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/99595/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/99595/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/99595/4d13f5ce93437f5263b41d1b58873bed/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/tyomitch/" title="tyomitch" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/b71/804/e6d/b71804e6dcbec22ada05c488b7ee4c1b.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/tyomitch/" class="tm-user-info__username">
      tyomitch
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2010-07-23T02:40:13.000Z" title="2010-07-23, 06:40">23  июля  2010 в 06:40</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Компиляция. 7: назначение регистров</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/programming/" class="tm-article-snippet__hubs-item-link"><span>Программирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><blockquote>File names are infinite in length, where infinity is set to 255 characters.<br/>
<i>--Peter Collinson: The Unix File System</i></blockquote><br/>
Итак, у нас есть программа на п-коде, и в её распоряжении неограниченное количество регистров (т.е. 255). Число регистров у реального процессора куда меньше (предположим, четыре). Что будем делать?<br/>
<br/>
<h3>Далее в посте:</h3><ol>
<li>Разбор п-кода</li>
<li>Время жизни</li>
<li>Реализация</li>
<li>Простые оптимизации</li>
<li>Расщепление версий</li>
<li>Работа с памятью</li>
<li>Что получилось?</li>
</ol><a name="habracut"></a><h3>Разбор п-кода</h3><br/>
В прошлом посте был дамп скомпилированной программы. Её 40 команд несложно расшифровать: <pre>
00 mov   r01, 0
01 mov   r02, 0x3e8
02 echo  0x126
03 echo  r01
04 echo  0xa0
05 echo  r02
06 echo  0xa7
07 le    r03, r01, r02
08 jz    r03, +0x1d (=0x26)
09 add   r04, r01, r02
0a mov   r05, 2
0b div   r06, r04, r05
0c echo  0x162
0d echo  r06
0e echo  0xcc
0f input r07
10 mov   r08, 1
11 eq    r09, r07, r08
12 jz    r09, +4 (=0x17)
13 mov   r0a, 1
14 sub   r0b, r06, r0a
15 add   r02, r0b, 0
16 jz    0,   +e (=0x25)
17 mov   r0c, 2
18 eq    r0d, r07, r0c
19 jz    r0d, +4 (=0x1e)
1a mov   r0e, 1
1b add   r0f, r06, r0e
1c add   r01, r0f, 0
1d jz    0,   +7 (=0x25)
1e mov   r10, 3
1f eq    r11, r07, r10
20 jz    r11, +3 (=0x24)
21 echo  0x146
22 hlt
23 jz    0,   +1 (=0x25)
24 echo  0x16a
25 jz    0,   -0x1f (=7)
26 echo  0xff
27 hlt
</pre><br/>
Видно, что не все регистры используются одновременно: большинство хранят промежуточные значения, которые нужны только для следующей команды. Например, <code>r03</code> используется только в командах <code>07-08</code>, а <code>r0f</code> только в командах <code>1b-1c</code>. Значит, нет никаких препятствий задействовать для хранимых значений один и тот же физический регистр: в командах <code>07-08</code> он будет использоваться для одного значения, а в <code>1b-1c</code> — для другого. Любые два регистра, которые не используются <i>одновременно для разных значений</i>, можно объединить в один физический регистр.<br/>
<br/>
Есть небольшая тонкость по поводу определения «используются одновременно для разных значений». Во-первых, нельзя считать временем жизни регистра просто промежуток от его первого упоминания до последнего: код может содержать прыжки во все стороны, например: <pre>
   ...
10 mov  r, 42
11 jz   0, 20
12 echo r
   ...
20 ...
   ...
30 jz   0, 12
   ...
</pre><br/>
Даже хотя <code>r</code> упоминается только в командах 10-12, он неявно используется и в команде 20, потому что после неё возможен прыжок обратно на 12; и значит, <code>r</code> нельзя объединять с другими регистрами, используемыми в команде 20.<br/>
<br/>
Вторая тонкость: <pre>
   ...
10 mov  r, 42
11 echo r
   ...
20 ...
   ...
30 mov  r, 24
31 echo r
   ...
</pre><br/>
В команде 20 регистр <code>r</code> на самом деле не используется, хотя упоминается и перед этим (10-11), и после этого (30-31). Можем хранить в нём любые другие значения, потому что перед следующим использованием (31) значение ему будет присвоено по-новой. В принципе, мы даже можем назначить разные физические регистры для <code>r</code> в 10-11 и в 31-31, потому что значения всё равно будут храниться разные. Но для этого нужно обнаружить, что у <code>r</code> две независимые «версии», и обрабатывать их по-отдельности.<br/>
<br/>
<h3>Время жизни</h3><br/>
Определить набор команд, в которых регистр используется, можно итеративно:<br/>
<ul>
<li>регистр нужен команде, которая <i>читает</i> его значение;</li>
<li>если из команды A можно перейти на B (непосредственно или прыжком), и регистр нужен B, то он нужен и А;</li>
<li>регистр не нужен команде, которая <i>задаёт</i> его значение.</li>
</ul> Для каждой команды определяем набор регистров, которые нужны ей «на входе» и «на выходе», и применяем три правила до тех пор, пока эти наборы не установятся. Вот что получим для нашей программы:<pre>
             номер итерации: 1(вход/вых) 2(вход/выход)       3(вход/выход)       4(вход/выход)     ...    итог(вход/выход)
00 mov   r01, 0                                                                                                    /r01
01 mov   r02, 0x3e8                                                                    /r01                     r01/r01,r02
02 echo  0x126                                 /r01             r01/r01             r01/r01                 r01,r02/r01,r02
03 echo  r01                    r01/        r01/                r01/                r01/r02                 r01,r02/r01,r02
04 echo  0xa0                                  /r02             r02/r02             r02/r02                 r01,r02/r01,r02
05 echo  r02                    r02/        r02/                r02/                r02/r01,r02             r01,r02/r01,r02
06 echo  0xa7                                  /r01,r02     r01,r02/r01,r02     r01,r02/r01,r02             r01,r02/r01,r02
07 le    r03, r01, r02      r01,r02/    r01,r02/r03         r01,r02/r03         r01,r02/r01,r02,r03         r01,r02/r01,r02,r03
08 jz    r03, +0x1d (=0x26)     r03/        r03/r01,r02 r01,r02,r03/r01,r02 r01,r02,r03/r01,r02         r01,r02,r03/r01,r02
09 add   r04, r01, r02      r01,r02/    r01,r02/            r01,r02/            r01,r02/r04                 r01,r02/r01,r02,r04
0a mov   r05, 2                                /r04,r05         r04/r04,r05         r04/r04,r05         r01,r02,r04/r01,r02,r04,r05
0b div   r06, r04, r05      r04,r05/    r04,r05/            r04,r05/            r04,r05/r06         r01,r02,r04,r05/r01,r02,r06
0c echo  0x162                                 /r06             r06/r06             r06/r06             r01,r02,r06/r01,r02,r06
0d echo  r06                    r06/        r06/                r06/                r06/                r01,r02,r06/r01,r02,r06
0e echo  0xcc                                                                                           r01,r02,r06/r01,r02,r06
0f input r07                                                                           /r07             r01,r02,r06/r01,r02,r06,r07
10 mov   r08, 1                                /r07,r08         r07/r07,r08         r07/r07,r08     r01,r02,r06,r07/r01,r02,r06,r07,r08
11 eq    r09, r07, r08      r07,r08/    r07,r08/r09         r07,r08/r09         r07,r08/r09     r01,r02,r06,r07,r08/r01,r02,r06,r07,r09
12 jz    r09, +4 (=0x17)        r09/        r09/                r09/                r09/r06,r07 r01,r02,r06,r07,r09/r01,r02,r06,r07
13 mov   r0a, 1                                /r06,r0a         r06/r06,r0a         r06/r06,r0a             r01,r06/r01,r06,r0a
14 sub   r0b, r06, r0a      r06,r0a/    r06,r0a/r0b         r06,r0a/r0b         r06,r0a/r0b             r01,r06,r0a/r01,r0b
15 add   r02, r0b, 0            r0b/        r0b/                r0b/                r0b/                    r01,r0b/r01,r02
16 jz    0,   +e (=0x25)                                                                                    r01,r02/r01,r02
17 mov   r0c, 2                                /r07,r0c         r07/r07,r0c         r07/r07,r0c     r01,r02,r06,r07/r01,r02,r06,r07,r0c
18 eq    r0d, r07, r0c      r07,r0c/    r07,r0c/r0d         r07,r0c/r0d         r07,r0c/r0d     r01,r02,r06,r07,r0c/r01,r02,r06,r07,r0d
19 jz    r0d, +4 (=0x1e)        r0d/        r0d/                r0d/                r0d/r06,r07 r01,r02,r06,r07,r0d/r01,r02,r06,r07
1a mov   r0e, 1                                /r06,r0e         r06/r06,r0e         r06/r06,r0e             r02,r06/r02,r06,r0e
1b add   r0f, r06, r0e      r06,r0e/    r06,r0e/r0f         r06,r0e/r0f         r06,r0e/r0f             r02,r06,r0e/r02,r0f
1c add   r01, r0f, 0            r0f/        r0f/                r0f/                r0f/                    r02,r0f/r01,r02
1d jz    0,   +7 (=0x25)                                                               /r01,r02             r01,r02/r01,r02
1e mov   r10, 3                                /r07,r10         r07/r07,r10         r07/r07,r10         r01,r02,r07/r01,r02,r07,r10
1f eq    r11, r07, r10      r07,r10/    r07,r10/r11         r07,r10/r11         r07,r10/r11         r01,r02,r07,r10/r01,r02,r11
20 jz    r11, +3 (=0x24)        r11/        r11/                r11/                r11/                r01,r02,r11/r01,r02
21 echo  0x146
22 hlt
23 jz    0,   +1 (=0x25)                                                               /r01,r02             r01,r02/r01,r02
24 echo  0x16a                                                                         /r01,r02             r01,r02/r01,r02
25 jz    0,   -0x1f (=7)                       /r01,r02     r01,r02/r01,r02     r01,r02/r01,r02             r01,r02/r01,r02
26 echo  0xff
27 hlt
</pre>По поводу отдельных итераций:<ol>
<li>На входе каждой команды — используемые ей регистры; (правило №1)</li>
<li>На выход каждой команды копируем вход достижимых из неё команд; (правило №2)</li>
<li>На вход каждой команды копируем её выход, исключая записанный командой регистр; (правило №3)</li>
<li>На выход каждой команды копируем вход достижимых из неё команд; (правило №2)</li>
</ol>Далее правила №2 и №3 повторяются поочерёдно.<br/>
<br/>
После нескольких итераций получаем окончательную разметку «живучести регистров» — какие регистры нужны каждой команде. Тогда можем переименовывать регистры п-кода в физические — например, «по-жадному»: берём «самый нужный» регистр (нужный наибольшему количеством команд); переименовываем в физический, который ещё не занят в соответствующих командах; повторяем.<br/>
Оптимальный выбор, каким п-регистрам следует предоставить физические, чтобы хватило на как можно больше, — возможен только полным перебором: эта задача равносильна «раскраске графа в минимум цветов», про которую математики верят, что для неё не существует эффективного решения. Наше «жадное» приближение — не самое худшее из возможных.<br/>
<br/>
Что делать, если для очередного п-регистра не окажется свободного физического? Например, в нашем коде есть команды (10-12, 17-19), использующие по 5 п-регистров: как минимум одному из них места не хватит. Понятно, что придётся хранить его в памяти.<br/>
Но просто сказать регистру «тебе не повезло, ты будешь храниться в памяти» мало: ведь команды нашего п-кода не умеют работать со значениями из памяти, равно как и команды большинства реальных процессоров. Необходимо на время использования доставать значение из памяти в регистр. Только в какой? Ведь потому и убрали значение в память, что все регистры заняты!<br/>
<br/>
На этом месте выученная мной теория заканчивается, и идут догадки и эвристики. Я решил перед командой, на которую не хватает регистров, «выливать в память» лишние регистры, а после — читать их из памяти обратно. Тем самым, во «времени жизни» вылитых регистров появится дырка на месте этой команды, и в этой дырке сможем использовать освободившиеся регистры для других целей.<br/>
<br/>
Чтобы можно было «раздвигать» код и вставлять в него команды чтения/записи в память, придётся чуточку поменять промежуточный формат: теперь это будет связанный список, и цель прыжка будет храниться не как смещение, а как указатель (превращая список в орграф). Во время генерации п-кода, для <a href="http://habrahabr.ru/blogs/programming/99592/">бэкпатчинга</a> нам понадобится обращаться к командам и по индексу; для этого заведём отдельный вектор смещений.<br/>
<code>    <font color="#008000">typedef</font> std::list&lt;<font color="#008000">struct</font> commandn>::iterator pcommandn;<br/>
    <font color="#008000">struct</font> commandn {<br/>
        command cmd;<br/>
        pcommandn tgt; <font color="#8080ff">// цель прыжка</font><br/>
        commandn(<font color="#008000">const</font> command&amp; cmd) : cmd(cmd), tgt(<font color="#ff6060">NULL</font>) {}<br/>
    };<br/>
<br/>
    std::list&lt;commandn> pcode;<br/>
    std::vector&lt;pcommandn> pcodeidx;<br/>
<br/>
    <font color="#008000">inline</font> <font color="#008000">int</font> emit(<font color="#008000">const</font> command&amp; cmd) {<br/>
        pcodeidx.push_back(pcode.insert(pcode.end(), commandn(cmd)));<br/>
        <font color="#800000">return</font> pcode.size()-<font color="#ff6060">1</font>;<br/>
    }<br/>
    <font color="#008000">inline</font> <font color="#008000">int</font> emit(command::opcodes opcode, regnum dest, regnum src1, regnum src2) {<br/>
        <font color="#800000">return</font> emit(command(opcode, dest, src1, src2));<br/>
    }<br/>
    <font color="#008000">inline</font> <font color="#008000">int</font> emit(command::opcodes opcode, regnum dest, <font color="#008000">short</font> imm) {<br/>
        <font color="#800000">return</font> emit(command(opcode, dest, imm));<br/>
    }<br/>
    <font color="#008000">inline</font> <font color="#008000">void</font> fix(<font color="#008000">int</font> index, command::opcodes opcode, regnum dest, <font color="#008000">short</font> imm) {<br/>
        *pcodeidx[index] = commandn(command(opcode, dest, imm));<br/>
    }<br/>
</code><br/>
Указатели на цель прыжка сложно заполнять во время генерации п-кода: в момент создания прыжков уже известен индекс цели, но ещё неизвестно, какая там будет стоять команда; ставить указатель на ещё не созданную команду проблематично. Поэтому после конца разбора и генерации п-кода обойдём сгенерированный код, и расставим указатели прыжков; потом выполним всю нужную работу с распределением регистров; и в конце, перед дампом p-кода в файл, нужно будет его «сериализовать» — определить окончательный индекс каждой команды, и заполнить смещения прыжков. Ради этого, добавим в <code>struct commandn</code> поле <code>int index;</code><br/>
<br/>
<code><font color="#008000">int</font> main() {<br/>
    yyparse();<br/>
    <font color="#8080ff">// расставить цели прыжков</font><br/>
    <font color="#800000">for</font>(<font color="#008000">int</font> i=<font color="#ff6060">0</font>; i&lt;pcode.size(); i++)<br/>
       <font color="#800000">if</font>(pcodeidx[i]->cmd.opcode==command::jz)<br/>
            pcodeidx[i]->tgt = pcodeidx[i+<font color="#ff6060">1</font>+pcodeidx[i]->cmd.imm];<br/>
<br/>
    <font color="#8080ff">// обработка / оптимизация</font><br/>
    <font color="#8080ff">// ...</font><br/>
<br/>
    <font color="#8080ff">// сериализация / расстановка смещений</font><br/>
    <font color="#008000">int</font> index = <font color="#ff6060">0</font>;<br/>
    foreach(i, pcode) i->index = index++;<br/>
    foreach(i, pcode)<br/>
        <font color="#800000">if</font> (i->cmd.opcode==command::jz)<br/>
            i->cmd.imm = i->tgt->index-i->index-<font color="#ff6060">1</font>;<br/>
<br/>
    <font color="#8080ff">// запись п-кода в файл</font><br/>
    <font color="#8080ff">// ...</font><br/>
}<br/>
</code><br/>
Дело за малым: реализовать «обработку / оптимизацию». Займёт она, как и можно ожидать, большую часть всего кода компилятора.<br/>
<br/>
<h3>Реализация</h3><br/>
Для назначения регистров будем хранить для каждой команды (прямо в <code>struct commandn</code>) множества живых на входе и на выходе регистров: отдельно — регистров п-кода, для определения времени жизни; и отдельно — физических регистров, для определения сочетаемости при собственно назначении.<br/>
<code>    <font color="#008000">typedef</font> std::set&lt;regnum> aliveset;<br/>
    <font color="#008000">enum</font> physreg { firstp = <font color="#ff6060">1</font>, lastp = <font color="#ff6060">4</font> };<br/>
    <font color="#008000">typedef</font> std::set&lt;physreg> alivesetp;<br/>
    <font color="#008000">struct</font> commandn {<br/>
        <font color="#8080ff">// ...</font><br/>
        aliveset onenter, onexit;       <font color="#8080ff">// liveness check</font><br/>
        alivesetp onenterp, onexitp;    <font color="#8080ff">// phys reg allocation</font><br/>
        <font color="#8080ff">// ...</font><br/>
    };<br/>
</code><br/>
Ещё одна полезная вещь — определение по опкоду, какие регистры используются командой:<br/>
<code>    <font color="#008000">inline</font> <font color="#008000">bool</font> hasnext(pcommandn cmd) {<br/>
        <font color="#800000">return</font> (cmd->cmd.opcode!=command::hlt &amp;&amp;!<br/>
                (cmd->cmd.opcode==command::jz &amp;&amp; !cmd->cmd.dest));<br/>
    }<br/>
    <font color="#008000">inline</font> <font color="#008000">bool</font> has2src(pcommandn cmd) {<br/>
        <font color="#800000">return</font> cmd->cmd.opcode>=command::add;<br/>
    }<br/>
    <font color="#008000">inline</font> <font color="#008000">bool</font> writesdest(pcommandn cmd) {<br/>
        <font color="#800000">return</font> cmd->cmd.opcode>=command::mov;<br/>
    }<br/>
    <font color="#008000">inline</font> <font color="#008000">bool</font> readsdest(pcommandn cmd) {<br/>
        <font color="#800000">return</font> cmd->cmd.opcode>=command::store &amp;&amp;<br/>
                cmd->cmd.opcode&lt;=command::echo;<br/>
    }<br/>
</code><br/>
После этого, по приведённой выше схеме, рассчитываем для каждой команды множество нужных на входе и на выходе регистров; заодно считаем, сколько раз нужен каждый регистр, для жадного назначения.<br/>
<code>std::vector&lt;<font color="#008000">int</font>> liveness() { <font color="#8080ff">// returns usecount</font><br/>
    std::vector&lt;<font color="#008000">int</font>> usecount(lastreg+<font color="#ff6060">1</font>);<br/>
    <font color="#008000">bool</font> changed = <font color="#ff6060">false</font>;<br/>
    <font color="#8080ff">// rule 1</font><br/>
    foreach(i, pcode) {<br/>
        i->onenter = i->onexit = aliveset();<br/>
        <font color="#800000">if</font> (has2src(i)) {<br/>
            <font color="#800000">if</font> (i->cmd.src1) {<br/>
                usecount[i->cmd.src1]++;<br/>
                i->onenter.insert(i->cmd.src1);<br/>
            }<br/>
            <font color="#800000">if</font> (i->cmd.src2) {<br/>
                usecount[i->cmd.src2]++;<br/>
                i->onenter.insert(i->cmd.src2);<br/>
            }<br/>
        } <font color="#800000">else</font> <font color="#800000">if</font> (readsdest(i) &amp;&amp; i->cmd.dest) {<br/>
            usecount[i->cmd.dest]++;<br/>
            i->onenter.insert(i->cmd.dest);<br/>
        }<br/>
        <font color="#800000">if</font> (i->onenter.size())<br/>
            changed = <font color="#ff6060">true</font>;<br/>
    }<br/>
    <font color="#800000">while</font> (changed) {<br/>
        changed = <font color="#ff6060">false</font>;<br/>
        foreach2(i, pcode, next) {<br/>
            <font color="#008000">int</font> oldsize = i->onenter.size()+i->onexit.size();<br/>
            <font color="#8080ff">// rule 2 (next command)</font><br/>
            <font color="#800000">if</font> (hasnext(i))<br/>
                i->onexit.insert(next->onenter.begin(), next->onenter.end());<br/>
            <font color="#8080ff">// rule 2 (jmp target)</font><br/>
            <font color="#800000">if</font> (i->cmd.opcode==command::jz)<br/>
                i->onexit.insert(i->tgt->onenter.begin(), i->tgt->onenter.end());<br/>
            <font color="#8080ff">// rule 3</font><br/>
            i->onenter.insert(i->onexit.begin(), i->onexit.end());<br/>
            <font color="#800000">if</font> (writesdest(i))<br/>
                i->onenter.erase(i->cmd.dest);<br/>
<br/>
            <font color="#800000">if</font> (i->onenter.size()+i->onexit.size() != oldsize)<br/>
                changed = <font color="#ff6060">true</font>;<br/>
        }<br/>
    }<br/>
    <font color="#800000">return</font> usecount;<br/>
}<br/>
</code><br/>
Использованный макрос <code>foreach2</code> позволяет в теле цикла смотреть и на текущий, и на следующий за ним элемент:<br/>
<code><font color="#ff40ff">#define foreach2(i, list, next) </font><font color="#008000">typedef</font><font color="#ff40ff"> typeof(list) TOKENPASTE2(T,</font><font color="#ff6060">__LINE__</font><font color="#ff40ff">); \</font><br/>
<font color="#ff40ff">        </font><font color="#800000">for</font><font color="#ff40ff">(TOKENPASTE2(T,</font><font color="#ff6060">__LINE__</font><font color="#ff40ff">)::iterator next = list.begin(), i=next++; i != list.end(); i=next, next++)</font><br/>
</code><br/>
В принципе, можно было сократить общее число итераций, если обходить команды не «сверху вниз», а «снизу вверх», потому что нужность «распространяется» от каждой команды к предыдущим; обход «сверху вниз» выбран ради упрощения кода. В самом худшем случае, для кода длиной <i>N</i> команд потребуется 2<i>N</i> итераций (на каждой итерации нужность распространяется на расстояние полкоманды). Для <code>test.jsk</code> хватило 35 итераций, потому что прыжки сокращают расстояния.<br/>
<br/>
Наконец, то, зачем мы всё это делали:<br/>
<code>    <font color="#8080ff">// обработка / оптимизация:</font><br/>
    <font color="#800000">while</font>(<font color="#ff6060">1</font>) { <font color="#8080ff">// пока все регистры не уложатся в физические</font><br/>
<br/>
        <font color="#8080ff">// предварительная обработка</font><br/>
        <font color="#8080ff">// ...</font><br/>
<br/>
        std::vector&lt;<font color="#008000">int</font>> usecount = liveness();<br/>
        std::vector&lt;physreg> physmap(lastreg+<font color="#ff6060">1</font>);<br/>
        foreach(i, pcode)<br/>
            i->onenterp = i->onexitp = alivesetp();<br/>
        <font color="#800000">while</font>(<font color="#ff6060">1</font>) {<br/>
            <font color="#8080ff">// самый нужный регистр</font><br/>
            std::vector&lt;<font color="#008000">int</font>>::iterator max = std::max_element(usecount.begin(), usecount.end());<br/>
            <font color="#800000">if</font> (!*max) <font color="#800000">break</font>; <font color="#8080ff">// все регистры размещены</font><br/>
            *max = <font color="#ff6060">0</font>;<br/>
            regnum r = max - usecount.begin();<br/>
            <font color="#8080ff">// поищем физ. регистр для п-регистра №r</font><br/>
            std::vector&lt;<font color="#008000">int</font>> collisions(lastp); <font color="#8080ff">// 0-based</font><br/>
            <font color="#800000">for</font> (physreg p=firstp; p&lt;=lastp; p=(physreg)(p+<font color="#ff6060">1</font>)) { <font color="#8080ff">// error: ISO C++ forbids incrementing an enum</font><br/>
                foreach(i, pcode) {<br/>
                    <font color="#800000">if</font> (contains(i->onenter, r) &amp;&amp; contains(i->onenterp, p))<br/>
                        collisions[p-<font color="#ff6060">1</font>]++;<br/>
                    <font color="#800000">if</font> (contains(i->onexit, r) &amp;&amp; contains(i->onexitp, p))<br/>
                        collisions[p-<font color="#ff6060">1</font>]++;<br/>
                }<br/>
                <font color="#800000">if</font> (collisions[p-<font color="#ff6060">1</font>]) <font color="#800000">continue</font>; <font color="#8080ff">// попробовать другой физ. рег</font><br/>
                physmap[r] = p;<br/>
                <font color="#8080ff">// разместили п-регистр №r в физическом №p</font><br/>
                foreach(i, pcode) {<br/>
                    <font color="#800000">if</font> (contains(i->onenter, r))<br/>
                        i->onenterp.insert(p);<br/>
                    <font color="#800000">if</font> (contains(i->onexit, r))<br/>
                        i->onexitp.insert(p);<br/>
                }<br/>
                <font color="#800000">break</font>; <font color="#8080ff">// успешное назначение</font><br/>
            }<br/>
            <font color="#800000">if</font> (physmap[r]) <font color="#800000">continue</font>; <font color="#8080ff">// нашлось куда разместить</font><br/>
            <font color="#8080ff">// не хватило физ. регистра для п-регистра №r</font><br/>
            <font color="#8080ff">// эвристика: найдём команду, в которой не хватает регистров</font><br/>
            foreach2(i, pcode, next)<br/>
                <font color="#800000">if</font> ((i->cmd.opcode!=command::load &amp;&amp; i->cmd.opcode!=command::store) &amp;&amp;<br/>
                        ((contains(i->onenter, r) &amp;&amp; i->onenterp.size()==lastp) ||<br/>
                         (contains(i->onexit, r) &amp;&amp; i->onexitp.size()==lastp))) {<br/>
                    <font color="#8080ff">// найдём, какой регистр можно вылить, и выльем</font><br/>
                    <font color="#8080ff">// ...</font><br/>
                    <font color="#800000">goto</font> afterspill;<br/>
                }<br/>
            <font color="#8080ff">// эвристика не сработала: что же делать?</font><br/>
            yyerror(<font color="#ff6060">"don't know how to proceed"</font>);<br/>
        }<br/>
        <font color="#8080ff">// все регистры размещены; переименовываем</font><br/>
        foreach(i, pcode) {<br/>
            i->cmd.dest = physmap[i->cmd.dest];<br/>
            <font color="#800000">if</font> (has2src(i)) {<br/>
                i->cmd.src1 = physmap[i->cmd.src1];<br/>
                i->cmd.src2 = physmap[i->cmd.src2];<br/>
            }<br/>
        }<br/>
        <font color="#800000">break</font>;<br/>
<br/>
<font color="#800000">afterspill</font>: <font color="#8080ff">// пост-обработка после "выливания регистра"</font><br/>
    }<br/>
</code><br/>
Ещё не углубляясь в то, как именно мы выливаем регистр, стоит упомянуть, что у приведённого кода масса проблем. Во-первых, эвристика работает только в самых простых случаях; чаще встречаются ситуации навроде <pre>
   ...
10 нужны r1,r2,r3,r4
   ...
20 нужны r1,r3,r4,r5
   ...
30 нужны r2,r3,r4,r5
   ...
</pre>Регистру <code>r5</code> не хватает физического, потому что все физические израсходовались на <code>r1,r2,r3,r4</code>; но нет ни одной команды, где все пять регистров нужны одновременно.<br/>
<br/>
Более жёсткая проблема — что каждый вылив засоряет программу бесполезными парами <code>store/load</code>, и их нужно вычищать — иначе используемые в них регистры создают достаточно «шума», чтоб регистров не хватило больше ни на что.<br/>
<br/>
Ещё одна идея: дырка во времени жизни, образовавшаяся из-за вылива, может разделить исходный п-регистр на две независимых «версии», которые можно размещать в разных физических регистрах. Ради гибкости нашей системы, стоит реализовать расщепление версий: тогда с каждой итерацией внешнего цикла времена жизни регистров будут сокращаться, и распределять им физические будет становиться всё проще и проще.<br/>
<br/>
И, раз уж мы пошли удалять лишние <code>load</code> и <code>store</code>, удалим заодно и прочие лишние команды. Учитывая, что у операций нашего п-кода нет других побочных эффектов, кроме вычисления регистра с результатом, — можно удалять команды, результат которых не жив на выходе. Может быть, программист присвоил значение неиспользуемой переменной, или употребил оператор наподобие <code>(2+2);</code><br/>
Удаляем всё подряд — так удалим до кучи недостижимый код (например, jz после hlt), и сожмём цепочки прыжков (заменим прыжок на прыжок одним прыжком).<br/>
<br/>
Для удаления команды, чтобы не искать и не исправлять все прыжки на неё, удобно заменить её на <code>nop</code>; в качестве него назначим безусловный прыжок на следующую команду (<code>jz r00, +0</code>). Выгода в том, что на следующей итерации прыжок на <code>nop</code> сожмётся по цепочке, и сам <code>nop</code> вычистится как недостижимая команда.<br/>
<br/>
<h3>Простые оптимизации</h3><br/>
Для обнаружения недостижимых команд пользуемся обходом в глубину; чтобы следить, какие команды уже обошли, в <code>struct commandn</code> добавляем новое поле <code>int reachcnt;</code><br/>
Нам хватило бы и булева поля; но «степень захода» каждой команды, может статься, ещё пригодится когда-нибудь потом.<br/>
<code><font color="#008000">void</font> markReachable(pcommandn cmd) {<br/>
    <font color="#808000">while</font>(!cmd->reachcnt++) {<br/>
        <font color="#808000">if</font> (cmd->cmd.opcode==command::jz)<br/>
            markReachable(cmd->tgt);<br/>
        <font color="#808000">if</font> (hasnext(cmd))<br/>
            cmd++;<br/>
        <font color="#808000">else</font><br/>
            <font color="#808000">break</font>;<br/>
    }<br/>
}<br/>
<br/>
<font color="#008000">void</font> nopOut(pcommandn cmd) {<br/>
    pcommandn next = cmd; next++;<br/>
    cmd->cmd = command(command::jz, <font color="#ff6060">0</font>,<font color="#ff6060">0</font>);<br/>
    cmd->tgt = next;<br/>
}<br/>
<br/>
<font color="#008000">void</font> simpleopt() {<br/>
    <font color="#8080ff">// сжать цепочки прыжков</font><br/>
    foreach(i, pcode)<br/>
        <font color="#808000">if</font>(i->cmd.opcode==command::jz)<br/>
            <font color="#808000">while</font>(i->tgt->cmd.opcode==command::jz &amp;&amp; !i->tgt->cmd.dest)<br/>
                i->tgt = i->tgt->tgt;<br/>
    <font color="#8080ff">// удалить недостижимый код</font><br/>
    foreach(i, pcode) i->reachcnt = <font color="#ff6060">0</font>;<br/>
    markReachable(pcode.begin());<br/>
    foreach2(i, pcode, next)<br/>
        <font color="#808000">if</font>(!i->reachcnt)<br/>
            pcode.erase(i);<br/>
    <font color="#8080ff">// удалить все nop: уже не могут быть целью прыжка</font><br/>
    foreach2(i, pcode, next)<br/>
        <font color="#808000">if</font>(i->cmd.opcode==command::jz &amp;&amp;<br/>
                !i->cmd.dest &amp;&amp; i->tgt==next)<br/>
            pcode.erase(i);<br/>
}<br/>
<br/>
    <font color="#8080ff">// предварительная обработка в цикле назначения регистров:</font><br/>
    simpleopt();<br/>
    <font color="#8080ff">// удалить команды с неживым результатом</font><br/>
    liveness();<br/>
    <font color="#008000">bool</font> changed = <font color="#ff6060">false</font>;<br/>
    foreach(i, pcode)<br/>
        <font color="#808000">if</font>(writesdest(i) &amp;&amp; !contains(i->onexit, i->cmd.dest)) {<br/>
            nopOut(i);<br/>
            changed = <font color="#ff6060">true</font>;<br/>
        }<br/>
    <font color="#808000">if</font> (changed) <font color="#808000">continue</font>;<br/>
    <font color="#8080ff">// расщепление версий</font><br/>
    <font color="#8080ff">// ...</font><br/>
</code><br/>
<br/>
<h3>Расщепление версий</h3><br/>
Если в «интервале нужности» регистра есть разрыв, т.е. значение из одного набора команд никогда не проникает в другой набор, — значит, регистр можно «расщепить» на пару регистров с более короткими временами жизни.<br/>
Для выделения безразрывных фрагментов из времён жизни пригодится ещё один графовый алгоритм: поиск компонент связности.<br/>
Стремимся больше к ясности кода, чем к его эффективности; поэтому у нас пвг внутри пвг, и слияние компонент выполняется обходом всего графа.<br/>
<br/>
В <code>struct commandn</code> потребуется ещё одно поле, последнее на сегодня: <code>std::map&lt;regnum,regnum> version;</code><br/>
В нём будем хранить для каждой команды соответствия «п-регистр -> номер версии».<br/>
Если регистр в команде используется, а соответствия в <code>version</code> ещё нет — значит, обход до этой команды ещё не дошёл.<br/>
Для внешнего же пвг, чтобы не заводить новое поле, пользуемся тем же <code>reachcnt</code>, что и в <code>markReachable()</code><br/>
<code>std::map&lt;regnum,regnum> renameto;       <font color="#8080ff">// для слияния компонент</font><br/>
<br/>
<font color="#008000">void</font> versionizeReg(pcommandn cmd, regnum r, regnum rv) <font color="#ff40ff">{</font> <font color="#8080ff">// переименовать r в rv во всей компоненте</font><br/>
    <font color="#808000">while</font>(!contains(cmd-<font color="#808000">></font>version, r) &amp;&amp;<br/>
            (contains(cmd-<font color="#808000">></font>onenter, r) || contains(cmd-<font color="#808000">></font>onexit, r))) <font color="#ff40ff">{</font><br/>
        <font color="#8080ff">// переименование</font><br/>
        cmd-<font color="#808000">></font>version[r] = renameto[rv];<br/>
        <font color="#808000">if</font> (cmd-<font color="#808000">></font>cmd.dest==r) cmd-<font color="#808000">></font>cmd.dest=renameto[rv];<br/>
        <font color="#808000">if</font> (has2src(cmd)) <font color="#ff40ff">{</font><br/>
            <font color="#808000">if</font> (cmd-<font color="#808000">></font>cmd.src1==r) cmd-<font color="#808000">></font>cmd.src<font color="#ff6060">1</font>=renameto[rv];<br/>
            <font color="#808000">if</font> (cmd-<font color="#808000">></font>cmd.src2==r) cmd-<font color="#808000">></font>cmd.src<font color="#ff6060">2</font>=renameto[rv];<br/>
        <font color="#ff40ff">}</font><br/>
        <font color="#808000">if</font> (!contains(cmd-<font color="#808000">></font>onexit,r)) <font color="#808000">return</font>; <font color="#8080ff">// больше не живой</font><br/>
        <font color="#808000">if</font> (cmd-<font color="#808000">></font>cmd.opcode==command::jz &amp;&amp;<br/>
                contains(cmd-<font color="#808000">></font>tgt-<font color="#808000">></font>onenter, r)) <font color="#ff40ff">{</font><br/>
            versionizeReg(cmd-<font color="#808000">></font>tgt, r, rv);<br/>
        <font color="#ff40ff">}</font><br/>
        <font color="#808000">if</font> (hasnext(cmd)) <font color="#ff40ff">{</font><br/>
            cmd++;<br/>
            <font color="#808000">if</font> (contains(cmd-<font color="#808000">></font>onenter, r))<br/>
                <font color="#808000">continue</font>;<br/>
        <font color="#ff40ff">}</font><br/>
        <font color="#808000">return</font>; <font color="#8080ff">// зашли в тупик</font><br/>
    <font color="#ff40ff">}</font><br/>
    <font color="#8080ff">// натолкнулись на другую версию?</font><br/>
    <font color="#808000">if</font>(contains(cmd-<font color="#808000">></font>version, r) &amp;&amp; cmd-<font color="#808000">></font>version[r]!=renameto[rv]) <font color="#ff40ff">{</font><br/>
        <font color="#8080ff">// слить renameto[rv] и cmd->version[r]</font><br/>
        regnum from = std::max(cmd-<font color="#808000">></font>version[r], renameto[rv]),<br/>
               to = std::min(cmd-<font color="#808000">></font>version[r], renameto[rv]);<br/>
        renameto[from] = to;<br/>
        foreach(i, pcode) <font color="#ff40ff">{</font><br/>
            <font color="#808000">if</font> (i-<font color="#808000">></font>cmd.dest==from) i-<font color="#808000">></font>cmd.dest = to;<br/>
            <font color="#808000">if</font> (has2src(i)) <font color="#ff40ff">{</font><br/>
                <font color="#808000">if</font> (i-<font color="#808000">></font>cmd.src1==from) i-<font color="#808000">></font>cmd.src<font color="#ff6060">1</font> = to;<br/>
                <font color="#808000">if</font> (i-<font color="#808000">></font>cmd.src2==from) i-<font color="#808000">></font>cmd.src<font color="#ff6060">2</font> = to;<br/>
            <font color="#ff40ff">}</font><br/>
            <font color="#808000">if</font>(contains(i-<font color="#808000">></font>version, r) &amp;&amp; i-<font color="#808000">></font>version[r]==from)<br/>
                i-<font color="#808000">></font>version[r] = to;<br/>
        <font color="#ff40ff">}</font><br/>
    <font color="#ff40ff">}</font><br/>
<font color="#ff40ff">}</font><br/>
<br/>
<font color="#008000">void</font> versionize(pcommandn cmd) <font color="#ff40ff">{</font><br/>
    <font color="#808000">while</font>(!cmd-<font color="#808000">></font>reachcnt++) <font color="#ff40ff">{</font><br/>
        <font color="#8080ff">// versionize registers that live on exit</font><br/>
        foreach(r, cmd-<font color="#808000">></font>onexit)<br/>
            <font color="#808000">if</font>(!contains(cmd-<font color="#808000">></font>version, *r)) <font color="#ff40ff">{</font><br/>
                regnum rv = newreg();<br/>
                renameto[rv] = rv;<br/>
                versionizeReg(cmd, *r, rv);<br/>
            <font color="#ff40ff">}</font><br/>
        <font color="#808000">if</font> (cmd-<font color="#808000">></font>cmd.opcode==command::jz)<br/>
            versionize(cmd-<font color="#808000">></font>tgt);<br/>
        <font color="#808000">if</font> (hasnext(cmd))<br/>
            cmd++;<br/>
        <font color="#808000">else</font><br/>
            <font color="#808000">break</font>;<br/>
    <font color="#ff40ff">}</font><br/>
<font color="#ff40ff">}</font><br/>
<br/>
    <font color="#8080ff">// расщепление версий:</font><br/>
    foreach(i, pcode) <font color="#ff40ff">{</font><br/>
        i-<font color="#808000">></font>version.clear();<br/>
        i-<font color="#808000">></font>reachcnt = <font color="#ff6060">0</font>;<br/>
    <font color="#ff40ff">}</font><br/>
    renameto.clear();<br/>
    <font color="#008000">int</font> lastbasereg = lastreg;<br/>
    versionize(pcode.begin());<br/>
    <font color="#8080ff">// переименовать версии, чтоб начинались с 1</font><br/>
    foreach(i, pcode) <font color="#ff40ff">{</font><br/>
        <font color="#808000">if</font> (i-<font color="#808000">></font>cmd.dest) i-<font color="#808000">></font>cmd.dest-=lastbasereg;<br/>
        <font color="#808000">if</font> (has2src(i)) <font color="#ff40ff">{</font><br/>
            <font color="#808000">if</font> (i-<font color="#808000">></font>cmd.src1) i-<font color="#808000">></font>cmd.src<font color="#ff6060">1</font>-=lastbasereg;<br/>
            <font color="#808000">if</font> (i-<font color="#808000">></font>cmd.src2) i-<font color="#808000">></font>cmd.src<font color="#ff6060">2</font>-=lastbasereg;<br/>
        <font color="#ff40ff">}</font><br/>
    <font color="#ff40ff">}</font><br/>
    lastreg -= lastbasereg;<br/>
</code><br/>
Осталось реализовать собственно вылив регистра. Конкретизируем эвристику: вылить можно любой регистр, который жив, но командой не используется.<br/>
<code>regnum spillable(pcommandn cmd) { <font color="#8080ff">// найти регистр, который можно вылить</font><br/>
    aliveset alive;<br/>
    alive.insert(cmd->onenter.begin(), cmd->onenter.end());<br/>
    alive.insert(cmd->onexit.begin(), cmd->onexit.end());<br/>
    alive.erase(cmd->cmd.dest);<br/>
    <font color="#808000">if</font> (has2src(cmd)) {<br/>
        alive.erase(cmd->cmd.src1);<br/>
        alive.erase(cmd->cmd.src2);<br/>
    }<br/>
    <font color="#808000">if</font> (!alive.size()) <font color="#808000">return</font> <font color="#ff6060">0</font>;<br/>
    <font color="#808000">return</font> *alive.begin();<br/>
}<br/>
</code><br/>
В отдельном <code>map</code> будем хранить по номеру регистра «адрес» его копии в памяти, чтобы все выливы регистра попадали в одно и то же место. Адрес присваивается регистру лишь в момент первого вылива.<br/>
<code><font color="#8080ff">// spill slots</font><br/>
std::map&lt;regnum,<font color="#008000">int</font>> spill;<br/>
<font color="#008000">int</font> lastspill = <font color="#ff6060">0</font>;<br/>
<br/>
<font color="#008000">void</font> spillAt(pcommandn cmd, regnum victim, pcommandn next) {<br/>
    <font color="#8080ff">// найти / выделить слот</font><br/>
    <font color="#008000">int</font> spslot = spill[victim];<br/>
    <font color="#808000">if</font>(!spslot) {<br/>
        spslot = ++lastspill;<br/>
        spill[victim] = spslot;<br/>
    }<br/>
    <font color="#8080ff">// вставить store перед и load после</font><br/>
    pcommandn me = pcode.insert(next, *cmd);<br/>
    cmd->cmd = command(command::store, victim, spslot);<br/>
    commandn load(command(command::load, victim, spslot));<br/>
    <font color="#808000">if</font>(hasnext(me))<br/>
        pcode.insert(next, load);<br/>
    <font color="#808000">if</font>(me->cmd.opcode==command::jz)<br/>
        me->tgt = pcode.insert(me->tgt, load);<br/>
}<br/>
</code><br/>
Поскольку команда заменяется тройкой <code>store-cmd-load</code>, нужно, чтобы существующие прыжки на команду прыгали на вставленный перед ней <code>store</code>. Чтобы не искать такие прыжки по всему коду, мы вставляем <i>следующей</i> командой копию <code>cmd</code>, а потом <i>оригинал</i> команды заменяем на <code>store</code>.<br/>
Аналогично, если команда — условный переход, то нужно, чтобы <code>load</code> выполнился при обоих исходах; поэтому и добавим его следующей командой, и вставим перед целью прыжка.<br/>
<br/>
(Немного досадно, что из-за возможности переезда команд из одного <code>commandn</code> в другой нам придётся связывать строки для <code>echo</code> с самими командами по «идентификатору», как и в первой древесной реализации: ни индексы команд, ни указатели не остаются неизменными.)<br/>
<br/>
Вторая эвристика: если не удалось найти команду, в которой заняты все физические регистры, то возьмём тот физический регистр, который «лучше всего подходит» (меньше всего коллизий с уже назначенными регистрами), и попытаемся освободить его всюду, где он нужен, но занят.<br/>
<code>    <font color="#8080ff">// не хватило физ. регистра для п-регистра №r</font><br/>
    regnum victim;<br/>
    <font color="#8080ff">// эвристика 1: найдём команду, в которой не хватает регистров</font><br/>
    foreach2(i, pcode, next)<br/>
        <font color="#808000">if</font> ((i->cmd.opcode!=command::load &amp;&amp; i->cmd.opcode!=command::store) &amp;&amp;<br/>
                ((contains(i->onenter, r) &amp;&amp; i->onenterp.size()==lastp) ||<br/>
                 (contains(i->onexit, r) &amp;&amp; i->onexitp.size()==lastp))) {<br/>
            victim = spillable(i);<br/>
            assert(victim);<br/>
            spillAt(i, victim, next);<br/>
            <font color="#808000">goto</font> afterspill;<br/>
        }<br/>
    <font color="#8080ff">// эвристика 2: найдём "самый подходящий" регистр</font><br/>
    physreg bestfit = (physreg)(std::max_element(collisions.begin(), collisions.end())-collisions.begin()+<font color="#ff6060">1</font>);<br/>
    foreach2(i, pcode, next)<br/>
        <font color="#808000">if</font> ((i->cmd.opcode!=command::load &amp;&amp; i->cmd.opcode!=command::store) &amp;&amp;<br/>
                ((contains(i->onenter, r) &amp;&amp; contains(i->onenterp, bestfit)) ||<br/>
                 (contains(i->onexit, r) &amp;&amp; contains(i->onexitp, bestfit))) &amp;&amp;<br/>
                (victim = spillable(i))) {<br/>
            spillAt(i, victim, next);<br/>
            <font color="#808000">goto</font> afterspill;<br/>
        }<br/>
    yyerror(<font color="#ff6060">"don't know how to proceed"</font>);<br/>
</code><br/>
При расщеплении версий нужно не забыть скопировать номер слота (все версии одного регистра хранятся в одном слоте), а потом, при переименовании версий, — не забыть обновить <code>spill</code>.<br/>
<br/>
Компилятор уже почти работает; последняя проблема — что генерируется куча бесполезных <code>load</code> и <code>store</code>, и из-за них не остаётся регистров на осмысленные команды.<br/>
<br/>
<h3>Работа с памятью</h3><br/>
Во-первых, может оказаться, что некоторые регистры используются исключительно в командах <code>load/store</code><br/>
Такие команды бесполезны: регистр записывается всегда в тот же слот, из которого был прочитан.<br/>
Вставим чистку после расщепления версий: там у нас как раз должно получиться много регистров с коротким временем жизни.<br/>
<code>    <font color="#8080ff">// вычистить бессмысленные регистры</font><br/>
    std::vector&lt;<font color="#008000">bool</font>> used(lastreg+<font color="#ff6060">1</font>);<br/>
    foreach(i, pcode) {<br/>
        <font color="#808000">if</font> (writesdest(i) &amp;&amp; i->cmd.opcode!=command::load)<br/>
            used[i->cmd.dest] = <font color="#ff6060">true</font>;<br/>
        <font color="#808000">if</font> (readsdest(i) &amp;&amp; i->cmd.opcode!=command::store)<br/>
            used[i->cmd.dest] = <font color="#ff6060">true</font>;<br/>
        <font color="#808000">if</font> (has2src(i)) {<br/>
            used[i->cmd.src1] = <font color="#ff6060">true</font>;<br/>
            used[i->cmd.src2] = <font color="#ff6060">true</font>;<br/>
        }<br/>
    }<br/>
    foreach(i, pcode)<br/>
        <font color="#808000">if</font> ((i->cmd.opcode==command::load &amp;&amp; !used[i->cmd.dest]) ||<br/>
            (i->cmd.opcode==command::store &amp;&amp; !used[i->cmd.dest]))<br/>
                nopOut(i);<br/>
</code><br/>
Во-вторых, если у нас есть цепочки одинаковых <code>load</code>, то все, кроме последней, удалятся за то, что прочитанный регистр не жив. А вот если у нас цепочки одинаковых <code>store</code>, то для их удаления нужно придумать нечто новое. Алгоритм очень похож на итеративное определение нужности регистров, только теперь определяем «несохранённость» — чтобы вычистить все сохранения уже сохранённых регистров.<ul>
<li>регистр не сохранён в команде, которая <i>задаёт</i> его значение;</li>
<li>если из команды A можно перейти на B (непосредственно или прыжком), и регистр не сохранён в A, то он не сохранён и в B;</li>
<li>регистр сохранён в команде, которая <i>сохраняет</i> его значение.</li>
</ul> Видим, что от предыдущего этот алгоритм отличается только направлением распространения: нужность распространяется от каждой команды к предыдущим, а несохранённость — к последующим.<br/>
В общем виде итеративный алгоритм вычисления множеств регистров в каждой точке программы называется <i>data flow analysis</i>, и применяется, кроме двух названных, и для многих других оптимизаций.<br/>
<br/>
<code><font color="#008000">void</font> unsaved() {<br/>
    <font color="#008000">bool</font> changed = <font color="#ff6060">false</font>;<br/>
    <font color="#8080ff">// rule 1</font><br/>
    foreach(i, pcode) {<br/>
        i->onenter = i->onexit = aliveset();<br/>
        <font color="#808000">if</font> (writesdest(i)) {<br/>
            i->onexit.insert(i->cmd.dest);<br/>
            changed = <font color="#ff6060">true</font>;<br/>
        }<br/>
    }<br/>
    <font color="#808000">while</font> (changed) {<br/>
        changed = <font color="#ff6060">false</font>;<br/>
        foreach2(i, pcode, next) {<br/>
            <font color="#008000">int</font> oldsize = i->onenter.size()+i->onexit.size();<br/>
            <font color="#8080ff">// rule 2 (next command)</font><br/>
            <font color="#808000">if</font> (hasnext(i))<br/>
                next->onenter.insert(i->onexit.begin(), i->onexit.end());<br/>
            <font color="#8080ff">// rule 2 (jmp target)</font><br/>
            <font color="#808000">if</font> (i->cmd.opcode==command::jz)<br/>
                i->tgt->onenter.insert(i->onexit.begin(), i->onexit.end());<br/>
            <font color="#8080ff">// rule 3</font><br/>
            i->onexit.insert(i->onenter.begin(), i->onenter.end());<br/>
            <font color="#808000">if</font> (i->cmd.opcode==command::store)<br/>
                i->onexit.erase(i->cmd.dest);<br/>
<br/>
            <font color="#808000">if</font> (i->onenter.size()+i->onexit.size() != oldsize)<br/>
                changed = <font color="#ff6060">true</font>;<br/>
        }<br/>
    }<br/>
}<br/>
<br/>
<font color="#808000">afterspill</font>: <font color="#8080ff">// пост-обработка после "выливания регистра"</font><br/>
        unsaved();<br/>
        foreach(i, pcode)<br/>
            <font color="#808000">if</font> (i->cmd.opcode==command::store &amp;&amp; !contains(i->onenter, i->cmd.dest))<br/>
                nopOut(i);<br/>
    }<br/>
</code><br/>
<br/>
<h3>Что получилось?</h3><br/>
Весь компилятор вместе: <a href="http://tyomitch.net.ru/jsk.y.regs.html">tyomitch.net.ru/jsk.y.regs.html</a><br/>
Из полутысячи строк, к парсингу относится лишь пятая часть. Действительно кажется, что по сравнению с трудозатратами на остальную часть компилятора, парсер — неинтересная мелочь сбоку. Но это лишь потому, что создание парсеров обсосано до косточек, и нам остаётся лишь воспользоваться готовым; тогда как при обработке кода больше места выдумке.<br/>
<br/>
В итоге назначения регистров и первых оптимизаций, генерируемый код удлинился всего на пару команд:<br/>
<pre>
00 mov   r01, 0
01 mov   r02, 0x3e8
02 echo  0x12e
03 echo  r01
04 echo  0xa8
05 echo  r02
06 echo  0xaf
07 le    r03, r01, r02
08 jz    r03, +0x1f (=0x28)
09 add   r03, r01, r02
0a mov   r04, 2
0b div   r03, r03, r04
0c echo  0x16a
0d echo  r03
0e echo  0xd4
0f input r04
10 store r01, 1
11 mov   r01, 1
12 eq    r01, r04, r01
13 jz    r01, +5 (=0x19)
14 load  r01, 1
15 mov   r02, 1
16 sub   r02, r03, r02
17 add   r02, r02, 0
18 jz    0,   -0x12 (=0x7)
19 mov   r01, 2
1a eq    r01, r04, r01
1b jz    r01, +4 (=0x20)
1c mov   r01, 1
1d add   r01, r03, r01
1e add   r01, r01, 0
1f jz    0,   -0x19 (=0x7)
20 load  r01, 1
21 mov   r03, 3
22 eq    r03, r04, r03
23 jz    r03, +2 (=0x26)
24 echo  0x14e
25 hlt
26 echo  0x172
27 jz    0,   -0x21 (=7)
28 echo  0x107
29 hlt
</pre><br/>
Зато, поскольку используется только четыре регистра, этот п-код возможно будет перевести в машинный код реального процессора.<br/>
<br/>
Продолжим в августе: уезжаю в отпуск, и дописываю этот пост прямо из аэропорта.<br/>
Всем приятного лета!</div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BA%D0%BE%D0%BC%D0%BF%D0%B8%D0%BB%D1%8F%D1%86%D0%B8%D1%8F%5D" class="tm-article-body__tags-item-link">компиляция</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B3%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F%20%D0%BA%D0%BE%D0%B4%D0%B0%5D" class="tm-article-body__tags-item-link">генерация кода</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BE%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%20%D0%BA%D0%BE%D0%B4%D0%B0%5D" class="tm-article-body__tags-item-link">оптимизация кода</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/programming/" class="tm-article-body__tags-item-link">
                  Программирование
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 62: ↑60 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 62: ↑60 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+58</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    86
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/99595/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      11
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/tyomitch/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/b71/804/e6d/b71804e6dcbec22ada05c488b7ee4c1b.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 796 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    414.5
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">7.6</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><span class="tm-user-card__name">Artyom Skrobov</span> <a href="/ru/users/tyomitch/" class="tm-user-card__nickname">
          @tyomitch
        </a> <!----></div> <p class="tm-user-card__short-info">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/99595/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 11 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2019-11-08T15:01:46.000Z" title="2019-11-08, 18:01">8  ноября  2019 в 18:01</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/wolfram/blog/473220/" class="tm-article-title__link"><span>Краеугольные камни уничтожения медленного кода в Wolfram Language: ускоряем код в десятки, сотни и тысячи раз</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 22: ↑21 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 22: ↑21 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+20</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.7K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    62
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/wolfram/blog/473220/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      20
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2019-09-26T11:25:58.000Z" title="2019-09-26, 14:25">26  сентября  2019 в 14:25</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/468027/" class="tm-article-title__link"><span>Методы оптимизации кода для Redd. Часть 2: некэшируемая память и параллельная работа шин</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 16: ↑15 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 16: ↑15 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+14</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    18
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/468027/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      2
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2019-09-17T07:40:32.000Z" title="2019-09-17, 10:40">17  сентября  2019 в 10:40</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/467353/" class="tm-article-title__link"><span>Методы оптимизации кода для Redd. Часть 1: влияние кэша</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 13: ↑12 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 13: ↑12 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+11</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.4K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    15
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/467353/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      9
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T07:08:30.000Z" title="2021-09-28, 10:08">сегодня в 10:08</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/nlmk/blog/580270/" class="tm-article-title__link"><span>Варим суп из стали: оптимизация логистики ковшей и как устроен цех КЦ № 2</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 65: ↑65 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 65: ↑65 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+65</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">5.1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    24
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/nlmk/blog/580270/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      23
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T08:07:48.000Z" title="2021-09-28, 11:07">сегодня в 11:07</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/domclick/blog/575686/" class="tm-article-title__link"><span>Когда сделаете доработку?</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 42: ↑41 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 42: ↑41 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+40</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    34
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/domclick/blog/575686/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      5
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T08:51:05.000Z" title="2021-09-28, 11:51">сегодня в 11:51</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/yandex/blog/579778/" class="tm-article-title__link"><span>YARL: как Яндекс построил распределённый Rate Limiter с нулевым влиянием на время ответа сервисов</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 38: ↑38 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 38: ↑38 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+38</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    23
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/yandex/blog/579778/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      7
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T14:25:12.000Z" title="2021-09-28, 17:25">сегодня в 17:25</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580516/" class="tm-article-title__link"><span>Лучший язык программирования</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 34: ↑31 и ↓3</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 34: ↑31 и ↓3" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+28</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.8K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    48
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580516/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      17
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T08:18:27.000Z" title="2021-09-28, 11:18">сегодня в 11:18</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/cloud4y/blog/580348/" class="tm-article-title__link"><span>Самый большой космический телескоп Джеймс Уэбб должен изменить наши представления о космосе</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 29: ↑28 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 29: ↑28 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+27</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    8
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/cloud4y/blog/580348/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      27
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="99595" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/99595/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/99595/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"99595":{"id":"99595","timePublished":"2010-07-23T02:40:13+00:00","isCorporative":false,"lang":"ru","titleHtml":"Компиляция. 7: назначение регистров","leadData":{"textHtml":"\u003Cblockquote\u003EFile names are infinite in length, where infinity is set to 255 characters.\u003Cbr\u002F\u003E\r\n\u003Ci\u003E--Peter Collinson: The Unix File System\u003C\u002Fi\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nИтак, у нас есть программа на п-коде, и в её распоряжении неограниченное количество регистров (т.е. 255). Число регистров у реального процессора куда меньше (предположим, четыре). Что будем делать?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EДалее в посте:\u003C\u002Fh3\u003E\u003Col\u003E\r\n\u003Cli\u003EРазбор п-кода\u003C\u002Fli\u003E\r\n\u003Cli\u003EВремя жизни\u003C\u002Fli\u003E\r\n\u003Cli\u003EРеализация\u003C\u002Fli\u003E\r\n\u003Cli\u003EПростые оптимизации\u003C\u002Fli\u003E\r\n\u003Cli\u003EРасщепление версий\u003C\u002Fli\u003E\r\n\u003Cli\u003EРабота с памятью\u003C\u002Fli\u003E\r\n\u003Cli\u003EЧто получилось?\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":414.5,"votesCount":796},"rating":7.6,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"57766","alias":"tyomitch","fullname":"Artyom Skrobov","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb71\u002F804\u002Fe6d\u002Fb71804e6dcbec22ada05c488b7ee4c1b.png","speciality":"Пользователь"},"statistics":{"commentsCount":11,"favoritesCount":86,"readingCount":4281,"score":58,"votesCount":62},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cblockquote\u003EFile names are infinite in length, where infinity is set to 255 characters.\u003Cbr\u002F\u003E\r\n\u003Ci\u003E--Peter Collinson: The Unix File System\u003C\u002Fi\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nИтак, у нас есть программа на п-коде, и в её распоряжении неограниченное количество регистров (т.е. 255). Число регистров у реального процессора куда меньше (предположим, четыре). Что будем делать?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EДалее в посте:\u003C\u002Fh3\u003E\u003Col\u003E\r\n\u003Cli\u003EРазбор п-кода\u003C\u002Fli\u003E\r\n\u003Cli\u003EВремя жизни\u003C\u002Fli\u003E\r\n\u003Cli\u003EРеализация\u003C\u002Fli\u003E\r\n\u003Cli\u003EПростые оптимизации\u003C\u002Fli\u003E\r\n\u003Cli\u003EРасщепление версий\u003C\u002Fli\u003E\r\n\u003Cli\u003EРабота с памятью\u003C\u002Fli\u003E\r\n\u003Cli\u003EЧто получилось?\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Ch3\u003EРазбор п-кода\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nВ прошлом посте был дамп скомпилированной программы. Её 40 команд несложно расшифровать: \u003Cpre\u003E\n00 mov   r01, 0\n01 mov   r02, 0x3e8\n02 echo  0x126\n03 echo  r01\n04 echo  0xa0\n05 echo  r02\n06 echo  0xa7\n07 le    r03, r01, r02\n08 jz    r03, +0x1d (=0x26)\n09 add   r04, r01, r02\n0a mov   r05, 2\n0b div   r06, r04, r05\n0c echo  0x162\n0d echo  r06\n0e echo  0xcc\n0f input r07\n10 mov   r08, 1\n11 eq    r09, r07, r08\n12 jz    r09, +4 (=0x17)\n13 mov   r0a, 1\n14 sub   r0b, r06, r0a\n15 add   r02, r0b, 0\n16 jz    0,   +e (=0x25)\n17 mov   r0c, 2\n18 eq    r0d, r07, r0c\n19 jz    r0d, +4 (=0x1e)\n1a mov   r0e, 1\n1b add   r0f, r06, r0e\n1c add   r01, r0f, 0\n1d jz    0,   +7 (=0x25)\n1e mov   r10, 3\n1f eq    r11, r07, r10\n20 jz    r11, +3 (=0x24)\n21 echo  0x146\n22 hlt\n23 jz    0,   +1 (=0x25)\n24 echo  0x16a\n25 jz    0,   -0x1f (=7)\n26 echo  0xff\n27 hlt\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВидно, что не все регистры используются одновременно: большинство хранят промежуточные значения, которые нужны только для следующей команды. Например, \u003Ccode\u003Er03\u003C\u002Fcode\u003E используется только в командах \u003Ccode\u003E07-08\u003C\u002Fcode\u003E, а \u003Ccode\u003Er0f\u003C\u002Fcode\u003E только в командах \u003Ccode\u003E1b-1c\u003C\u002Fcode\u003E. Значит, нет никаких препятствий задействовать для хранимых значений один и тот же физический регистр: в командах \u003Ccode\u003E07-08\u003C\u002Fcode\u003E он будет использоваться для одного значения, а в \u003Ccode\u003E1b-1c\u003C\u002Fcode\u003E — для другого. Любые два регистра, которые не используются \u003Ci\u003Eодновременно для разных значений\u003C\u002Fi\u003E, можно объединить в один физический регистр.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсть небольшая тонкость по поводу определения «используются одновременно для разных значений». Во-первых, нельзя считать временем жизни регистра просто промежуток от его первого упоминания до последнего: код может содержать прыжки во все стороны, например: \u003Cpre\u003E\n   ...\n10 mov  r, 42\n11 jz   0, 20\n12 echo r\n   ...\n20 ...\n   ...\n30 jz   0, 12\n   ...\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nДаже хотя \u003Ccode\u003Er\u003C\u002Fcode\u003E упоминается только в командах 10-12, он неявно используется и в команде 20, потому что после неё возможен прыжок обратно на 12; и значит, \u003Ccode\u003Er\u003C\u002Fcode\u003E нельзя объединять с другими регистрами, используемыми в команде 20.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВторая тонкость: \u003Cpre\u003E\n   ...\n10 mov  r, 42\n11 echo r\n   ...\n20 ...\n   ...\n30 mov  r, 24\n31 echo r\n   ...\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВ команде 20 регистр \u003Ccode\u003Er\u003C\u002Fcode\u003E на самом деле не используется, хотя упоминается и перед этим (10-11), и после этого (30-31). Можем хранить в нём любые другие значения, потому что перед следующим использованием (31) значение ему будет присвоено по-новой. В принципе, мы даже можем назначить разные физические регистры для \u003Ccode\u003Er\u003C\u002Fcode\u003E в 10-11 и в 31-31, потому что значения всё равно будут храниться разные. Но для этого нужно обнаружить, что у \u003Ccode\u003Er\u003C\u002Fcode\u003E две независимые «версии», и обрабатывать их по-отдельности.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EВремя жизни\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nОпределить набор команд, в которых регистр используется, можно итеративно:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eрегистр нужен команде, которая \u003Ci\u003Eчитает\u003C\u002Fi\u003E его значение;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eесли из команды A можно перейти на B (непосредственно или прыжком), и регистр нужен B, то он нужен и А;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eрегистр не нужен команде, которая \u003Ci\u003Eзадаёт\u003C\u002Fi\u003E его значение.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E Для каждой команды определяем набор регистров, которые нужны ей «на входе» и «на выходе», и применяем три правила до тех пор, пока эти наборы не установятся. Вот что получим для нашей программы:\u003Cpre\u003E\n             номер итерации: 1(вход\u002Fвых) 2(вход\u002Fвыход)       3(вход\u002Fвыход)       4(вход\u002Fвыход)     ...    итог(вход\u002Fвыход)\n00 mov   r01, 0                                                                                                    \u002Fr01\n01 mov   r02, 0x3e8                                                                    \u002Fr01                     r01\u002Fr01,r02\n02 echo  0x126                                 \u002Fr01             r01\u002Fr01             r01\u002Fr01                 r01,r02\u002Fr01,r02\n03 echo  r01                    r01\u002F        r01\u002F                r01\u002F                r01\u002Fr02                 r01,r02\u002Fr01,r02\n04 echo  0xa0                                  \u002Fr02             r02\u002Fr02             r02\u002Fr02                 r01,r02\u002Fr01,r02\n05 echo  r02                    r02\u002F        r02\u002F                r02\u002F                r02\u002Fr01,r02             r01,r02\u002Fr01,r02\n06 echo  0xa7                                  \u002Fr01,r02     r01,r02\u002Fr01,r02     r01,r02\u002Fr01,r02             r01,r02\u002Fr01,r02\n07 le    r03, r01, r02      r01,r02\u002F    r01,r02\u002Fr03         r01,r02\u002Fr03         r01,r02\u002Fr01,r02,r03         r01,r02\u002Fr01,r02,r03\n08 jz    r03, +0x1d (=0x26)     r03\u002F        r03\u002Fr01,r02 r01,r02,r03\u002Fr01,r02 r01,r02,r03\u002Fr01,r02         r01,r02,r03\u002Fr01,r02\n09 add   r04, r01, r02      r01,r02\u002F    r01,r02\u002F            r01,r02\u002F            r01,r02\u002Fr04                 r01,r02\u002Fr01,r02,r04\n0a mov   r05, 2                                \u002Fr04,r05         r04\u002Fr04,r05         r04\u002Fr04,r05         r01,r02,r04\u002Fr01,r02,r04,r05\n0b div   r06, r04, r05      r04,r05\u002F    r04,r05\u002F            r04,r05\u002F            r04,r05\u002Fr06         r01,r02,r04,r05\u002Fr01,r02,r06\n0c echo  0x162                                 \u002Fr06             r06\u002Fr06             r06\u002Fr06             r01,r02,r06\u002Fr01,r02,r06\n0d echo  r06                    r06\u002F        r06\u002F                r06\u002F                r06\u002F                r01,r02,r06\u002Fr01,r02,r06\n0e echo  0xcc                                                                                           r01,r02,r06\u002Fr01,r02,r06\n0f input r07                                                                           \u002Fr07             r01,r02,r06\u002Fr01,r02,r06,r07\n10 mov   r08, 1                                \u002Fr07,r08         r07\u002Fr07,r08         r07\u002Fr07,r08     r01,r02,r06,r07\u002Fr01,r02,r06,r07,r08\n11 eq    r09, r07, r08      r07,r08\u002F    r07,r08\u002Fr09         r07,r08\u002Fr09         r07,r08\u002Fr09     r01,r02,r06,r07,r08\u002Fr01,r02,r06,r07,r09\n12 jz    r09, +4 (=0x17)        r09\u002F        r09\u002F                r09\u002F                r09\u002Fr06,r07 r01,r02,r06,r07,r09\u002Fr01,r02,r06,r07\n13 mov   r0a, 1                                \u002Fr06,r0a         r06\u002Fr06,r0a         r06\u002Fr06,r0a             r01,r06\u002Fr01,r06,r0a\n14 sub   r0b, r06, r0a      r06,r0a\u002F    r06,r0a\u002Fr0b         r06,r0a\u002Fr0b         r06,r0a\u002Fr0b             r01,r06,r0a\u002Fr01,r0b\n15 add   r02, r0b, 0            r0b\u002F        r0b\u002F                r0b\u002F                r0b\u002F                    r01,r0b\u002Fr01,r02\n16 jz    0,   +e (=0x25)                                                                                    r01,r02\u002Fr01,r02\n17 mov   r0c, 2                                \u002Fr07,r0c         r07\u002Fr07,r0c         r07\u002Fr07,r0c     r01,r02,r06,r07\u002Fr01,r02,r06,r07,r0c\n18 eq    r0d, r07, r0c      r07,r0c\u002F    r07,r0c\u002Fr0d         r07,r0c\u002Fr0d         r07,r0c\u002Fr0d     r01,r02,r06,r07,r0c\u002Fr01,r02,r06,r07,r0d\n19 jz    r0d, +4 (=0x1e)        r0d\u002F        r0d\u002F                r0d\u002F                r0d\u002Fr06,r07 r01,r02,r06,r07,r0d\u002Fr01,r02,r06,r07\n1a mov   r0e, 1                                \u002Fr06,r0e         r06\u002Fr06,r0e         r06\u002Fr06,r0e             r02,r06\u002Fr02,r06,r0e\n1b add   r0f, r06, r0e      r06,r0e\u002F    r06,r0e\u002Fr0f         r06,r0e\u002Fr0f         r06,r0e\u002Fr0f             r02,r06,r0e\u002Fr02,r0f\n1c add   r01, r0f, 0            r0f\u002F        r0f\u002F                r0f\u002F                r0f\u002F                    r02,r0f\u002Fr01,r02\n1d jz    0,   +7 (=0x25)                                                               \u002Fr01,r02             r01,r02\u002Fr01,r02\n1e mov   r10, 3                                \u002Fr07,r10         r07\u002Fr07,r10         r07\u002Fr07,r10         r01,r02,r07\u002Fr01,r02,r07,r10\n1f eq    r11, r07, r10      r07,r10\u002F    r07,r10\u002Fr11         r07,r10\u002Fr11         r07,r10\u002Fr11         r01,r02,r07,r10\u002Fr01,r02,r11\n20 jz    r11, +3 (=0x24)        r11\u002F        r11\u002F                r11\u002F                r11\u002F                r01,r02,r11\u002Fr01,r02\n21 echo  0x146\n22 hlt\n23 jz    0,   +1 (=0x25)                                                               \u002Fr01,r02             r01,r02\u002Fr01,r02\n24 echo  0x16a                                                                         \u002Fr01,r02             r01,r02\u002Fr01,r02\n25 jz    0,   -0x1f (=7)                       \u002Fr01,r02     r01,r02\u002Fr01,r02     r01,r02\u002Fr01,r02             r01,r02\u002Fr01,r02\n26 echo  0xff\n27 hlt\n\u003C\u002Fpre\u003EПо поводу отдельных итераций:\u003Col\u003E\r\n\u003Cli\u003EНа входе каждой команды — используемые ей регистры; (правило №1)\u003C\u002Fli\u003E\r\n\u003Cli\u003EНа выход каждой команды копируем вход достижимых из неё команд; (правило №2)\u003C\u002Fli\u003E\r\n\u003Cli\u003EНа вход каждой команды копируем её выход, исключая записанный командой регистр; (правило №3)\u003C\u002Fli\u003E\r\n\u003Cli\u003EНа выход каждой команды копируем вход достижимых из неё команд; (правило №2)\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003EДалее правила №2 и №3 повторяются поочерёдно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле нескольких итераций получаем окончательную разметку «живучести регистров» — какие регистры нужны каждой команде. Тогда можем переименовывать регистры п-кода в физические — например, «по-жадному»: берём «самый нужный» регистр (нужный наибольшему количеством команд); переименовываем в физический, который ещё не занят в соответствующих командах; повторяем.\u003Cbr\u002F\u003E\r\nОптимальный выбор, каким п-регистрам следует предоставить физические, чтобы хватило на как можно больше, — возможен только полным перебором: эта задача равносильна «раскраске графа в минимум цветов», про которую математики верят, что для неё не существует эффективного решения. Наше «жадное» приближение — не самое худшее из возможных.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто делать, если для очередного п-регистра не окажется свободного физического? Например, в нашем коде есть команды (10-12, 17-19), использующие по 5 п-регистров: как минимум одному из них места не хватит. Понятно, что придётся хранить его в памяти.\u003Cbr\u002F\u003E\r\nНо просто сказать регистру «тебе не повезло, ты будешь храниться в памяти» мало: ведь команды нашего п-кода не умеют работать со значениями из памяти, равно как и команды большинства реальных процессоров. Необходимо на время использования доставать значение из памяти в регистр. Только в какой? Ведь потому и убрали значение в память, что все регистры заняты!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа этом месте выученная мной теория заканчивается, и идут догадки и эвристики. Я решил перед командой, на которую не хватает регистров, «выливать в память» лишние регистры, а после — читать их из памяти обратно. Тем самым, во «времени жизни» вылитых регистров появится дырка на месте этой команды, и в этой дырке сможем использовать освободившиеся регистры для других целей.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧтобы можно было «раздвигать» код и вставлять в него команды чтения\u002Fзаписи в память, придётся чуточку поменять промежуточный формат: теперь это будет связанный список, и цель прыжка будет храниться не как смещение, а как указатель (превращая список в орграф). Во время генерации п-кода, для \u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Fprogramming\u002F99592\u002F\"\u003Eбэкпатчинга\u003C\u002Fa\u003E нам понадобится обращаться к командам и по индексу; для этого заведём отдельный вектор смещений.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E    \u003Cfont color=\"#008000\"\u003Etypedef\u003C\u002Ffont\u003E std::list&lt;\u003Cfont color=\"#008000\"\u003Estruct\u003C\u002Ffont\u003E commandn\u003E::iterator pcommandn;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Estruct\u003C\u002Ffont\u003E commandn {\u003Cbr\u002F\u003E\r\n        command cmd;\u003Cbr\u002F\u003E\r\n        pcommandn tgt; \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F цель прыжка\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        commandn(\u003Cfont color=\"#008000\"\u003Econst\u003C\u002Ffont\u003E command&amp; cmd) : cmd(cmd), tgt(\u003Cfont color=\"#ff6060\"\u003ENULL\u003C\u002Ffont\u003E) {}\u003Cbr\u002F\u003E\r\n    };\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n    std::list&lt;commandn\u003E pcode;\u003Cbr\u002F\u003E\r\n    std::vector&lt;pcommandn\u003E pcodeidx;\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E emit(\u003Cfont color=\"#008000\"\u003Econst\u003C\u002Ffont\u003E command&amp; cmd) {\u003Cbr\u002F\u003E\r\n        pcodeidx.push_back(pcode.insert(pcode.end(), commandn(cmd)));\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E pcode.size()-\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E emit(command::opcodes opcode, regnum dest, regnum src1, regnum src2) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E emit(command(opcode, dest, src1, src2));\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E emit(command::opcodes opcode, regnum dest, \u003Cfont color=\"#008000\"\u003Eshort\u003C\u002Ffont\u003E imm) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E emit(command(opcode, dest, imm));\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E fix(\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E index, command::opcodes opcode, regnum dest, \u003Cfont color=\"#008000\"\u003Eshort\u003C\u002Ffont\u003E imm) {\u003Cbr\u002F\u003E\r\n        *pcodeidx[index] = commandn(command(opcode, dest, imm));\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nУказатели на цель прыжка сложно заполнять во время генерации п-кода: в момент создания прыжков уже известен индекс цели, но ещё неизвестно, какая там будет стоять команда; ставить указатель на ещё не созданную команду проблематично. Поэтому после конца разбора и генерации п-кода обойдём сгенерированный код, и расставим указатели прыжков; потом выполним всю нужную работу с распределением регистров; и в конце, перед дампом p-кода в файл, нужно будет его «сериализовать» — определить окончательный индекс каждой команды, и заполнить смещения прыжков. Ради этого, добавим в \u003Ccode\u003Estruct commandn\u003C\u002Fcode\u003E поле \u003Ccode\u003Eint index;\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E main() {\u003Cbr\u002F\u003E\r\n    yyparse();\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F расставить цели прыжков\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#800000\"\u003Efor\u003C\u002Ffont\u003E(\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E i=\u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E; i&lt;pcode.size(); i++)\u003Cbr\u002F\u003E\r\n       \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E(pcodeidx[i]-\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n            pcodeidx[i]-\u003Etgt = pcodeidx[i+\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E+pcodeidx[i]-\u003Ecmd.imm];\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F обработка \u002F оптимизация\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F ...\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F сериализация \u002F расстановка смещений\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E index = \u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    foreach(i, pcode) i-\u003Eindex = index++;\u003Cbr\u002F\u003E\r\n    foreach(i, pcode)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n            i-\u003Ecmd.imm = i-\u003Etgt-\u003Eindex-i-\u003Eindex-\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F запись п-кода в файл\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F ...\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nДело за малым: реализовать «обработку \u002F оптимизацию». Займёт она, как и можно ожидать, большую часть всего кода компилятора.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EРеализация\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nДля назначения регистров будем хранить для каждой команды (прямо в \u003Ccode\u003Estruct commandn\u003C\u002Fcode\u003E) множества живых на входе и на выходе регистров: отдельно — регистров п-кода, для определения времени жизни; и отдельно — физических регистров, для определения сочетаемости при собственно назначении.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E    \u003Cfont color=\"#008000\"\u003Etypedef\u003C\u002Ffont\u003E std::set&lt;regnum\u003E aliveset;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Eenum\u003C\u002Ffont\u003E physreg { firstp = \u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E, lastp = \u003Cfont color=\"#ff6060\"\u003E4\u003C\u002Ffont\u003E };\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Etypedef\u003C\u002Ffont\u003E std::set&lt;physreg\u003E alivesetp;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Estruct\u003C\u002Ffont\u003E commandn {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F ...\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        aliveset onenter, onexit;       \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F liveness check\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        alivesetp onenterp, onexitp;    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F phys reg allocation\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F ...\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    };\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nЕщё одна полезная вещь — определение по опкоду, какие регистры используются командой:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E hasnext(pcommandn cmd) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E (cmd-\u003Ecmd.opcode!=command::hlt &amp;&amp;!\u003Cbr\u002F\u003E\r\n                (cmd-\u003Ecmd.opcode==command::jz &amp;&amp; !cmd-\u003Ecmd.dest));\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E has2src(pcommandn cmd) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E cmd-\u003Ecmd.opcode\u003E=command::add;\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E writesdest(pcommandn cmd) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E cmd-\u003Ecmd.opcode\u003E=command::mov;\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Einline\u003C\u002Ffont\u003E \u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E readsdest(pcommandn cmd) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E cmd-\u003Ecmd.opcode\u003E=command::store &amp;&amp;\u003Cbr\u002F\u003E\r\n                cmd-\u003Ecmd.opcode&lt;=command::echo;\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nПосле этого, по приведённой выше схеме, рассчитываем для каждой команды множество нужных на входе и на выходе регистров; заодно считаем, сколько раз нужен каждый регистр, для жадного назначения.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Estd::vector&lt;\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E\u003E liveness() { \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F returns usecount\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    std::vector&lt;\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E\u003E usecount(lastreg+\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E);\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E changed = \u003Cfont color=\"#ff6060\"\u003Efalse\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 1\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach(i, pcode) {\u003Cbr\u002F\u003E\r\n        i-\u003Eonenter = i-\u003Eonexit = aliveset();\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (has2src(i)) {\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Ecmd.src1) {\u003Cbr\u002F\u003E\r\n                usecount[i-\u003Ecmd.src1]++;\u003Cbr\u002F\u003E\r\n                i-\u003Eonenter.insert(i-\u003Ecmd.src1);\u003Cbr\u002F\u003E\r\n            }\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Ecmd.src2) {\u003Cbr\u002F\u003E\r\n                usecount[i-\u003Ecmd.src2]++;\u003Cbr\u002F\u003E\r\n                i-\u003Eonenter.insert(i-\u003Ecmd.src2);\u003Cbr\u002F\u003E\r\n            }\u003Cbr\u002F\u003E\r\n        } \u003Cfont color=\"#800000\"\u003Eelse\u003C\u002Ffont\u003E \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (readsdest(i) &amp;&amp; i-\u003Ecmd.dest) {\u003Cbr\u002F\u003E\r\n            usecount[i-\u003Ecmd.dest]++;\u003Cbr\u002F\u003E\r\n            i-\u003Eonenter.insert(i-\u003Ecmd.dest);\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Eonenter.size())\u003Cbr\u002F\u003E\r\n            changed = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#800000\"\u003Ewhile\u003C\u002Ffont\u003E (changed) {\u003Cbr\u002F\u003E\r\n        changed = \u003Cfont color=\"#ff6060\"\u003Efalse\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        foreach2(i, pcode, next) {\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E oldsize = i-\u003Eonenter.size()+i-\u003Eonexit.size();\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 2 (next command)\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (hasnext(i))\u003Cbr\u002F\u003E\r\n                i-\u003Eonexit.insert(next-\u003Eonenter.begin(), next-\u003Eonenter.end());\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 2 (jmp target)\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n                i-\u003Eonexit.insert(i-\u003Etgt-\u003Eonenter.begin(), i-\u003Etgt-\u003Eonenter.end());\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 3\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            i-\u003Eonenter.insert(i-\u003Eonexit.begin(), i-\u003Eonexit.end());\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (writesdest(i))\u003Cbr\u002F\u003E\r\n                i-\u003Eonenter.erase(i-\u003Ecmd.dest);\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Eonenter.size()+i-\u003Eonexit.size() != oldsize)\u003Cbr\u002F\u003E\r\n                changed = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#800000\"\u003Ereturn\u003C\u002Ffont\u003E usecount;\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nИспользованный макрос \u003Ccode\u003Eforeach2\u003C\u002Fcode\u003E позволяет в теле цикла смотреть и на текущий, и на следующий за ним элемент:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u003Cfont color=\"#ff40ff\"\u003E#define foreach2(i, list, next) \u003C\u002Ffont\u003E\u003Cfont color=\"#008000\"\u003Etypedef\u003C\u002Ffont\u003E\u003Cfont color=\"#ff40ff\"\u003E typeof(list) TOKENPASTE2(T,\u003C\u002Ffont\u003E\u003Cfont color=\"#ff6060\"\u003E__LINE__\u003C\u002Ffont\u003E\u003Cfont color=\"#ff40ff\"\u003E); \\\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#ff40ff\"\u003E        \u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Efor\u003C\u002Ffont\u003E\u003Cfont color=\"#ff40ff\"\u003E(TOKENPASTE2(T,\u003C\u002Ffont\u003E\u003Cfont color=\"#ff6060\"\u003E__LINE__\u003C\u002Ffont\u003E\u003Cfont color=\"#ff40ff\"\u003E)::iterator next = list.begin(), i=next++; i != list.end(); i=next, next++)\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nВ принципе, можно было сократить общее число итераций, если обходить команды не «сверху вниз», а «снизу вверх», потому что нужность «распространяется» от каждой команды к предыдущим; обход «сверху вниз» выбран ради упрощения кода. В самом худшем случае, для кода длиной \u003Ci\u003EN\u003C\u002Fi\u003E команд потребуется 2\u003Ci\u003EN\u003C\u002Fi\u003E итераций (на каждой итерации нужность распространяется на расстояние полкоманды). Для \u003Ccode\u003Etest.jsk\u003C\u002Fcode\u003E хватило 35 итераций, потому что прыжки сокращают расстояния.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНаконец, то, зачем мы всё это делали:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F обработка \u002F оптимизация:\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#800000\"\u003Ewhile\u003C\u002Ffont\u003E(\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E) { \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F пока все регистры не уложатся в физические\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F предварительная обработка\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F ...\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n        std::vector&lt;\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E\u003E usecount = liveness();\u003Cbr\u002F\u003E\r\n        std::vector&lt;physreg\u003E physmap(lastreg+\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E);\u003Cbr\u002F\u003E\r\n        foreach(i, pcode)\u003Cbr\u002F\u003E\r\n            i-\u003Eonenterp = i-\u003Eonexitp = alivesetp();\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ewhile\u003C\u002Ffont\u003E(\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E) {\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F самый нужный регистр\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            std::vector&lt;\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E\u003E::iterator max = std::max_element(usecount.begin(), usecount.end());\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (!*max) \u003Cfont color=\"#800000\"\u003Ebreak\u003C\u002Ffont\u003E; \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F все регистры размещены\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            *max = \u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n            regnum r = max - usecount.begin();\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F поищем физ. регистр для п-регистра №r\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            std::vector&lt;\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E\u003E collisions(lastp); \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F 0-based\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Efor\u003C\u002Ffont\u003E (physreg p=firstp; p&lt;=lastp; p=(physreg)(p+\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E)) { \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F error: ISO C++ forbids incrementing an enum\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n                foreach(i, pcode) {\u003Cbr\u002F\u003E\r\n                    \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (contains(i-\u003Eonenter, r) &amp;&amp; contains(i-\u003Eonenterp, p))\u003Cbr\u002F\u003E\r\n                        collisions[p-\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E]++;\u003Cbr\u002F\u003E\r\n                    \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (contains(i-\u003Eonexit, r) &amp;&amp; contains(i-\u003Eonexitp, p))\u003Cbr\u002F\u003E\r\n                        collisions[p-\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E]++;\u003Cbr\u002F\u003E\r\n                }\u003Cbr\u002F\u003E\r\n                \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (collisions[p-\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E]) \u003Cfont color=\"#800000\"\u003Econtinue\u003C\u002Ffont\u003E; \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F попробовать другой физ. рег\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n                physmap[r] = p;\u003Cbr\u002F\u003E\r\n                \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F разместили п-регистр №r в физическом №p\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n                foreach(i, pcode) {\u003Cbr\u002F\u003E\r\n                    \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (contains(i-\u003Eonenter, r))\u003Cbr\u002F\u003E\r\n                        i-\u003Eonenterp.insert(p);\u003Cbr\u002F\u003E\r\n                    \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (contains(i-\u003Eonexit, r))\u003Cbr\u002F\u003E\r\n                        i-\u003Eonexitp.insert(p);\u003Cbr\u002F\u003E\r\n                }\u003Cbr\u002F\u003E\r\n                \u003Cfont color=\"#800000\"\u003Ebreak\u003C\u002Ffont\u003E; \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F успешное назначение\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            }\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (physmap[r]) \u003Cfont color=\"#800000\"\u003Econtinue\u003C\u002Ffont\u003E; \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F нашлось куда разместить\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F не хватило физ. регистра для п-регистра №r\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F эвристика: найдём команду, в которой не хватает регистров\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            foreach2(i, pcode, next)\u003Cbr\u002F\u003E\r\n                \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E ((i-\u003Ecmd.opcode!=command::load &amp;&amp; i-\u003Ecmd.opcode!=command::store) &amp;&amp;\u003Cbr\u002F\u003E\r\n                        ((contains(i-\u003Eonenter, r) &amp;&amp; i-\u003Eonenterp.size()==lastp) ||\u003Cbr\u002F\u003E\r\n                         (contains(i-\u003Eonexit, r) &amp;&amp; i-\u003Eonexitp.size()==lastp))) {\u003Cbr\u002F\u003E\r\n                    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F найдём, какой регистр можно вылить, и выльем\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n                    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F ...\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n                    \u003Cfont color=\"#800000\"\u003Egoto\u003C\u002Ffont\u003E afterspill;\u003Cbr\u002F\u003E\r\n                }\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F эвристика не сработала: что же делать?\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            yyerror(\u003Cfont color=\"#ff6060\"\u003E\"don't know how to proceed\"\u003C\u002Ffont\u003E);\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F все регистры размещены; переименовываем\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        foreach(i, pcode) {\u003Cbr\u002F\u003E\r\n            i-\u003Ecmd.dest = physmap[i-\u003Ecmd.dest];\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#800000\"\u003Eif\u003C\u002Ffont\u003E (has2src(i)) {\u003Cbr\u002F\u003E\r\n                i-\u003Ecmd.src1 = physmap[i-\u003Ecmd.src1];\u003Cbr\u002F\u003E\r\n                i-\u003Ecmd.src2 = physmap[i-\u003Ecmd.src2];\u003Cbr\u002F\u003E\r\n            }\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#800000\"\u003Ebreak\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#800000\"\u003Eafterspill\u003C\u002Ffont\u003E: \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F пост-обработка после \"выливания регистра\"\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nЕщё не углубляясь в то, как именно мы выливаем регистр, стоит упомянуть, что у приведённого кода масса проблем. Во-первых, эвристика работает только в самых простых случаях; чаще встречаются ситуации навроде \u003Cpre\u003E\n   ...\n10 нужны r1,r2,r3,r4\n   ...\n20 нужны r1,r3,r4,r5\n   ...\n30 нужны r2,r3,r4,r5\n   ...\n\u003C\u002Fpre\u003EРегистру \u003Ccode\u003Er5\u003C\u002Fcode\u003E не хватает физического, потому что все физические израсходовались на \u003Ccode\u003Er1,r2,r3,r4\u003C\u002Fcode\u003E; но нет ни одной команды, где все пять регистров нужны одновременно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nБолее жёсткая проблема — что каждый вылив засоряет программу бесполезными парами \u003Ccode\u003Estore\u002Fload\u003C\u002Fcode\u003E, и их нужно вычищать — иначе используемые в них регистры создают достаточно «шума», чтоб регистров не хватило больше ни на что.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕщё одна идея: дырка во времени жизни, образовавшаяся из-за вылива, может разделить исходный п-регистр на две независимых «версии», которые можно размещать в разных физических регистрах. Ради гибкости нашей системы, стоит реализовать расщепление версий: тогда с каждой итерацией внешнего цикла времена жизни регистров будут сокращаться, и распределять им физические будет становиться всё проще и проще.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ, раз уж мы пошли удалять лишние \u003Ccode\u003Eload\u003C\u002Fcode\u003E и \u003Ccode\u003Estore\u003C\u002Fcode\u003E, удалим заодно и прочие лишние команды. Учитывая, что у операций нашего п-кода нет других побочных эффектов, кроме вычисления регистра с результатом, — можно удалять команды, результат которых не жив на выходе. Может быть, программист присвоил значение неиспользуемой переменной, или употребил оператор наподобие \u003Ccode\u003E(2+2);\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nУдаляем всё подряд — так удалим до кучи недостижимый код (например, jz после hlt), и сожмём цепочки прыжков (заменим прыжок на прыжок одним прыжком).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля удаления команды, чтобы не искать и не исправлять все прыжки на неё, удобно заменить её на \u003Ccode\u003Enop\u003C\u002Fcode\u003E; в качестве него назначим безусловный прыжок на следующую команду (\u003Ccode\u003Ejz r00, +0\u003C\u002Fcode\u003E). Выгода в том, что на следующей итерации прыжок на \u003Ccode\u003Enop\u003C\u002Fcode\u003E сожмётся по цепочке, и сам \u003Ccode\u003Enop\u003C\u002Fcode\u003E вычистится как недостижимая команда.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EПростые оптимизации\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nДля обнаружения недостижимых команд пользуемся обходом в глубину; чтобы следить, какие команды уже обошли, в \u003Ccode\u003Estruct commandn\u003C\u002Fcode\u003E добавляем новое поле \u003Ccode\u003Eint reachcnt;\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nНам хватило бы и булева поля; но «степень захода» каждой команды, может статься, ещё пригодится когда-нибудь потом.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E markReachable(pcommandn cmd) {\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Ewhile\u003C\u002Ffont\u003E(!cmd-\u003Ereachcnt++) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (cmd-\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n            markReachable(cmd-\u003Etgt);\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (hasnext(cmd))\u003Cbr\u002F\u003E\r\n            cmd++;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eelse\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Ebreak\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E nopOut(pcommandn cmd) {\u003Cbr\u002F\u003E\r\n    pcommandn next = cmd; next++;\u003Cbr\u002F\u003E\r\n    cmd-\u003Ecmd = command(command::jz, \u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E);\u003Cbr\u002F\u003E\r\n    cmd-\u003Etgt = next;\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E simpleopt() {\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F сжать цепочки прыжков\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach(i, pcode)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(i-\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Ewhile\u003C\u002Ffont\u003E(i-\u003Etgt-\u003Ecmd.opcode==command::jz &amp;&amp; !i-\u003Etgt-\u003Ecmd.dest)\u003Cbr\u002F\u003E\r\n                i-\u003Etgt = i-\u003Etgt-\u003Etgt;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F удалить недостижимый код\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach(i, pcode) i-\u003Ereachcnt = \u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    markReachable(pcode.begin());\u003Cbr\u002F\u003E\r\n    foreach2(i, pcode, next)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(!i-\u003Ereachcnt)\u003Cbr\u002F\u003E\r\n            pcode.erase(i);\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F удалить все nop: уже не могут быть целью прыжка\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach2(i, pcode, next)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(i-\u003Ecmd.opcode==command::jz &amp;&amp;\u003Cbr\u002F\u003E\r\n                !i-\u003Ecmd.dest &amp;&amp; i-\u003Etgt==next)\u003Cbr\u002F\u003E\r\n            pcode.erase(i);\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F предварительная обработка в цикле назначения регистров:\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    simpleopt();\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F удалить команды с неживым результатом\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    liveness();\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E changed = \u003Cfont color=\"#ff6060\"\u003Efalse\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    foreach(i, pcode)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(writesdest(i) &amp;&amp; !contains(i-\u003Eonexit, i-\u003Ecmd.dest)) {\u003Cbr\u002F\u003E\r\n            nopOut(i);\u003Cbr\u002F\u003E\r\n            changed = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (changed) \u003Cfont color=\"#808000\"\u003Econtinue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F расщепление версий\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F ...\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EРасщепление версий\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nЕсли в «интервале нужности» регистра есть разрыв, т.е. значение из одного набора команд никогда не проникает в другой набор, — значит, регистр можно «расщепить» на пару регистров с более короткими временами жизни.\u003Cbr\u002F\u003E\r\nДля выделения безразрывных фрагментов из времён жизни пригодится ещё один графовый алгоритм: поиск компонент связности.\u003Cbr\u002F\u003E\r\nСтремимся больше к ясности кода, чем к его эффективности; поэтому у нас пвг внутри пвг, и слияние компонент выполняется обходом всего графа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ \u003Ccode\u003Estruct commandn\u003C\u002Fcode\u003E потребуется ещё одно поле, последнее на сегодня: \u003Ccode\u003Estd::map&lt;regnum,regnum\u003E version;\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nВ нём будем хранить для каждой команды соответствия «п-регистр -\u003E номер версии».\u003Cbr\u002F\u003E\r\nЕсли регистр в команде используется, а соответствия в \u003Ccode\u003Eversion\u003C\u002Fcode\u003E ещё нет — значит, обход до этой команды ещё не дошёл.\u003Cbr\u002F\u003E\r\nДля внешнего же пвг, чтобы не заводить новое поле, пользуемся тем же \u003Ccode\u003Ereachcnt\u003C\u002Fcode\u003E, что и в \u003Ccode\u003EmarkReachable()\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Estd::map&lt;regnum,regnum\u003E renameto;       \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F для слияния компонент\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E versionizeReg(pcommandn cmd, regnum r, regnum rv) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F переименовать r в rv во всей компоненте\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Ewhile\u003C\u002Ffont\u003E(!contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion, r) &amp;&amp;\u003Cbr\u002F\u003E\r\n            (contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eonenter, r) || contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eonexit, r))) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F переименование\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion[r] = renameto[rv];\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.dest==r) cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.dest=renameto[rv];\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (has2src(cmd)) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src1==r) cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E=renameto[rv];\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src2==r) cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src\u003Cfont color=\"#ff6060\"\u003E2\u003C\u002Ffont\u003E=renameto[rv];\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (!contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eonexit,r)) \u003Cfont color=\"#808000\"\u003Ereturn\u003C\u002Ffont\u003E; \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F больше не живой\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.opcode==command::jz &amp;&amp;\u003Cbr\u002F\u003E\r\n                contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Etgt-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eonenter, r)) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            versionizeReg(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Etgt, r, rv);\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (hasnext(cmd)) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            cmd++;\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eonenter, r))\u003Cbr\u002F\u003E\r\n                \u003Cfont color=\"#808000\"\u003Econtinue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Ereturn\u003C\u002Ffont\u003E; \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F зашли в тупик\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F натолкнулись на другую версию?\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion, r) &amp;&amp; cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion[r]!=renameto[rv]) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F слить renameto[rv] и cmd-\u003Eversion[r]\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        regnum from = std::max(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion[r], renameto[rv]),\u003Cbr\u002F\u003E\r\n               to = std::min(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion[r], renameto[rv]);\u003Cbr\u002F\u003E\r\n        renameto[from] = to;\u003Cbr\u002F\u003E\r\n        foreach(i, pcode) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.dest==from) i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.dest = to;\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (has2src(i)) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n                \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src1==from) i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E = to;\u003Cbr\u002F\u003E\r\n                \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src2==from) i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src\u003Cfont color=\"#ff6060\"\u003E2\u003C\u002Ffont\u003E = to;\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(contains(i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion, r) &amp;&amp; i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion[r]==from)\u003Cbr\u002F\u003E\r\n                i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion[r] = to;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E versionize(pcommandn cmd) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Ewhile\u003C\u002Ffont\u003E(!cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ereachcnt++) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F versionize registers that live on exit\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        foreach(r, cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eonexit)\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(!contains(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion, *r)) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n                regnum rv = newreg();\u003Cbr\u002F\u003E\r\n                renameto[rv] = rv;\u003Cbr\u002F\u003E\r\n                versionizeReg(cmd, *r, rv);\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n            versionize(cmd-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Etgt);\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (hasnext(cmd))\u003Cbr\u002F\u003E\r\n            cmd++;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eelse\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Ebreak\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F расщепление версий:\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach(i, pcode) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Eversion.clear();\u003Cbr\u002F\u003E\r\n        i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ereachcnt = \u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    renameto.clear();\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E lastbasereg = lastreg;\u003Cbr\u002F\u003E\r\n    versionize(pcode.begin());\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F переименовать версии, чтоб начинались с 1\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach(i, pcode) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.dest) i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.dest-=lastbasereg;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (has2src(i)) \u003Cfont color=\"#ff40ff\"\u003E{\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src1) i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E-=lastbasereg;\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src2) i-\u003Cfont color=\"#808000\"\u003E\u003E\u003C\u002Ffont\u003Ecmd.src\u003Cfont color=\"#ff6060\"\u003E2\u003C\u002Ffont\u003E-=lastbasereg;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#ff40ff\"\u003E}\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    lastreg -= lastbasereg;\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nОсталось реализовать собственно вылив регистра. Конкретизируем эвристику: вылить можно любой регистр, который жив, но командой не используется.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eregnum spillable(pcommandn cmd) { \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F найти регистр, который можно вылить\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    aliveset alive;\u003Cbr\u002F\u003E\r\n    alive.insert(cmd-\u003Eonenter.begin(), cmd-\u003Eonenter.end());\u003Cbr\u002F\u003E\r\n    alive.insert(cmd-\u003Eonexit.begin(), cmd-\u003Eonexit.end());\u003Cbr\u002F\u003E\r\n    alive.erase(cmd-\u003Ecmd.dest);\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (has2src(cmd)) {\u003Cbr\u002F\u003E\r\n        alive.erase(cmd-\u003Ecmd.src1);\u003Cbr\u002F\u003E\r\n        alive.erase(cmd-\u003Ecmd.src2);\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (!alive.size()) \u003Cfont color=\"#808000\"\u003Ereturn\u003C\u002Ffont\u003E \u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Ereturn\u003C\u002Ffont\u003E *alive.begin();\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nВ отдельном \u003Ccode\u003Emap\u003C\u002Fcode\u003E будем хранить по номеру регистра «адрес» его копии в памяти, чтобы все выливы регистра попадали в одно и то же место. Адрес присваивается регистру лишь в момент первого вылива.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u003Cfont color=\"#8080ff\"\u003E\u002F\u002F spill slots\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\nstd::map&lt;regnum,\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E\u003E spill;\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E lastspill = \u003Cfont color=\"#ff6060\"\u003E0\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E spillAt(pcommandn cmd, regnum victim, pcommandn next) {\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F найти \u002F выделить слот\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E spslot = spill[victim];\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(!spslot) {\u003Cbr\u002F\u003E\r\n        spslot = ++lastspill;\u003Cbr\u002F\u003E\r\n        spill[victim] = spslot;\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F вставить store перед и load после\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    pcommandn me = pcode.insert(next, *cmd);\u003Cbr\u002F\u003E\r\n    cmd-\u003Ecmd = command(command::store, victim, spslot);\u003Cbr\u002F\u003E\r\n    commandn load(command(command::load, victim, spslot));\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(hasnext(me))\u003Cbr\u002F\u003E\r\n        pcode.insert(next, load);\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E(me-\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n        me-\u003Etgt = pcode.insert(me-\u003Etgt, load);\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nПоскольку команда заменяется тройкой \u003Ccode\u003Estore-cmd-load\u003C\u002Fcode\u003E, нужно, чтобы существующие прыжки на команду прыгали на вставленный перед ней \u003Ccode\u003Estore\u003C\u002Fcode\u003E. Чтобы не искать такие прыжки по всему коду, мы вставляем \u003Ci\u003Eследующей\u003C\u002Fi\u003E командой копию \u003Ccode\u003Ecmd\u003C\u002Fcode\u003E, а потом \u003Ci\u003Eоригинал\u003C\u002Fi\u003E команды заменяем на \u003Ccode\u003Estore\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\nАналогично, если команда — условный переход, то нужно, чтобы \u003Ccode\u003Eload\u003C\u002Fcode\u003E выполнился при обоих исходах; поэтому и добавим его следующей командой, и вставим перед целью прыжка.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n(Немного досадно, что из-за возможности переезда команд из одного \u003Ccode\u003Ecommandn\u003C\u002Fcode\u003E в другой нам придётся связывать строки для \u003Ccode\u003Eecho\u003C\u002Fcode\u003E с самими командами по «идентификатору», как и в первой древесной реализации: ни индексы команд, ни указатели не остаются неизменными.)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВторая эвристика: если не удалось найти команду, в которой заняты все физические регистры, то возьмём тот физический регистр, который «лучше всего подходит» (меньше всего коллизий с уже назначенными регистрами), и попытаемся освободить его всюду, где он нужен, но занят.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F не хватило физ. регистра для п-регистра №r\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    regnum victim;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F эвристика 1: найдём команду, в которой не хватает регистров\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach2(i, pcode, next)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E ((i-\u003Ecmd.opcode!=command::load &amp;&amp; i-\u003Ecmd.opcode!=command::store) &amp;&amp;\u003Cbr\u002F\u003E\r\n                ((contains(i-\u003Eonenter, r) &amp;&amp; i-\u003Eonenterp.size()==lastp) ||\u003Cbr\u002F\u003E\r\n                 (contains(i-\u003Eonexit, r) &amp;&amp; i-\u003Eonexitp.size()==lastp))) {\u003Cbr\u002F\u003E\r\n            victim = spillable(i);\u003Cbr\u002F\u003E\r\n            assert(victim);\u003Cbr\u002F\u003E\r\n            spillAt(i, victim, next);\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Egoto\u003C\u002Ffont\u003E afterspill;\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F эвристика 2: найдём \"самый подходящий\" регистр\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    physreg bestfit = (physreg)(std::max_element(collisions.begin(), collisions.end())-collisions.begin()+\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E);\u003Cbr\u002F\u003E\r\n    foreach2(i, pcode, next)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E ((i-\u003Ecmd.opcode!=command::load &amp;&amp; i-\u003Ecmd.opcode!=command::store) &amp;&amp;\u003Cbr\u002F\u003E\r\n                ((contains(i-\u003Eonenter, r) &amp;&amp; contains(i-\u003Eonenterp, bestfit)) ||\u003Cbr\u002F\u003E\r\n                 (contains(i-\u003Eonexit, r) &amp;&amp; contains(i-\u003Eonexitp, bestfit))) &amp;&amp;\u003Cbr\u002F\u003E\r\n                (victim = spillable(i))) {\u003Cbr\u002F\u003E\r\n            spillAt(i, victim, next);\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Egoto\u003C\u002Ffont\u003E afterspill;\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n    yyerror(\u003Cfont color=\"#ff6060\"\u003E\"don't know how to proceed\"\u003C\u002Ffont\u003E);\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nПри расщеплении версий нужно не забыть скопировать номер слота (все версии одного регистра хранятся в одном слоте), а потом, при переименовании версий, — не забыть обновить \u003Ccode\u003Espill\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКомпилятор уже почти работает; последняя проблема — что генерируется куча бесполезных \u003Ccode\u003Eload\u003C\u002Fcode\u003E и \u003Ccode\u003Estore\u003C\u002Fcode\u003E, и из-за них не остаётся регистров на осмысленные команды.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EРабота с памятью\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nВо-первых, может оказаться, что некоторые регистры используются исключительно в командах \u003Ccode\u003Eload\u002Fstore\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nТакие команды бесполезны: регистр записывается всегда в тот же слот, из которого был прочитан.\u003Cbr\u002F\u003E\r\nВставим чистку после расщепления версий: там у нас как раз должно получиться много регистров с коротким временем жизни.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F вычистить бессмысленные регистры\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    std::vector&lt;\u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E\u003E used(lastreg+\u003Cfont color=\"#ff6060\"\u003E1\u003C\u002Ffont\u003E);\u003Cbr\u002F\u003E\r\n    foreach(i, pcode) {\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (writesdest(i) &amp;&amp; i-\u003Ecmd.opcode!=command::load)\u003Cbr\u002F\u003E\r\n            used[i-\u003Ecmd.dest] = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (readsdest(i) &amp;&amp; i-\u003Ecmd.opcode!=command::store)\u003Cbr\u002F\u003E\r\n            used[i-\u003Ecmd.dest] = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (has2src(i)) {\u003Cbr\u002F\u003E\r\n            used[i-\u003Ecmd.src1] = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n            used[i-\u003Ecmd.src2] = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    foreach(i, pcode)\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E ((i-\u003Ecmd.opcode==command::load &amp;&amp; !used[i-\u003Ecmd.dest]) ||\u003Cbr\u002F\u003E\r\n            (i-\u003Ecmd.opcode==command::store &amp;&amp; !used[i-\u003Ecmd.dest]))\u003Cbr\u002F\u003E\r\n                nopOut(i);\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nВо-вторых, если у нас есть цепочки одинаковых \u003Ccode\u003Eload\u003C\u002Fcode\u003E, то все, кроме последней, удалятся за то, что прочитанный регистр не жив. А вот если у нас цепочки одинаковых \u003Ccode\u003Estore\u003C\u002Fcode\u003E, то для их удаления нужно придумать нечто новое. Алгоритм очень похож на итеративное определение нужности регистров, только теперь определяем «несохранённость» — чтобы вычистить все сохранения уже сохранённых регистров.\u003Cul\u003E\r\n\u003Cli\u003Eрегистр не сохранён в команде, которая \u003Ci\u003Eзадаёт\u003C\u002Fi\u003E его значение;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eесли из команды A можно перейти на B (непосредственно или прыжком), и регистр не сохранён в A, то он не сохранён и в B;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eрегистр сохранён в команде, которая \u003Ci\u003Eсохраняет\u003C\u002Fi\u003E его значение.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E Видим, что от предыдущего этот алгоритм отличается только направлением распространения: нужность распространяется от каждой команды к предыдущим, а несохранённость — к последующим.\u003Cbr\u002F\u003E\r\nВ общем виде итеративный алгоритм вычисления множеств регистров в каждой точке программы называется \u003Ci\u003Edata flow analysis\u003C\u002Fi\u003E, и применяется, кроме двух названных, и для многих других оптимизаций.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u003Cfont color=\"#008000\"\u003Evoid\u003C\u002Ffont\u003E unsaved() {\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#008000\"\u003Ebool\u003C\u002Ffont\u003E changed = \u003Cfont color=\"#ff6060\"\u003Efalse\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 1\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n    foreach(i, pcode) {\u003Cbr\u002F\u003E\r\n        i-\u003Eonenter = i-\u003Eonexit = aliveset();\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (writesdest(i)) {\u003Cbr\u002F\u003E\r\n            i-\u003Eonexit.insert(i-\u003Ecmd.dest);\u003Cbr\u002F\u003E\r\n            changed = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n    \u003Cfont color=\"#808000\"\u003Ewhile\u003C\u002Ffont\u003E (changed) {\u003Cbr\u002F\u003E\r\n        changed = \u003Cfont color=\"#ff6060\"\u003Efalse\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        foreach2(i, pcode, next) {\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#008000\"\u003Eint\u003C\u002Ffont\u003E oldsize = i-\u003Eonenter.size()+i-\u003Eonexit.size();\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 2 (next command)\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (hasnext(i))\u003Cbr\u002F\u003E\r\n                next-\u003Eonenter.insert(i-\u003Eonexit.begin(), i-\u003Eonexit.end());\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 2 (jmp target)\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Ecmd.opcode==command::jz)\u003Cbr\u002F\u003E\r\n                i-\u003Etgt-\u003Eonenter.insert(i-\u003Eonexit.begin(), i-\u003Eonexit.end());\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F rule 3\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n            i-\u003Eonexit.insert(i-\u003Eonenter.begin(), i-\u003Eonenter.end());\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Ecmd.opcode==command::store)\u003Cbr\u002F\u003E\r\n                i-\u003Eonexit.erase(i-\u003Ecmd.dest);\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Eonenter.size()+i-\u003Eonexit.size() != oldsize)\u003Cbr\u002F\u003E\r\n                changed = \u003Cfont color=\"#ff6060\"\u003Etrue\u003C\u002Ffont\u003E;\u003Cbr\u002F\u003E\r\n        }\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#808000\"\u003Eafterspill\u003C\u002Ffont\u003E: \u003Cfont color=\"#8080ff\"\u003E\u002F\u002F пост-обработка после \"выливания регистра\"\u003C\u002Ffont\u003E\u003Cbr\u002F\u003E\r\n        unsaved();\u003Cbr\u002F\u003E\r\n        foreach(i, pcode)\u003Cbr\u002F\u003E\r\n            \u003Cfont color=\"#808000\"\u003Eif\u003C\u002Ffont\u003E (i-\u003Ecmd.opcode==command::store &amp;&amp; !contains(i-\u003Eonenter, i-\u003Ecmd.dest))\u003Cbr\u002F\u003E\r\n                nopOut(i);\u003Cbr\u002F\u003E\r\n    }\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EЧто получилось?\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nВесь компилятор вместе: \u003Ca href=\"http:\u002F\u002Ftyomitch.net.ru\u002Fjsk.y.regs.html\"\u003Etyomitch.net.ru\u002Fjsk.y.regs.html\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nИз полутысячи строк, к парсингу относится лишь пятая часть. Действительно кажется, что по сравнению с трудозатратами на остальную часть компилятора, парсер — неинтересная мелочь сбоку. Но это лишь потому, что создание парсеров обсосано до косточек, и нам остаётся лишь воспользоваться готовым; тогда как при обработке кода больше места выдумке.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ итоге назначения регистров и первых оптимизаций, генерируемый код удлинился всего на пару команд:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n00 mov   r01, 0\n01 mov   r02, 0x3e8\n02 echo  0x12e\n03 echo  r01\n04 echo  0xa8\n05 echo  r02\n06 echo  0xaf\n07 le    r03, r01, r02\n08 jz    r03, +0x1f (=0x28)\n09 add   r03, r01, r02\n0a mov   r04, 2\n0b div   r03, r03, r04\n0c echo  0x16a\n0d echo  r03\n0e echo  0xd4\n0f input r04\n10 store r01, 1\n11 mov   r01, 1\n12 eq    r01, r04, r01\n13 jz    r01, +5 (=0x19)\n14 load  r01, 1\n15 mov   r02, 1\n16 sub   r02, r03, r02\n17 add   r02, r02, 0\n18 jz    0,   -0x12 (=0x7)\n19 mov   r01, 2\n1a eq    r01, r04, r01\n1b jz    r01, +4 (=0x20)\n1c mov   r01, 1\n1d add   r01, r03, r01\n1e add   r01, r01, 0\n1f jz    0,   -0x19 (=0x7)\n20 load  r01, 1\n21 mov   r03, 3\n22 eq    r03, r04, r03\n23 jz    r03, +2 (=0x26)\n24 echo  0x14e\n25 hlt\n26 echo  0x172\n27 jz    0,   -0x21 (=7)\n28 echo  0x107\n29 hlt\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЗато, поскольку используется только четыре регистра, этот п-код возможно будет перевести в машинный код реального процессора.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПродолжим в августе: уезжаю в отпуск, и дописываю этот пост прямо из аэропорта.\u003Cbr\u002F\u003E\r\nВсем приятного лета!\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"компиляция"},{"titleHtml":"генерация кода"},{"titleHtml":"оптимизация кода"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F99595\u002F4d13f5ce93437f5263b41d1b58873bed\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F99595\u002F4d13f5ce93437f5263b41d1b58873bed\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F99595\\\u002F\"},\"headline\":\"Компиляция. 7: назначение регистров\",\"datePublished\":\"2010-07-23T06:40:13+04:00\",\"dateModified\":\"2010-07-23T06:40:13+04:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Artyom Skrobov\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"File names are infinite in length, where infinity is set to 255 characters. --Peter Collinson: The Unix File System Итак, у нас есть программа на п-коде, и в её...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F99595\\\u002F#post-content-body\",\"about\":[\"h_programming\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F99595\\\u002F4d13f5ce93437f5263b41d1b58873bed\\\u002F\"]}","metaDescription":"File names are infinite in length, where infinity is set to 255 characters.\r\n--Peter Collinson: The Unix File System\r\nИтак, у нас есть программа на п-коде, и в её распоряжении неограниченное...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"575686":{"id":"575686","timePublished":"2021-09-28T08:07:48+00:00","isCorporative":true,"lang":"ru","titleHtml":"Когда сделаете доработку?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1097452","alias":"Turundur","fullname":"Станислав Малышев","avatarUrl":"","speciality":"Разработчик"},"statistics":{"commentsCount":5,"favoritesCount":34,"readingCount":4182,"score":40,"votesCount":42},"hubs":[{"relatedData":null,"id":"22422","alias":"domclick","type":"corporative","title":"Блог компании ДомКлик","titleHtml":"Блог компании ДомКлик","isProfiled":false},{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EДовольно часто я попадаю в ситуацию, когда мне нужно в моменте оценить длительность реализации реализации бизнес-фичи. Обычно это какая-нибудь рядовая встреча, на которой инициатор бизнес-идеи, резво размахивая руками в воздухе, рассказывает о своем предложении. В конце своего выступления, в котором часто много слов (но не цифр) сказано о том, зачем это фича нужна и какой эффект она даст, всегда звучит сакральный вопрос: «Когда сделаете эту великолепную доработку?»\u003C\u002Fp\u003E\u003Cp\u003EЯ хотел бы поделиться с читателем ходом своих рассуждений, которые позволяют мне довольно точно оценивать сроки реализации даже в самых запущенных случаях.\u003C\u002Fp\u003E\u003Cp\u003EРазумеется, я не смогу предусмотреть и учесть все нюансы и специфики, принятые в различных компаниях в процессе разработки и вывода новой функциональности в эксплуатацию. Однако я верю, что описанные ниже практики будут полезны и вы сможете их адаптировать под свою ситуацию.\u003C\u002Fp\u003E\u003Cp\u003EСразу упомяну, что речь идет в первую очередь о продуктовых компаниях, где нет жесткого учета рабочего времени и можно подумать о качестве и поддерживаемости новой функциональности. В случае заказной разработки всё обычно гораздо сложнее и требует более детальной проработки.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb36\u002F6f1\u002Fe84\u002Fb366f1e845d886daf41be0f315b7c9a6.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb36\u002F6f1\u002Fe84\u002Fb366f1e845d886daf41be0f315b7c9a6.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"разработка"},{"titleHtml":"оценка"},{"titleHtml":"заказчик"}]},"579590":{"id":"579590","timePublished":"2021-09-27T23:58:49+00:00","isCorporative":true,"lang":"ru","titleHtml":"Seeed XIAO RP2040: микроконтроллер с отличными возможностями за $5","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Les Pounder","originalUrl":"https:\u002F\u002Fwww.tomshardware.com\u002Freviews\u002Fseeed-xiao-rp2040-review-dollar5-brain-food"}}],"author":{"id":"2071241","alias":"Deluar","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F1a5\u002F707\u002F699\u002F1a5707699dc1770d6a9cdd5d777d5bb0.jpg","speciality":"Разработчик"},"statistics":{"commentsCount":15,"favoritesCount":24,"readingCount":7770,"score":22,"votesCount":36},"hubs":[{"relatedData":null,"id":"14740","alias":"selectel","type":"corporative","title":"Блог компании Selectel","titleHtml":"Блог компании Selectel","isProfiled":false},{"relatedData":null,"id":"19737","alias":"controllers","type":"collective","title":"Программирование микроконтроллеров","titleHtml":"Программирование микроконтроллеров","isProfiled":true},{"relatedData":null,"id":"21894","alias":"gadgets","type":"collective","title":"Гаджеты","titleHtml":"Гаджеты","isProfiled":false},{"relatedData":null,"id":"21976","alias":"DIY","type":"collective","title":"DIY или Сделай сам","titleHtml":"DIY или Сделай сам","isProfiled":false},{"relatedData":null,"id":"22016","alias":"easyelectronics","type":"collective","title":"Электроника для начинающих","titleHtml":"Электроника для начинающих","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F53b\u002F390\u002F960\u002F53b39096013cb151e161ebf489fcca96.jpg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНа первый взгляд Seeed XIAO RP2040 не выглядит многообещающим. Но это обманчивое впечатление. Возможностей у него много. Благо, у компании есть опыт разработки подобных систем, ведь это не первый микроконтроллер от Seeed. Более того, ранее компания выпускала устройство на базе Seeeduino XIAO, которое выглядит близнецом XIAO RP2040, да и стоит столько же — $5.40. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНо у XIAO RP2040 другой чип — здесь мы имеем дело с RP2040 SoC, так что этот микроконтроллер гораздо более мощный, чем предыдущая система. Причем доплачивать не нужно — стоимость та же. Стоит ли новинка пяти долларов? Забегая наперед, скажу — да, стоит. \u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"микроконтроллеры"},{"titleHtml":"гаджеты"},{"titleHtml":"устройства"},{"titleHtml":"электроника"}]},"579778":{"id":"579778","timePublished":"2021-09-28T08:51:05+00:00","isCorporative":true,"lang":"ru","titleHtml":"YARL: как Яндекс построил распределённый Rate Limiter с нулевым влиянием на время ответа сервисов","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"91003","alias":"DenKoren","fullname":"Кореневский Денис","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F1a3\u002F2cd\u002F706\u002F1a32cd706b2d50526638707e3d3cdacc.png","speciality":"Release Engineer"},"statistics":{"commentsCount":7,"favoritesCount":23,"readingCount":3002,"score":38,"votesCount":38},"hubs":[{"relatedData":null,"id":"4991","alias":"yandex","type":"corporative","title":"Блог компании Яндекс","titleHtml":"Блог компании Яндекс","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"7504","alias":"refactoring","type":"collective","title":"Проектирование и рефакторинг","titleHtml":"Проектирование и рефакторинг","isProfiled":true},{"relatedData":null,"id":"8880","alias":"server_side_optimization","type":"collective","title":"Серверная оптимизация","titleHtml":"Серверная оптимизация","isProfiled":true},{"relatedData":null,"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EYandex Rate Limiter (далее просто YARL) — это сервис лимитирования нагрузки для распределённых сервисов. Его особенность в том, что он способен работать с миллионами квот, имея при этом очень низкие накладные расходы на проверку квоты. Если совсем кратко, это система распределённых \u003Ca href=\"https:\u002F\u002Fwww.wikiwand.com\u002Fen\u002FLeaky_bucket\" rel=\"nofollow noopener noreferrer\"\u003ELeaky Bucket'ов\u003C\u002Fa\u003E, с помощью которых можно ограничивать разные величины, связанные со временем: скорость передачи данных по сети, запросы в секунду и т. п.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdg\u002Fte\u002F--\u002Fdgte--d9wm8qyawhplaw4c87mky.jpeg\"\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EМеня зовут Денис Кореневский, я работаю в службе разработки внутреннего хранилища Яндекса, и сегодня я расскажу, как YARL устроен внутри, почему мы вообще написали своё решение и с какими трудностями нам пришлось столкнуться в процессе создания. Добро пожаловать под кат.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"rate limiter"},{"titleHtml":"балансировка нагрузки"}]},"579814":{"id":"579814","timePublished":"2021-09-28T08:18:35+00:00","isCorporative":true,"lang":"ru","titleHtml":"World of Tanks Blitz — как мы сделали для танков динамическую подвеску","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2793863","alias":"alexbabey","fullname":"Alexander Babey","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffbd\u002Fb5f\u002F74d\u002Ffbdb5f74ddb6dab8c23878b6bdfc06ca.jpg","speciality":"Render Developer"},"statistics":{"commentsCount":7,"favoritesCount":12,"readingCount":3004,"score":14,"votesCount":14},"hubs":[{"relatedData":null,"id":"18218","alias":"wargaming","type":"corporative","title":"Блог компании Wargaming","titleHtml":"Блог компании Wargaming","isProfiled":false},{"relatedData":null,"id":"643","alias":"3d_graphics","type":"collective","title":"Работа с 3D-графикой","titleHtml":"Работа с 3D-графикой","isProfiled":true},{"relatedData":null,"id":"21980","alias":"games","type":"collective","title":"Игры и игровые приставки","titleHtml":"Игры и игровые приставки","isProfiled":false}],"flows":[{"id":"2","alias":"design","title":"Дизайн"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EБольшой World of Tanks продолжает активно развиваться — игра часто получает обновления, включая как что-то, связанное с игровым процессом (новые карты и танки, режимы игры и сезонные события, умения экипажа и полевая модернизация), так и что-то чисто техническое. Например, использование новых графических технологий. Если мы говорим о ПК, то здесь есть множество гибких настроек, чтобы и комфортно поиграть с красивой картинкой, и сам ПК при этом не спалить.\u003C\u002Fp\u003E\u003Cp\u003EВ случае с мобильными устройствами все немного сложнее, и апдейты графики проводятся не так часто.&nbsp;\u003C\u002Fp\u003E\u003Cp\u003EВ этом посте рендер-разработчики студии мобильной разработки Wargaming MS-1 Рамиль Кудашев и Александр Бабей расскажут о том, что нового (и красивого) появилось в летнем релизе World of Tanks Blitz.&nbsp;\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EОсторожно, внутри тяжелые гифки.\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3a7\u002F9aa\u002Fc59\u002F3a79aac597c683f1a440fae3061a2296.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3a7\u002F9aa\u002Fc59\u002F3a79aac597c683f1a440fae3061a2296.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"mobile games"},{"titleHtml":"wot blitz"},{"titleHtml":"render"},{"titleHtml":"suspension"},{"titleHtml":"pbr"}]},"580104":{"id":"580104","timePublished":"2021-09-28T09:41:42+00:00","isCorporative":true,"lang":"ru","titleHtml":"«Рост зарплат в IT это плохо? Вы же шутите, да?»","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2294597","alias":"Svetlana_get-it","fullname":"Светлана Петровичева","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F911\u002Fccf\u002Fb06\u002F911ccfb06379afc9647fcc9d45656e72.jpg","speciality":"HR tech Entrepreneur, основатель сервиса headz.io"},"statistics":{"commentsCount":162,"favoritesCount":38,"readingCount":19696,"score":25,"votesCount":49},"hubs":[{"relatedData":null,"id":"22550","alias":"headzio","type":"corporative","title":"Блог компании Headz.io","titleHtml":"Блог компании Headz.io","isProfiled":false},{"relatedData":null,"id":"20688","alias":"research","type":"collective","title":"Исследования и прогнозы в IT","titleHtml":"Исследования и прогнозы в IT","isProfiled":false},{"relatedData":null,"id":"20740","alias":"career","type":"collective","title":"Карьера в IT-индустрии","titleHtml":"Карьера в IT-индустрии","isProfiled":false},{"relatedData":null,"id":"21890","alias":"statistics","type":"collective","title":"Статистика в IT","titleHtml":"Статистика в IT","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНедавно мы выпустили статью «\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fheadzio\u002Fblog\u002F578792\u002F\"\u003E\u003Cu\u003EДефицит в IT: платите больше\u003C\u002Fu\u003E\u003C\u002Fa\u003E» о росте зарплат. Совпадение или нет, но чуть позже вышла \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F578820\u002F\"\u003E\u003Cu\u003Eстатья о минусах большого заработка у российских айтишников\u003C\u002Fu\u003E\u003C\u002Fa\u003E. Автор рассуждал о том, как высокие зарплаты могут навредить IT-отрасли. На первый взгляд аргументы выглядят логично. Но это только на первый взгляд.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7a3\u002F36d\u002F860\u002F7a336d8606f7ceb93d3322caea8419cb.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7a3\u002F36d\u002F860\u002F7a336d8606f7ceb93d3322caea8419cb.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"рост зарплат"},{"titleHtml":"карьера программиста"},{"titleHtml":"карьера ит-специалиста"},{"titleHtml":"ответ"},{"titleHtml":"прогнозы"},{"titleHtml":"статистика"}]},"580168":{"id":"580168","timePublished":"2021-09-28T11:03:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как вообще Интернет приходит в ЦОД","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1919391","alias":"ntsaplin","fullname":"Никита Цаплин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F3a9\u002Fa0c\u002F722\u002F3a9a0c722ab0b73193e60b9f84f9a2c0.png","speciality":"010501.65 Прикладная математика и информатика"},"statistics":{"commentsCount":8,"favoritesCount":30,"readingCount":3116,"score":26,"votesCount":26},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"20","alias":"hosting","type":"collective","title":"Хостинг","titleHtml":"Хостинг","isProfiled":false},{"relatedData":null,"id":"20682","alias":"pm","type":"collective","title":"Управление проектами","titleHtml":"Управление проектами","isProfiled":true}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"Пользователь VDS-хостинга задал нам вопрос о том, откуда берётся Интернет. И тут мы поняли, что это тот самый детский вопрос, на который не так-то просто нормально ответить. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nДумаю, что 99 % людей ответят: берёт и приходит, а потом задумаются. Это настолько естественно и очевидно, что обычно просто не обсуждается. Ну там, знаете, оптика, она приходит в домик, в домике стоит коробка, а из коробки идёт медь. Вот примерно так оно и работает. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ теории всё так и есть, но на практике это выглядит немного иначе. И есть нюансы. Давайте покажу, откуда к нам приходит Интернет и в чём. А заодно поговорим про то, где фильтруется трафик и как это устроено в хостинге. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nДля нас всё начинается вот с этой ракеты в Королёве:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F580168\u002F\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fwl\u002Fkl\u002Fqf\u002Fwlklqfzn9is5zcsqlww90dwdqfc.jpeg\"\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fcommons.wikimedia.org\u002Fwiki\u002FFile:Vostok-2M_(8A292M)_in_Korolyov,_Moscow_Oblast.jpg\" rel=\"nofollow noopener noreferrer\"\u003EИсточник\u003C\u002Fa\u003E\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЭто памятник «Восток-2М» (8А292М), стоящий в Королёве примерно на том месте, где вообще был разработан «Восток». Перед ним находится люк, где одна трасса оптики разделяется на три к M9, или \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FMSK-IX\" rel=\"nofollow noopener noreferrer\"\u003EMSK-IX \u003C\u002Fa\u003E— московской международной телефонной станции № 9, где когда-то появился самый крупный узел обмена трафика. Сейчас это главное место, откуда Интернет поставляется в Москву. Из-за некоторых особенностей нашей территории бомбоубежища именно в этом люке под ракетой находится уязвимое место оптики, где все три канала идут вместе, и их легко перерубить экскаватором на протяжении примерно 120 метров. В других местах до и после ракеты такого нет. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nСоответственно один луч идёт через наш ЦОД в Ивантеевку, поворачивает в Щёлково и заканчивается на M9-IX. Второй подземный ввод идёт через Ярославское шоссе, третий ввод — дополнительный, он скачет по столбам от коллектора до ЦОДа в одну сторону и до местного провайдера в другую, а провайдер уже врезается в кольцо оптики по городу и тоже попадает в девятку.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"хостинг"},{"titleHtml":"VDS-хостинг"},{"titleHtml":"Интернет"},{"titleHtml":"ЦОД"},{"titleHtml":"ruvds_статьи"}]},"580170":{"id":"580170","timePublished":"2021-09-28T10:36:25+00:00","isCorporative":true,"lang":"ru","titleHtml":"Дитя конверсии: обзор ноутбука IBM ThinkPad iSeries 1400","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"154372","alias":"ereinion","fullname":"Виталий Прокофьев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F53d\u002F8ec\u002F1fb\u002F53d8ec1fb1d65d37bb85b94c51b17167.jpg","speciality":"Руководитель отдела услуг администрирования"},"statistics":{"commentsCount":0,"favoritesCount":6,"readingCount":3662,"score":24,"votesCount":24},"hubs":[{"relatedData":null,"id":"14740","alias":"selectel","type":"corporative","title":"Блог компании Selectel","titleHtml":"Блог компании Selectel","isProfiled":false},{"relatedData":null,"id":"21898","alias":"hardware","type":"collective","title":"Компьютерное железо","titleHtml":"Компьютерное железо","isProfiled":false},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false},{"relatedData":null,"id":"21930","alias":"antikvariat","type":"collective","title":"Старое железо","titleHtml":"Старое железо","isProfiled":false},{"relatedData":null,"id":"21952","alias":"notebooks","type":"collective","title":"Ноутбуки","titleHtml":"Ноутбуки","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsn\u002Fs4\u002F4f\u002Fsns44fybis21deyqyx_mrkwrkie.png\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nКогда компания пытается войти в новый для себя сегмент рынка, часто получаются очень необычные и забавные девайсы. Яркие примеры — почти электромобиль BMW i3, самолет HondaJet, постсоветские мясорубки и соковыжималки, которые после обработки напильником требовали лицензии на ношение, и ноутбуки IBM ThinkPad iSeries. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЗадуманные как недорогие машины для домашнего применения и крайне малого бизнеса, эти машины стали примером неоднозначных решений и странного дизайна. Но со временем превратились в большую редкость, не сразу понятую и принятую коллекционерами, но теперь — очень желанную.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ноутбук"},{"titleHtml":"лэптоп"},{"titleHtml":"старое железо"},{"titleHtml":"история ИТ"},{"titleHtml":"celeron"},{"titleHtml":"intel"},{"titleHtml":"thinkpad"},{"titleHtml":"ibm"},{"titleHtml":"lenovo"}]},"580214":{"id":"580214","timePublished":"2021-09-28T03:06:01+00:00","isCorporative":false,"lang":"ru","titleHtml":"Как выбрать подложку для СВЧ плат?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2759195","alias":"Leka_engineer","fullname":"Олеся","avatarUrl":"","speciality":"инженер-разработчик СВЧ устройств"},"statistics":{"commentsCount":24,"favoritesCount":16,"readingCount":1281,"score":18,"votesCount":24},"hubs":[{"relatedData":null,"id":"19395","alias":"netdev","type":"collective","title":"Разработка систем связи","titleHtml":"Разработка систем связи","isProfiled":true},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"22016","alias":"easyelectronics","type":"collective","title":"Электроника для начинающих","titleHtml":"Электроника для начинающих","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭтой статьёй я продолжаю цикл (надеюсь, что получится несколько) статей про особенности проектирования и изготовления СВЧ-плат. Эта  статья очень простая, так что, скорее всего, большинство читателей-СВЧшников не найдёт в ней ничего нового. Однако, я надеюсь, что статья будет полезна начинающим разработчикам.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"свч"},{"titleHtml":"свч-техника"},{"titleHtml":"печатная плата"},{"titleHtml":"производство электроники"},{"titleHtml":"разработка электроники"},{"titleHtml":"приложения для android"}]},"580222":{"id":"580222","timePublished":"2021-09-28T13:07:07+00:00","isCorporative":true,"lang":"ru","titleHtml":"Ортодонтия во взрослом возрасте: зачем вам это надо и что лучше знать до начала лечения","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2793023","alias":"magomedovazuzu","fullname":"Магомедова Зузу","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd25\u002Fd7f\u002Fc69\u002Fd25d7fc697c903cbe6dfdf1423b5b7ba.jpg","speciality":"Врач стоматолог-ортопед"},"statistics":{"commentsCount":5,"favoritesCount":17,"readingCount":2715,"score":16,"votesCount":24},"hubs":[{"relatedData":null,"id":"22616","alias":"belayaraduga","type":"corporative","title":"Блог компании Белая Радуга","titleHtml":"Блог компании Белая Радуга","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21996","alias":"health","type":"collective","title":"Здоровье","titleHtml":"Здоровье","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fph\u002Fy_\u002Fys\u002Fphy_ysqfi51itdfzul5g9ujtcpe.png\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Ci\u003E\u003Ca href=\"https:\u002F\u002Forthodonticassoc.com\u002Fblog\u002Fthe-evolution-of-orthodontic-braces\u002F\" rel=\"nofollow noopener noreferrer\"\u003EПримерно \u003C\u002Fa\u003Eтак в конце XIX века выпрямляли зубы\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ современном мире не принято умирать от кривых зубов. Максимум, что с вами случится, — станет не очень приятно широко открывать рот, вылетит челюстной сустав, вырастут амортизационные издержки на периодонт зубов, да и со стоматологом вы начнёте видеться чаще. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ принципе 99% проблем с расположением зубов сегодня можно исправить без проблем. Для этого есть опоры, создающие давление на зубы и кости, двигающие их. Брекеты несъёмные фиксируются с внешней или внутренней стороны зубов, ими можно решить много проблем, но они требуют постоянного ухода и посещения клиники раз в месяц. Альтернатива — элайнеры, прозрачные капы. Их можно снимать, чистить зубы как обычно и есть всё подряд. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ большинстве случаев ортодонтическое лечение требует от 8 месяцев до 2 лет в зависимости от сложности случая. На масштабные изменения вроде перемещения соседнего седьмого зуба на место отсутствующего шестого может уйти и 3 года. Плюс есть вероятность неуспеха, потому что нужно много считать.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nСмоделировать возможную ситуацию можно на основе данных КТ, телерентгенограммы и 3D-моделирования (это после съёмки полости рта сканером). Это более-менее страхует от скрытых кист, сверхкомплектных зубов и прочих радостей, которые могут вылезти в процессе лечения. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nИтак, сегодня: \u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E Что умеет современная ортодонтия и сколько она стоит.\u003C\u002Fli\u003E\r\n\u003Cli\u003E Как мы корректируем прикус с помощью брекетов и элайнеров. \u003C\u002Fli\u003E\r\n\u003Cli\u003E Зачем используем в дополнение минивинты (импланты) и нёбные расширители.\u003C\u002Fli\u003E\r\n\u003Cli\u003E Когда будет результат. И что мы делаем, чтобы его закрепить. \u003C\u002Fli\u003E\r\n\u003Cli\u003E Что может пойти не так при установке брекетов или элайнеров.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"зуб"},{"titleHtml":"ортодонтия"},{"titleHtml":"лечение"},{"titleHtml":"элайнеры"},{"titleHtml":"брекеты"},{"titleHtml":"стоматология"}]},"580240":{"id":"580240","timePublished":"2021-09-28T11:02:14+00:00","isCorporative":false,"lang":"ru","titleHtml":"SQLite-песочница в браузере","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"5634","alias":"nalgeon","fullname":"Антон Жиянов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F031\u002F537\u002F2ce\u002F0315372ce4ec69d2b80b64771b54b5a2.png","speciality":"Python, SQL и открытые данные"},"statistics":{"commentsCount":1,"favoritesCount":41,"readingCount":1733,"score":26,"votesCount":26},"hubs":[{"relatedData":null,"id":"144","alias":"open_source","type":"collective","title":"Open source","titleHtml":"Open source","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"594","alias":"sql","type":"collective","title":"SQL","titleHtml":"SQL","isProfiled":true},{"relatedData":null,"id":"18554","alias":"sqlite","type":"collective","title":"SQLite","titleHtml":"SQLite","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЧего мне всегда не хватало, так это аналога JSFiddle для SQLite. Онлайн-песочницы, в которой можно быстро проверить SQL-запрос и поделиться с другими.\u003C\u002Fp\u003E\u003Cp\u003EВот чего хотелось:\u003C\u002Fp\u003E\u003Cp\u003E— Возможность загрузить готовую базу, а не писать SQL для создания таблиц.\u003Cbr\u003E— Подключать как локальные базы, так и удаленные (по url).\u003Cbr\u003E— Сохранять базу и запросы в облаке.\u003Cbr\u003E— Бесплатно и без регистрации.\u003Cbr\u003E— Свежайшая версия SQLite.\u003Cbr\u003E— Минимализм.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd46\u002F816\u002Fde0\u002Fd46816de0e7cacdab5b8e27a6b48d6d0.png","buttonTextHtml":"В итоге сделал сам","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd46\u002F816\u002Fde0\u002Fd46816de0e7cacdab5b8e27a6b48d6d0.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"песочница"},{"titleHtml":"gist"},{"titleHtml":"sql.js"},{"titleHtml":"sqlime"}]},"580270":{"id":"580270","timePublished":"2021-09-28T07:08:30+00:00","isCorporative":true,"lang":"ru","titleHtml":"Варим суп из стали: оптимизация логистики ковшей и как устроен цех КЦ № 2","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2790193","alias":"AlexanderSkorniakov","fullname":"Александр Скорняков","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fcbf\u002F737\u002F072\u002Fcbf737072762c9fe82994575e36e0c25.jpg","speciality":"Руководитель цифровых продуктов"},"statistics":{"commentsCount":23,"favoritesCount":24,"readingCount":5120,"score":65,"votesCount":65},"hubs":[{"relatedData":null,"id":"22816","alias":"nlmk","type":"corporative","title":"Блог компании Блог компании Группа НЛМК","titleHtml":"Блог компании Блог компании Группа НЛМК","isProfiled":false},{"relatedData":null,"id":"397","alias":"analysis_design","type":"collective","title":"Анализ и проектирование систем","titleHtml":"Анализ и проектирование систем","isProfiled":true},{"relatedData":null,"id":"18816","alias":"industrial_control_system","type":"collective","title":"Промышленное программирование","titleHtml":"Промышленное программирование","isProfiled":true},{"relatedData":null,"id":"20682","alias":"pm","type":"collective","title":"Управление проектами","titleHtml":"Управление проектами","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"Привет из конвертерного цеха металлургического комбината! Смотрите, у нас тут есть вот такой суп в ковше, стоящем на сталевозе:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdh\u002F3m\u002Fmn\u002Fdh3mmn_3v_fbdyt4k2hs3fhfnjm.jpeg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Ci\u003EТаких ковшей на 320 тонн стали в цехе 40 штук, и они медленно остывают. Этой стали грустно и одиноко, она подмерзает. Через эти ковши проходит 10 миллионов тонн стали в год, это 14% стали России\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНа входе в цех у нас жидкий чугун и металлолом, на выходе надо получить сляб — большой слиток стали. Контур системы диспетчеризации «Гефест» начинается с конвертера, где мы продуваем чугун кислородом, таким образом окисляем и удаляем ненужные нам примеси. После конвертера получается «стальной бульон» для супа, в который уже можно добавлять основные ингредиенты, чтобы получались разные марки стали. За смену мы выплавляем несколько заказов, и каждая сталь требует своего рецепта — это разные добавки, разные техпроцессы, разные температуры и разные последовательности действий. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fiv\u002Fmh\u002Fdj\u002Fivmhdjdffezd6k7p1kmw38_akcu.jpeg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Ci\u003EНа участке аргонной установки\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nУзким местом, в зависимости от сорта стали, может стать любой технологический узел на пути плавки от конвертера до разливки — агрегаты внепечной обработки, мостовые краны или сталевозы для перемещения ковшей могут оказаться в какой-то конкретный момент перегружены. Раньше графики последовательности действий составлялись в блокноте человеком и были недостаточно оптимизированы. Плюс непредсказуемость: графики с довольно широкими временными границами дают большие потери производительности, а графики с узкими границами — не дают прореагировать на возможную поломку, задержку в процессе или вынужденную остановку. Не знаю, сколько стоит у вас простой прода, но у нас один остывший не к месту ковш запросто может нанести ущерба на несколько миллионов рублей. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ общем, мы написали систему, которая не только оптимизирует загрузку этого участка производства, но и регулярно (во время смены) пересчитывает всю логистику ковшей.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНо давайте начну с, собственно, рассказа про то, что же именно оптимизируется в цехе.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"сталь"},{"titleHtml":"производство"},{"titleHtml":"оптимизация"},{"titleHtml":"металл"},{"titleHtml":"металлургия"},{"titleHtml":"диспетчеризация"}]},"580304":{"id":"580304","timePublished":"2021-09-27T18:31:25+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как сделать 248MP фотографию Солнца","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Simon Tang","originalUrl":"https:\u002F\u002Fpetapixel.com\u002F2021\u002F09\u002F15\u002Fa-closer-look-how-i-created-a-248mp-photo-of-the-sun\u002F"}}],"author":{"id":"2192534","alias":"Itelma","fullname":"T-800","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc3a\u002Fd1e\u002F43d\u002Fc3ad1e43d500046c3228c9494b510912.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":12,"favoritesCount":15,"readingCount":4239,"score":18,"votesCount":18},"hubs":[{"relatedData":null,"id":"22356","alias":"itelma","type":"corporative","title":"Блог компании НПП ИТЭЛМА","titleHtml":"Блог компании НПП ИТЭЛМА","isProfiled":false},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21932","alias":"photo","type":"collective","title":"Фототехника","titleHtml":"Фототехника","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fe02\u002F643\u002Fa55\u002Fe02643a550e20aa10c366e20956e4b40.jpg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ci\u003EЭто изображение диска нашего Солнца создано с помощью большого рефракторного (линзового) телескопа и высокоскоростной монохромной CMOS-камеры.\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКаждый день над нашими головами висит большой шар света. Он там всегда, и никто не обращает на него внимания. Разумеется, мы не советуем вам долго смотреть на него и при этом ослепнуть, тем не менее, наука дала нам возможность смотреть прямо на солнце совершенно безопасно.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПоскольку техника стала более доступной, обычный человек может заглянуть в многочисленные слои Солнца с помощью специального оборудования, которое может купить в любом хорошем магазине телескопов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ этой статье мы подробно рассмотрим слой, известный как хромосфера: область Солнца, видимая в оранжево-красном спектре. При помощи специального фильтра это устройство блокирует весь нежелательный свет, пропуская при этом определенный диапазон частот, который нас интересует.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"обработка изображений"},{"titleHtml":"фототехника"}]},"580336":{"id":"580336","timePublished":"2021-09-28T05:40:43+00:00","isCorporative":false,"lang":"ru","titleHtml":"DOM, который построил Chrome. Или не построил? Или не Chrome? Или не DOM?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2671923","alias":"Maxim_from_HW","fullname":"Максим","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F33e\u002F1a0\u002F5ba\u002F33e1a05ba0d2d651cc292ce76ad45ee1.png","speciality":"CEO"},"statistics":{"commentsCount":22,"favoritesCount":52,"readingCount":4501,"score":18,"votesCount":22},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"524","alias":"complete_code","type":"collective","title":"Совершенный код","titleHtml":"Совершенный код","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EОбычный, теневой, виртуальный, инкрементальный… Как получилось, что простой программный интерфейс доступа к элементам веб-страниц обзавелся таким количеством «родственников»? Чем современные фреймворки не устраивает стандартная объектная модель документа или просто DOM? Что и как на самом деле отрисовывает браузер в процессе рендера веб-страницы?\u003C\u002Fp\u003E\u003Cp\u003EВсем привет, это \u003Ca href=\"https:\u002F\u002Fwww.facebook.com\u002Fmy.kravets\" rel=\"noopener noreferrer nofollow\"\u003EМакс Кравец\u003C\u002Fa\u003E из Holyweb. Помните сцену из Матрицы, в которой один из юных кандидатов в Избранные наставляет Нео: «Не пытайся согнуть ложку. Первое, что ты должен понять — ложки не существует!»? Давайте переформулирую: «Не пытайся изменить DOM...». А вот о том, что прячется под многоточием, мы сегодня и поговорим.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5c9\u002F1cb\u002Fe9b\u002F5c91cbe9b4674ea479fed0a55f81fb7c.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5c9\u002F1cb\u002Fe9b\u002F5c91cbe9b4674ea479fed0a55f81fb7c.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"dom"},{"titleHtml":"google chrome"},{"titleHtml":"javascript"},{"titleHtml":"css"}]},"580348":{"id":"580348","timePublished":"2021-09-28T08:18:27+00:00","isCorporative":true,"lang":"ru","titleHtml":"Самый большой космический телескоп Джеймс Уэбб должен изменить наши представления о космосе","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"64252","alias":"Cloud4Y","fullname":"Cloud4Y","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc2d\u002Fd0d\u002Fc05\u002Fc2dd0dc05834aebeb86bb76e35caeaab.png","speciality":"Корпоративный облачный провайдер"},"statistics":{"commentsCount":27,"favoritesCount":8,"readingCount":4146,"score":27,"votesCount":29},"hubs":[{"relatedData":null,"id":"17352","alias":"cloud4y","type":"corporative","title":"Блог компании Cloud4Y","titleHtml":"Блог компании Cloud4Y","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИзучение новых миров,  понимание происхождения Вселенной, поиск жизни вне Земли. Всё это — задачи космического телескопа \"Джеймс Уэбб\", долгожданного преемника Хаббла.  Телескоп больше и легче Хаббла, зато в 100 раз мощнее,  а приборы — в семь раз чувствительнее. \u003C\u002Fp\u003E\u003Cp\u003EДжеймс Уэбб — это устройство для поиска ответов на неотвеченные вопросы о Вселенной, для изучения того, что до сих пор оставалось неизведанным. Что же такого в этом телескопе?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ed\u002F24e\u002Fd75\u002F0ed24ed759f6e945b81c1ce1beedd228.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ed\u002F24e\u002Fd75\u002F0ed24ed759f6e945b81c1ce1beedd228.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Телескоп"},{"titleHtml":"уэбб"},{"titleHtml":"космос"},{"titleHtml":"технологии"}]},"580360":{"id":"580360","timePublished":"2021-09-28T07:27:40+00:00","isCorporative":true,"lang":"ru","titleHtml":"Вы используете больше Open Source-софта, чем думаете","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Klint Finley","originalUrl":"https:\u002F\u002Fgithub.com\u002Freadme\u002Ffeatured\u002Funseen-oss"}}],"author":{"id":"16172","alias":"shurup","fullname":"Дмитрий Шурупов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F062\u002Fc85\u002F607\u002F062c85607fbe4aaa29e1ad2076cd13a0.jpg","speciality":"Open Source geek"},"statistics":{"commentsCount":1,"favoritesCount":6,"readingCount":3478,"score":26,"votesCount":30},"hubs":[{"relatedData":null,"id":"20940","alias":"flant","type":"corporative","title":"Блог компании Флант","titleHtml":"Блог компании Флант","isProfiled":false},{"relatedData":null,"id":"144","alias":"open_source","type":"collective","title":"Open source","titleHtml":"Open source","isProfiled":true},{"relatedData":null,"id":"20688","alias":"research","type":"collective","title":"Исследования и прогнозы в IT","titleHtml":"Исследования и прогнозы в IT","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cstrong\u003E\u003Cem\u003EПрим. перев.\u003C\u002Fem\u003E\u003C\u002Fstrong\u003E\u003Cem\u003E: оригинал этой статьи был опубликован минувшим летом в рамках проекта ReadME. Он создан в GitHub с целью стать своеобразной трибуной для многочисленных Open Source-разработчиков, предоставив им возможность поделиться с широким сообществом актуальными для них проблемами. Данный материал несет в себе призыв «перестать воспринимать Open Source как должное» и раскрывает те сложности, с которыми сталкиваются многие авторы свободного ПО, применяемого буквально повсеместно.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EТобиас Копперс (Tobias Koppers) не работает в Instagram. И никогда не работал. Но с 2014 года он отвечает за поддержку важного компонента веб-версии Instagram. Копперс является создателем webpack — Open Source-инструмента для сборки (или «бандлинга») кода JavaScript.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"open source"}]},"580374":{"id":"580374","timePublished":"2021-09-28T08:46:26+00:00","isCorporative":true,"lang":"ru","titleHtml":"Делаем базу знаний для .NET разработчиков","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1181772","alias":"nevoroman","fullname":"Роман Неволин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F21d\u002F1d5\u002F7d9\u002F21d1d57d92a296101a1da62761632a78.jpg","speciality":"DevRel"},"statistics":{"commentsCount":6,"favoritesCount":24,"readingCount":2249,"score":12,"votesCount":14},"hubs":[{"relatedData":null,"id":"15878","alias":"skbkontur","type":"corporative","title":"Блог компании Контур","titleHtml":"Блог компании Контур","isProfiled":false},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"546","alias":"net","type":"collective","title":".NET","titleHtml":".NET","isProfiled":true},{"relatedData":null,"id":"20740","alias":"career","type":"collective","title":"Карьера в IT-индустрии","titleHtml":"Карьера в IT-индустрии","isProfiled":false},{"relatedData":null,"id":"20754","alias":"tech_events","type":"collective","title":"Конференции","titleHtml":"Конференции","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"},{"id":"4","alias":"marketing","title":"Маркетинг"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EМы вместе с DotNetRu решили сделать базу знаний для .NET разработчиков. Собрать доступные в открытом доступе материалы по .NET и выбрать из них лучшие. Разбить все это по категориям и сложности, выстроить порядок изучения. А еще пригласить известных экспертов в каждой из тем, чтобы они помогли выбрать материалы и рассказали, что и почему вам будет полезно изучить.\u003C\u002Fp\u003E\u003Cp\u003EИ теперь мы по этому поводу будем проводить по два митапу раз в две недели — начиная уже с этой пятницы. Под катом будут детали, имена, даты и всякие пояснения, что и почему мы хотим сделать.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5dd\u002F71e\u002Fcc9\u002F5dd71ecc908ff997a1f46f440a9daaad.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5dd\u002F71e\u002Fcc9\u002F5dd71ecc908ff997a1f46f440a9daaad.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"образование"},{"titleHtml":"dotnetru"},{"titleHtml":"opensource"},{"titleHtml":"обучение разработчика"}]},"580382":{"id":"580382","timePublished":"2021-09-28T10:30:17+00:00","isCorporative":true,"lang":"ru","titleHtml":"Советский «Мерседес» или как в Минске строили спортпрототип","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2776555","alias":"turbovagon","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":2,"favoritesCount":5,"readingCount":1920,"score":17,"votesCount":21},"hubs":[{"relatedData":null,"id":"17357","alias":"timeweb","type":"corporative","title":"Блог компании Timeweb","titleHtml":"Блог компании Timeweb","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"22004","alias":"transport","type":"collective","title":"Транспорт","titleHtml":"Транспорт","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Во второй половине 50-х годов в Советском Союзе начал набирать популярность автоспорт. Появляются всё новые соревнования, усложняется их регламент, растут требования и к гонщикам, и к машинам. На старт шоссейно-кольцевых начали выходить уже не слегка «обработанные напильником» серийные легковушки, а вполне гоночные штучные поделки, напоминающие современные спортпрототипы.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fz7\u002Fgs\u002Fzg\u002Fz7gszgbo8pc-ogtvjgvjd6vpaga.jpeg\"\u003E\u003Cbr\u003E\r\n\u003Ci\u003EВот, например, некоторые участники заезда 1956 года. Штучное поделие МАЗа с двигателем «Москвич-402» в первом ряду. Дальше будет лучше.\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nОдним из них стал МАЗ-1500, детище, как нетрудно догадаться, специалистов Минского автозавода. Да, профильным направлением предприятия были грузовики. Однако от кульманов конструкторов до воплощения в металле доходила и разного рода автоэкзотика. Посему, когда в Минавтопроме БССР возникла идея создать команду для участия в чемпионате Советского Союза по шоссейно-кольцевым гонкам, работу по новому проекту возглавил руководитель Конструкторского отдела МАЗа, автогонщик Владимир Майборода.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ссср"},{"titleHtml":"спорткар"},{"titleHtml":"автогонки"},{"titleHtml":"гараж"},{"titleHtml":"МАЗ"},{"titleHtml":"автомобили"}]},"580428":{"id":"580428","timePublished":"2021-09-28T10:57:35+00:00","isCorporative":true,"lang":"ru","titleHtml":"«Понаехавший» в Чехию: как купить квартиру в столице и стать «своим» с акцентом","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2581359","alias":"annesina","fullname":"Анна Есина","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5d1\u002Fc94\u002F326\u002F5d1c943260bd153cf9263a6b59e7be21.png","speciality":"Пользователь"},"statistics":{"commentsCount":3,"favoritesCount":24,"readingCount":3652,"score":15,"votesCount":19},"hubs":[{"relatedData":null,"id":"22506","alias":"gms","type":"corporative","title":"Блог компании gms & g-mate","titleHtml":"Блог компании gms & g-mate","isProfiled":false},{"relatedData":null,"id":"20734","alias":"it_immigration","type":"collective","title":"IT-эмиграция","titleHtml":"IT-эмиграция","isProfiled":false},{"relatedData":null,"id":"20740","alias":"career","type":"collective","title":"Карьера в IT-индустрии","titleHtml":"Карьера в IT-индустрии","isProfiled":false},{"relatedData":null,"id":"20742","alias":"read","type":"collective","title":"Читальный зал","titleHtml":"Читальный зал","isProfiled":false},{"relatedData":null,"id":"22024","alias":"urban","type":"collective","title":"Урбанизм","titleHtml":"Урбанизм","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EБольшое количество компаний и стартапов приглашают в Чехию IT-специалистов из стран СНГ. Почему они приезжают сюда? Разработчик из Омска ответил на популярные вопросы о переезде программиста в Прагу: какие нужны документы, как проходит адаптация, нужен ли диплом и как приобрести свое жилье. Передаем ему слово.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F995\u002F1b1\u002F45c\u002F9951b145c95413abb6f46ba5649b52f2.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F995\u002F1b1\u002F45c\u002F9951b145c95413abb6f46ba5649b52f2.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"g-mate"},{"titleHtml":"прага"},{"titleHtml":"чехия"},{"titleHtml":"переезд"},{"titleHtml":"IT-эмиграция"},{"titleHtml":"релокейт"},{"titleHtml":"релокация"}]},"580468":{"id":"580468","timePublished":"2021-09-28T12:04:47+00:00","isCorporative":true,"lang":"ru","titleHtml":"Проект «Горирожа»: про двойной подбородок","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1588913","alias":"elena_pastukhova","fullname":"Елена Пастухова","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F1dc\u002F879\u002Fc33\u002F1dc879c33e39127162333771dba2137a.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":19,"favoritesCount":17,"readingCount":3156,"score":15,"votesCount":43},"hubs":[{"relatedData":null,"id":"21848","alias":"geltek","type":"corporative","title":"Блог компании Гельтек-Медика","titleHtml":"Блог компании Гельтек-Медика","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21996","alias":"health","type":"collective","title":"Здоровье","titleHtml":"Здоровье","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Борода у мужчин — это самый действенный способ скрыть жир. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЕсть люди, которым повезло с квадратной челюстью: тогда всё прямо натянуто, и когда у обычного человека уже был бы тройной подбородок, у них — только двойной. Но если у вас славянский тип лица, то это не про вас. У нас прекрасный профиль, но в профиль будет видно даже минимальное количество жира. У азиатского типа — высокие скулы, которые тянут жир в другую сторону, а у нас нет никаких подобных генетических конструкций, поэтому при деформационном типе старения всё это ползёт вниз. Формируется либо второй подбородок, либо жировой компартмент располагается на щеках, и появляются так называемые «бульдожьи щёки». \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПоскольку жир там точно такой же, как на пузе и боках у мальчиков и на попе у девочек, то бороться с ним можно дефицитом калорий и физической нагрузкой. Ещё можно уменьшить склонность к отёчности и поднять тонус кожи через увлажнение. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nСюрпризом стало то, что испытуемые из тестовой группы проекта Thermo Intensive (более известного вам как «\u003Ca href=\"https:\u002F\u002Fgeltek-medica.ru\u002Fcatalog\u002Fkosmetika\u002Fseriya-body-care\u002Fanticellyulitnyj-gel-thermo-intensive\u002F\u002F\" rel=\"nofollow noopener noreferrer\"\u003EГорижопа\u003C\u002Fa\u003E» ) начали мазать средство не в целевую область, а ещё и на лицо, рассчитывая, что жир там будет убираться так же быстро. Мы сразу запретили им это делать (потому что щитовидка рядом, а мажут они широко) и сразу задумались про новое средство. \u003Cbr\u003E\r\n \u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fbk\u002Fsd\u002Ffy\u002Fbksdfyfl8jwg3mvvmrjs4xzibz4.png\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Ci\u003EПервая стадия, когда борода ещё не особо нужна. \u003Ca href=\"https:\u002F\u002Fmelmagazine.com\u002Fwp-content\u002Fuploads\u002F2018\u002F08\u002F1SmLNcqJD9Ao7TSeV1MwobA.png\" rel=\"nofollow noopener noreferrer\"\u003EИсточник\u003C\u002Fa\u003E\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПотому что бета-тестеры обозначили нам рыночную нишу. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nСобственно, вы его тогда спрашивали и в комментариях, сразу раскусив, как можно неправильно использовать состав. И вот теперь у меня есть что показать.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"горирожа"},{"titleHtml":"второй подбородок"},{"titleHtml":"жир"},{"titleHtml":"артикулярная гимнастика"},{"titleHtml":"средство"},{"titleHtml":"гель"}]},"580516":{"id":"580516","timePublished":"2021-09-28T14:25:12+00:00","isCorporative":false,"lang":"ru","titleHtml":"Лучший язык программирования","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"8114","alias":"markshevchenko","fullname":"Марк Шевченко","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb16\u002F6c1\u002Fc82\u002Fb166c1c82387bf9406fcd39f40dc264e.jpg","speciality":"программист"},"statistics":{"commentsCount":17,"favoritesCount":48,"readingCount":6837,"score":28,"votesCount":34},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВопрос, который часто задают начинающие программисты&nbsp;— какой язык программирования изучать? Вопрос звучит разумно. Хочется выбрать самый лучший, чтобы потом не пришлось переучиваться.\u003C\u002Fp\u003E\u003Cp\u003EМожно ли на него ответить?\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"образование"},{"titleHtml":"языки программирования"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["580270","575686","579778","580516","580348","580168","580240","580360","580104","580170","579590","580336","580214","580304","580382","580222","580468","580428","579814","580374"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":4},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["473220","468027","467353"],"similarListRefs":{"467353":{"id":"467353","timePublished":"2019-09-17T07:40:32+00:00","isCorporative":false,"lang":"ru","titleHtml":"Методы оптимизации кода для Redd. Часть 1: влияние кэша","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1145546","alias":"EasyLy","fullname":"Павел Локтев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F2eb\u002F39b\u002F24c\u002F2eb39b24c4a68d43ad0b0015c5c56aa2.png","speciality":"Системное ПО, инструменты для разработчиков"},"statistics":{"commentsCount":9,"favoritesCount":15,"readingCount":1362,"score":11,"votesCount":13},"hubs":[{"id":"5767","alias":"system_programming","type":"collective","title":"Системное программирование","titleHtml":"Системное программирование","isProfiled":true},{"id":"19737","alias":"controllers","type":"collective","title":"Программирование микроконтроллеров","titleHtml":"Программирование микроконтроллеров","isProfiled":true},{"id":"21898","alias":"hardware","type":"collective","title":"Компьютерное железо","titleHtml":"Компьютерное железо","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп","titleHtml":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"В \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F452656\u002F\"\u003Eпервой статье\u003C\u002Fa\u003E цикла я активно продвигал идею, что разработка кода под Redd вторична, а первичен основной проект. Redd — вспомогательный инструмент, так что тратить на него уйму времени неправильно. То есть разработка под него должна идти быстро. Но это совсем не значит, что получившиеся программы должны быть неоптимальны. Собственно, если их совсем не оптимизировать, то просто мощности аппаратуры не хватит, чтобы реализовать нужную тестовую систему. Поэтому процесс, как я и сказал, должен быть быстрым и непринуждённым, но вот некоторые принципы оптимизации разработчик должен всегда держать в уме.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fky\u002Fgv\u002Fge\u002Fkygvge7bilfbzntymcu3qzlk4mq.jpeg\"\u003E\u003Cbr\u003E\r\n \u003Cbr\u003E\r\nПро оптимизацию изданы толстые книжки. Часть этих книжек полезна, часть уже устарела, так как описанные в них принципы давно перекочевали на этап автоматической оптимизации при сборке кода… Но существуют некоторые вещи, которые не имеют никакой ценности при разработке обычных программ под обычные процессоры, поэтому в типовых книжках обычно не описывается. Их мы сейчас и начнём рассматривать.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"status":"published","plannedPublishTime":null,"checked":null},"468027":{"id":"468027","timePublished":"2019-09-26T11:25:58+00:00","isCorporative":false,"lang":"ru","titleHtml":"Методы оптимизации кода для Redd. Часть 2: некэшируемая память и параллельная работа шин","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1145546","alias":"EasyLy","fullname":"Павел Локтев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F2eb\u002F39b\u002F24c\u002F2eb39b24c4a68d43ad0b0015c5c56aa2.png","speciality":"Системное ПО, инструменты для разработчиков"},"statistics":{"commentsCount":2,"favoritesCount":18,"readingCount":1002,"score":14,"votesCount":16},"hubs":[{"id":"5767","alias":"system_programming","type":"collective","title":"Системное программирование","titleHtml":"Системное программирование","isProfiled":true},{"id":"19737","alias":"controllers","type":"collective","title":"Программирование микроконтроллеров","titleHtml":"Программирование микроконтроллеров","isProfiled":true},{"id":"21898","alias":"hardware","type":"collective","title":"Компьютерное железо","titleHtml":"Компьютерное железо","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп","titleHtml":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"В \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F467353\u002F\"\u003Eпрошлой статье\u003C\u002Fa\u003E мы выяснили, что кэш — это безусловно полезная штука, но применительно к контроллерной логике он иногда создаёт трудности. В частности, он вносит непредсказуемость длительности импульсов либо иных задержек при программном формировании временных диаграмм. Ну, и в «общепрограммистском» плане, неудачное расположение функции может свести выигрыш от кэша на нет, постоянно провоцируя его перезагрузку из медленной памяти. Я упоминал, что 15 лет назад мы вынуждены были делать специальный препроцессор, который устранял возникающие проблемы для процессора SPARC-8, и обещал, что расскажу, как легко устранить подобные трудности при разработке для синтезированного процессора Nios II, рекомендуемого для использования в комплексе Redd. Пришла пора выполнить обещание.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fpr\u002Fsx\u002Fix\u002Fprsxixkamqwdpusqqagnx0xnh1q.png\"\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"status":"published","plannedPublishTime":null,"checked":null},"473220":{"id":"473220","timePublished":"2019-11-08T15:01:46+00:00","isCorporative":true,"lang":"ru","titleHtml":"Краеугольные камни уничтожения медленного кода в Wolfram Language: ускоряем код в десятки, сотни и тысячи раз","editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"593575","alias":"OsipovRoman","fullname":"Осипов Роман","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F023\u002F54a\u002Fbd3\u002F02354abd3288d831c9d107fa7277a941.jpg","speciality":"Руководитель IT-студии, эксперт Wolfram, математик"},"statistics":{"commentsCount":20,"favoritesCount":62,"readingCount":6742,"score":20,"votesCount":22},"hubs":[{"id":"10020","alias":"wolfram","type":"corporative","title":"Блог компании Wolfram Research","titleHtml":"Блог компании Wolfram Research","isProfiled":false},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true},{"id":"17716","alias":"debug","type":"collective","title":"Отладка","titleHtml":"Отладка","isProfiled":true},{"id":"17853","alias":"funcprog","type":"collective","title":"Функциональное программирование","titleHtml":"Функциональное программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv class=\"oembed\"\u003E\u003Cdiv\u003E\u003Cdiv style=\"left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.2493%;\"\u003E\u003Ciframe src=\"https:\u002F\u002Fwww.youtube.com\u002Fembed\u002FA6PXwq2TNOI?rel=0&amp;showinfo=1&amp;hl=en-US\" style=\"border: 0; top: 0; left: 0; width: 100%; height: 100%; position: absolute;\" allowfullscreen scrolling=\"no\"\u003E\u003C\u002Fiframe\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cb\u003EСкачать файл с кодом и данные можно в \u003Ca href=\"https:\u002F\u002Fblog.wolframmathematica.ru\u002F2208\u002F07-11-2019\u002F\"\u003Eоригинале поста в моем блоге\u003C\u002Fa\u003E\u003C\u002Fb\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКартинка к вебинару и посту взята не просто так: в определенном смысле символьное ядро Wolfram Language можно сравнить с Таносом — если бы его мощь была бы направлена в правильное русло, он мог бы стать самым мощным и полезным «добряком». Так же и с символьным ядром Wolfram — его чудовищную мощь нужно правильно использовать, а если это делать не так, оно может стать настоящим «злом», замедляющим все очень сильно. Начинающие разработчики не знают многих важнейших парадигм, идей и принципов языка Wolfram Language, пишут код, который на самом деле дико неэффективен и после этого разочаровываются, хотя тут нет вины Wolfram Language. Эту ситуацию призвана исправить эта статья.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nМне довелось работать с Wolfram Language начиная с (уже довольно далекого) 2005 года (тогда еще была версия Mathematica 5.2, сейчас уже 12-я). За эти почти 15 лет произошло очень много: добавились тысячи новых встроенных функций и областей, в которых они работают (\u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FMachineLearning.html\"\u003Eмашинное обучение\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FGeometricComputation.html\"\u003Eточная геометрия\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FAudioProcessing.html\"\u003Eработа с аудио\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FWebOperations.html\"\u003Eработа в вебе\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FCloudFunctionsAndDeployment.html\"\u003Eоблачные возможности\u003C\u002Fa\u003E, глубокая поддержка \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FUnits.html\"\u003Eединиц измерения\u003C\u002Fa\u003E, интеграция с \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FKnowledgeRepresentationAndAccess.html\"\u003Eбазами данных Wolfram|Alpha\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FGeographicData.html\"\u003Eгеографические вычисления\u003C\u002Fa\u003E, поддержка работы с \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002FCUDALink\u002Fguide\u002FCUDALink.html\"\u003ECUDA\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Freference.wolfram.com\u002Flanguage\u002FWolframClientForPython\u002F\"\u003EPython\u003C\u002Fa\u003E, \u003Ca href=\"http:\u002F\u002Freference.wolfram.com\u002Flanguage\u002Fguide\u002FParallelComputing.html\"\u003Eраспараллеливание\u003C\u002Fa\u003E операций и многое многое другое), появились новые сервисы — облако \u003Ca href=\"https:\u002F\u002Fwww.wolframcloud.com\u002F\"\u003EWolfram Cloud\u003C\u002Fa\u003E, широко известная система вычислительных значeний \u003Ca href=\"https:\u002F\u002Fwww.wolframalpha.com\u002F\"\u003EWolfram|Alpha\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fresources.wolframcloud.com\u002FFunctionRepository\u002F\"\u003Eрепозиторий функций\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fresources.wolframcloud.com\u002FNeuralNetRepository\u002F?source=nav\"\u003Eрепозиторий нейросетей\u003C\u002Fa\u003E и пр.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":null,"image":null},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"tyomitch":{"scoreStats":{"score":414.5,"votesCount":796},"rating":7.6,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"57766","alias":"tyomitch","fullname":"Artyom Skrobov","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb71\u002F804\u002Fe6d\u002Fb71804e6dcbec22ada05c488b7ee4c1b.png","speciality":"Пользователь"}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
