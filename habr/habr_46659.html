<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Иерархические структуры данных и Doctrine / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/46659\/"},"headline":"Иерархические структуры данных и Doctrine","datePublished":"2008-12-10T18:18:21+03:00","dateModified":"2008-12-10T23:05:45+03:00","author":{"@type":"Person","name":"Михаил Стадник"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Введение  Хранение иерархических данных (или попросту &mdash; деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда раз...","url":"https:\/\/habr.com\/ru\/post\/46659\/#post-content-body","about":["h_webdev","f_develop"],"image":["https:\/\/habrastorage.org\/getpro\/habr\/post_images\/fce\/1c2\/6b3\/fce1c26b3ecdcee5037ccf2e5fa86d50.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/765\/d7e\/b72\/765d7eb723f92da4a974817d19863bc3.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/90b\/a43\/b01\/90ba43b011ca58799b0fad09a9c289de.gif","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/39a\/cbc\/47e\/39acbc47ef660d9a3ba01e25ace3d8d9.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/80d\/126\/cb0\/80d126cb007779d502bd92e6522774cb.gif","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/96b\/f21\/dcb\/96bf21dcb4175e85c0ee696932d100c9.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/55c\/36b\/37b\/55c36b37b77a5d3c8e23b66fd53cd807.gif","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/051\/fca\/96a\/051fca96a9b383a0554ffbd9188fe61d.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/235\/bd0\/09b\/235bd009bafdd26ee393aafd6e540f90.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Иерархические структуры данных и Doctrine" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Иерархические структуры данных и Doctrine" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Иерархические структуры данных и Doctrine" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Введение

Хранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Введение

Хранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Введение

Хранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Введение

Хранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Введение

Хранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/46659/8262acf054ba6d751ee5f3622c1875df/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/46659/8262acf054ba6d751ee5f3622c1875df/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/46659/8262acf054ba6d751ee5f3622c1875df/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/46659/8262acf054ba6d751ee5f3622c1875df/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/46659/8262acf054ba6d751ee5f3622c1875df/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="46659" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2008-12-10T15:18:21.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/46659/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/46659/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" rel="amphtml" href="https://habr.com/ru/amp/post/46659/"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/46659/8262acf054ba6d751ee5f3622c1875df/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Mikhus/" title="Mikhus" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/6e4/8eb/cc7/6e48ebcc7a0a442dd08af1ecd52e5ee6.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/Mikhus/" class="tm-user-info__username">
      Mikhus
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2008-12-10T15:18:21.000Z" title="2008-12-10, 18:18">10  декабря  2008 в 18:18</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Иерархические структуры данных и Doctrine</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/webdev/" class="tm-article-snippet__hubs-item-link"><span>Разработка веб-сайтов</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><h2>Введение</h2><br/>
<br/>
Хранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной задачей.<br/>
<br/>
В первую очередь, это связано с тем, что реляционные базы не приспособлены к хранению иерархических структур (как, например, XML-файлы), структура реляционных таблиц представляет из себя простые списки. Иерархические же данные имеют связь «родитель-наследники», которая не реализована в реляционной структуре.<br/>
<br/>
Тем не менее, задача «хранить деревья в базе данных» рано или поздно возникает перед любым разработчиком.<br/>
<br/>
Ниже мы подробно рассмотрим, какие существуют подходы в организации хранения деревьев в реляционных БД, а также рассмотрим инструментарий, который нам предоставляет ORM Doctrine для работы с такими структурами.<br/>
<a name="habracut"></a><br/>
<h2>Список смежных вершин (Adjacency List)</h2><br/>
<br/>
<h3>Описание структуры</h3><br/>
<br/>
Как правило, такая структура данных предполагает хранение информации о смежных вершинах нашего дерева. Давайте рассмотрим простейший граф с темя вершинами (1,2,3):<br/>
<br/>
<img title="Граф с тремя вершинами" src="/img/image-loader.svg" height="141" data-src="https://habrastorage.org/getpro/habr/post_images/fce/1c2/6b3/fce1c26b3ecdcee5037ccf2e5fa86d50.png" data-width="158"/><br/>
<br/>
<em>Рис. 1. Граф с тремя вершинами</em><br/>
<br/>
Как видим каждый элемент данного графа хранит информацию о связи с другими элементами, т.е.:<br/>
<br/>
<blockquote><pre>1 - 2,3
2 - 1,3
3 - 1,2</pre></blockquote><br/>
<br/>
Фактически, для построения дерева такой граф избыточен, т.к. для привычной ветвистой структуры нам нужно хранить только связь «родитель-наследник», т.е.:<br/>
<br/>
<blockquote><pre>2-1
3-1</pre></blockquote><br/>
<br/>
Тогда мы получим дерево с одним корневым элементом (1) и двумя ветками (2,3):<br/>
<br/>
<img title="Граф дерева" src="/img/image-loader.svg" height="141" data-src="https://habrastorage.org/getpro/habr/post_images/765/d7e/b72/765d7eb723f92da4a974817d19863bc3.png" data-width="158"/><br/>
<br/>
<em>Рис. 2. Граф дерева</em><br/>
<br/>
В принципе, тот и другой графы можно, при желании, отобразить в базе данных с помощью списка смежных вершин, но, поскольку нас интересуют именно деревья, остановимся на них.<br/>
<br/>
Итак, чтобы хранить в базе данных иерархическую структуру методом списка смежных вершин (Adjacency List), нам необходимо хранить информацию о связях «наследник-родитель» в таблицах с данными. Давайте рассмотрим реальный пример дерева:<br/>
<br/>
<img title="Adjacency List" src="/img/image-loader.svg" height="380" data-src="https://habrastorage.org/getpro/habr/post_images/90b/a43/b01/90ba43b011ca58799b0fad09a9c289de.gif" data-width="500"/><br/>
<br/>
<em>Рис. 3. Древовидная структура методом смежных вершин</em><br/>
<br/>
На рисунке квадратами обозначены узлы деревьев. У каждого узла есть имя (верхний прямоугольник внутри квадрата), идентификатор (левый нижний квадрат) и ссылка на идентификатор родителя (правый нижний квадрат). Как видно из Рис. 3, каждый наследник в такой структуре ссылается на своего предка. В терминах БД мы можем это отобразить следующим образом в виде таблицы:<br/>
<br/>
<img title="Таблица данных дерева, построенная методом списка смежных вершин" src="/img/image-loader.svg" height="80" data-src="https://habrastorage.org/getpro/habr/post_images/39a/cbc/47e/39acbc47ef660d9a3ba01e25ace3d8d9.png" data-width="210"/><br/>
<br/>
<em>Рис. 4. Таблица данных дерева, построенная методом списка смежных вершин</em><br/>
<br/>
Или же в виде SQL:<br/>
<br/>
<blockquote><pre>CREATE TABLE al_tree (
    `id` BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `parent_id` BIGINT NULL,
    `name` VARCHAR(50) NOT NULL
) TYPE=InnoDB DEFAULT CHARSET=utf8;

CREATE INDEX fk_tree_tree ON al_tree (parent_id);

ALTER TABLE al_tree ADD CONSTRAINT fk_tree_tree
    FOREIGN KEY (parent_id) REFERENCES al_tree (id) ON UPDATE CASCADE ON DELETE CASCADE;

INSERT INTO al_tree VALUES
    (1, NULL, 'FOOD'),
    (2, 1, 'VEGETABLE'),
    (3, 2, 'POTATO'),
    (4, 2, 'TOMATO'),
    (5, 1, 'FRUIT'),
    (6, 5, 'APPLE'),
    (7, 5, 'BANANA');</pre></blockquote><br/>
<br/>
Следует сразу отметить, что такой алгоритм хранения деревьев обладает определенными как достоинствами, так и недостатками. В первую очередь, он не совсем удобен для чтения — и это его основной недостаток.<br/>
<br/>
Проблемы с чтением из БД менее заметны, если вычитывать все дерево целиком. Это достаточно простой запрос:<br/>
<br/>
<blockquote><pre>SELECT * FROM al_tree ORDER BY id;</pre></blockquote><br/>
<br/>
Результат:<br/>
<br/>
<blockquote><pre>+----+-----------+-----------+
| id | parent_id | name      |
+----+-----------+-----------+
|  1 |      NULL | FOOD      |
|  2 |         1 | VEGETABLE |
|  3 |         2 | POTATO    |
|  4 |         2 | TOMATO    |
|  5 |         1 | FRUIT     |
|  6 |         5 | APPLE     |
|  7 |         5 | BANANA    |
+----+-----------+-----------+</pre></blockquote><br/>
<br/>
Однако в дальнейшем такая выборка подразумевает достаточно емкую программную пост-обработку данных. Сначала нужно рекурсивно перестроить данные с учетом связей «предок-наследник» и лишь потом их можно будет использовать для вывода куда-либо.<br/>
<br/>
Другой вариант чтения дерева целиком:<br/>
<br/>
<blockquote><pre>SELECT t1.name AS lvl1, t2.name as lvl2, t3.name as lvl3
FROM al_tree AS t1
LEFT JOIN al_tree AS t2 ON t2.parent_id = t1.id
LEFT JOIN al_tree AS t3 ON t3.parent_id = t2.id
LEFT JOIN al_tree AS t4 ON t4.parent_id = t3.id
WHERE t1.id = 1;</pre></blockquote><br/>
<br/>
Результат в данном случае будет такой:<br/>
<br/>
<blockquote><pre>+------+-----------+--------+
| lvl1 | lvl2      | lvl3   |
+------+-----------+--------+
| FOOD | VEGETABLE | POTATO |
| FOOD | VEGETABLE | TOMATO |
| FOOD | FRUIT     | APPLE  |
| FOOD | FRUIT     | BANANA |
+------+-----------+--------+</pre></blockquote><br/>
<br/>
Хотя данные в таком виде уже более приспособлены сразу для вывода, но, как видите, главный недостаток такого подхода — необходимо достоверно знать количество уровней вложенности в вашей иерархии, кроме того, чем больше иерархия, тем больше JOIN'ов — тем ниже производительность.<br/>
<br/>
Тем не менее, данный способ обладает и существенными достоинствами — в дерево легко вносить изменения, менять местами и удалять узлы.<br/>
<br/>
Вывод — данный алгоритм хорошо применим, если вы оперируете с небольшими древовидными структурами, которые часто поддаются изменениям.<br/>
<br/>
С другой стороны, этот алгоритм также довольно уверенно себя чувствует и с большими деревьями, если считывать их порциями вида «знаю родителя — прочитать всех наследников». Хороший пример такого случая — динамически подгружаемые деревья. В этом случае алгоритм практически оптимизирован для такого поведения.<br/>
<br/>
Однако он плохо применим, когда нужно вычитывать какие-либо иные куски дерева, находить пути, предыдущие и следующие узлы при обходе и вычитывать ветки дерева целиком (на всю глубину).<br/>
<br/>
<h3>Использование списка смежных вершин в Doctrine</h3><br/>
<br/>
Сначала хотелось бы высказать несколько вводных слов по организации шаблонов таблиц в Doctrine, с помощью которых подобные вещи в ней и реализуются. Те, кто уже знаком с этой концепцией в доктрине, может перескочить несколько абзацев вперед к более интересным вещам.<br/>
<br/>
Итак, сущности, которыми мы оперируем в ORM Doctrine — это активные записи (<a href="http://martinfowler.com/eaaCatalog/activeRecord.html">Active Record</a>). Т.е. объекты, которые совмещают в себе бизнес-логику и сами умеют взаимодействовать с базой данных. Но разработчики Doctrine предусмотрели расширение функциональности объектов записей не только наследованием, но и применением к этим объектам «шаблонов поведения». Это реализуется пакетом Doctrine/Template.<br/>
<br/>
Т.о., если возникает необходимость воспитать активную запись до какого-либо поведения (например, Versionable — проводит аудит всех изменений, I18N — многоязычная или NestedSet — древовидная вида «вложенное множество»), то это можно сделать как раз с помощью данных шаблонов поведения.<br/>
<br/>
Чтобы подключить какой-либо из существующих шаблонов, достаточно сконфигурировать должным образом нашу модель (посредством YAML или прямо в коде базовой таблицы модели).<br/>
<br/>
Когда придет время, мы покажем на примерах, как это сделать.<br/>
<br/>
Пока, к сожалению, или к счастью, но в виде шаблона к таблицам метод списка смежных вершин в Doctrine не реализован. При желании вы можете написать реализацию сами и даже предложить ее разработчикам Doctrine, — это уже на ваше усмотрение.<br/>
<br/>
Тем не менее, основные функции, которые могут быть реализованы в рамках данной модели, можно реализовать в Doctrine и без использования шаблонов поведения. К сожалению, функций работы с деревом мы не получим, но основные задачи решать сможем.<br/>
<br/>
Для этого следует сконфигурировать нашу модель должным образом. Используя YAML опишем структуру нашей таблицы:<br/>
<br/>
<blockquote><pre>AlTree:
  tableName: al_tree
  columns:
    id:
      type: integer(8)
      primary: true
      autoincrement: true
    name:
      type: string(50)
      notnull: true
    parent_id: integer(8)</pre></blockquote><br/>
<br/>
А вот теперь самое важное — правильно описать связи в таблице. Там же со следующей строчки напишем:<br/>
<br/>
<blockquote><pre>  relations:
    Parent:
      class: AlTree
      local: parent_id
      foreign: id
      type: one
    Children:
      class: AlTree
      local: id
      foreign: parent_id
      type: many</pre></blockquote><br/>
<br/>
Теперь соберем нашу модель, запустив команду:<br/>
<br/>
<blockquote><pre>./doctrine generate-models-yaml</pre></blockquote><br/>
<br/>
Все. Модель готова. Фактически тоже самое можно было сделать в уже готовом базовом классе BaseAlTree:<br/>
<br/>
<blockquote><pre>&lt;?php
...
  public function setUp()
  {
    $this->hasOne('AlTree as Parent', array('local' => 'parent_id',
                                            'foreign' => 'id'));

    $this->hasMany('AlTree as Children', array('local' => 'id',
                                               'foreign' => 'parent_id'));
  }
...
?></pre></blockquote><br/>
<br/>
Теперь пришло время насладиться результатами нашей работы. Напишем несложный код, отображающий дерево, построенное с отступами на обычной HTML-странице, используя рекурсию.<br/>
<br/>
<blockquote><pre>&lt;?
/**
 * Извлекаем корневой элемент дерева
 */
$root = Doctrine::getTable( 'AlTree')->findByDql( 'WHERE parent_id IS NULL')->getFirst();
echo '&lt;pre>';
printRTree( $root);
echo '&lt;/pre>';

/**
 * Рекурсивно печатет дерево на экран
 *
 * @param AlTree $node - объект записи - узел дерева
 * @param int $level - уровень вложенности переданого узла
 */
function printRTree( AlTree $node, $level = 0) {
	/**
	 * Вот эта строчка и "рисует" наше дерево
	 */
	echo str_repeat( "\t", $level) . $node->getName() . "\n";

	/**
	 * Далее проверяем, есть ли наследники,
	 * и если есть - входим в рекурсию.
	 * Обратите внимание - вот то чудо-свойство
	 * Children, которое мы описали в конфиге
	 * нашей модели!
	 */
	if (($children = $node->Children->getIterator()) &amp;&amp; $children->count() > 0) {
		$level++;
		while (($child = $children->current())) {
			/**
			 * Входим в рекурсию
			 */
			printRTree( $child, $level);
			$children->next();
		}
	}
}
?></pre></blockquote><br/>
<br/>
Обратите внимание, после того, как мы сконфигурировали должным образом связи у нашего объекта модели, нам стали доступны свойства <strong>Children</strong> и <strong>Parent</strong>. Однако любое первое обращение к ним на чтение порождает запрос к базе данных. Поэтому, для построения больших деревьев целиком за один проход, такой подход может оказаться довольно затратным.<br/>
<br/>
Но в тоже время, реализовать динамически подгружаемое дерево таким способом — одно удовольствие!<br/>
<br/>
<h2>Вложенное множество (Nested Set)</h2><br/>
<br/>
<h3>Описание структуры</h3><br/>
<br/>
Об этом алгоритме и его быстродействии, наверное, слышали все веб-разработчики. Да, этот алгоритм действительно очень хорош, когда требуется часто и много обращаться к иерархическим данным на чтение. Рассмотрим суть данного подхода.<br/>
<br/>
При построении дерева на основе вложенных множеств, мы воспользуемся принципом обхода этого дерева слева-направо, как показано стрелками на Рис. 5. Для этого определим для каждого узла дерева целочисленные ключи слева (lft) и справа (rgt) (нижние квадратики внутри узла). И раздадим им во время обхода целочисленные инкрементные значения. Посмотрите что получилось.<br/>
<br/>
<img title="Nested Set" src="/img/image-loader.svg" height="383" data-src="https://habrastorage.org/getpro/habr/post_images/80d/126/cb0/80d126cb007779d502bd92e6522774cb.gif" data-width="500"/><br/>
<br/>
<em>Рис. 5. Вложенное множество (Nested Set).</em><br/>
<br/>
Корневой элемент получил ключи 1 и 14, которые включают в себя диапазон чисел всех остальных ключей. Ветка VEGETABLE получила ключи 2 и 7, которые, в свою очередь, включают весь диапазон чисел ключей всех ее наследников и т.д. Вот они — вложенные множества. Все просто, не так ли?<br/>
<br/>
Давайте воссоздадим такую же структуру в контексте таблицы БД.<br/>
<br/>
<img title="Nested Set Tree Table" src="/img/image-loader.svg" height="95" data-src="https://habrastorage.org/getpro/habr/post_images/96b/f21/dcb/96bf21dcb4175e85c0ee696932d100c9.png" data-width="166"/><br/>
<br/>
<em>Рис. 6. Таблица иерархических данных на основе метода вложенных множеств</em><br/>
<br/>
Или же в виде SQL:<br/>
<br/>
<blockquote><pre>CREATE TABLE ns_tree (
    `id` BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `name` VARCHAR(50) NOT NULL,
    `lft` BIGINT NOT NULL,
    `rgt` BIGINT NOT NULL,
    `level` BIGINT NOT NULL
) TYPE=InnoDB DEFAULT CHARSET=utf8;

CREATE INDEX nslrl_idx ON ns_tree (lft, rgt, level);

INSERT INTO ns_tree VALUES
    (1, 'FOOD', 1, 14, 0),
    (2, 'VEGETABLE', 2, 7, 1),
    (3, 'POTATO', 3, 4, 2),
    (4, 'TOMATO', 5, 6, 2),
    (5, 'FRUIT', 8, 13, 1),
    (6, 'APPLE', 9, 10, 2),
    (7, 'BANANA', 11, 12, 2);</pre></blockquote><br/>
<br/>
Как видите, мы ввели дополнительно еще одно поле в таблицу — level. В нем будет храниться информация об уровне вложенности каждой ветки дерева. В принципе, это делать вовсе не обязательно — уровень вложенности может быть достаточно просто вычислен, но так как данный алгоритм оптимизирован как раз для чтения, то почему бы не выиграть в производительности за счет кеширования информации об уровне? Риторический вопрос…<br/>
<br/>
<strong>Чтение дерева из БД</strong><br/>
<br/>
Читаем все дерево:<br/>
<br/>
<blockquote><pre>SELECT node.id, node.name, node.level
FROM ns_tree AS node,
ns_tree AS parent
WHERE node.lft BETWEEN parent.lft AND parent.rgt
AND parent.id = 1
ORDER BY node.lft;</pre></blockquote><br/>
<br/>
Результат будет таким:<br/>
<br/>
<blockquote><pre>+----+-----------+-------+
| id | name      | level |
+----+-----------+-------+
|  1 | FOOD      |     0 |
|  2 | VEGETABLE |     1 |
|  3 | POTATO    |     2 |
|  4 | TOMATO    |     2 |
|  5 | FRUIT     |     1 |
|  6 | APPLE     |     2 |
|  7 | BANANA    |     2 |
+----+-----------+-------+</pre></blockquote><br/>
<br/>
Теоретически, тот же результат мы бы могли получить, вычисляя уровень вложенности на лету:<br/>
<br/>
<blockquote><pre>SELECT node.id, node.name, (COUNT(parent.id) - 1) AS level
FROM ns_tree AS node,
ns_tree AS parent
WHERE node.lft BETWEEN parent.lft AND parent.rgt
GROUP BY node.name
ORDER BY node.lft;</pre></blockquote><br/>
<br/>
Попробуйте сравнить результат самостоятельно — он будет идентичен первому. Только сам запрос в данном случае более ресурсоемкий. А так как Nested Set — это оптимальный алгоритм чтения, то небольшая оптимизация в виде кеширования уровня вложенности рядом с остальными данными не такая уж и плохая стратегия.<br/>
<br/>
Таким же, довольно несложным образом мы можем считывать целые ветки, пути из нашего дерева, обходить его узлы и т.д.<br/>
<br/>
Например, если мы хотим извлечь все овощи (VEGETABLE) из нашего примера, это сделать достаточно просто:<br/>
<br/>
<blockquote><pre>SELECT node.id, node.name, node.level
FROM ns_tree AS node, ns_tree AS parent
WHERE node.lft BETWEEN parent.lft AND parent.rgt AND parent.id = 2
ORDER BY node.lft;</pre></blockquote><br/>
<br/>
При этом, если необходимо исключить из результатов самого родителя вы можете поступить несколькими методами:<br/>
<ul>
<li>добавив HAVING level > 1</li>
<li>добавив в условие WHERE: AND node.id != 2</li>
</ul><br/>
или другим способом — пусть это будет творческой задачей для читателя.<br/>
<br/>
Да, быстрое и гибкое чтение, включая агрегацию с внешними связанными данными — конек данного алгоритма.<br/>
<br/>
Тем не менее, не бывает худа без добра, и в данном случае, значительные трудности начинаются когда нам необходимо внести изменения в Nested Set дерево или удалить какую-либо из его ветвей.<br/>
<br/>
Это связано, в первую очередь, с тем, что при изменениях, нам будет <strong>необходимо пересчитать все ключи той части дерева, которая находится справа от изменяемого узла</strong>, а также обновить информацию об уровнях вложенности. И все это не сделать одним простым запросом.<br/>
<br/>
Смотрите сами.<br/>
<br/>
<strong>Добавление новой ветки</strong><br/>
<br/>
Предположим, что мы хотим добавить новую ветку с именем SEA FOOD в наше дерево на одном уровне с VEGETABLES и FRUIT.<br/>
<br/>
<blockquote><pre>BEGIN;

SELECT @treeRight := rgt FROM ns_tree
WHERE id = 2; /* справа от ветки VEGETABLES, у которой id = 2 */

UPDATE ns_tree SET rgt = rgt + 2 WHERE rgt > @treeRight;
UPDATE ns_tree SET lft = lft + 2 WHERE lft > @treeRight;

INSERT INTO ns_tree VALUES(0, 'SEA FOOD', @treeRight + 1, @treeRight + 2, 1);

COMMIT;</pre></blockquote><br/>
<br/>
Если вы используете в MySQL таблицы MYISAM, или версию, которая не поддерживает транзакции, вы можете вместо BEGIN и COMMIT использовать блокировки на запись:<br/>
<br/>
<blockquote><pre>LOCK TABLE ns_tree WRITE;
...
UNLOCK TABLES;</pre></blockquote><br/>
<br/>
Как видите, задача на добавление новой ветки достаточно затратная и нетривиальная. Тем не менее, решаемая.<br/>
<br/>
<strong>Удаление ветки</strong><br/>
<br/>
Давайте теперь попробуем удалить вновь созданную ветку:<br/>
<br/>
<blockquote><pre>BEGIN;

SELECT @treeLeft := lft, @treeRight := rgt, @treeWidth := rgt - lft + 1
FROM ns_tree
WHERE id = 8; /* здесь идентификатор новой записи с именем 'SEA FOOD' */

DELETE FROM ns_tree WHERE lft BETWEEN @treeLeft AND @treeRight;
/*
  ВНИМАНИЕ!
  Обратите внимание - мы не удаляем по id,
  Хотя в данном случае это бы нас устроило.
  Но в общем случае нам необходимо удалить всю ветку с ее содержимым!
*/

UPDATE ns_tree SET rgt = rgt - @treeWidth WHERE rgt > @treeRight;
UPDATE ns_tree SET lft = lft - @treeWidth WHERE lft > @treeRight;

COMMIT;</pre></blockquote><br/>
<br/>
Вывод — Nested Set действительно хорош, когда нам необходимо считывать структуру деревьев из БД. При этом он одинаково хорош для деревьев любого объема.<br/>
<br/>
Тем не менее, для иерархических структур, которые подвергаются частому изменению он, очевидно, не будет являться оптимальным выбором.<br/>
<br/>
<h3>Использование Nested Set в Doctrine</h3><br/>
<br/>
А вот этот метод имеет отражение в Doctrine в виде реализации шаблона поведения, который мы можем привязать к нашей модели.<br/>
<br/>
Сделать это довольно просто, методом конфигурации модели через YAML-конфиг или прамо в коде базового класса.<br/>
<br/>
YAML:<br/>
<br/>
<blockquote><pre>NsTree:
  tableName: ns_tree
  actAs: [NestedSet]
  columns:
    id:
      type: integer(8)
      primary: true
      autoincrement: true
    name:
      type: string(50)
      notnull: true
    lft:
      type: integer(8)
      notnull: true
    rgt:
      type: integer(8)
      notnull: true
    level:
      type: integer(8)
      notnull: true</pre></blockquote><br/>
<br/>
Как видите, достаточно просто указать <strong>actAs: [NestedSet]</strong> в описании класса.<br/>
<br/>
Однако Doctrine предоставляет более гибкую конфигурацию NestedSet модели. Например, вы можете хранить в одной таблице несколько деревьев. Для этого, вам необходимо ввести в таблицу дополнительное поле, в котором вы будете хранить идентификатор корня дерева для каждой записи.<br/>
<br/>
В этом случае конфигурацию следовало бы записать так:<br/>
<br/>
<blockquote><pre>NsTree:
  tableName: ns_tree
  actAs: 
    NestedSet:
      hasManyRoots: true
      rootColumnName: root_id
  columns:
    id:
      type: integer(8)
      primary: true
      autoincrement: true
    root_id:
      type: integer(8)
      notnull: true
    name:
      type: string(50)
      notnull: true
    lft:
      type: integer(8)
      notnull: true
    rgt:
      type: integer(8)
      notnull: true
    level:
      type: integer(8)
      notnull: true</pre></blockquote><br/>
<br/>
Все то же самое могло бы быть проделано в существующем базовом классе модели. <br/>
<br/>
Для первого случая:<br/>
<br/>
<blockquote><pre>&lt;?php
...
    public function setTableDefinition()
    {
        ...
        $this->actAs('NestedSet');
       ...
    }
...
?></pre></blockquote><br/>
<br/>
или:<br/>
<br/>
<blockquote><pre>&lt;?php
...
    public function setTableDefinition()
    {
        ...
        $this->actAs('Doctrine_Template_NestedSet');
       ...
    }
...
?></pre></blockquote><br/>
<br/>
Для второго случая (несколько деревьев):<br/>
<br/>
<blockquote><pre>&lt;?php
...
    public function setTableDefinition()
    {
        ...
        $options = array('hasManyRoots'     => true,
                         'rootColumnName'   => 'root_id');
        $this->actAs('NestedSet', $options);
       ...
    }
...
?></pre></blockquote><br/>
<br/>
Заметьте, Doctrine использует 'root_id' в качестве имени поля по умолчанию. Поэтому вам не обязательно указывать эту опцию, если оно совпадает с именем в вашей реальной таблице. В противном случае вы можете его задать.<br/>
<br/>
<strong>Примеры работы с деревьями Nested Set в Doctrine</strong><br/>
<br/>
Извлекаем и печатаем все дерево на экран:<br/>
<br/>
<blockquote><pre>&lt;?php
$tree = Doctrine::getTable( 'NsTree')->getTree()->fetchTree();
echo "&lt;pre>";
foreach ($tree as $node) {
    echo str_repeat( "\t", $node['level']) . $node['name'] . "\n";
}
echo "&lt;/pre>";
?></pre></blockquote><br/>
<br/>
Посмотрите как это просто!<br/>
<br/>
За дополнительными примерами и информацией вы можете обратиться к официальной документации Doctrine, разделы <a href="http://www.doctrine-project.org/documentation/manual/1_0/en/one-page#hierarchical-data:nested-set:working-with-the-trees">8.2.4</a> и <a href="http://www.doctrine-project.org/documentation/manual/1_0/en/one-page#hierarchical-data:nested-set:advanced-usage">8.2.5</a><br/>
<br/>
<h2>Материализованный путь (Materialized Path)</h2><br/>
<br/>
<h3>Описание структуры</h3><br/>
<br/>
Еще один довольно интересный подход для хранения иерархических структур. Основная идея алгоритма в хранении полного пути к узлу от вершины дерева. Выглядит это примерно так:<br/>
<br/>
<img title="Materialized Path" src="/img/image-loader.svg" height="378" data-src="https://habrastorage.org/getpro/habr/post_images/55c/36b/37b/55c36b37b77a5d3c8e23b66fd53cd807.gif" data-width="496"/><br/>
<br/>
<em>Рис. 7. Древовидная структура, организованная по принципу «материализованый путь»</em><br/>
<br/>
Принцип формирования таких путей достаточно прост. Глубина пути — это уровень дерева. Внутри ветки нумерация — инкрементная. Другими словами, VEGETABLE — первый ребенок FOOD, FRUIT — второй ребенок и т.д.<br/>
<br/>
Проще будет взглянуть на это в виде таблицы:<br/>
<br/>
<blockquote><pre>+---------------+-------+
| name          | path  |
+---------------+-------+
| FOOD          | 1     |
|   VEGETABLE   | 1.1   |
|     POTATO    | 1.1.1 |
|     TOMATO    | 1.1.2 |
|   FRUIT       | 1.2   |
|     APPLE     | 1.2.1 |
|     BANANA    | 1.2.2 |
+---------------+-------+</pre></blockquote><br/>
<br/>
Возможно, так даже более наглядно.<br/>
<br/>
В базе данных все это находит следующее отражение.<br/>
<br/>
<img title="Materialized Path Table Structure" src="/img/image-loader.svg" height="72" data-src="https://habrastorage.org/getpro/habr/post_images/051/fca/96a/051fca96a9b383a0554ffbd9188fe61d.png" data-width="167"/><br/>
<br/>
<em>Рис. 8. структура таблицы иерархических данных, организованных по принципу «материализованный путь»</em><br/>
<br/>
Или в виде SQL:<br/>
<br/>
<blockquote><pre>CREATE TABLE mp_tree (
    `id` BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    `name` VARCHAR(50) NOT NULL,
    `path` VARCHAR(100) NOT NULL
) TYPE=InnoDB DEFAULT CHARSET=utf8;

CREATE INDEX mpp_idx ON mp_tree (`path`);

INSERT INTO mp_tree VALUES
    (1, 'FOOD', '1'),
    (2, 'VEGETABLE', '1.1'),
    (3, 'POTATO', '1.1.1'),
    (4, 'TOMATO', '1.1.2'),
    (5, 'FRUIT', '1.2'),
    (6, 'APPLE', '1.2.1'),
    (7, 'BANANA', '1.2.2');</pre></blockquote><br/>
<br/>
В чем же преимущество такого подхода?<br/>
<br/>
Во-первых, по сравнению с Nested Set, он более поддается изменениям. В то же время остается достаточно удобным для выборки деревьев целиком и их частей. Но, и он не идеален. Особенно по части поиска предков ветки.<br/>
<br/>
<strong>Поиск пути к узлу:</strong><br/>
<br/>
<blockquote><pre>SELECT t1.name from mp_tree t1, mp_tree t2
WHERE t2.path like CONCAT( t1.path, '.%')
AND t2.id = 3; /* Поиск пути к узлу с именем 'POTATO' */</pre></blockquote><br/>
<br/>
Результат:<br/>
<br/>
<blockquote><pre>+-----------+
| name      |
+-----------+
| FOOD      |
| VEGETABLE |
+-----------+</pre></blockquote><br/>
<br/>
<strong>Вычисление уровня вложенности.</strong><br/>
<br/>
Для решения этой задачи нам в принципе достаточно посчитать кол-во точек (или других разделителей, если вы используете не точку) в путях. К сожалению, MySQL не имеет подходящей функции, но мы можем ее реализовать достаточно просто своими силами:<br/>
<br/>
<blockquote><pre>CREATE FUNCTION STRFIND (str VARCHAR(255), delimtr CHAR(1)) RETURNS INT
BEGIN
DECLARE _cnt INT;
DECLARE _start INT;
SET _cnt = -1;
SET _start = 1;
WHILE _start > 0 DO
  SET _start = LOCATE( delimtr, str);
  SET str    = SUBSTRING( str, _start + 1);
  SET _cnt   = _cnt + 1;
END WHILE;
RETURN _cnt;
END</pre></blockquote><br/>
<br/>
<strong>Выбор ветки:</strong><br/>
<br/>
<blockquote><pre>SELECT name, strfind( path, '.') AS level 
FROM mp_tree 
WHERE path LIKE '1.1%'; /* Выбираем всю ветку 'VEGETABLES' */;</pre></blockquote><br/>
<br/>
Результат:<br/>
<br/>
<blockquote><pre>+-----------+-------+
| name      | level |
+-----------+-------+
| VEGETABLE |     1 |
| POTATO    |     2 |
| TOMATO    |     2 |
+-----------+-------+</pre></blockquote><br/>
<br/>
Обратите внимание, в данном примере мы воспользовались нашей самописной функцией и это было достаточно удобно.<br/>
<br/>
<strong>Поиск родителя:</strong><br/>
<br/>
<blockquote><pre>SELECT t2.* 
FROM mp_tree t1, mp_tree t2 
WHERE t1.id=3 AND t2.path=SUBSTRING( t1.path, 1, (LENGTH(t1.path) - LOCATE('.', REVERSE(t1.path))));</pre></blockquote><br/>
<br/>
Как видите, все эти запросы не тешат максимальной производительностью (по сравнению с предыдущим методом), но, тем не менее, использование именно этого алгоритма может быть заметно удобнее, для деревьев, над которыми часто выполняются как операции чтения, так и изменения.<br/>
<br/>
Насколько известно автору, алгоритм довольно уверенно себя чувствует на достаточно больших объемах данных.<br/>
<br/>
Следует отметить, что наиболее неприятной в данном алгоритме будет операция вставки узла в середину уже существующей структуры (между другими узлами), т.к. это повлечет изменение всех путей в нижележащих узлах. Хотя, справедливости ради, следует сказать, что такая операция окажется нетривиальной для любой модели хранения данных. Другая тяжелая операция — это перенос одной ветки в другую.<br/>
<br/>
А вот удаление, добавление в конец или изменение узла — это операции довольно простые, и, как правило, не вызывают сложностей в данной модели.<br/>
<br/>
Как видно из примеров, данный алгоритм также можно несколько оптимизировать на чтение, путем введения ещё одного поля level, как это было сделано для списков смежных вершин (Nested Set). Однако это несколько усложнит операции добавления, изменения и удаления узлов дерева, т.к. уровни придется пересчитывать для всего или части дерева при каждом изменении. В конечном счете, именно разработчику решать, в какую сторону следует делать перекос производительности.<br/>
<br/>
<h3>Использование в Doctrine</h3><br/>
<br/>
К сожалению, на данный момент, этот метод хранения деревьев пока не нашел своей реализации в ORM Doctrine (текущая версия на момент написания материала — 1.0.4, 1.1.0 — в альфа версии также реализации не имеет).<br/>
<br/>
Тем не менее есть все предпосылки полагать, что его реализация появится в будущем, т.к. исходные коды библиотеки содержат в пакете Doctrine/Tree абстракный пустой класс с именем MaterializedPath.<br/>
<br/>
Автор будет следить за событиями и обновит эту статью, как только реализация найдет свое отражение, так что можете сюда вернуться позже.<br/>
<br/>
<h2>Комбинированный подход</h2><br/>
<br/>
По сути вопроса следует отметить, что скомбинировать приведенные методы можно лишь в двух направлениях:<br/>
<ul>
<li>Списки смежности + материализованный путь (Adjacency List + Materialized Path)</li>
<li>Списки смежности + вложенные множества (Adjacency List + Nested Set)</li>
</ul><br/>
Комбинировать же Nested Set и Materialized Path особого смысла не имеет, т.к. существенного выигрыша ни в чтении, ни в записи вы не получите.<br/>
<br/>
Фактически, комбинирование подходов на уровне БД ограничивается вводом поля, хранящего ссылку на родительскую запись в таблицы списков смежности и материализованных путей:<br/>
<br/>
<img src="/img/image-loader.svg" title="Таблицы данных структур AL+MP и AL+NS" height="106" data-src="https://habrastorage.org/getpro/habr/post_images/235/bd0/09b/235bd009bafdd26ee393aafd6e540f90.png" data-width="420"/><br/>
<br/>
<em>Рис. 9. Таблицы моделей иерархических структур данных AL+MP и AL+NS</em><br/>
<br/>
Последствия такого подхода очевидны.<br/>
<br/>
<strong>AL+MP</strong><br/>
<br/>
Для AL при использовании с MP:<br/>
<ul>
<li>Улучшаются операции выборки ветвей и поддеревьев целиком</li>
<li>Ухудшаются операции переноса ветвей</li>
</ul><br/>
<br/>
Для MP при использовании с AL:<br/>
<ul>
<li>Улучшаются операции выборки родителей заданного узла</li>
<li>Улучшаются операции выборки наследников заданного узла</li>
</ul><br/>
<br/>
<strong>AL+NS</strong><br/>
<br/>
Для связки AL+NS взаимовыгодность не столь очевидна. В первую очередь это объясняется тем, что недостатки от проблем изменения узлов дерева в модели NS напрочь убивают в этой сфере все достоинства AL. Это значит, что такую связку следует рассматривать лишь как качественное улучшение поиска родителей и наследников заданного узла в алгоритме NS, а также как повышение надежности самого алгоритма (ключи можно всегда перестроить в случае порчи — информацию о связях хранит AL). Утверждение о повышении надежности справедливо и для предыдущей комбинации методов. Но ведь и это качественное улучшение, хотя и не такое очевидное, не так ли?<br/>
<br/>
<h2>Заключение</h2><br/>
<br/>
В данной статье мы рассмотрели несколько основных методов хранения иерархических данных в реляционных БД и очертили все их достоинства и недостатки. Также мы показали на практике, какие из них доступны для использования в реализации ORM Doctrine, и как их использовать.<br/>
<br/>
Очевидно, что даже выбор того или иного метода в каждом конкретном случае — задача не такая уж и простая, но автор надеется, что данный материал будет способствовать принятию осознанного и правильного решения, а также будет способствовать творческому процессу поиска новых и более оптимальных решений.<br/>
<br/>
Удачи в девелопменте!<br/>
<br/>
<blockquote><sub>P.S. Это кросс-пост <a href="http://mikhailstadnik.com/hierarchical-data-structures-and-doctrine">оригинальной статьи</a> с моего блога</sub></blockquote></div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BAdjacency%20List%5D" class="tm-article-body__tags-item-link">Adjacency List</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BDoctrine%5D" class="tm-article-body__tags-item-link">Doctrine</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bhierarchical%20data%5D" class="tm-article-body__tags-item-link">hierarchical data</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BMaterialized%20Path%5D" class="tm-article-body__tags-item-link">Materialized Path</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BMySQL%5D" class="tm-article-body__tags-item-link">MySQL</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BNested%20Set%5D" class="tm-article-body__tags-item-link">Nested Set</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Btree%5D" class="tm-article-body__tags-item-link">tree</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%91%D0%B0%D0%B7%D1%8B%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%5D" class="tm-article-body__tags-item-link">Базы данных</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D1%8C%D1%8F%5D" class="tm-article-body__tags-item-link">деревья</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B8%D0%B5%D1%80%D0%B0%D1%80%D1%85%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5%5D" class="tm-article-body__tags-item-link">иерархические данные</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC%D1%8B%5D" class="tm-article-body__tags-item-link">алгоритмы</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bphp%205%5D" class="tm-article-body__tags-item-link">php 5</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/webdev/" class="tm-article-body__tags-item-link">
                  Разработка веб-сайтов
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 64: ↑63 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 64: ↑63 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+62</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    433
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/46659/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      41
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Mikhus/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/6e4/8eb/cc7/6e48ebcc7a0a442dd08af1ecd52e5ee6.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 144 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    122.7
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><span class="tm-user-card__name">Михаил Стадник</span> <a href="/ru/users/Mikhus/" class="tm-user-card__nickname">
          @Mikhus
        </a> <!----></div> <p class="tm-user-card__short-info">Software Engineer</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/46659/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 41 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2020-11-25T09:13:56.000Z" title="2020-11-25, 12:13">25  ноября  2020 в 12:13</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/auriga/blog/529742/" class="tm-article-title__link"><span>Выращивание Nested sets в условиях .Net</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 18: ↑18 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 18: ↑18 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+18</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.4K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    24
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/auriga/blog/529742/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      4
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2020-09-15T18:59:33.000Z" title="2020-09-15, 21:59">15  сентября  2020 в 21:59</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/519298/" class="tm-article-title__link"><span>Nested Sets для Javascript</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 16: ↑10 и ↓6</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 16: ↑10 и ↓6" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+4</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    23
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/519298/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      17
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2016-04-24T01:54:39.000Z" title="2016-04-24, 04:54">24  апреля  2016 в 04:54</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/282305/" class="tm-article-title__link"><span>Оптимизация модели Nested Set в PHPixie</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 16: ↑13 и ↓3</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 16: ↑13 и ↓3" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+10</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.7K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    24
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/282305/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      26
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T10:05:13.000Z" title="2021-09-26, 13:05">вчера в 13:05</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/579980/" class="tm-article-title__link"><span>Источник опорного напряжения — один из принципов и одна из реализаций</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 46: ↑44 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 46: ↑44 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+42</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.4K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    54
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/579980/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      5
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T21:49:14.000Z" title="2021-09-27, 00:49">сегодня в 00:49</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580092/" class="tm-article-title__link"><span>30 сентября: Let's Encrypt и конец срока действия IdenTrust DST Root CA X3</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 36: ↑36 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 36: ↑36 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+36</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">11K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    40
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580092/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      54
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T19:37:10.000Z" title="2021-09-26, 22:37">вчера в 22:37</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580086/" class="tm-article-title__link"><span>Термо принтер и JavaScript</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 33: ↑32 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 33: ↑32 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+31</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    30
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580086/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      40
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T19:00:02.000Z" title="2021-09-26, 22:00">вчера в 22:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/funcorp/blog/579542/" class="tm-article-title__link"><span>Jetpack Compose — как легко построить UI на Android</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 31: ↑27 и ↓4</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 31: ↑27 и ↓4" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+23</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.9K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    48
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/funcorp/blog/579542/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      6
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T09:00:04.000Z" title="2021-09-27, 12:00">сегодня в 12:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580060/" class="tm-article-title__link"><span>Арракис, который мы заслужили</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 23: ↑22 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 23: ↑22 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+21</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    7
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580060/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      0
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="46659" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/46659/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/46659/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"46659":{"id":"46659","timePublished":"2008-12-10T15:18:21+00:00","isCorporative":false,"lang":"ru","titleHtml":"Иерархические структуры данных и Doctrine","leadData":{"textHtml":"\u003Ch2\u003EВведение\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной задачей.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ первую очередь, это связано с тем, что реляционные базы не приспособлены к хранению иерархических структур (как, например, XML-файлы), структура реляционных таблиц представляет из себя простые списки. Иерархические же данные имеют связь «родитель-наследники», которая не реализована в реляционной структуре.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТем не менее, задача «хранить деревья в базе данных» рано или поздно возникает перед любым разработчиком.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНиже мы подробно рассмотрим, какие существуют подходы в организации хранения деревьев в реляционных БД, а также рассмотрим инструментарий, который нам предоставляет ORM Doctrine для работы с такими структурами.\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":122.7,"votesCount":144},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"46773","alias":"Mikhus","fullname":"Михаил Стадник","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F6e4\u002F8eb\u002Fcc7\u002F6e48ebcc7a0a442dd08af1ecd52e5ee6.jpg","speciality":"Software Engineer"},"statistics":{"commentsCount":41,"favoritesCount":433,"readingCount":69280,"score":62,"votesCount":64},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Ch2\u003EВведение\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной задачей.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ первую очередь, это связано с тем, что реляционные базы не приспособлены к хранению иерархических структур (как, например, XML-файлы), структура реляционных таблиц представляет из себя простые списки. Иерархические же данные имеют связь «родитель-наследники», которая не реализована в реляционной структуре.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТем не менее, задача «хранить деревья в базе данных» рано или поздно возникает перед любым разработчиком.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНиже мы подробно рассмотрим, какие существуют подходы в организации хранения деревьев в реляционных БД, а также рассмотрим инструментарий, который нам предоставляет ORM Doctrine для работы с такими структурами.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EСписок смежных вершин (Adjacency List)\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EОписание структуры\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак правило, такая структура данных предполагает хранение информации о смежных вершинах нашего дерева. Давайте рассмотрим простейший граф с темя вершинами (1,2,3):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Граф с тремя вершинами\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"141\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Ffce\u002F1c2\u002F6b3\u002Ffce1c26b3ecdcee5037ccf2e5fa86d50.png\" data-width=\"158\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 1. Граф с тремя вершинами\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак видим каждый элемент данного графа хранит информацию о связи с другими элементами, т.е.:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E1 - 2,3\n2 - 1,3\n3 - 1,2\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nФактически, для построения дерева такой граф избыточен, т.к. для привычной ветвистой структуры нам нужно хранить только связь «родитель-наследник», т.е.:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E2-1\n3-1\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТогда мы получим дерево с одним корневым элементом (1) и двумя ветками (2,3):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Граф дерева\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"141\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F765\u002Fd7e\u002Fb72\u002F765d7eb723f92da4a974817d19863bc3.png\" data-width=\"158\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 2. Граф дерева\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ принципе, тот и другой графы можно, при желании, отобразить в базе данных с помощью списка смежных вершин, но, поскольку нас интересуют именно деревья, остановимся на них.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, чтобы хранить в базе данных иерархическую структуру методом списка смежных вершин (Adjacency List), нам необходимо хранить информацию о связях «наследник-родитель» в таблицах с данными. Давайте рассмотрим реальный пример дерева:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Adjacency List\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"380\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F90b\u002Fa43\u002Fb01\u002F90ba43b011ca58799b0fad09a9c289de.gif\" data-width=\"500\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 3. Древовидная структура методом смежных вершин\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа рисунке квадратами обозначены узлы деревьев. У каждого узла есть имя (верхний прямоугольник внутри квадрата), идентификатор (левый нижний квадрат) и ссылка на идентификатор родителя (правый нижний квадрат). Как видно из Рис. 3, каждый наследник в такой структуре ссылается на своего предка. В терминах БД мы можем это отобразить следующим образом в виде таблицы:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Таблица данных дерева, построенная методом списка смежных вершин\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"80\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F39a\u002Fcbc\u002F47e\u002F39acbc47ef660d9a3ba01e25ace3d8d9.png\" data-width=\"210\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 4. Таблица данных дерева, построенная методом списка смежных вершин\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИли же в виде SQL:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ECREATE TABLE al_tree (\n    `id` BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,\n    `parent_id` BIGINT NULL,\n    `name` VARCHAR(50) NOT NULL\n) TYPE=InnoDB DEFAULT CHARSET=utf8;\n\nCREATE INDEX fk_tree_tree ON al_tree (parent_id);\n\nALTER TABLE al_tree ADD CONSTRAINT fk_tree_tree\n    FOREIGN KEY (parent_id) REFERENCES al_tree (id) ON UPDATE CASCADE ON DELETE CASCADE;\n\nINSERT INTO al_tree VALUES\n    (1, NULL, 'FOOD'),\n    (2, 1, 'VEGETABLE'),\n    (3, 2, 'POTATO'),\n    (4, 2, 'TOMATO'),\n    (5, 1, 'FRUIT'),\n    (6, 5, 'APPLE'),\n    (7, 5, 'BANANA');\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСледует сразу отметить, что такой алгоритм хранения деревьев обладает определенными как достоинствами, так и недостатками. В первую очередь, он не совсем удобен для чтения — и это его основной недостаток.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПроблемы с чтением из БД менее заметны, если вычитывать все дерево целиком. Это достаточно простой запрос:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT * FROM al_tree ORDER BY id;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРезультат:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E+----+-----------+-----------+\n| id | parent_id | name      |\n+----+-----------+-----------+\n|  1 |      NULL | FOOD      |\n|  2 |         1 | VEGETABLE |\n|  3 |         2 | POTATO    |\n|  4 |         2 | TOMATO    |\n|  5 |         1 | FRUIT     |\n|  6 |         5 | APPLE     |\n|  7 |         5 | BANANA    |\n+----+-----------+-----------+\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОднако в дальнейшем такая выборка подразумевает достаточно емкую программную пост-обработку данных. Сначала нужно рекурсивно перестроить данные с учетом связей «предок-наследник» и лишь потом их можно будет использовать для вывода куда-либо.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДругой вариант чтения дерева целиком:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT t1.name AS lvl1, t2.name as lvl2, t3.name as lvl3\nFROM al_tree AS t1\nLEFT JOIN al_tree AS t2 ON t2.parent_id = t1.id\nLEFT JOIN al_tree AS t3 ON t3.parent_id = t2.id\nLEFT JOIN al_tree AS t4 ON t4.parent_id = t3.id\nWHERE t1.id = 1;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРезультат в данном случае будет такой:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E+------+-----------+--------+\n| lvl1 | lvl2      | lvl3   |\n+------+-----------+--------+\n| FOOD | VEGETABLE | POTATO |\n| FOOD | VEGETABLE | TOMATO |\n| FOOD | FRUIT     | APPLE  |\n| FOOD | FRUIT     | BANANA |\n+------+-----------+--------+\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХотя данные в таком виде уже более приспособлены сразу для вывода, но, как видите, главный недостаток такого подхода — необходимо достоверно знать количество уровней вложенности в вашей иерархии, кроме того, чем больше иерархия, тем больше JOIN'ов — тем ниже производительность.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТем не менее, данный способ обладает и существенными достоинствами — в дерево легко вносить изменения, менять местами и удалять узлы.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВывод — данный алгоритм хорошо применим, если вы оперируете с небольшими древовидными структурами, которые часто поддаются изменениям.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nС другой стороны, этот алгоритм также довольно уверенно себя чувствует и с большими деревьями, если считывать их порциями вида «знаю родителя — прочитать всех наследников». Хороший пример такого случая — динамически подгружаемые деревья. В этом случае алгоритм практически оптимизирован для такого поведения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОднако он плохо применим, когда нужно вычитывать какие-либо иные куски дерева, находить пути, предыдущие и следующие узлы при обходе и вычитывать ветки дерева целиком (на всю глубину).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EИспользование списка смежных вершин в Doctrine\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСначала хотелось бы высказать несколько вводных слов по организации шаблонов таблиц в Doctrine, с помощью которых подобные вещи в ней и реализуются. Те, кто уже знаком с этой концепцией в доктрине, может перескочить несколько абзацев вперед к более интересным вещам.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, сущности, которыми мы оперируем в ORM Doctrine — это активные записи (\u003Ca href=\"http:\u002F\u002Fmartinfowler.com\u002FeaaCatalog\u002FactiveRecord.html\"\u003EActive Record\u003C\u002Fa\u003E). Т.е. объекты, которые совмещают в себе бизнес-логику и сами умеют взаимодействовать с базой данных. Но разработчики Doctrine предусмотрели расширение функциональности объектов записей не только наследованием, но и применением к этим объектам «шаблонов поведения». Это реализуется пакетом Doctrine\u002FTemplate.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТ.о., если возникает необходимость воспитать активную запись до какого-либо поведения (например, Versionable — проводит аудит всех изменений, I18N — многоязычная или NestedSet — древовидная вида «вложенное множество»), то это можно сделать как раз с помощью данных шаблонов поведения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧтобы подключить какой-либо из существующих шаблонов, достаточно сконфигурировать должным образом нашу модель (посредством YAML или прямо в коде базовой таблицы модели).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКогда придет время, мы покажем на примерах, как это сделать.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПока, к сожалению, или к счастью, но в виде шаблона к таблицам метод списка смежных вершин в Doctrine не реализован. При желании вы можете написать реализацию сами и даже предложить ее разработчикам Doctrine, — это уже на ваше усмотрение.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТем не менее, основные функции, которые могут быть реализованы в рамках данной модели, можно реализовать в Doctrine и без использования шаблонов поведения. К сожалению, функций работы с деревом мы не получим, но основные задачи решать сможем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля этого следует сконфигурировать нашу модель должным образом. Используя YAML опишем структуру нашей таблицы:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003EAlTree:\n  tableName: al_tree\n  columns:\n    id:\n      type: integer(8)\n      primary: true\n      autoincrement: true\n    name:\n      type: string(50)\n      notnull: true\n    parent_id: integer(8)\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА вот теперь самое важное — правильно описать связи в таблице. Там же со следующей строчки напишем:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E  relations:\n    Parent:\n      class: AlTree\n      local: parent_id\n      foreign: id\n      type: one\n    Children:\n      class: AlTree\n      local: id\n      foreign: parent_id\n      type: many\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь соберем нашу модель, запустив команду:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E.\u002Fdoctrine generate-models-yaml\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсе. Модель готова. Фактически тоже самое можно было сделать в уже готовом базовом классе BaseAlTree:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E&lt;?php\n...\n  public function setUp()\n  {\n    $this-\u003EhasOne('AlTree as Parent', array('local' =\u003E 'parent_id',\n                                            'foreign' =\u003E 'id'));\n\n    $this-\u003EhasMany('AlTree as Children', array('local' =\u003E 'id',\n                                               'foreign' =\u003E 'parent_id'));\n  }\n...\n?\u003E\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь пришло время насладиться результатами нашей работы. Напишем несложный код, отображающий дерево, построенное с отступами на обычной HTML-странице, используя рекурсию.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E&lt;?\n\u002F**\n * Извлекаем корневой элемент дерева\n *\u002F\n$root = Doctrine::getTable( 'AlTree')-\u003EfindByDql( 'WHERE parent_id IS NULL')-\u003EgetFirst();\necho '&lt;pre\u003E';\nprintRTree( $root);\necho '&lt;\u002Fpre\u003E';\n\n\u002F**\n * Рекурсивно печатет дерево на экран\n *\n * @param AlTree $node - объект записи - узел дерева\n * @param int $level - уровень вложенности переданого узла\n *\u002F\nfunction printRTree( AlTree $node, $level = 0) {\n\t\u002F**\n\t * Вот эта строчка и \"рисует\" наше дерево\n\t *\u002F\n\techo str_repeat( \"\\t\", $level) . $node-\u003EgetName() . \"\\n\";\n\n\t\u002F**\n\t * Далее проверяем, есть ли наследники,\n\t * и если есть - входим в рекурсию.\n\t * Обратите внимание - вот то чудо-свойство\n\t * Children, которое мы описали в конфиге\n\t * нашей модели!\n\t *\u002F\n\tif (($children = $node-\u003EChildren-\u003EgetIterator()) &amp;&amp; $children-\u003Ecount() \u003E 0) {\n\t\t$level++;\n\t\twhile (($child = $children-\u003Ecurrent())) {\n\t\t\t\u002F**\n\t\t\t * Входим в рекурсию\n\t\t\t *\u002F\n\t\t\tprintRTree( $child, $level);\n\t\t\t$children-\u003Enext();\n\t\t}\n\t}\n}\n?\u003E\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОбратите внимание, после того, как мы сконфигурировали должным образом связи у нашего объекта модели, нам стали доступны свойства \u003Cstrong\u003EChildren\u003C\u002Fstrong\u003E и \u003Cstrong\u003EParent\u003C\u002Fstrong\u003E. Однако любое первое обращение к ним на чтение порождает запрос к базе данных. Поэтому, для построения больших деревьев целиком за один проход, такой подход может оказаться довольно затратным.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНо в тоже время, реализовать динамически подгружаемое дерево таким способом — одно удовольствие!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EВложенное множество (Nested Set)\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EОписание структуры\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОб этом алгоритме и его быстродействии, наверное, слышали все веб-разработчики. Да, этот алгоритм действительно очень хорош, когда требуется часто и много обращаться к иерархическим данным на чтение. Рассмотрим суть данного подхода.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПри построении дерева на основе вложенных множеств, мы воспользуемся принципом обхода этого дерева слева-направо, как показано стрелками на Рис. 5. Для этого определим для каждого узла дерева целочисленные ключи слева (lft) и справа (rgt) (нижние квадратики внутри узла). И раздадим им во время обхода целочисленные инкрементные значения. Посмотрите что получилось.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Nested Set\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"383\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F80d\u002F126\u002Fcb0\u002F80d126cb007779d502bd92e6522774cb.gif\" data-width=\"500\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 5. Вложенное множество (Nested Set).\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКорневой элемент получил ключи 1 и 14, которые включают в себя диапазон чисел всех остальных ключей. Ветка VEGETABLE получила ключи 2 и 7, которые, в свою очередь, включают весь диапазон чисел ключей всех ее наследников и т.д. Вот они — вложенные множества. Все просто, не так ли?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДавайте воссоздадим такую же структуру в контексте таблицы БД.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Nested Set Tree Table\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"95\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F96b\u002Ff21\u002Fdcb\u002F96bf21dcb4175e85c0ee696932d100c9.png\" data-width=\"166\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 6. Таблица иерархических данных на основе метода вложенных множеств\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИли же в виде SQL:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ECREATE TABLE ns_tree (\n    `id` BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,\n    `name` VARCHAR(50) NOT NULL,\n    `lft` BIGINT NOT NULL,\n    `rgt` BIGINT NOT NULL,\n    `level` BIGINT NOT NULL\n) TYPE=InnoDB DEFAULT CHARSET=utf8;\n\nCREATE INDEX nslrl_idx ON ns_tree (lft, rgt, level);\n\nINSERT INTO ns_tree VALUES\n    (1, 'FOOD', 1, 14, 0),\n    (2, 'VEGETABLE', 2, 7, 1),\n    (3, 'POTATO', 3, 4, 2),\n    (4, 'TOMATO', 5, 6, 2),\n    (5, 'FRUIT', 8, 13, 1),\n    (6, 'APPLE', 9, 10, 2),\n    (7, 'BANANA', 11, 12, 2);\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак видите, мы ввели дополнительно еще одно поле в таблицу — level. В нем будет храниться информация об уровне вложенности каждой ветки дерева. В принципе, это делать вовсе не обязательно — уровень вложенности может быть достаточно просто вычислен, но так как данный алгоритм оптимизирован как раз для чтения, то почему бы не выиграть в производительности за счет кеширования информации об уровне? Риторический вопрос…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EЧтение дерева из БД\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧитаем все дерево:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT node.id, node.name, node.level\nFROM ns_tree AS node,\nns_tree AS parent\nWHERE node.lft BETWEEN parent.lft AND parent.rgt\nAND parent.id = 1\nORDER BY node.lft;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРезультат будет таким:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E+----+-----------+-------+\n| id | name      | level |\n+----+-----------+-------+\n|  1 | FOOD      |     0 |\n|  2 | VEGETABLE |     1 |\n|  3 | POTATO    |     2 |\n|  4 | TOMATO    |     2 |\n|  5 | FRUIT     |     1 |\n|  6 | APPLE     |     2 |\n|  7 | BANANA    |     2 |\n+----+-----------+-------+\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеоретически, тот же результат мы бы могли получить, вычисляя уровень вложенности на лету:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT node.id, node.name, (COUNT(parent.id) - 1) AS level\nFROM ns_tree AS node,\nns_tree AS parent\nWHERE node.lft BETWEEN parent.lft AND parent.rgt\nGROUP BY node.name\nORDER BY node.lft;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПопробуйте сравнить результат самостоятельно — он будет идентичен первому. Только сам запрос в данном случае более ресурсоемкий. А так как Nested Set — это оптимальный алгоритм чтения, то небольшая оптимизация в виде кеширования уровня вложенности рядом с остальными данными не такая уж и плохая стратегия.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТаким же, довольно несложным образом мы можем считывать целые ветки, пути из нашего дерева, обходить его узлы и т.д.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНапример, если мы хотим извлечь все овощи (VEGETABLE) из нашего примера, это сделать достаточно просто:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT node.id, node.name, node.level\nFROM ns_tree AS node, ns_tree AS parent\nWHERE node.lft BETWEEN parent.lft AND parent.rgt AND parent.id = 2\nORDER BY node.lft;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПри этом, если необходимо исключить из результатов самого родителя вы можете поступить несколькими методами:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003Eдобавив HAVING level \u003E 1\u003C\u002Fli\u003E\r\n\u003Cli\u003Eдобавив в условие WHERE: AND node.id != 2\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nили другим способом — пусть это будет творческой задачей для читателя.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДа, быстрое и гибкое чтение, включая агрегацию с внешними связанными данными — конек данного алгоритма.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТем не менее, не бывает худа без добра, и в данном случае, значительные трудности начинаются когда нам необходимо внести изменения в Nested Set дерево или удалить какую-либо из его ветвей.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто связано, в первую очередь, с тем, что при изменениях, нам будет \u003Cstrong\u003Eнеобходимо пересчитать все ключи той части дерева, которая находится справа от изменяемого узла\u003C\u002Fstrong\u003E, а также обновить информацию об уровнях вложенности. И все это не сделать одним простым запросом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСмотрите сами.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EДобавление новой ветки\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПредположим, что мы хотим добавить новую ветку с именем SEA FOOD в наше дерево на одном уровне с VEGETABLES и FRUIT.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003EBEGIN;\n\nSELECT @treeRight := rgt FROM ns_tree\nWHERE id = 2; \u002F* справа от ветки VEGETABLES, у которой id = 2 *\u002F\n\nUPDATE ns_tree SET rgt = rgt + 2 WHERE rgt \u003E @treeRight;\nUPDATE ns_tree SET lft = lft + 2 WHERE lft \u003E @treeRight;\n\nINSERT INTO ns_tree VALUES(0, 'SEA FOOD', @treeRight + 1, @treeRight + 2, 1);\n\nCOMMIT;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли вы используете в MySQL таблицы MYISAM, или версию, которая не поддерживает транзакции, вы можете вместо BEGIN и COMMIT использовать блокировки на запись:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ELOCK TABLE ns_tree WRITE;\n...\nUNLOCK TABLES;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак видите, задача на добавление новой ветки достаточно затратная и нетривиальная. Тем не менее, решаемая.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EУдаление ветки\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДавайте теперь попробуем удалить вновь созданную ветку:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003EBEGIN;\n\nSELECT @treeLeft := lft, @treeRight := rgt, @treeWidth := rgt - lft + 1\nFROM ns_tree\nWHERE id = 8; \u002F* здесь идентификатор новой записи с именем 'SEA FOOD' *\u002F\n\nDELETE FROM ns_tree WHERE lft BETWEEN @treeLeft AND @treeRight;\n\u002F*\n  ВНИМАНИЕ!\n  Обратите внимание - мы не удаляем по id,\n  Хотя в данном случае это бы нас устроило.\n  Но в общем случае нам необходимо удалить всю ветку с ее содержимым!\n*\u002F\n\nUPDATE ns_tree SET rgt = rgt - @treeWidth WHERE rgt \u003E @treeRight;\nUPDATE ns_tree SET lft = lft - @treeWidth WHERE lft \u003E @treeRight;\n\nCOMMIT;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВывод — Nested Set действительно хорош, когда нам необходимо считывать структуру деревьев из БД. При этом он одинаково хорош для деревьев любого объема.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТем не менее, для иерархических структур, которые подвергаются частому изменению он, очевидно, не будет являться оптимальным выбором.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EИспользование Nested Set в Doctrine\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА вот этот метод имеет отражение в Doctrine в виде реализации шаблона поведения, который мы можем привязать к нашей модели.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСделать это довольно просто, методом конфигурации модели через YAML-конфиг или прамо в коде базового класса.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nYAML:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ENsTree:\n  tableName: ns_tree\n  actAs: [NestedSet]\n  columns:\n    id:\n      type: integer(8)\n      primary: true\n      autoincrement: true\n    name:\n      type: string(50)\n      notnull: true\n    lft:\n      type: integer(8)\n      notnull: true\n    rgt:\n      type: integer(8)\n      notnull: true\n    level:\n      type: integer(8)\n      notnull: true\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак видите, достаточно просто указать \u003Cstrong\u003EactAs: [NestedSet]\u003C\u002Fstrong\u003E в описании класса.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОднако Doctrine предоставляет более гибкую конфигурацию NestedSet модели. Например, вы можете хранить в одной таблице несколько деревьев. Для этого, вам необходимо ввести в таблицу дополнительное поле, в котором вы будете хранить идентификатор корня дерева для каждой записи.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ этом случае конфигурацию следовало бы записать так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ENsTree:\n  tableName: ns_tree\n  actAs: \n    NestedSet:\n      hasManyRoots: true\n      rootColumnName: root_id\n  columns:\n    id:\n      type: integer(8)\n      primary: true\n      autoincrement: true\n    root_id:\n      type: integer(8)\n      notnull: true\n    name:\n      type: string(50)\n      notnull: true\n    lft:\n      type: integer(8)\n      notnull: true\n    rgt:\n      type: integer(8)\n      notnull: true\n    level:\n      type: integer(8)\n      notnull: true\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсе то же самое могло бы быть проделано в существующем базовом классе модели. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля первого случая:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E&lt;?php\n...\n    public function setTableDefinition()\n    {\n        ...\n        $this-\u003EactAs('NestedSet');\n       ...\n    }\n...\n?\u003E\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nили:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E&lt;?php\n...\n    public function setTableDefinition()\n    {\n        ...\n        $this-\u003EactAs('Doctrine_Template_NestedSet');\n       ...\n    }\n...\n?\u003E\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля второго случая (несколько деревьев):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E&lt;?php\n...\n    public function setTableDefinition()\n    {\n        ...\n        $options = array('hasManyRoots'     =\u003E true,\n                         'rootColumnName'   =\u003E 'root_id');\n        $this-\u003EactAs('NestedSet', $options);\n       ...\n    }\n...\n?\u003E\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗаметьте, Doctrine использует 'root_id' в качестве имени поля по умолчанию. Поэтому вам не обязательно указывать эту опцию, если оно совпадает с именем в вашей реальной таблице. В противном случае вы можете его задать.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EПримеры работы с деревьями Nested Set в Doctrine\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИзвлекаем и печатаем все дерево на экран:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E&lt;?php\n$tree = Doctrine::getTable( 'NsTree')-\u003EgetTree()-\u003EfetchTree();\necho \"&lt;pre\u003E\";\nforeach ($tree as $node) {\n    echo str_repeat( \"\\t\", $node['level']) . $node['name'] . \"\\n\";\n}\necho \"&lt;\u002Fpre\u003E\";\n?\u003E\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосмотрите как это просто!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗа дополнительными примерами и информацией вы можете обратиться к официальной документации Doctrine, разделы \u003Ca href=\"http:\u002F\u002Fwww.doctrine-project.org\u002Fdocumentation\u002Fmanual\u002F1_0\u002Fen\u002Fone-page#hierarchical-data:nested-set:working-with-the-trees\"\u003E8.2.4\u003C\u002Fa\u003E и \u003Ca href=\"http:\u002F\u002Fwww.doctrine-project.org\u002Fdocumentation\u002Fmanual\u002F1_0\u002Fen\u002Fone-page#hierarchical-data:nested-set:advanced-usage\"\u003E8.2.5\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EМатериализованный путь (Materialized Path)\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EОписание структуры\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕще один довольно интересный подход для хранения иерархических структур. Основная идея алгоритма в хранении полного пути к узлу от вершины дерева. Выглядит это примерно так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Materialized Path\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"378\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F55c\u002F36b\u002F37b\u002F55c36b37b77a5d3c8e23b66fd53cd807.gif\" data-width=\"496\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 7. Древовидная структура, организованная по принципу «материализованый путь»\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПринцип формирования таких путей достаточно прост. Глубина пути — это уровень дерева. Внутри ветки нумерация — инкрементная. Другими словами, VEGETABLE — первый ребенок FOOD, FRUIT — второй ребенок и т.д.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПроще будет взглянуть на это в виде таблицы:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E+---------------+-------+\n| name          | path  |\n+---------------+-------+\n| FOOD          | 1     |\n|   VEGETABLE   | 1.1   |\n|     POTATO    | 1.1.1 |\n|     TOMATO    | 1.1.2 |\n|   FRUIT       | 1.2   |\n|     APPLE     | 1.2.1 |\n|     BANANA    | 1.2.2 |\n+---------------+-------+\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВозможно, так даже более наглядно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ базе данных все это находит следующее отражение.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg title=\"Materialized Path Table Structure\" src=\"\u002Fimg\u002Fimage-loader.svg\" height=\"72\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F051\u002Ffca\u002F96a\u002F051fca96a9b383a0554ffbd9188fe61d.png\" data-width=\"167\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 8. структура таблицы иерархических данных, организованных по принципу «материализованный путь»\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИли в виде SQL:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ECREATE TABLE mp_tree (\n    `id` BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,\n    `name` VARCHAR(50) NOT NULL,\n    `path` VARCHAR(100) NOT NULL\n) TYPE=InnoDB DEFAULT CHARSET=utf8;\n\nCREATE INDEX mpp_idx ON mp_tree (`path`);\n\nINSERT INTO mp_tree VALUES\n    (1, 'FOOD', '1'),\n    (2, 'VEGETABLE', '1.1'),\n    (3, 'POTATO', '1.1.1'),\n    (4, 'TOMATO', '1.1.2'),\n    (5, 'FRUIT', '1.2'),\n    (6, 'APPLE', '1.2.1'),\n    (7, 'BANANA', '1.2.2');\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ чем же преимущество такого подхода?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВо-первых, по сравнению с Nested Set, он более поддается изменениям. В то же время остается достаточно удобным для выборки деревьев целиком и их частей. Но, и он не идеален. Особенно по части поиска предков ветки.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EПоиск пути к узлу:\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT t1.name from mp_tree t1, mp_tree t2\nWHERE t2.path like CONCAT( t1.path, '.%')\nAND t2.id = 3; \u002F* Поиск пути к узлу с именем 'POTATO' *\u002F\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРезультат:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E+-----------+\n| name      |\n+-----------+\n| FOOD      |\n| VEGETABLE |\n+-----------+\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EВычисление уровня вложенности.\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля решения этой задачи нам в принципе достаточно посчитать кол-во точек (или других разделителей, если вы используете не точку) в путях. К сожалению, MySQL не имеет подходящей функции, но мы можем ее реализовать достаточно просто своими силами:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ECREATE FUNCTION STRFIND (str VARCHAR(255), delimtr CHAR(1)) RETURNS INT\nBEGIN\nDECLARE _cnt INT;\nDECLARE _start INT;\nSET _cnt = -1;\nSET _start = 1;\nWHILE _start \u003E 0 DO\n  SET _start = LOCATE( delimtr, str);\n  SET str    = SUBSTRING( str, _start + 1);\n  SET _cnt   = _cnt + 1;\nEND WHILE;\nRETURN _cnt;\nEND\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EВыбор ветки:\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT name, strfind( path, '.') AS level \nFROM mp_tree \nWHERE path LIKE '1.1%'; \u002F* Выбираем всю ветку 'VEGETABLES' *\u002F;\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРезультат:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003E+-----------+-------+\n| name      | level |\n+-----------+-------+\n| VEGETABLE |     1 |\n| POTATO    |     2 |\n| TOMATO    |     2 |\n+-----------+-------+\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОбратите внимание, в данном примере мы воспользовались нашей самописной функцией и это было достаточно удобно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EПоиск родителя:\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cpre\u003ESELECT t2.* \nFROM mp_tree t1, mp_tree t2 \nWHERE t1.id=3 AND t2.path=SUBSTRING( t1.path, 1, (LENGTH(t1.path) - LOCATE('.', REVERSE(t1.path))));\u003C\u002Fpre\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак видите, все эти запросы не тешат максимальной производительностью (по сравнению с предыдущим методом), но, тем не менее, использование именно этого алгоритма может быть заметно удобнее, для деревьев, над которыми часто выполняются как операции чтения, так и изменения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНасколько известно автору, алгоритм довольно уверенно себя чувствует на достаточно больших объемах данных.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСледует отметить, что наиболее неприятной в данном алгоритме будет операция вставки узла в середину уже существующей структуры (между другими узлами), т.к. это повлечет изменение всех путей в нижележащих узлах. Хотя, справедливости ради, следует сказать, что такая операция окажется нетривиальной для любой модели хранения данных. Другая тяжелая операция — это перенос одной ветки в другую.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА вот удаление, добавление в конец или изменение узла — это операции довольно простые, и, как правило, не вызывают сложностей в данной модели.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак видно из примеров, данный алгоритм также можно несколько оптимизировать на чтение, путем введения ещё одного поля level, как это было сделано для списков смежных вершин (Nested Set). Однако это несколько усложнит операции добавления, изменения и удаления узлов дерева, т.к. уровни придется пересчитывать для всего или части дерева при каждом изменении. В конечном счете, именно разработчику решать, в какую сторону следует делать перекос производительности.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003EИспользование в Doctrine\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nК сожалению, на данный момент, этот метод хранения деревьев пока не нашел своей реализации в ORM Doctrine (текущая версия на момент написания материала — 1.0.4, 1.1.0 — в альфа версии также реализации не имеет).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТем не менее есть все предпосылки полагать, что его реализация появится в будущем, т.к. исходные коды библиотеки содержат в пакете Doctrine\u002FTree абстракный пустой класс с именем MaterializedPath.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nАвтор будет следить за событиями и обновит эту статью, как только реализация найдет свое отражение, так что можете сюда вернуться позже.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EКомбинированный подход\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПо сути вопроса следует отметить, что скомбинировать приведенные методы можно лишь в двух направлениях:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСписки смежности + материализованный путь (Adjacency List + Materialized Path)\u003C\u002Fli\u003E\r\n\u003Cli\u003EСписки смежности + вложенные множества (Adjacency List + Nested Set)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nКомбинировать же Nested Set и Materialized Path особого смысла не имеет, т.к. существенного выигрыша ни в чтении, ни в записи вы не получите.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nФактически, комбинирование подходов на уровне БД ограничивается вводом поля, хранящего ссылку на родительскую запись в таблицы списков смежности и материализованных путей:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" title=\"Таблицы данных структур AL+MP и AL+NS\" height=\"106\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F235\u002Fbd0\u002F09b\u002F235bd009bafdd26ee393aafd6e540f90.png\" data-width=\"420\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cem\u003EРис. 9. Таблицы моделей иерархических структур данных AL+MP и AL+NS\u003C\u002Fem\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПоследствия такого подхода очевидны.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EAL+MP\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля AL при использовании с MP:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EУлучшаются операции выборки ветвей и поддеревьев целиком\u003C\u002Fli\u003E\r\n\u003Cli\u003EУхудшаются операции переноса ветвей\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля MP при использовании с AL:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EУлучшаются операции выборки родителей заданного узла\u003C\u002Fli\u003E\r\n\u003Cli\u003EУлучшаются операции выборки наследников заданного узла\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003EAL+NS\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля связки AL+NS взаимовыгодность не столь очевидна. В первую очередь это объясняется тем, что недостатки от проблем изменения узлов дерева в модели NS напрочь убивают в этой сфере все достоинства AL. Это значит, что такую связку следует рассматривать лишь как качественное улучшение поиска родителей и наследников заданного узла в алгоритме NS, а также как повышение надежности самого алгоритма (ключи можно всегда перестроить в случае порчи — информацию о связях хранит AL). Утверждение о повышении надежности справедливо и для предыдущей комбинации методов. Но ведь и это качественное улучшение, хотя и не такое очевидное, не так ли?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EЗаключение\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ данной статье мы рассмотрели несколько основных методов хранения иерархических данных в реляционных БД и очертили все их достоинства и недостатки. Также мы показали на практике, какие из них доступны для использования в реализации ORM Doctrine, и как их использовать.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОчевидно, что даже выбор того или иного метода в каждом конкретном случае — задача не такая уж и простая, но автор надеется, что данный материал будет способствовать принятию осознанного и правильного решения, а также будет способствовать творческому процессу поиска новых и более оптимальных решений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУдачи в девелопменте!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Csub\u003EP.S. Это кросс-пост \u003Ca href=\"http:\u002F\u002Fmikhailstadnik.com\u002Fhierarchical-data-structures-and-doctrine\"\u003Eоригинальной статьи\u003C\u002Fa\u003E с моего блога\u003C\u002Fsub\u003E\u003C\u002Fblockquote\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"Adjacency List"},{"titleHtml":"Doctrine"},{"titleHtml":"hierarchical data"},{"titleHtml":"Materialized Path"},{"titleHtml":"MySQL"},{"titleHtml":"Nested Set"},{"titleHtml":"tree"},{"titleHtml":"Базы данных"},{"titleHtml":"деревья"},{"titleHtml":"иерархические данные"},{"titleHtml":"алгоритмы"},{"titleHtml":"php 5"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F46659\u002F8262acf054ba6d751ee5f3622c1875df\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F46659\u002F8262acf054ba6d751ee5f3622c1875df\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F46659\\\u002F\"},\"headline\":\"Иерархические структуры данных и Doctrine\",\"datePublished\":\"2008-12-10T18:18:21+03:00\",\"dateModified\":\"2008-12-10T23:05:45+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Михаил Стадник\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Введение  Хранение иерархических данных (или попросту &mdash; деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда раз...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F46659\\\u002F#post-content-body\",\"about\":[\"h_webdev\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Ffce\\\u002F1c2\\\u002F6b3\\\u002Ffce1c26b3ecdcee5037ccf2e5fa86d50.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F765\\\u002Fd7e\\\u002Fb72\\\u002F765d7eb723f92da4a974817d19863bc3.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F90b\\\u002Fa43\\\u002Fb01\\\u002F90ba43b011ca58799b0fad09a9c289de.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F39a\\\u002Fcbc\\\u002F47e\\\u002F39acbc47ef660d9a3ba01e25ace3d8d9.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F80d\\\u002F126\\\u002Fcb0\\\u002F80d126cb007779d502bd92e6522774cb.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F96b\\\u002Ff21\\\u002Fdcb\\\u002F96bf21dcb4175e85c0ee696932d100c9.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F55c\\\u002F36b\\\u002F37b\\\u002F55c36b37b77a5d3c8e23b66fd53cd807.gif\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F051\\\u002Ffca\\\u002F96a\\\u002F051fca96a9b383a0554ffbd9188fe61d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002F235\\\u002Fbd0\\\u002F09b\\\u002F235bd009bafdd26ee393aafd6e540f90.png\"]}","metaDescription":"Введение\r\n\r\nХранение иерархических данных (или попросту — деревьев) в реляционных структурах задача довольно нетривиальная и вызывает некоторые проблемы, когда разработчики сталкиваются с подобной...","mainImageUrl":null,"amp":true},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"578296":{"id":"578296","timePublished":"2021-09-26T14:00:02+00:00","isCorporative":true,"lang":"ru","titleHtml":"Вектор? Растр? А может — и то, и другое?","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Zach Leatherman","originalUrl":"https:\u002F\u002Fwww.zachleat.com\u002Fweb\u002Fvector-raster-split\u002F"}}],"author":{"id":"1220775","alias":"ru_vds","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fe36\u002F812\u002Fd3d\u002Fe36812d3de38eb3d479d7a13228717ef.png","speciality":"Пользователь"},"statistics":{"commentsCount":8,"favoritesCount":25,"readingCount":2152,"score":17,"votesCount":19},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"449","alias":"vector_graphics","type":"collective","title":"Работа с векторной графикой","titleHtml":"Работа с векторной графикой","isProfiled":true},{"relatedData":null,"id":"8880","alias":"server_side_optimization","type":"collective","title":"Серверная оптимизация","titleHtml":"Серверная оптимизация","isProfiled":true},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"19802","alias":"graph_design","type":"collective","title":"Графический дизайн","titleHtml":"Графический дизайн","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"2","alias":"design","title":"Дизайн"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"На этой неделе я столкнулся с интересным классом задач, для решения которых, как я теперь понимаю, можно было использовать гораздо более удачный подход и раньше. Но существует ли такой подход?\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F578296\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fge\u002Fkf\u002F1n\u002Fgekf1nauxn50imhrqyil4rlzj5m.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Ci\u003E\u003Cfont color=\"#999999\"\u003EИзображение для верхней части сайта\u003C\u002Ffont\u003E\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nРечь идёт о подготовке изображения, рассчитанного на использовании в верхней правой части сайта \u003Ca href=\"https:\u002F\u002Fjamstackconf.com\" rel=\"nofollow noopener noreferrer\"\u003Ejamstackconf.com\u003C\u002Fa\u003E. Мы, в маркетинговой команде Netlify, используем Figma. Первая моя попытка экспорта этого изображения для использования его на сайте оказалась далеко не самой удачной.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"графика"},{"titleHtml":"веб-разработка"},{"titleHtml":"ruvds_перевод"}]},"579296":{"id":"579296","timePublished":"2021-09-26T10:00:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Упрощаем эмуляцию X86 с помощью Live CD","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"ClassicHasClass","originalUrl":"https:\u002F\u002Fwww.talospace.com\u002F2021\u002F09\u002Fbetter-x8664-emulation-with-live-cds.html"}}],"author":{"id":"2488151","alias":"Bright_Translate","fullname":"Дмитрий Брайт","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff9c\u002Fff9\u002F7d9\u002Ff9cff97d9c0677af28dab451897f88e4.jpg","speciality":"Переводчик"},"statistics":{"commentsCount":7,"favoritesCount":19,"readingCount":2376,"score":13,"votesCount":13},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"7289","alias":"nix","type":"collective","title":"*nix","titleHtml":"*nix","isProfiled":true},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false},{"relatedData":null,"id":"21930","alias":"antikvariat","type":"collective","title":"Старое железо","titleHtml":"Старое железо","isProfiled":false}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F579296\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fmt\u002Fwb\u002F5s\u002Fmtwb5s5gaflvyaymdbaqbremhye.png\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nТипичный подход к эмулированию среды для запуска старых файлов с архитектурой i386 сопряжен со сложностями, в частности с поиском всех необходимых библиотек. Однако этой проблемы можно избежать, воспользовавшись заранее подготовленным образом Live CD, о чем в статье и пойдет речь на примере образа эмулятора Palm OS и игры Shogo: Mobile Armor Division.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ruvds_перевод"},{"titleHtml":"QEMU"},{"titleHtml":"pose"},{"titleHtml":"palm"}]},"579542":{"id":"579542","timePublished":"2021-09-26T19:00:02+00:00","isCorporative":true,"lang":"ru","titleHtml":"Jetpack Compose — как легко построить UI на Android","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2713395","alias":"i15in","fullname":"Иван","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F25f\u002Fe4b\u002Ff94\u002F25fe4bf94867d9647a0ae809abf2e429.jpg","speciality":"Android developer"},"statistics":{"commentsCount":6,"favoritesCount":48,"readingCount":2895,"score":23,"votesCount":31},"hubs":[{"relatedData":null,"id":"18232","alias":"funcorp","type":"corporative","title":"Блог компании FUNCORP","titleHtml":"Блог компании FUNCORP","isProfiled":false},{"relatedData":null,"id":"6345","alias":"mobile_dev","type":"collective","title":"Разработка мобильных приложений","titleHtml":"Разработка мобильных приложений","isProfiled":true},{"relatedData":null,"id":"9188","alias":"ui","type":"collective","title":"Интерфейсы","titleHtml":"Интерфейсы","isProfiled":true},{"relatedData":null,"id":"17107","alias":"android_dev","type":"collective","title":"Разработка под Android","titleHtml":"Разработка под Android","isProfiled":true},{"relatedData":null,"id":"19441","alias":"kotlin","type":"collective","title":"Kotlin","titleHtml":"Kotlin","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"2","alias":"design","title":"Дизайн"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ июле этого года вместе с Android Studio Arctic Fox вышла одна из долгожданных библиотек — Jetpack Compose. Она позволяет создавать пользовательский интерфейс в декларативном стиле и обещает быть революцией в построении UI.\u003C\u002Fp\u003E\u003Cp\u003EРазбираемся, так ли это на самом деле, какие у библиотеки преимущества и недостатки. Подробности — в статье.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5da\u002F63d\u002F3cb\u002F5da63d3cbeb8e38de3dde2792d851722.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5da\u002F63d\u002F3cb\u002F5da63d3cbeb8e38de3dde2792d851722.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"разработка мобильных приложений"},{"titleHtml":"jetpack compose"},{"titleHtml":"ui"},{"titleHtml":"интерфейсы"},{"titleHtml":"android"},{"titleHtml":"kotlin"},{"titleHtml":"android studio"},{"titleHtml":"arctic fox"},{"titleHtml":"пользовательские интерфейсы"}]},"579772":{"id":"579772","timePublished":"2021-09-27T05:32:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сливы процветают. Эксперт-«параноик» Майкл Баззель о защите личных данных","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Michael Bazzell","originalUrl":"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F"}}],"author":{"id":"2297567","alias":"SearchInform_team","fullname":null,"avatarUrl":"","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":4,"readingCount":1437,"score":9,"votesCount":9},"hubs":[{"relatedData":null,"id":"22418","alias":"searchinform","type":"corporative","title":"Блог компании SearchInform","titleHtml":"Блог компании SearchInform","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНаш очередной пост из серии «интересное на иностранном языке» – рассказ Майкла Баззеля о том, как сберечь свои персональные данные от утечек. Майкл – знаковая фигура в сфере OSINT, работал в правительстве США и ФБР, его приглашали в качестве технического эксперта в сериал «Мистер Робот», который считают достойным с точки зрения достоверности. В личной жизни эксперт придерживается настолько жестких правил в отношении информационной гигиены, что некоторые считают его «неадекватом». Так ли это – может быть несколько мнений. \u003C\u002Fp\u003E\u003Cp\u003EОдин из факторов, который убеждает в правильном подходе Майкла, – что риски обнаружить свои данные в интернете стали существенно выше, потому что шифровальщики без разбору сливают в сеть все, до чего дотягиваются при атаках на бизнес. Приводим перевод \u003Ca href=\"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F\"\u003Eпоста Майкла Баззеля\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EАтакуют корпорации, а страдают люди\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EБольшинство людей не задумываются о том, как их касается проблема распространения вирусов-шифровальщиков. Логика такова: речь идет о проблемах компаний, это они вынуждены платить выкуп. При чем тут, казалось бы, обычные люди?! \u003C\u002Fp\u003E\u003Cp\u003EА при том, что преступники сменили тактику: сейчас они не просто шифруют данные, но и скачивают их, выкладывают в открытый доступ, если компании не платят им выкуп. Теперь давайте подумаем, что в этих слитых базах? Множество данных о сотрудниках, клиентах, контрагентах, с которыми компания-жертва работает.\u003C\u002Fp\u003E\u003Cp\u003EХочу сразу уточнить: я это пишу не потому что выступаю за уплату выкупа. Я за то, чтобы сопротивляться избыточному сбору данных там, где это не обязательно. Мы халатно относимся к своим ПДн, раздавая их по первому требованию.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"персональные данные"},{"titleHtml":"пдн"},{"titleHtml":"сёрчинформ"},{"titleHtml":"Майкл Баззел"},{"titleHtml":"утечки информации"}]},"579804":{"id":"579804","timePublished":"2021-09-26T12:06:13+00:00","isCorporative":true,"lang":"ru","titleHtml":"ОС для работы со звуком — что она умеет","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2691015","alias":"mirhifi","fullname":"«Мир Hi-Fi»","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fdfb\u002F713\u002Fedb\u002Fdfb713edbeed85de6588bd27d6c43229.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":24,"readingCount":5698,"score":9,"votesCount":11},"hubs":[{"relatedData":null,"id":"18822","alias":"audiomania","type":"corporative","title":"Блог компании Аудиомания","titleHtml":"Блог компании Аудиомания","isProfiled":false},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"21918","alias":"soft","type":"collective","title":"Софт","titleHtml":"Софт","isProfiled":false},{"relatedData":null,"id":"21988","alias":"sound","type":"collective","title":"Звук","titleHtml":"Звук","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EОдин из предыдущих материалов мы посвятили \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Faudiomania\u002Fblog\u002F575076\u002F\"\u003Eинструментам\u003C\u002Fa\u003E для сборки цифровой звуковой рабочей станции (DAW). Еще мы говорили об \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Faudiomania\u002Fblog\u002F575892\u002F\"\u003Eopen source проектах\u003C\u002Fa\u003E, в рамках которых можно сделать собственный синтезатор или педалборд.\u003C\u002Fp\u003E\u003Cp\u003EСегодня продолжим тему и расскажем об открытой ОС \u003Cstrong\u003EElk Audio\u003C\u002Fstrong\u003E, построенной на базе Linux. Она заточена под обработку звука на встраиваемых системах.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa15\u002Ffc8\u002F97f\u002Fa15fc897faa2b01e93257c9af08a6eaa.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa15\u002Ffc8\u002F97f\u002Fa15fc897faa2b01e93257c9af08a6eaa.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"аудиомания"},{"titleHtml":"звук"},{"titleHtml":"Elk Audio"},{"titleHtml":"операционные системы"},{"titleHtml":"DAW"}]},"579854":{"id":"579854","timePublished":"2021-09-27T06:03:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Видишь уязвимости? А они есть! Наше исследование популярных CMS-систем","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2684283","alias":"Solar_Pentest","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":5,"favoritesCount":9,"readingCount":1670,"score":17,"votesCount":19},"hubs":[{"relatedData":null,"id":"20826","alias":"solarsecurity","type":"corporative","title":"Блог компании Ростелеком-Солар","titleHtml":"Блог компании Ростелеком-Солар","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛьвиная доля всех работ по анализу защищенности внешнего периметра – это тестирование веб-приложений. Здесь могут быть как корпоративные решения, так и «домашние» разработки на базе различных публичных систем управления контентом (CMS). Мы всегда проводим глубокий анализ подобных решений на тестовых стендах и зачастую находим уязвимости нулевого дня. Собственно, из опыта таких проектов и родилась идея собрать исследовательскую команду и провести глубокий анализ популярных CMS-систем и различных плагинов для них. В этом посте мы поделимся результатами нашего исследования, а также продемонстрируем примеры уязвимого кода наиболее интересных, на наш взгляд, уязвимостей и примеры их эксплуатации. Конечно все эти уязвимости уже исправлены и описываются здесь с разрешения владельцев систем.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","buttonTextHtml":"Не всё то в безопасности, что с Bug Bounty","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"cms"},{"titleHtml":"уязвимости"},{"titleHtml":"уязвимости и их эксплуатация"},{"titleHtml":"уязвимость нулевого дня"}]},"579980":{"id":"579980","timePublished":"2021-09-26T10:05:13+00:00","isCorporative":false,"lang":"ru","titleHtml":"Источник опорного напряжения — один из принципов и одна из реализаций","editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"269411","alias":"VT100","fullname":null,"avatarUrl":"","speciality":"Пользователь"},"statistics":{"commentsCount":5,"favoritesCount":54,"readingCount":6420,"score":42,"votesCount":46},"hubs":[{"relatedData":null,"id":"21472","alias":"circuit-design","type":"collective","title":"Схемотехника","titleHtml":"Схемотехника","isProfiled":true},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"21976","alias":"DIY","type":"collective","title":"DIY или Сделай сам","titleHtml":"DIY или Сделай сам","isProfiled":false},{"relatedData":null,"id":"22016","alias":"easyelectronics","type":"collective","title":"Электроника для начинающих","titleHtml":"Электроника для начинающих","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Как не счесть «алмазов в каменных пещерах» — так не счесть случаев, когда необходимо втиснуть какую-нибудь характеристику «непрерывного» внешнего мира в «дискретное» нутро цифровых алгоритмов или извлечь обратно. Как помнят многие — это делается с помощью аналого-цифровых (АЦП, ADC) и цифро-аналоговых (ЦАП, DAC) преобразователей. Но только более посвящённые — обратят при этом внимание на источник опорного напряжения для преобразований (ИОН, Reference), который во многом определяет стабильность и абсолютную точность полученного результата. Конечно, есть некоторое число случаев, когда можно произвести измерение или генерацию отношения двух токов или напряжений. Тогда достаточно подать большее из них на опорный вход преобразователя. Но это — именно «некоторое число».\u003Cbr\u003E\r\n Желающих ознакомиться с одним из принципов и одной из реализаций температурно-стабильного ИОН — приглашаю под кат. Помощь в этом — предоставит симулятор \u003Ca href=\"https:\u002F\u002Fwww.analog.com\u002Fen\u002Fdesign-center\u002Fdesign-tools-and-calculators\u002Fltspice-simulator.html\" rel=\"nofollow noopener noreferrer\"\u003ELTSPICE\u003C\u002Fa\u003E (несмотря на то, что человек с КДПВ сказал: «My favorite CAD is solder»). Желательно — знание закона Ома, правил Кирхгофа, принципов работы биполярного транзистора (на уровне модели Эберса-Молла) и идеального операционного усилителя.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cb\u003EКДПВ1\u003C\u002Fb\u003E: Robert Allan Pease — the czar of bandgap. «Орденские цепи» — из ИМС стабилизаторов в корпусе TO-3.\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fj9\u002Ffk\u002Fui\u002Fj9fkuinqeb01dhjearz6ekwbahc.jpeg\"\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Источники питания"},{"titleHtml":"АЦП и ЦАП"},{"titleHtml":"схемотехника для чайников."}]},"580008":{"id":"580008","timePublished":"2021-09-27T06:30:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"Летний Магнитогорск","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2614609","alias":"city_scraper","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8f8\u002Fd6c\u002F328\u002F8f8d6c328ec3a513103b6757c2c21610.png","speciality":"Пользователь"},"statistics":{"commentsCount":3,"favoritesCount":2,"readingCount":1707,"score":10,"votesCount":14},"hubs":[{"relatedData":null,"id":"22012","alias":"Ecology","type":"collective","title":"Экология","titleHtml":"Экология","isProfiled":false},{"relatedData":null,"id":"22024","alias":"urban","type":"collective","title":"Урбанизм","titleHtml":"Урбанизм","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EМагнитогорск Челябинской области – один из крупнейших мировых центров чёрной металлургии. В России это шестой из крупнейших городов, которые не являются центрами субъектов страны. \u003C\u002Fp\u003E\u003Cp\u003EСовсем недавно город был одним из наиболее неблагополучных с точки зрения загрязнения атмосферного воздуха, но в 2021 году был зафиксирован «повышенный» уровень – то есть не «высокий» или «очень высокий», как раньше. \u003C\u002Fp\u003E\u003Cp\u003EКак этот город выглядит летом? Где и как его жители могут проводить время?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Магнитогорск"},{"titleHtml":"промышленность"},{"titleHtml":"промышленные города"},{"titleHtml":"урбанизм\u002Fурбания"},{"titleHtml":"урбанистика"},{"titleHtml":"города России"},{"titleHtml":"города"}]},"580018":{"id":"580018","timePublished":"2021-09-26T09:06:26+00:00","isCorporative":false,"lang":"ru","titleHtml":"Сколько стоит замена батарей в электромобилях?","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Bryce Gaton","originalUrl":"https:\u002F\u002Fthedriven.io\u002F2021\u002F07\u002F23\u002Fhow-much-are-replacement-batteries-for-electric-vehicles-in-australia\u002F"}}],"author":{"id":"1803585","alias":"GeorgKDeft","fullname":"дима","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F10f\u002Fd61\u002F864\u002F10fd6186430ede52ad4a1567dff9afdc.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":193,"favoritesCount":22,"readingCount":37725,"score":18,"votesCount":36},"hubs":[{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21914","alias":"energy","type":"collective","title":"Энергия и элементы питания","titleHtml":"Энергия и элементы питания","isProfiled":false},{"relatedData":null,"id":"22004","alias":"transport","type":"collective","title":"Транспорт","titleHtml":"Транспорт","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E Мы приветствуем вопросы читателей об аккумуляторных электромобилях, зарядках и обо всем, что вы хотите узнать. Поэтому, пожалуйста, отправьте их, и мы заставим наших экспертов ответить и пригласить других людей внести свой вклад через раздел комментариев.  \u003C\u002Fp\u003E\u003Cp\u003EСегодняшний вопрос читателя: У меня есть вопрос относительно стоимости замены батареи в BEV, доступной в Австралии, и производитель сообщил срок службы до того, как потребуется замена?  \u003C\u002Fp\u003E\u003Cp\u003EЭта тема является ключевым моментом, который волнует многих покупателей перед покупкой BEV. С уважением, Андрей.\u003C\u002Fp\u003E\u003Cp\u003E Привет, Эндрю, да, вопрос о том, когда заменять аккумулятор электромобиля и о стоимости, важен - но, возможно, не так сильно, как думает широкая публика.  \u003C\u002Fp\u003E\u003Cp\u003EПервое: я разделю вопрос на две части. Какова вероятность того, что аккумулятор потребует замены в течение срока службы автомобиля? Какова стоимость возможной замены батареи? Потребуется ли замена аккумулятора в течение срока службы автомобиля? Чтобы ответить на этот вопрос, необходимо изучить две проблемы: Когда аккумулятор перестанет «подходить по назначению»? а также Как долго длится «жизнь автомобиля»?  \u003C\u002Fp\u003E\u003Cp\u003EВо-первых, значительная часть производителей дает гарантию на свои батареи как минимум на 70% емкости, оставшейся после 8 лет. Для Hyundai Kona с запасом хода 450–500 км по городу это соответствует минимальному диапазону 315–350 км в возрасте 8 лет. Для многих, если не для большинства, это означает зарядку, возможно, два раза в неделю, а не один раз в неделю. То же самое и для дальних путешествий - может быть, пара дополнительных остановок для перезарядки, например, по пути между Сиднеем и Брисбеном.  \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F937\u002F372\u002F95b\u002F93737295b6a08ba7a8b84ab4b0c417e2.jpg","buttonTextHtml":"Далее в цифрах о цене аккумуляторов сейчас","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F937\u002F372\u002F95b\u002F93737295b6a08ba7a8b84ab4b0c417e2.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"аккумуляторы"},{"titleHtml":"замена"},{"titleHtml":"электромобили"},{"titleHtml":"цена"}]},"580038":{"id":"580038","timePublished":"2021-09-26T13:35:19+00:00","isCorporative":false,"lang":"ru","titleHtml":"KODI: собираем удобный и функциональный медиацентр для дома. Часть 9. Spotify","editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"2644801","alias":"arboozof","fullname":"Роман","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff76\u002F452\u002F3d5\u002Ff764523d55be8ef6fc4307ea3158dadf.png","speciality":"IT\u002FRetail"},"statistics":{"commentsCount":12,"favoritesCount":34,"readingCount":5132,"score":10,"votesCount":10},"hubs":[{"relatedData":null,"id":"36","alias":"linux","type":"collective","title":"Настройка Linux","titleHtml":"Настройка Linux","isProfiled":true},{"relatedData":null,"id":"144","alias":"open_source","type":"collective","title":"Open source","titleHtml":"Open source","isProfiled":true},{"relatedData":null,"id":"21908","alias":"smartphones","type":"collective","title":"Смартфоны","titleHtml":"Смартфоны","isProfiled":false},{"relatedData":null,"id":"21946","alias":"video_tech","type":"collective","title":"Видеотехника","titleHtml":"Видеотехника","isProfiled":false},{"relatedData":null,"id":"21988","alias":"sound","type":"collective","title":"Звук","titleHtml":"Звук","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПродолжаем тему интеграции в наш медиацентр онлайн-сервисов прослушивания музыки. Ранее мы уже «подружили» медиацентр KODI с сервисом Яндекс.Музыка. Сегодня на очереди не менее популярный сервис – Spotify.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd36\u002Fb76\u002Fd13\u002Fd36b76d13fccd166d952840d838d4997.png","buttonTextHtml":"Читать дальше &rarr;","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd36\u002Fb76\u002Fd13\u002Fd36b76d13fccd166d952840d838d4997.png","fit":"cover","positionY":0,"positionX":14.74358974359}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"kodi"},{"titleHtml":"xbmc"},{"titleHtml":"ubuntu"},{"titleHtml":"kubuntu"},{"titleHtml":"music"},{"titleHtml":"spotify"},{"titleHtml":"addons"},{"titleHtml":"дополнения"},{"titleHtml":"тв"}]},"580048":{"id":"580048","timePublished":"2021-09-26T14:22:36+00:00","isCorporative":false,"lang":"ru","titleHtml":"Будь строже к себе: как ограничения помогают сделать код лучше","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2787821","alias":"ZeBrains_team","fullname":"Станислав Маслов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fae3\u002F3ee\u002F4f1\u002Fae33ee4f1a117aeeab42ec5a9e2eba25.jpg","speciality":"директор продакшена в IT-компании"},"statistics":{"commentsCount":10,"favoritesCount":45,"readingCount":4042,"score":8,"votesCount":16},"hubs":[{"relatedData":null,"id":"19583","alias":"dev_management","type":"collective","title":"Управление разработкой","titleHtml":"Управление разработкой","isProfiled":true},{"relatedData":null,"id":"20682","alias":"pm","type":"collective","title":"Управление проектами","titleHtml":"Управление проектами","isProfiled":true},{"relatedData":null,"id":"20726","alias":"productpm","type":"collective","title":"Управление продуктом","titleHtml":"Управление продуктом","isProfiled":true}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cstrong\u003E\u003Cem\u003EЕсли вам приходилось задумываться о построении эффективной экосистемы проекта и определении ролей тимлида и разработчика — статья Артема Прозорова из ZeBrains для вас. \u003C\u002Fem\u003E\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EПредлагаю вам задуматься над одним вопросом. Но не спешите с ответом, потому что он не так очевиден, как может показаться:\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EКакая из команд может реализовать более технически стабильный продукт?&nbsp;\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EКоманда №1:\u003C\u002Fstrong\u003E Проектный менеджер, аналитик, тестировщик и несколько разработчиков, у каждого из которых за плечами минимум три года опыта. Все работают в одном офисе, посвящая свое время одному проекту в режиме fulltime.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EКоманда №2:\u003C\u002Fstrong\u003E Один сильный разработчик. Ему помогают множество не знакомых между собой людей из разных часовых поясов. У каждого — свой набор компетенций и уровень опыта. Работой над проектом участники занимаются в свободном режиме, по несколько часов в неделю.\u003C\u002Fp\u003E\u003Cp\u003E* * *\u003C\u002Fp\u003E\u003Cp\u003EОтвет на этот вопрос получим к концу статьи.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fefe\u002F413\u002Feb2\u002Fefe413eb27c391cfcfef0484e6997aab.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"управление проектами"},{"titleHtml":"управление продуктом"},{"titleHtml":"управление командой разработки"},{"titleHtml":"управление командами разработчиков"},{"titleHtml":"тимлид"},{"titleHtml":"тимлиды и разработчики"}]},"580052":{"id":"580052","timePublished":"2021-09-26T15:29:26+00:00","isCorporative":false,"lang":"ru","titleHtml":"Почему экология не может быть плохой?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2568695","alias":"phanerozoi_evidence","fullname":"Фанерозой","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fdcc\u002F862\u002F561\u002Fdcc862561429f2ed85090ac53e39cf7d.jpg","speciality":"Биологи, врач, научный популяризатор, палеонтолог"},"statistics":{"commentsCount":46,"favoritesCount":24,"readingCount":4455,"score":8,"votesCount":28},"hubs":[{"relatedData":null,"id":"20742","alias":"read","type":"collective","title":"Читальный зал","titleHtml":"Читальный зал","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"22012","alias":"Ecology","type":"collective","title":"Экология","titleHtml":"Экология","isProfiled":false},{"relatedData":null,"id":"22750","alias":"biology","type":"collective","title":"Биология","titleHtml":"Биология","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cem\u003EСо второй половины ХХ в мы всё чаще слышим из средств массовой информации выражения «плохая экология», «сохранить экологию», «экология строительных материалов». Но, к сожалению, не многие знают, что такое «экология» на самом деле. Для разгадки тайн экологии нам предстоит окунуться в удивительный мир науки...\u003C\u002Fem\u003E\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9a4\u002Fecf\u002Fd11\u002F9a4ecfd1144e299873622d45d23d2ce0.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9a4\u002Fecf\u002Fd11\u002F9a4ecfd1144e299873622d45d23d2ce0.png","fit":"cover","positionY":29.545454545455,"positionX":1.4102564102564}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"виды"},{"titleHtml":"охрана окружающей среды"},{"titleHtml":"мифы"},{"titleHtml":"экосистема"},{"titleHtml":"биогеоценоз"},{"titleHtml":"экология"},{"titleHtml":"экосистемы"},{"titleHtml":"биоценозы"},{"titleHtml":"биология"},{"titleHtml":"вирусы"}]},"580060":{"id":"580060","timePublished":"2021-09-27T09:00:04+00:00","isCorporative":true,"lang":"ru","titleHtml":"Арракис, который мы заслужили","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"238277","alias":"Zelenyikot","fullname":"Виталий Егоров","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F22b\u002F2d7\u002F7a5\u002F22b2d77a57b687aae24784a3e53089c9.jpg","speciality":"Популяризатор космонавтики"},"statistics":{"commentsCount":0,"favoritesCount":7,"readingCount":1221,"score":21,"votesCount":23},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false},{"relatedData":null,"id":"21984","alias":"sci-fi","type":"collective","title":"Научная фантастика","titleHtml":"Научная фантастика","isProfiled":false},{"relatedData":null,"id":"22014","alias":"futurenow","type":"collective","title":"Будущее здесь","titleHtml":"Будущее здесь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F580060\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fk0\u002Fds\u002Fy5\u002Fk0dsy5npxclyjdytiroqga7-leu.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nВо вселенной писателя-фантаста Фрэнка Герберта, Дюна, она же Арракис &mdash; это пустынная и маловодная планета с двумя лунами. По сюжету, она находится за пределами Солнечной системы, но если мы захотим поискать ближайшую схожую параллель,&nbsp;то больше всего подходит планета Марс. Предлагаю воспользоваться возможностями, которые даёт современная космонавтика, и совершить воображаемую прогулку на нашу Дюну.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Марс"},{"titleHtml":"Дюна"},{"titleHtml":"MRO"},{"titleHtml":"Curiosity"},{"titleHtml":"марсоход"},{"titleHtml":"ruvds_статьи"}]},"580080":{"id":"580080","timePublished":"2021-09-26T19:12:55+00:00","isCorporative":false,"lang":"ru","titleHtml":"Дайджест свежих материалов из мира фронтенда за последнюю неделю №486 (20 — 26 сентября 2021)","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"59347","alias":"alexzfort","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd2a\u002Fe8a\u002F5ac\u002Fd2ae8a5ac9876f838ebdd45f3ea3bc3b.png","speciality":""},"statistics":{"commentsCount":2,"favoritesCount":16,"readingCount":2714,"score":17,"votesCount":17},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"307","alias":"css","type":"collective","title":"CSS","titleHtml":"CSS","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"17103","alias":"html5","type":"collective","title":"HTML","titleHtml":"HTML","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"Предлагаем вашему вниманию подборку с ссылками на новые материалы из области фронтенда и около него.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fec\u002F0x\u002Fkx\u002Fec0xkxfr5jd-rci1wjo9bmr4cns.jpeg\"\u003E\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дайджест"},{"titleHtml":"фронтенд"},{"titleHtml":"css"},{"titleHtml":"js"},{"titleHtml":"es6"},{"titleHtml":"vue"},{"titleHtml":"react"},{"titleHtml":"angular"},{"titleHtml":"ember"},{"titleHtml":"html5"},{"titleHtml":"браузеры"},{"titleHtml":"ссылки"}]},"580084":{"id":"580084","timePublished":"2021-09-26T19:30:13+00:00","isCorporative":false,"lang":"ru","titleHtml":"Telegram Bots vs Google Forms","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2705023","alias":"dm_aq","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":4,"favoritesCount":18,"readingCount":3304,"score":7,"votesCount":7},"hubs":[{"relatedData":null,"id":"144","alias":"open_source","type":"collective","title":"Open source","titleHtml":"Open source","isProfiled":true},{"relatedData":null,"id":"19441","alias":"kotlin","type":"collective","title":"Kotlin","titleHtml":"Kotlin","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EGoogle forms отличный инструмент для решения простых организационных задач, например, сбор информации для регистрации людей на небольшое мероприятие. Но что если мы попытаемся решить эту задачу по другому? Например через telegram.&nbsp;\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"telegrambot"},{"titleHtml":"telegram"},{"titleHtml":"kotlin"},{"titleHtml":"spring"}]},"580086":{"id":"580086","timePublished":"2021-09-26T19:37:10+00:00","isCorporative":false,"lang":"ru","titleHtml":"Термо принтер и JavaScript","editorVersion":"2.0","postType":"article","postLabels":[{"type":"recovery","data":null}],"author":{"id":"1709955","alias":"IIIarp","fullname":"Сергей Шарпов","avatarUrl":"","speciality":"Веб разработчик"},"statistics":{"commentsCount":40,"favoritesCount":30,"readingCount":6557,"score":31,"votesCount":33},"hubs":[{"relatedData":null,"id":"84","alias":"crazydev","type":"collective","title":"Ненормальное программирование","titleHtml":"Ненормальное программирование","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПриобрел я на днях термопринтер (кассовый аппарат, если изволите) жене для магазина и решил что смогу его обуздать как истинный программист и сделать свою веб кассу, вместо того, что-бы использовать платные решения, ведь задача простая, печатать чеки, но это оказалось не так то и просто...\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4f3\u002F259\u002Fe4e\u002F4f3259e4e73b5bfae82890fd3db512a0.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4f3\u002F259\u002Fe4e\u002F4f3259e4e73b5bfae82890fd3db512a0.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"термопринтер"},{"titleHtml":"javascript"},{"titleHtml":"webusb"}]},"580088":{"id":"580088","timePublished":"2021-09-26T21:17:27+00:00","isCorporative":false,"lang":"ru","titleHtml":"Запуск X-приложения в chroot на примере POSE (или «QEMU не нужен»)","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1481597","alias":"edo1h","fullname":null,"avatarUrl":"","speciality":"немного программист, немного админ"},"statistics":{"commentsCount":5,"favoritesCount":7,"readingCount":832,"score":11,"votesCount":11},"hubs":[{"relatedData":null,"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true},{"relatedData":null,"id":"7289","alias":"nix","type":"collective","title":"*nix","titleHtml":"*nix","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭта мини-статья родилась как ответ на статью \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F579296\" rel=\"noopener noreferrer nofollow\"\u003EУпрощаем эмуляцию X86 с помощью Live CD\u003C\u002Fa\u003E, в которой для запуска старых 32-битных приложений на 64-битных дистрибутивах Linux предлагалось использовать QEMU + Live CD — по моему мнению «из пушки по воробьям». Опишу своё решение на \u003Ccode\u003Echroot\u003C\u002Fcode\u003E + \u003Ccode\u003Edebootstrap\u003C\u002Fcode\u003E. \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"chroot"},{"titleHtml":"debootstrap"},{"titleHtml":"xwindow"}]},"580090":{"id":"580090","timePublished":"2021-09-26T21:19:11+00:00","isCorporative":false,"lang":"ru","titleHtml":"Сравнение подходов к реализации распределенных транзакций для микросервисов","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null},{"type":"translation","data":{"originalAuthorName":"Bilgin Ibryam","originalUrl":"https:\u002F\u002Fdevelopers.redhat.com\u002Farticles\u002F2021\u002F09\u002F21\u002Fdistributed-transaction-patterns-microservices-compared"}}],"author":{"id":"194270","alias":"sprosin","fullname":"Sergey Prosin","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd67\u002F5d8\u002F1d6\u002Fd675d81d6fe5bf69493735cef4910eb5.jpg","speciality":"Веду команды к релизам, пишу статьи, выступаю."},"statistics":{"commentsCount":3,"favoritesCount":66,"readingCount":3021,"score":13,"votesCount":13},"hubs":[{"relatedData":null,"id":"7504","alias":"refactoring","type":"collective","title":"Проектирование и рефакторинг","titleHtml":"Проектирование и рефакторинг","isProfiled":true},{"relatedData":null,"id":"21482","alias":"distributed_systems","type":"collective","title":"Распределённые системы","titleHtml":"Распределённые системы","isProfiled":true},{"relatedData":null,"id":"22115","alias":"microservices","type":"collective","title":"Микросервисы","titleHtml":"Микросервисы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКак архитектор-консультант в Red Hat, я имел возможность поработать над множеством проектов для наших клиентов. У каждого из них есть свои особенности, которые, однако, имеют некоторые общие черты. Большинство клиентов хотят знать, как скоординировать запись в несколько систем одновременно. Ответ на этот вопрос обычно включает подробное объяснение двойной записи, распределенных транзакций, современных альтернатив, а также возможных сценариев сбоев и недостатков каждого подхода. Как правило, именно в этот момент заказчик понимает, что разделение монолитного приложения на микросервисы - долгий и сложный путь, обычно требующий компромиссов.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc4\u002F35d\u002Fff3\u002Fbc435dff35d09143dacf29bbc1e470a7.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc4\u002F35d\u002Fff3\u002Fbc435dff35d09143dacf29bbc1e470a7.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"распределенные системы"},{"titleHtml":"микросервисы"},{"titleHtml":"транзакции"},{"titleHtml":"распределенные транзакции"},{"titleHtml":"оркестрация"},{"titleHtml":"оркестрация микросервисов"},{"titleHtml":"хореография"},{"titleHtml":"конвейеры"}]},"580092":{"id":"580092","timePublished":"2021-09-26T21:49:14+00:00","isCorporative":false,"lang":"ru","titleHtml":"30 сентября: Let's Encrypt и конец срока действия IdenTrust DST Root CA X3","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"805873","alias":"rantal","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":54,"favoritesCount":40,"readingCount":11062,"score":36,"votesCount":36},"hubs":[{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E30 сентября 2021 14:01:15  GMT оканчивается срок действия корневого сертификата IdenTrust DST Root CA X3.\u003C\u002Fp\u003E\u003Cp\u003EЭто событие достойно вашего внимания по той причине, что после наступления этого момента ряд устаревших систем перестанут доверять сертификатам,&nbsp;выпущенным центром сертификации Let’s Encrypt. С учётом того, что на текущий момент Let's Encrypt предоставляет бесплатные криптографические сертификаты примерно для \u003Ca href=\"https:\u002F\u002Fletsencrypt.org\u002Fstats\u002F\" rel=\"noopener noreferrer nofollow\"\u003E250 миллионов доменных имен\u003C\u002Fa\u003E, а \"устаревшие системы\" - это порой системы возрастом всего 5-6 лет, вряд ли окончание срока действия сертификата&nbsp;DST Root CA X3 пройдёт для всех гладко и незаметно. В чём причина, кого конкретно это затронет, и что можно сделать?\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"let's encrypt"},{"titleHtml":"DST Root CA X3"},{"titleHtml":"корневой сертификат"},{"titleHtml":"https"},{"titleHtml":"tls"},{"titleHtml":"openssl"}]},"580094":{"id":"580094","timePublished":"2021-09-26T22:35:26+00:00","isCorporative":false,"lang":"ru","titleHtml":"Блокчейн нас подвёл? Почему ДЭГ — это плохо и можем ли мы адекватно контролировать процесс подсчёта голосов?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"206414","alias":"PoltoS","fullname":"Сергей Полторак","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5cf\u002F03a\u002Fc7f\u002F5cf03ac7fe60ea8a6686bd4c57627ddc.png","speciality":""},"statistics":{"commentsCount":59,"favoritesCount":17,"readingCount":9443,"score":20,"votesCount":36},"hubs":[{"relatedData":null,"id":"118","alias":"crypto","type":"collective","title":"Криптография","titleHtml":"Криптография","isProfiled":true},{"relatedData":null,"id":"210","alias":"it_testing","type":"collective","title":"Тестирование IT-систем","titleHtml":"Тестирование IT-систем","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИнтересно наблюдать, как дискредитируется термин блокчейна на выборах в госдуму. Вроде голосование было на блокчейне, но его якобы подделали. Т.е. блокчейн можно подделать или ЦИК и ДИТ нам подсунули какой-то лохчейн вместо блокчейна?!? И мало кто обсуждает происходящее по существу без эмоций, связанных с результатами партий и кандидатов.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e5\u002F82b\u002F9d0\u002F6e582b9d062dd29fa41c7842a8b76495.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e5\u002F82b\u002F9d0\u002F6e582b9d062dd29fa41c7842a8b76495.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Криптография"},{"titleHtml":"блокчейн"},{"titleHtml":"открытые данные"},{"titleHtml":"электронное голосование"},{"titleHtml":"выборы"},{"titleHtml":"выборы в госдуму"},{"titleHtml":"дэг"},{"titleHtml":"дэг 2021"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["579980","580092","580086","579542","580060","580094","580018","579854","580080","578296","580090","579296","580088","580008","580038","579772","579804","580052","580048","580084"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":2},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["529742","519298","282305"],"similarListRefs":{"282305":{"id":"282305","timePublished":"2016-04-24T01:54:39+00:00","isCorporative":false,"lang":"ru","titleHtml":"Оптимизация модели Nested Set в PHPixie","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"368857","alias":"jigpuzzled","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F32f\u002F26d\u002F545\u002F32f26d5454627feb88eb78b1ce6beb66.jpg","speciality":null},"statistics":{"commentsCount":26,"favoritesCount":24,"readingCount":6690,"score":10,"votesCount":16},"hubs":[{"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F7cd\u002F47c\u002F66c\u002F7cd47c66c5df9f4b83f7886240a1cba2.png\" alt=\"image\" align=\"right\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсего 2 часа назад я дописал последний тест к новому типу связи для \u003Ca href=\"http:\u002F\u002Fphpixie.com\"\u003EPHPixie\u003C\u002Fa\u003E ORM — Nested Set. Я долго думал использовать ли этот подход или же Closure Table для хранения деревьев в SQL базах. Но в результате Closure Table проиграл ввиду квазиквадратических размеров к которым растет таблица связей (при 20 нодах в худшем случае уже можно получить 190 записей). Так что следующей задачей стала оптимизация классического Nested Set подхода, и результат мне очень даже понравился.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null},"519298":{"id":"519298","timePublished":"2020-09-15T18:59:33+00:00","isCorporative":false,"lang":"ru","titleHtml":"Nested Sets для Javascript","editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2464077","alias":"orxtime","fullname":"Armashenko Artem","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc8e\u002F792\u002Fe6d\u002Fc8e792e6db80e76a4947d0b07deac4c8.jpg","speciality":"Web-разработчик"},"statistics":{"commentsCount":17,"favoritesCount":23,"readingCount":3590,"score":4,"votesCount":16},"hubs":[{"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"id":"17110","alias":"nodejs","type":"collective","title":"Node.JS","titleHtml":"Node.JS","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"На любом современном сайте (да и на сайтах постарше) встречаются вложенные структуры, иерархия объектов, деревья. Самый распространенный пример — каталог. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСегодня множество проектов разрабатывается с использованием Javascript. Как же хранить древовидные структцры в этом случае? Об этом и хотелось бы поговорить.\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null},"529742":{"id":"529742","timePublished":"2020-11-25T09:13:56+00:00","isCorporative":true,"lang":"ru","titleHtml":"Выращивание Nested sets в условиях .Net","editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"2494389","alias":"antonkrotoff","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffa1\u002F611\u002Fade\u002Ffa1611ade2af6a4ec5645242a455f030.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":4,"favoritesCount":24,"readingCount":2373,"score":18,"votesCount":18},"hubs":[{"id":"22460","alias":"auriga","type":"corporative","title":"Блог компании Auriga","titleHtml":"Блог компании Auriga","isProfiled":false},{"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true},{"id":"17718","alias":"csharp","type":"collective","title":"C#","titleHtml":"C#","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fso\u002Fk5\u002Fyz\u002Fsok5yzyhngmoltjfktbox7vbgak.jpeg\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПривет, меня зовут Антон, и я разработчик. Сына я родил, дом \u003Cs\u003Eпостроил\u003C\u002Fs\u003E купил, осталось вырастить дерево. Так как агроном из меня не очень, пришлось дерево кодить. Наш проект состоит из нескольких микросервисов на .Net Core, в PostgreSQL базе хранятся сущности, которые образуют иерархические связи. Расскажу о том, какую структуру лучше выбрать для хранения таких данных, почему именно Nested sets, на какие грабли можно наступить, и как с этим потом жить.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"mikhus":{"scoreStats":{"score":122.7,"votesCount":144},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"46773","alias":"Mikhus","fullname":"Михаил Стадник","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F6e4\u002F8eb\u002Fcc7\u002F6e48ebcc7a0a442dd08af1ecd52e5ee6.jpg","speciality":"Software Engineer"}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
