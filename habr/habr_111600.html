<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3/3 / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/111600\/"},"headline":"Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3\/3","datePublished":"2011-01-10T23:30:57+03:00","dateModified":"2011-01-11T03:34:52+03:00","author":{"@type":"Person","name":"Андрей Кондратович"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили п...","url":"https:\/\/habr.com\/ru\/post\/111600\/#post-content-body","about":["h_erlang","f_develop"],"image":["https:\/\/habrastorage.org\/storage\/habraeffect\/99\/0a\/990adb2b0b14d2c533856b20c5076859.png","https:\/\/habrastorage.org\/storage\/habraeffect\/18\/9e\/189ee7454e725aad11900dca00e9fa9a.png","http:\/\/habrastorage.org\/storage\/habraeffect\/05\/a6\/05a6ca691576b310ff886ae946e7995b.png","http:\/\/habrastorage.org\/storage\/habraeffect\/9b\/4e\/9b4e632241b3342804a43e92156878af.png","http:\/\/habrastorage.org\/storage\/habraeffect\/e6\/68\/e668ac6be86de46482d9a6d98af80b45.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3/3" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3/3" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3/3" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/111600/031316c1b833b34d2b7880ddfe26181c/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/111600/031316c1b833b34d2b7880ddfe26181c/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/111600/031316c1b833b34d2b7880ddfe26181c/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/111600/031316c1b833b34d2b7880ddfe26181c/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/111600/031316c1b833b34d2b7880ddfe26181c/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="111600" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2011-01-10T20:30:57.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/111600/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/111600/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/111600/031316c1b833b34d2b7880ddfe26181c/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/cursed/" title="cursed" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/ee2/d9d/439/ee2d9d439b8e4ca737f1119d22a63601.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/cursed/" class="tm-user-info__username">
      cursed
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2011-01-10T20:30:57.000Z" title="2011-01-10, 23:30">10  января  2011 в 23:30</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3/3</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/erlang/" class="tm-article-snippet__hubs-item-link"><span>Erlang/OTP</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div></div> <!----> <!----></div></div> <div class="tm-page-article__origin"><a href="http://www.metabrew.com/article/a-million-user-comet-application-with-mochiweb-part-3/" target="_blank" class="tm-page-article__origin-link">
                Автор оригинала:
                <span class="tm-page-article__origin-value">
                  Richard Jones
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><a href="http://habrahabr.ru/blogs/erlang/111252/">Часть 1</a> и <a href="http://habrahabr.ru/blogs/erlang/111350/">Часть 2</a> в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого подключения. Мы повторили c10k тест. Мы сделали графики. Это была забава, но теперь пора повторить все для 1 миллиона соединений.<br/>
<br/>
Это статья покрывает следующее:<br/>
• Использование базы данных Mnesia;<br/>
• Генерация правдоподобного набора данных вида «friends» для миллиона пользователей;<br/>
• Настройка Mnesia и ввод наших данных;<br/>
• Открытие миллиона соединений с одной машины;<br/>
• Сравнительный тест с 1 миллионом пользователей;<br/>
• Libevent + Си для обработки соединений;<br/>
• Финальные выводы.<br/>
<a name="habracut"></a><br/>
Одна из частей этого теста заключается в возможности открыть 1 000 000 соединений с единственной тестовой машины. Написать сервер, который в состоянии принять 1 000 000 соединений легче, чем фактическое создавание 1 000 000 соединений. Таким образом, изрядная часть этой статьи о методах, используемых, чтобы открыть 1 000 000 соединений с единственной машины.<br/>
<br/>
<h4>Запуск нашего Pubsub.</h4><br/>
В части 2 мы использовали маршрутизатор, чтобы отправить сообщения определенным пользователям. Это прекрасно для chat/IM системы, но есть более полезные вещи, которые мы могли бы сделать вместо этого. Прежде, чем мы начнем крупномасштабный тест, давайте добавим еще один модуль – база данных подписчика. Мы создадим хранилище с данными о Ваших друзьях, таким образом, оно может предоставить Вам все события, сгенерированные людьми из Вашего списка друзей.<br/>
<br/>
Мое намерение состоит в том, чтобы использовать это для Last.fm. Таким образом, я могу получить канал в реальном времени песен, которые мои друзья в настоящий момент слушают. Это может одинаково примениться и к другим событиям, сгенерированным в социальных сетях. Фото, загруженное в Flickr, элементы новостного канала Facebook, Twitter и т.д. У FriendFeed даже есть API в реальном времени в бете, таким образом, это определенно актуально.<br/>
<br/>
<h4>Реализация менеджера подписки</h4><br/>
Мы реализуем простой менеджер по подписке, но мы будем подписывать людей на всех их друзей автоматически.<br/>
<br/>
API:<br/>
• add_subscriptions([{Subscriber, Subscribee},...])<br/>
• remove_subscriptions([{Subscriber, Subscribee},...])<br/>
• get_subscribers(User)<br/>
<br/>
<pre><code>
-module(subsmanager).
-behaviour(gen_server).
-include("/usr/local/lib/erlang/lib/stdlib-1.15.4/include/qlc.hrl").
-export([init/1, handle_call/3, handle_cast/2, handle_info/2, terminate/2, code_change/3]).
-export([add_subscriptions/1,
         remove_subscriptions/1,
         get_subscribers/1,
         first_run/0,
         stop/0,
         start_link/0]).
-record(subscription, {subscriber, subscribee}).
-record(state, {}). % state is all in mnesia
-define(SERVER, global:whereis_name(?MODULE)).
 
start_link() ->
    gen_server:start_link({global, ?MODULE}, ?MODULE, [], []).
 
stop() ->
    gen_server:call(?SERVER, {stop}).
 
add_subscriptions(SubsList) ->
    gen_server:call(?SERVER, {add_subscriptions, SubsList}, infinity).
 
remove_subscriptions(SubsList) ->
    gen_server:call(?SERVER, {remove_subscriptions, SubsList}, infinity).
 
get_subscribers(User) ->
    gen_server:call(?SERVER, {get_subscribers, User}).
 
%%
 
init([]) ->
    ok = mnesia:start(),
    io:format("Waiting on mnesia tables..\n",[]),
    mnesia:wait_for_tables([subscription], 30000),
    Info = mnesia:table_info(subscription, all),
    io:format("OK. Subscription table info: \n~w\n\n",[Info]),
    {ok, #state{}}.
 
handle_call({stop}, _From, State) ->
    {stop, stop, State};
 
handle_call({add_subscriptions, SubsList}, _From, State) ->
    % Transactionally is slower:
    % F = fun() ->
    %         [ ok = mnesia:write(S) || S &lt;- SubsList ]
    %     end,
    % mnesia:transaction(F),
    [ mnesia:dirty_write(S) || S &lt;- SubsList ],
    {reply, ok, State};
 
handle_call({remove_subscriptions, SubsList}, _From, State) ->
    F = fun() ->
        [ ok = mnesia:delete_object(S) || S &lt;- SubsList ]
    end,
    mnesia:transaction(F),
    {reply, ok, State};
 
handle_call({get_subscribers, User}, From, State) ->
    F = fun() ->
        Subs = mnesia:dirty_match_object(#subscription{subscriber=‘_’, subscribee=User}),
        Users = [Dude || #subscription{subscriber=Dude, subscribee=_} &lt;- Subs],
        gen_server:reply(From, Users)
    end,
    spawn(F),
    {noreply, State}.
 
handle_cast(_Msg, State) -> {noreply, State}.
handle_info(_Msg, State) -> {noreply, State}.
 
terminate(_Reason, _State) ->
    mnesia:stop(),
    ok.
 
code_change(_OldVersion, State, _Extra) ->
    io:format("Reloading code for ?MODULE\n",[]),
    {ok, State}.
 
%%
 
first_run() ->
    mnesia:create_schema([node()]),
    ok = mnesia:start(),
    Ret = mnesia:create_table(subscription,
    [
     {disc_copies, [node()]},
     {attributes, record_info(fields, subscription)},
     {index, [subscribee]}, %index subscribee too
     {type, bag}
    ]),
    Ret.
</code></pre><br/>
<br/>
Примечательно:<br/>
• я включал qlc.hrl, необходимый для Mnesia, используя абсолютный путь. Это не хорошо, но по-другому у меня не получилось.<br/>
• get_subscribers порождает другой процесс и делегирует создание ответа этотому же процессу, используя gen_server:reply. Это означает, что цикл gen_server не будет блокироваться на этом вызове, если мы будем часто вызывать lookup.<br/>
• rr(”subsmanager.erl”). Пример ниже позволяет Вам использовать определения записей в оболочке erl. Поместить Ваши определений в records.hrl файл и включить его в Ваших модулях является лучшим стилем. Я поступил так для краткости.<br/>
<br/>
Теперь проверим. first_run () создает схему Mnesia, поэтому важно вызвать его первым. Другой потенциальный глюк с mnesia — то, что (по умолчанию) к базе данных может получить доступ только узел, который создал ее, поэтому задайте оболочке erl имя.<br/>
<pre><code>
$ mkdir /var/mnesia
$ erl -boot start_sasl -mnesia dir '"/var/mnesia_data"' -sname subsman
(subsman@localhost)1> c(subsmanager).
{ok,subsmanager}
(subsman@localhost)2> subsmanager:first_run().
...
{atomic,ok}
(subsman@localhost)3> subsmanager:start_link().
Waiting on mnesia tables..
OK. Subscription table info:
[{access_mode,read_write},{active_replicas,[subsman@localhost]},{arity,3},{attributes,[subscriber,subscribee]},{checkpoints,[]},{commit_work,[{index,bag,[{3,{ram,57378}}]}]},{cookie,{{1224,800064,900003},subsman@localhost}},{cstruct,{cstruct,subscription,bag,[],[subsman@localhost],[],0,read_write,[3],[],false,subscription,[subscriber,subscribee],[],[],{{1224,863164,904753},subsman@localhost},{{2,0},[]}}},{disc_copies,[subsman@localhost]},{disc_only_copies,[]},{frag_properties,[]},{index,[3]},{load_by_force,false},{load_node,subsman@localhost},{load_order,0},{load_reason,{dumper,create_table}},{local_content,false},{master_nodes,[]},{memory,288},{ram_copies,[]},{record_name,subscription},{record_validation,{subscription,3,bag}},{type,bag},{size,0},{snmp,[]},{storage_type,disc_copies},{subscribers,[]},{user_properties,[]},{version,{{2,0},[]}},{where_to_commit,[{subsman@localhost,disc_copies}]},{where_to_read,subsman@localhost},{where_to_write,[subsman@localhost]},{wild_pattern,{subscription,'_','_'}},{{index,3},57378}]

{ok,&lt;0.105.0>}
(subsman@localhost)4> rr("subsmanager.erl").
[state,subscription]
(subsman@localhost)5> subsmanager:add_subscriptions([ #subscription{subscriber=alice, subscribee=rj} ]).
ok
(subsman@localhost)6> subsmanager:add_subscriptions([ #subscription{subscriber=bob, subscribee=rj} ]).
ok
(subsman@localhost)7> subsmanager:get_subscribers(rj).
[bob,alice]
(subsman@localhost)8> subsmanager:remove_subscriptions([ #subscription{subscriber=bob, subscribee=rj} ]).
ok
(subsman@localhost)8> subsmanager:get_subscribers(rj).
[alice]
(subsman@localhost)10> subsmanager:get_subscribers(charlie).
[]
</code></pre><br/>
Мы будем использовать целочисленные Id, чтобы различать пользователей – но для этого теста я использовал атомы (rj, alice, bob) и предполагал, что alice и bob являются друзьями rj. Замечательно, что mnesia (и ets/dets) не заботится, какие типы Вы использовали – любой терм Erlang допустим. Это означает, что обновление для поддержки различных типов не вызовет труда. <br/>
<br/>
<h4>Изменение маршрутизатора</h4><br/>
Вместо того, чтобы адресовать сообщения определенным пользователям, то есть router:send(123, «Hello user 123»), мы «пометим» сообщения – человек, который сгенерировал сообщение – и есть маршрутизатор, который передает сообщение каждому подписанному пользователю. Другими словами API будет работать так: router:send(123, «Hello everyone subscribed to user 123»).<br/>
<pre><code>
-module(router).
-behaviour(gen_server).
 
-export([start_link/0]).
-export([init/1, handle_call/3, handle_cast/2, handle_info/2,
     terminate/2, code_change/3]).
 
-export([send/2, login/2, logout/1]).
 
-define(SERVER, global:whereis_name(?MODULE)).
 
% will hold bidirectional mapping between id &lt;–> pid
-record(state, {pid2id, id2pid}).
 
start_link() ->
    gen_server:start_link({global, ?MODULE}, ?MODULE, [], []).
 
% sends Msg to anyone subscribed to Id
send(Id, Msg) ->
    gen_server:call(?SERVER, {send, Id, Msg}).
 
login(Id, Pid) when is_pid(Pid) ->
    gen_server:call(?SERVER, {login, Id, Pid}).
 
logout(Pid) when is_pid(Pid) ->
    gen_server:call(?SERVER, {logout, Pid}).
 
%%
 
init([]) ->
    % set this so we can catch death of logged in pids:
    process_flag(trap_exit, true),
    % use ets for routing tables
    {ok, #state{
                pid2id = ets:new(?MODULE, [bag]),
                id2pid = ets:new(?MODULE, [bag])
               }
    }.
 
handle_call({login, Id, Pid}, _From, State) when is_pid(Pid) ->
    ets:insert(State#state.pid2id, {Pid, Id}),
    ets:insert(State#state.id2pid, {Id, Pid}),
    link(Pid), % tell us if they exit, so we can log them out
    %io:format("~w logged in as ~w\n",[Pid, Id]),
    {reply, ok, State};
 
handle_call({logout, Pid}, _From, State) when is_pid(Pid) ->
    unlink(Pid),
    PidRows = ets:lookup(State#state.pid2id, Pid),
    case PidRows of
        [] ->
            ok;
        _ ->
            IdRows = [ {I,P} || {P,I} &lt;- PidRows ], % invert tuples
            ets:delete(State#state.pid2id, Pid),   % delete all pid->id entries
            [ ets:delete_object(State#state.id2pid, Obj) || Obj &lt;- IdRows ] % and all id->pid
    end,
    %io:format("pid ~w logged out\n",[Pid]),
    {reply, ok, State};
 
handle_call({send, Id, Msg}, From, State) ->
    F = fun() ->
        % get users who are subscribed to Id:
        Users = subsmanager:get_subscribers(Id),
        io:format("Subscribers of ~w = ~w\n",[Id, Users]),
        % get pids of anyone logged in from Users list:
        Pids0 = lists:map(
            fun(U)->
                [ P || { _I, P } &lt;- ets:lookup(State#state.id2pid, U) ]
            end,
            [ Id | Users ] % we are always subscribed to ourselves
        ),
        Pids = lists:flatten(Pids0),
        io:format("Pids: ~w\n", [Pids]),
        % send Msg to them all
        M = {router_msg, Msg},
        [ Pid ! M || Pid &lt;- Pids ],
        % respond with how many users saw the message
        gen_server:reply(From, {ok, length(Pids)})
    end,
    spawn(F),
    {noreply, State}.
 
% handle death and cleanup of logged in processes
handle_info(Info, State) ->
    case Info of
        {‘EXIT’, Pid, _Why} ->
            handle_call({logout, Pid}, blah, State);
        Wtf ->
            io:format("Caught unhandled message: ~w\n", [Wtf])
    end,
    {noreply, State}.
 
handle_cast(_Msg, State) ->
    {noreply, State}.
terminate(_Reason, _State) ->
    ok.
code_change(_OldVsn, State, _Extra) ->
    {ok, State}.
</code></pre><br/>
<br/>
Небольшой тест – я использовал атомы вместо id.<br/>
<pre><code>
(subsman@localhost)1> c(subsmanager), c(router), rr("subsmanager.erl").
(subsman@localhost)2> subsmanager:start_link().
(subsman@localhost)3> router:start_link().
(subsman@localhost)4> Subs = [#subscription{subscriber=alice, subscribee=rj}, #subscription{subscriber=bob, subscribee=rj}].
[#subscription{subscriber = alice,subscribee = rj},
#subscription{subscriber = bob,subscribee = rj}]
(subsman@localhost)5> subsmanager:add_subscriptions(Subs).
ok
(subsman@localhost)6> router:send(rj, "RJ did something").
Subscribers of rj = [bob,alice]
Pids: []
{ok,0}
(subsman@localhost)7> router:login(alice, self()).
ok
(subsman@localhost)8> router:send(rj, "RJ did something").
Subscribers of rj = [bob,alice]
Pids: [&lt;0.46.0>]
{ok,1}
(subsman@localhost)9> receive {router_msg, M} -> io:format("~s\n",[M]) end.
RJ did something
ok
</code></pre><br/>
Видно, что alice может получать сообщения, когда кто-либо, на кого она подписана посылает сообщение, даже при том, что сообщение не было отправлено непосредственно alice. Вывод показывает, что маршрутизатор идентифицировал возможные цели как [alice, bob], но передал сообщение одному человеку, alice, потому что bob не был авторизован.<br/>
<br/>
<h4>Генерирование простого набор данных</h4><br/>
Мы можем сгенерировать много отношения наугад, но это не особенно реалистично. У социальных сетей обычно есть несколько суперпопулярных пользователей (у некоторых пользователей Twitter есть более чем 100 000 последователей), и много людей только с горсткой друзей.<br/>
Чтобы cгенерировать набор данных, я использовал модуль Python от превосходной библиотеки igraph:<br/>
<pre><code class="python">
import igraph
g = igraph.Graph.Barabasi(1000000, 15, directed=False)
print "Edges: " + str(g.ecount()) + " Verticies: " + str(g.vcount())
g.write_edgelist("fakefriends.txt")
</code></pre><br/>
<br/>
<h4>Загрузка данных в Mnesia</h4><br/>
Этот маленький модуль читает fakefriends.txt файл и создает список подписок.<br/>
<pre><code>
-module(readfriends).
-export([load/1]).
-record(subscription, {subscriber, subscribee}).
 
load(Filename) ->
    for_each_line_in_file(Filename,
        fun(Line, Acc) ->
            [As, Bs] = string:tokens(string:strip(Line, right, $\n), " "),
            {A, _} = string:to_integer(As),
            {B, _} = string:to_integer(Bs),
            [ #subscription{subscriber=A, subscribee=B} | Acc ]
        end, [read], []).
 
% via: http://www.trapexit.org/Reading_Lines_from_a_File
for_each_line_in_file(Name, Proc, Mode, Accum0) ->
    {ok, Device} = file:open(Name, Mode),
    for_each_line(Device, Proc, Accum0).
 
for_each_line(Device, Proc, Accum) ->
    case io:get_line(Device, "") of
        eof  -> file:close(Device), Accum;
        Line -> NewAccum = Proc(Line, Accum),
                    for_each_line(Device, Proc, NewAccum)
    end.
</code></pre><br/>
Теперь в оболочке subsmanager Вы можете читать из текстового файла и добавлять подписки:<br/>
<pre><code>
$ erl -name router@minifeeds4.gs2 +K true +A 128 -setcookie secretcookie -mnesia dump_log_write_threshold 50000 -mnesia dc_dump_limit 40
erl> c(readfriends), c(subsmanager).
erl> subsmanager:first_run().
erl> subsmanager:start_link().
erl> subsmanager:add_subscriptions( readfriends:load("fakefriends.txt") ).
</code></pre><br/>
Отметьте дополнительные параметры – они помогут избежать сообщений «** WARNING ** Mnesia is overloaded». Документация Mnesia содержит много других настроек, достойных внимания.<br/>
<br/>
<h4>1 000 000</h4><br/>
Создание миллиона tcp соединений от одного узла нетривиально. У меня есть чувство, что люди, которые делают это регулярно, на выделенных маленьких кластерах для моделирования большого количества соединений, вероятно используют реальный инструмент вроде Tsung. Даже с настройкой из Части 1, мы все еще упираемся в жесткий предел портов. При создании tcp соединения, клиентский порт выделяется из диапазона в /proc/sys/net/ipv4/ip_local_port_range. Не имеет значения, если Вы задаете его вручную, или используете автоматический порт. В части 1 мы устанавливаем диапазон в «1024 65535», т.е. у нас 65535-1024 = 64511 непривилегированных доступных порта. Некоторые из них будут использоваться другими процессами, но мы никогда не перевалим за 64511 клиента, потому что мы исчерпаем порты.<br/>
Локальный диапазон портов связан с IP, так, если мы будем делать исходящие соединения из различных локальных IP-адресов, то мы будем в состоянии открыть больше 64511 исходящих соединений.<br/>
<br/>
Так что давайте создадим 17 новых IP-адресов, чтобы сделать 62 000 соединений от каждого – это предоставит нам в общей сложности 1 054 000 соединений:<br/>
<pre><code>
$ for i in `seq 1 17`; do echo sudo ifconfig eth0:$i 10.0.0.$i up ; done
</code></pre><br/>
Если Вы проверите ifconfig теперь, Вы должны видеть свои виртуальные интерфейсы: eth0:1, eth0:2 … eth0:17, каждый с различным IP-адресом.<br/>
<br/>
Все, что остается теперь, это изменить floodtest из Части 1, чтобы выбрать локальный IP. К сожалению, erlang http клиент не позволяет Вам определять исходный IP.<br/>
<br/>
<i>В этой точке я рассматривал другую возможность: использовать 17 пар IP – один на сервере и один на клиенте – каждая пара в их собственной изолированной /30 подсети. Я думаю, что, если бы я тогда заставил клиент соединиться с каким-либо IP сервера, он вынудил бы локальный адрес быть вторым из пары, потому что только один из локальных IP фактически будет в состоянии достигнуть IP сервера по данной подсети. В теории это означало бы объявлять, что локальный исходный IP на клиентской машине не будет необходим (хотя диапазон IP адресов сервера должен был бы быть определен). Я не знаю, сработало ли бы это или нет – это звучало вероятным в то время. В конце, я решил, что это было бы слишком извращенным.</i><br/>
<br/>
gen_tcp позволяет Вам определять исходный адрес, таким образом, я закончил тем, что использовал сырой клиент:<br/>
<pre><code>
-module(floodtest2).
-compile(export_all).
-define(SERVERADDR, "10.1.2.3"). % where mochiweb is running
-define(SERVERPORT, 8000).
 
% Generate the config in bash like so (chose some available address space):
% EACH=62000; for i in `seq 1 17`; do echo "{{10,0,0,$i}, $((($i-1)*$EACH+1)), $(($i*$EACH))}, "; done
 
run(Interval) ->
        Config = [
{{10,0,0,1}, 1, 62000},
{{10,0,0,2}, 62001, 124000},
{{10,0,0,3}, 124001, 186000},
{{10,0,0,4}, 186001, 248000},
{{10,0,0,5}, 248001, 310000},
{{10,0,0,6}, 310001, 372000},
{{10,0,0,7}, 372001, 434000},
{{10,0,0,8}, 434001, 496000},
{{10,0,0,9}, 496001, 558000},
{{10,0,0,10}, 558001, 620000},
{{10,0,0,11}, 620001, 682000},
{{10,0,0,12}, 682001, 744000},
{{10,0,0,13}, 744001, 806000},
{{10,0,0,14}, 806001, 868000},
{{10,0,0,15}, 868001, 930000},
{{10,0,0,16}, 930001, 992000},
{{10,0,0,17}, 992001, 1054000}],
        start(Config, Interval).
 
start(Config, Interval) ->
        Monitor = monitor(),
        AdjustedInterval = Interval / length(Config),
        [ spawn(fun start/5, [Lower, Upper, Ip, AdjustedInterval, Monitor])
          || {Ip, Lower, Upper}  &lt;- Config ],
        ok.
 
start(LowerID, UpperID, _, _, _) when LowerID == UpperID -> done;
start(LowerID, UpperID, LocalIP, Interval, Monitor) ->
        spawn(fun connect/5, [?SERVERADDR, ?SERVERPORT, LocalIP, "/test/"++LowerID, Monitor]),
        receive after Interval -> start(LowerID + 1, UpperID, LocalIP, Interval, Monitor) end.
 
connect(ServerAddr, ServerPort, ClientIP, Path, Monitor) ->
        Opts = [binary, {packet, 0}, {ip, ClientIP}, {reuseaddr, true}, {active, false}],
        {ok, Sock} = gen_tcp:connect(ServerAddr, ServerPort, Opts),
        Monitor ! open,
        ReqL = io_lib:format("GET ~s\r\nHost: ~s\r\n\r\n", [Path, ServerAddr]),
        Req = list_to_binary(ReqL),
        ok = gen_tcp:send(Sock, [Req]),
        do_recv(Sock, Monitor),
        (catch gen_tcp:close(Sock)),
        ok.
 
do_recv(Sock, Monitor)->
        case gen_tcp:recv(Sock, 0) of
                {ok, B} ->
                        Monitor ! {bytes, size(B)},
                        io:format("Recvd ~s\n", [ binary_to_list(B)]),
                        io:format("Recvd ~w bytes\n", [size(B)]),
                        do_recv(Sock, Monitor);
                {error, closed} ->
                        Monitor ! closed,
                        closed;
                Other ->
                        Monitor ! closed,
                        io:format("Other:~w\n",[Other])
        end.
 
% Monitor process receives stats and reports how much data we received etc:
monitor() ->
        Pid = spawn(?MODULE, monitor0, [{0,0,0,0}]),
        timer:send_interval(10000, Pid, report),
        Pid.
 
monitor0({Open, Closed, Chunks, Bytes}=S) ->
        receive
                report  -> io:format("{Open, Closed, Chunks, Bytes} = ~w\n",[S]);
                open    -> monitor0({Open + 1, Closed, Chunks, Bytes});
                closed  -> monitor0({Open, Closed + 1, Chunks, Bytes});
                chunk   -> monitor0({Open, Closed, Chunks + 1, Bytes});
                {bytes, B} -> monitor0({Open, Closed, Chunks, Bytes + B})
        end.
</code></pre><br/>
Сперва я соединился с mochiweb приложением из Части 1 – оно просто отправляет одно сообщение каждому клиенту каждые 10 секунд.<br/>
<pre><code>
erl> c(floodtest2), floodtest2:run(20).
</code></pre><br/>
<br/>
<h4>Оно быстро съело всю мою память</h4><br/>
Оказывается, открытие большого количества соединений с помощью gen_tcp убивает много памяти. Я предполагаю, что потребовалось бы ~36GB, чтобы заставить это работать. Я не интересовался попыткой оптимизировать мой erlang http клиент, и единственной машиной с более 32Гб памяти, которую я мог достать, была одна из наших баз данных, и я не смог найти хорошее оправдание, чтобы выключить Last.fm, пока я балуюсь :)<br/>
<br/>
В этот момент я решил вспомнить испытанный libevent, который, имеет HTTP API. У более новых версий также есть функция evhttp_connection_set_local_address в http API.<br/>
<br/>
Вот http клиент на C, использующий libevent:<br/>
<pre><code>
#include &lt;sys/types.h>
#include &lt;sys/time.h>
#include &lt;sys/queue.h>
#include &lt;stdlib.h>
#include &lt;err.h>
#include &lt;event.h>
#include &lt;evhttp.h>
#include &lt;unistd.h>
#include &lt;stdio.h>
#include &lt;sys/socket.h>
#include &lt;netinet/in.h>
#include &lt;time.h>
#include &lt;pthread.h>
 
#define BUFSIZE 4096
#define NUMCONNS 62000
#define SERVERADDR "10.103.1.43"
#define SERVERPORT 8000
#define SLEEP_MS 10
 
char buf[BUFSIZE];
 
int bytes_recvd = 0;
int chunks_recvd = 0;
int closed = 0;
int connected = 0;
 
// called per chunk received
void chunkcb(struct evhttp_request * req, void * arg)
{
    int s = evbuffer_remove( req->input_buffer, &amp;buf, BUFSIZE );
    //printf("Read %d bytes: %s\n", s, &amp;buf);
    bytes_recvd += s;
    chunks_recvd++;
    if(connected >= NUMCONNS &amp;&amp; chunks_recvd%10000==0)
        printf(">Chunks: %d\tBytes: %d\tClosed: %d\n", chunks_recvd, bytes_recvd, closed);
}
 
// gets called when request completes
void reqcb(struct evhttp_request * req, void * arg)
{
    closed++;
}
 
int main(int argc, char **argv)
{
    event_init();
    struct evhttp *evhttp_connection;
    struct evhttp_request *evhttp_request;
    char addr[16];
    char path[32]; // eg: "/test/123"
    int i,octet;
    for(octet=1; octet&lt;=17; octet++){
        sprintf(&amp;addr, "10.224.0.%d", octet);
        for(i=1;i&lt;=NUMCONNS;i++) {
            evhttp_connection = evhttp_connection_new(SERVERADDR, SERVERPORT);
            evhttp_connection_set_local_address(evhttp_connection, &amp;addr);
            evhttp_set_timeout(evhttp_connection, 864000); // 10 day timeout
            evhttp_request = evhttp_request_new(reqcb, NULL);
            evhttp_request->chunk_cb = chunkcb;
            sprintf(&amp;path, "/test/%d", ++connected);
            if(i%100==0)  printf("Req: %s\t->\t%s\n", addr, &amp;path);
            evhttp_make_request( evhttp_connection, evhttp_request, EVHTTP_REQ_GET, path );
            evhttp_connection_set_timeout(evhttp_request->evcon, 864000);
            event_loop( EVLOOP_NONBLOCK );
            if( connected % 200 == 0 )
                printf("\nChunks: %d\tBytes: %d\tClosed: %d\n", chunks_recvd, bytes_recvd, closed);
            usleep(SLEEP_MS*1000);
        }
    }
    event_dispatch();
    return 0;
}
</code></pre><br/>
Большинство параметров заданы жестко как #define, таким образом, Вы можете отредактировать его и перекомпилировать:<br/>
<pre><code>
$ gcc -o httpclient httpclient.c -levent
$ ./httpclient
</code></pre><br/>
<br/>
<h4>Он все еще не в состоянии открыть больше 64 500 портов</h4><br/>
Чтобы открыть больше 64 500 соединений, Вы должны определить локальный адрес и локальный порт самостоятельно, и управлять ими соответственно.<br/>
<br/>
К сожалению, у libevent HTTP API нет опции, чтобы определить локальный порт. Я исправил libevent, чтобы добавить такую функцию:<br/>
<pre><code>
void evhttp_connection_set_local_port(struct evhttp_connection *evcon, u_short port);.
</code></pre><br/>
Это было удивительно приятным опытом: libevent кажется правильно написанным, и документация довольно приличная.<br/>
<br/>
С этим измененным libevent я смог добавить следующее в вышеупомянутом коде:<br/>
<pre><code>
evhttp_connection_set_local_port(evhttp_connection, 1024+i);
</code></pre><br/>
Теперь многократные соединения от различных адресов смогли использовать тот же самый локальный номер порта, определенный для локального адреса. Я перекомпилировал клиент, и позволил ему работать некоторое время, чтобы удостовериться, что он пройдет барьер.<br/>
<br/>
Netstat подтверждает это:<br/>
<pre><code>
# netstat -n | awk '/^tcp/ {t[$NF]++}END{for(state in t){print state, t[state]}}'
TIME_WAIT 8
ESTABLISHED 118222
</code></pre><br/>
Это показывает, сколько портов открыто в различных состояниях. Нам наконец удалось открыть больше 2^16 соединения.<br/>
<br/>
Теперь у нас есть инструмент, способный к открытию миллиона http соединений от единственного компьютера. Похоже, это использует приблизительно 2 Кб для каждого подключения, плюс то, что занимает ядро. Пора провести тест нашего mochiweb сервера.<br/>
<br/>
<h4>C1024K</h4><br/>
Для этого теста я использовал 4 различных сервера. Главное различие между данным тестом и предыдущими – это модифицированный клиент, написанный на Си.<br/>
Server 1 – Quad-core 2GHz CPU, 16GB of RAM<br/>
• Запуск subsmanager<br/>
• Загрузка данных<br/>
• Запуск маршрутизатора<br/>
Server 2 – Dual Quad-core 2.8GHz CPU, 32GB of RAM<br/>
• Запуск Mochiweb приложения<br/>
Server 3 – Quad-core 2GHz CPU, 16GB of RAM<br/>
• Создание 17 выртиуальных IP адресов<br/>
• Установка libevent<br/>
• Запуск клиента: ./httpclient (100 подключений в секунду)<br/>
Server 4 – Dual-core 2GHz, 2GB RAM<br/>
• Запуск msggen для отправки кучи сообщений<br/>
<br/>
Использование памяти во время открытия соединений и в течении некоторого времени:<br/>
<img src="/img/image-loader.svg" data-src="https://habrastorage.org/storage/habraeffect/99/0a/990adb2b0b14d2c533856b20c5076859.png"/><br/>
HttpClient имеет встроенную задержку 10мс между соединениями, поэтому потребовалось почти 3 часа, чтобы открыть миллион соединений. Потребовалосб окло 25Гб памяти. Вот как выглядит мой сервер глазами Ganglia:<br/>
<img src="/img/image-loader.svg" data-src="https://habrastorage.org/storage/habraeffect/18/9e/189ee7454e725aad11900dca00e9fa9a.png"/><br/>
Вы можете видеть, что требуется около 38GB, и дальше начинается подкачка. Я подозреваю, что разница в основном в потреблении ядра.<br/>
<br/>
Сообщения были сгенерированы, используя 1000 процессов, при среднем времени между сообщениями около 60мс на процесс, давая около 16666 сообщений в секунду:<br/>
<pre><code>
erl> [ spawn( fun()->msggen:start(1000000, 10+random:uniform(100), 1000000) end) || I &lt;- lists:seq(1,1000) ].
</code></pre><br/>
Server 4 в Ganglia:<br/>
<img src="/img/image-loader.svg" data-src="http://habrastorage.org/storage/habraeffect/05/a6/05a6ca691576b310ff886ae946e7995b.png"/><br/>
Около 10 MB в секунду – 16,666 сообщений.<br/>
<br/>
Когда я начал посылать сообщения, загрузка на первом сервере осталась низкой. Потребление CPU на втором сервере возрастало:<br/>
<img src="/img/image-loader.svg" data-src="http://habrastorage.org/storage/habraeffect/9b/4e/9b4e632241b3342804a43e92156878af.png"/><br/>
Естественно, что т.к. процессы выходят из hibernate() для обработки сообщений, использование памяти увеличивается незначительно. Наличие всех открытых подключений без каких-либо сообщений являестя оптимальным в использования памяти. Неудивительно, что какие-либо действия требуют больше памяти.<br/>
<br/>
Так где же течет память? Mochiweb требует 40 Гб оперативной памяти, чтобы держать открытыми 1 000 000 активных соединений. Под нагрузкой, до 30GB из памяти будет использоваться mochiweb, а остальные 10 Гб ядром. Другими словами, необходимо около 40Кб на соединение.<br/>
<br/>
В ходе различных испытаний с большим количеством соединений, я закончил тем, что сделал некоторые дополнительные изменения в sysctl.conf. Я пришел к этому с помощью проб и ошибок, и я не знаю, какие значения менять. Моя политика была в ожидании ошибки, чтобы проверить /var/log/kern.log и посмотреть, что мне скажет таинственная ошибка. Вот настройки:<br/>
<pre><code>
net.core.rmem_max = 33554432
net.core.wmem_max = 33554432
net.ipv4.tcp_rmem = 4096 16384 33554432
net.ipv4.tcp_wmem = 4096 16384 33554432
net.ipv4.tcp_mem = 786432 1048576 26777216
net.ipv4.tcp_max_tw_buckets = 360000
net.core.netdev_max_backlog = 2500
vm.min_free_kbytes = 65536
vm.swappiness = 0
net.ipv4.ip_local_port_range = 1024 65535
</code></pre><br/>
Я хотел бы узнать больше о настройках TCP Linux, чтобы сделать более обоснованные объяснения. Почти наверняка, эти настройки не является оптимальными, но по крайней мере, этого было достаточно, чтобы достичь 1 000 000 соединений.<br/>
<br/>
<h4>Узел Erlang на Libevent</h4><br/>
После вмешательства в HTTP API для libevent, казалось совершенно разумным провести сранение вышеописанного теста с libevent HTTPd, написанным на Cи.<br/>
<br/>
Я бы хотел как можно больше кода оставить на erlang, так что давайте делать минимум на Cи — только обработку HTTP соединений. <br/>
<br/>
Libevent имеет асинхронный HTTP API, что делает реализацию HTTP сервера тривиальной. Я также искал повод, чтобы попробовать интерфейс Си для Erlang. Это сервер HTTP с использованием libevent, который идентифицирует пользователей с помощью целого Id (как наше mochiweb приложение), а также действует как Erlang Си-узел.<br/>
<br/>
Он подключается к назначенному Erlang узлу, прослушивает сообщения типа {123, &lt;&lt;«Hello user 123»>>}, отправляет “Hello user 123″ для пользователя 123, если он подключен. Сообщения для пользователей, которые не связаны отбрасываются, как и раньше.<br/>
<pre><code>
#include &lt;sys/types.h>
#include &lt;sys/time.h>
#include &lt;sys/queue.h>
#include &lt;stdlib.h>
#include &lt;err.h>
#include &lt;event.h>
#include &lt;evhttp.h>
#include &lt;stdio.h>
#include &lt;sys/socket.h>
#include &lt;netinet/in.h>
 
#include "erl_interface.h"
#include "ei.h"
 
#include &lt;pthread.h>
 
#define BUFSIZE 1024
#define MAXUSERS (17*65536) // C1024K
 
// List of current http requests by uid:
struct evhttp_request * clients[MAXUSERS+1];
// Memory to store uids passed to the cleanup callback:
int slots[MAXUSERS+1];
 
// called when user disconnects
void cleanup(struct evhttp_connection *evcon, void *arg)
{
    int *uidp = (int *) arg;
    fprintf(stderr, "disconnected uid %d\n", *uidp);
    clients[*uidp] = NULL;
}
 
// handles http connections, sets them up for chunked transfer,
// extracts the user id and registers in the global connection table,
// also sends a welcome chunk.
void request_handler(struct evhttp_request *req, void *arg)
{
        struct evbuffer *buf;
        buf = evbuffer_new();
        if (buf == NULL){
            err(1, "failed to create response buffer");
        }
 
        evhttp_add_header(req->output_headers, "Content-Type", "text/html; charset=utf-8");
 
        int uid = -1;
        if(strncmp(evhttp_request_uri(req), "/test/", 6) == 0){
            uid = atoi( 6+evhttp_request_uri(req) );
        }
 
        if(uid &lt;= 0){
            evbuffer_add_printf(buf, "User id not found, try /test/123 instead");
            evhttp_send_reply(req, HTTP_NOTFOUND, "Not Found", buf);
            evbuffer_free(buf);
            return;
        }
 
        if(uid > MAXUSERS){
            evbuffer_add_printf(buf, "Max uid allowed is %d", MAXUSERS);
            evhttp_send_reply(req, HTTP_SERVUNAVAIL, "We ran out of numbers", buf);
            evbuffer_free(buf);
            return;
        }
 
        evhttp_send_reply_start(req, HTTP_OK, "OK");
        // Send welcome chunk:
        evbuffer_add_printf(buf, "Welcome, Url: ‘%s’ Id: %d\n", evhttp_request_uri(req), uid);
        evhttp_send_reply_chunk(req, buf);
        evbuffer_free(buf);
 
        // put reference into global uid->connection table:
        clients[uid] = req;
        // set close callback
        evhttp_connection_set_closecb( req->evcon, cleanup, &amp;slots[uid] );
}
 
 
// runs in a thread – the erlang c-node stuff
// expects msgs like {uid, msg} and sends a a ‘msg’ chunk to uid if connected
void cnode_run()
{
    int fd;                                  /* fd to Erlang node */
    int got;                                 /* Result of receive */
    unsigned char buf[BUFSIZE];              /* Buffer for incoming message */
    ErlMessage emsg;                         /* Incoming message */
 
    ETERM *uid, *msg;
 
    erl_init(NULL, 0);
 
    if (erl_connect_init(1, "secretcookie", 0) == -1)
        erl_err_quit("erl_connect_init");
 
    if ((fd = erl_connect("httpdmaster@localhost")) &lt; 0)
        erl_err_quit("erl_connect");
 
    fprintf(stderr, "Connected to httpdmaster@localhost\n\r");
 
    struct evbuffer *evbuf;
 
    while (1) {
        got = erl_receive_msg(fd, buf, BUFSIZE, &amp;emsg);
        if (got == ERL_TICK) {
            continue;
        } else if (got == ERL_ERROR) {
            fprintf(stderr, "ERL_ERROR from erl_receive_msg.\n");
            break;
        } else {
            if (emsg.type == ERL_REG_SEND) {
                // get uid and body data from eg: {123, &lt;&lt;"Hello">>}
                uid = erl_element(1, emsg.msg);
                msg = erl_element(2, emsg.msg);
                int userid = ERL_INT_VALUE(uid);
                char *body = (char *) ERL_BIN_PTR(msg);
                int body_len = ERL_BIN_SIZE(msg);
                // Is this userid connected?
                if(clients[userid]){
                    fprintf(stderr, "Sending %d bytes to uid %d\n", body_len, userid);                
                    evbuf = evbuffer_new();
                    evbuffer_add(evbuf, (const void*)body, (size_t) body_len);
                    evhttp_send_reply_chunk(clients[userid], evbuf);
                    evbuffer_free(evbuf);
                }else{
                    fprintf(stderr, "Discarding %d bytes to uid %d – user not connected\n", 
                            body_len, userid);                
                    // noop
                }
                erl_free_term(emsg.msg);
                erl_free_term(uid); 
                erl_free_term(msg);
            }
        }
    }
    // if we got here, erlang connection died.
    // this thread is supposed to run forever
    // TODO – gracefully handle failure / reconnect / etc
    pthread_exit(0);
}
 
int main(int argc, char **argv)
{
    // Launch the thread that runs the cnode:
    pthread_attr_t tattr;
    pthread_t helper;
    int status;
    pthread_create(&amp;helper, NULL, cnode_run, NULL);
 
    int i;
    for(i=0;i&lt;=MAXUSERS;i++) slots[i]=i;
    // Launch libevent httpd:
    struct evhttp *httpd;
    event_init();
    httpd = evhttp_start("0.0.0.0", 8000);
    evhttp_set_gencb(httpd, request_handler, NULL);
    event_dispatch();
    // Not reached, event_dispatch() shouldn’t return
    evhttp_free(httpd);
    return 0;
}
</code></pre><br/>
Максимальное количество пользователей задано с помощью #define, прослушивается порт 8000 и ожидаются пользователи. Также жестко задано имя Erlang узела cookie.<br/>
<br/>
Запустите узел, к которому будет подключатсясервер:<br/>
<pre><code>
$ erl -setcookie secretcookie -sname httpdmaster@localhost
</code></pre><br/>
<br/>
Запустим Си-узел:<br/>
<pre><code>
$ gcc -o httpdcnode httpdcnode.c -lerl_interface -lei -levent
$ ./httpdcnode
</code></pre><br/>
Проверьте, что виден узел:<br/>
<pre><code>
erl> nodes(hidden).
[c1@localhost]
</code></pre><br/>
Откройте в своем браузере <a href="http://localhost">localhost</a>:8000/test/123. Вы должны увидеть приветственное сообщение.<br/>
Далее отправьте сообщение Си-узлу:<br/>
<pre><code>
erl> {any, c1@localhost} ! {123, &lt;&lt;"Hello Libevent World">>}.
</code></pre><br/>
Обратите внимание, что мы не используем Pid — мы используем {procname, node}. Мы используем «any», как название процесса, который игнорируется Cи-узлом. <br/>
<br/>
Теперь вы в состоянии доставить сообщения через Erlang, но все соединения управляются libevent программой на Си, которая действует как узел Erlang.<br/>
<br/>
После удаления отладочного вывода, я подключил 1 000 000 клиентов к httpdcnode серверу, используя тот же самый клиент, как и выше. Машина показала, в общей сложности чуть менее 10 Гб используемой памяти. <br/>
<br/>
Память сервера была стабильно около 2GB:<br/>
<img src="/img/image-loader.svg" data-src="http://habrastorage.org/storage/habraeffect/e6/68/e668ac6be86de46482d9a6d98af80b45.png"/><br/>
<br/>
<b>Порядка 2Кб на каждое подключение.</b><br/>
<br/>
Состояние памяти:<br/>
<pre><code>
Mem: 32968672k total, 9636488k used, 23332184k free, 180k buffers 
</code></pre><br/>
Так kernel/ TCP стек берет дополнительные 8Кб за соединение, которые кажутся высокими, но у меня нет ничего для для сравнения. <br/>
<br/>
Этот libevent-cnode сервер требует определенной дополнительной работы над собой. Не разумно обрабатывать несколько соединений от одного пользователя, и все еще присутствуют “race conditions”, если вы отключитесь тогда, когда сообщение было только отправлено.<br/>
<br/>
Несмотря на это, мы использовали Erlang для всех интересных вещей, и Cи + libevent использовались для низкоуровневых операций. Программа на Cи может быть запущен в качестве драйвера или C-узла, а интерфейсы Erlang могут дать вам достойный API. У меня все еще осталось желание поэкспериментировать с этим.<br/>
<br/>
<h4>Финальные выводы</h4><br/>
<br/>
У меня есть достаточно данных сейчас судить, какое оборудование будет необходимо, если мы развернем большую систему масштаба Last.fm. Даже в худшем случае 40Кб за соединение является хорошим результатом — память довольно дешевая на данный момент, и 40GB для поддержки миллионов пользователей не является проблемой. 10GB еще лучше.</div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmochiweb%5D" class="tm-article-body__tags-item-link">mochiweb</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Berlang%5D" class="tm-article-body__tags-item-link">erlang</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Blibevent%5D" class="tm-article-body__tags-item-link">libevent</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/erlang/" class="tm-article-body__tags-item-link">
                  Erlang/OTP
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 57: ↑53 и ↓4</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 57: ↑53 и ↓4" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+49</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    90
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/111600/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      12
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/cursed/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/ee2/d9d/439/ee2d9d439b8e4ca737f1119d22a63601.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 152 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    102.7
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><span class="tm-user-card__name">Андрей Кондратович</span> <a href="/ru/users/cursed/" class="tm-user-card__nickname">
          @cursed
        </a> <!----></div> <p class="tm-user-card__short-info">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/111600/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 12 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2020-12-30T07:00:05.000Z" title="2020-12-30, 10:00">30  декабря  2020 в 10:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/535594/" class="tm-article-title__link"><span>Отправляем SMS из Erlang/Elixir. Короткая инструкция</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 11: ↑11 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 11: ↑11 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+11</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.3K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    19
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/535594/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      3
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2019-12-29T14:22:23.000Z" title="2019-12-29, 17:22">29  декабря  2019 в 17:22</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/482398/" class="tm-article-title__link"><span>Логическая репликация из PostgreSQL в Erlang</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 22: ↑21 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 22: ↑21 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+20</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.4K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    26
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/482398/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      4
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2019-09-09T16:01:01.000Z" title="2019-09-09, 19:01">9  сентября  2019 в 19:01</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/466697/" class="tm-article-title__link"><span>Монады в Erlang</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 19: ↑19 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 19: ↑19 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+19</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.4K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    27
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/466697/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      5
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-29T06:19:53.000Z" title="2021-09-29, 09:19">сегодня в 09:19</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580582/" class="tm-article-title__link"><span>Конфиденциальность пользователей Telegram снова нарушена. Представители мессенджера требуют не раскрывать подробностей</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 191: ↑186 и ↓5</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 191: ↑186 и ↓5" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+181</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">29K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    28
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580582/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      71
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T14:25:12.000Z" title="2021-09-28, 17:25">вчера в 17:25</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580516/" class="tm-article-title__link"><span>Лучший язык программирования</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 168: ↑161 и ↓7</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 168: ↑161 и ↓7" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+154</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">40K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    182
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580516/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      87
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T17:18:57.000Z" title="2021-09-28, 20:18">вчера в 20:18</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580034/" class="tm-article-title__link"><span>Пыль, пылевые клещи и их аллергены. Профилактика и защита</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 62: ↑58 и ↓4</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 62: ↑58 и ↓4" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+54</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">11K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    62
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580034/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      53
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-29T13:00:01.000Z" title="2021-09-29, 16:00">сегодня в 16:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/579972/" class="tm-article-title__link"><span>Апскейл, который смог</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 44: ↑44 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 44: ↑44 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+44</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.4K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    38
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/579972/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      12
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-29T00:18:17.000Z" title="2021-09-29, 03:18">сегодня в 03:18</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/selectel/blog/579530/" class="tm-article-title__link"><span>Лучше поздно, чем никогда: Microsoft решила продолжить историю Skype</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 41: ↑39 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 41: ↑39 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+37</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">17K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    8
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/selectel/blog/579530/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      58
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="111600" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/111600/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/111600/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"111600":{"id":"111600","timePublished":"2011-01-10T20:30:57+00:00","isCorporative":false,"lang":"ru","titleHtml":"Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3\u002F3","leadData":{"textHtml":"\u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Ferlang\u002F111252\u002F\"\u003EЧасть 1\u003C\u002Fa\u003E и \u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Ferlang\u002F111350\u002F\"\u003EЧасть 2\u003C\u002Fa\u003E в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого подключения. Мы повторили c10k тест. Мы сделали графики. Это была забава, но теперь пора повторить все для 1 миллиона соединений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто статья покрывает следующее:\u003Cbr\u002F\u003E\r\n• Использование базы данных Mnesia;\u003Cbr\u002F\u003E\r\n• Генерация правдоподобного набора данных вида «friends» для миллиона пользователей;\u003Cbr\u002F\u003E\r\n• Настройка Mnesia и ввод наших данных;\u003Cbr\u002F\u003E\r\n• Открытие миллиона соединений с одной машины;\u003Cbr\u002F\u003E\r\n• Сравнительный тест с 1 миллионом пользователей;\u003Cbr\u002F\u003E\r\n• Libevent + Си для обработки соединений;\u003Cbr\u002F\u003E\r\n• Финальные выводы.\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Richard Jones","originalUrl":"http:\u002F\u002Fwww.metabrew.com\u002Farticle\u002Fa-million-user-comet-application-with-mochiweb-part-3\u002F"}}],"author":{"scoreStats":{"score":102.7,"votesCount":152},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"60428","alias":"cursed","fullname":"Андрей Кондратович","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fee2\u002Fd9d\u002F439\u002Fee2d9d439b8e4ca737f1119d22a63601.png","speciality":null},"statistics":{"commentsCount":12,"favoritesCount":90,"readingCount":4477,"score":49,"votesCount":57},"hubs":[{"relatedData":null,"id":"8238","alias":"erlang","type":"collective","title":"Erlang\u002FOTP","titleHtml":"Erlang\u002FOTP","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Ferlang\u002F111252\u002F\"\u003EЧасть 1\u003C\u002Fa\u003E и \u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Ferlang\u002F111350\u002F\"\u003EЧасть 2\u003C\u002Fa\u003E в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого подключения. Мы повторили c10k тест. Мы сделали графики. Это была забава, но теперь пора повторить все для 1 миллиона соединений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто статья покрывает следующее:\u003Cbr\u002F\u003E\r\n• Использование базы данных Mnesia;\u003Cbr\u002F\u003E\r\n• Генерация правдоподобного набора данных вида «friends» для миллиона пользователей;\u003Cbr\u002F\u003E\r\n• Настройка Mnesia и ввод наших данных;\u003Cbr\u002F\u003E\r\n• Открытие миллиона соединений с одной машины;\u003Cbr\u002F\u003E\r\n• Сравнительный тест с 1 миллионом пользователей;\u003Cbr\u002F\u003E\r\n• Libevent + Си для обработки соединений;\u003Cbr\u002F\u003E\r\n• Финальные выводы.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nОдна из частей этого теста заключается в возможности открыть 1 000 000 соединений с единственной тестовой машины. Написать сервер, который в состоянии принять 1 000 000 соединений легче, чем фактическое создавание 1 000 000 соединений. Таким образом, изрядная часть этой статьи о методах, используемых, чтобы открыть 1 000 000 соединений с единственной машины.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EЗапуск нашего Pubsub.\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nВ части 2 мы использовали маршрутизатор, чтобы отправить сообщения определенным пользователям. Это прекрасно для chat\u002FIM системы, но есть более полезные вещи, которые мы могли бы сделать вместо этого. Прежде, чем мы начнем крупномасштабный тест, давайте добавим еще один модуль – база данных подписчика. Мы создадим хранилище с данными о Ваших друзьях, таким образом, оно может предоставить Вам все события, сгенерированные людьми из Вашего списка друзей.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМое намерение состоит в том, чтобы использовать это для Last.fm. Таким образом, я могу получить канал в реальном времени песен, которые мои друзья в настоящий момент слушают. Это может одинаково примениться и к другим событиям, сгенерированным в социальных сетях. Фото, загруженное в Flickr, элементы новостного канала Facebook, Twitter и т.д. У FriendFeed даже есть API в реальном времени в бете, таким образом, это определенно актуально.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EРеализация менеджера подписки\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nМы реализуем простой менеджер по подписке, но мы будем подписывать людей на всех их друзей автоматически.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nAPI:\u003Cbr\u002F\u003E\r\n• add_subscriptions([{Subscriber, Subscribee},...])\u003Cbr\u002F\u003E\r\n• remove_subscriptions([{Subscriber, Subscribee},...])\u003Cbr\u002F\u003E\r\n• get_subscribers(User)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n-module(subsmanager).\r\n-behaviour(gen_server).\r\n-include(\"\u002Fusr\u002Flocal\u002Flib\u002Ferlang\u002Flib\u002Fstdlib-1.15.4\u002Finclude\u002Fqlc.hrl\").\r\n-export([init\u002F1, handle_call\u002F3, handle_cast\u002F2, handle_info\u002F2, terminate\u002F2, code_change\u002F3]).\r\n-export([add_subscriptions\u002F1,\r\n         remove_subscriptions\u002F1,\r\n         get_subscribers\u002F1,\r\n         first_run\u002F0,\r\n         stop\u002F0,\r\n         start_link\u002F0]).\r\n-record(subscription, {subscriber, subscribee}).\r\n-record(state, {}). % state is all in mnesia\r\n-define(SERVER, global:whereis_name(?MODULE)).\r\n \r\nstart_link() -\u003E\r\n    gen_server:start_link({global, ?MODULE}, ?MODULE, [], []).\r\n \r\nstop() -\u003E\r\n    gen_server:call(?SERVER, {stop}).\r\n \r\nadd_subscriptions(SubsList) -\u003E\r\n    gen_server:call(?SERVER, {add_subscriptions, SubsList}, infinity).\r\n \r\nremove_subscriptions(SubsList) -\u003E\r\n    gen_server:call(?SERVER, {remove_subscriptions, SubsList}, infinity).\r\n \r\nget_subscribers(User) -\u003E\r\n    gen_server:call(?SERVER, {get_subscribers, User}).\r\n \r\n%%\r\n \r\ninit([]) -\u003E\r\n    ok = mnesia:start(),\r\n    io:format(\"Waiting on mnesia tables..\\n\",[]),\r\n    mnesia:wait_for_tables([subscription], 30000),\r\n    Info = mnesia:table_info(subscription, all),\r\n    io:format(\"OK. Subscription table info: \\n~w\\n\\n\",[Info]),\r\n    {ok, #state{}}.\r\n \r\nhandle_call({stop}, _From, State) -\u003E\r\n    {stop, stop, State};\r\n \r\nhandle_call({add_subscriptions, SubsList}, _From, State) -\u003E\r\n    % Transactionally is slower:\r\n    % F = fun() -\u003E\r\n    %         [ ok = mnesia:write(S) || S &lt;- SubsList ]\r\n    %     end,\r\n    % mnesia:transaction(F),\r\n    [ mnesia:dirty_write(S) || S &lt;- SubsList ],\r\n    {reply, ok, State};\r\n \r\nhandle_call({remove_subscriptions, SubsList}, _From, State) -\u003E\r\n    F = fun() -\u003E\r\n        [ ok = mnesia:delete_object(S) || S &lt;- SubsList ]\r\n    end,\r\n    mnesia:transaction(F),\r\n    {reply, ok, State};\r\n \r\nhandle_call({get_subscribers, User}, From, State) -\u003E\r\n    F = fun() -\u003E\r\n        Subs = mnesia:dirty_match_object(#subscription{subscriber=‘_’, subscribee=User}),\r\n        Users = [Dude || #subscription{subscriber=Dude, subscribee=_} &lt;- Subs],\r\n        gen_server:reply(From, Users)\r\n    end,\r\n    spawn(F),\r\n    {noreply, State}.\r\n \r\nhandle_cast(_Msg, State) -\u003E {noreply, State}.\r\nhandle_info(_Msg, State) -\u003E {noreply, State}.\r\n \r\nterminate(_Reason, _State) -\u003E\r\n    mnesia:stop(),\r\n    ok.\r\n \r\ncode_change(_OldVersion, State, _Extra) -\u003E\r\n    io:format(\"Reloading code for ?MODULE\\n\",[]),\r\n    {ok, State}.\r\n \r\n%%\r\n \r\nfirst_run() -\u003E\r\n    mnesia:create_schema([node()]),\r\n    ok = mnesia:start(),\r\n    Ret = mnesia:create_table(subscription,\r\n    [\r\n     {disc_copies, [node()]},\r\n     {attributes, record_info(fields, subscription)},\r\n     {index, [subscribee]}, %index subscribee too\r\n     {type, bag}\r\n    ]),\r\n    Ret.\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПримечательно:\u003Cbr\u002F\u003E\r\n• я включал qlc.hrl, необходимый для Mnesia, используя абсолютный путь. Это не хорошо, но по-другому у меня не получилось.\u003Cbr\u002F\u003E\r\n• get_subscribers порождает другой процесс и делегирует создание ответа этотому же процессу, используя gen_server:reply. Это означает, что цикл gen_server не будет блокироваться на этом вызове, если мы будем часто вызывать lookup.\u003Cbr\u002F\u003E\r\n• rr(”subsmanager.erl”). Пример ниже позволяет Вам использовать определения записей в оболочке erl. Поместить Ваши определений в records.hrl файл и включить его в Ваших модулях является лучшим стилем. Я поступил так для краткости.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь проверим. first_run () создает схему Mnesia, поэтому важно вызвать его первым. Другой потенциальный глюк с mnesia — то, что (по умолчанию) к базе данных может получить доступ только узел, который создал ее, поэтому задайте оболочке erl имя.\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n$ mkdir \u002Fvar\u002Fmnesia\r\n$ erl -boot start_sasl -mnesia dir '\"\u002Fvar\u002Fmnesia_data\"' -sname subsman\r\n(subsman@localhost)1\u003E c(subsmanager).\r\n{ok,subsmanager}\r\n(subsman@localhost)2\u003E subsmanager:first_run().\r\n...\r\n{atomic,ok}\r\n(subsman@localhost)3\u003E subsmanager:start_link().\r\nWaiting on mnesia tables..\r\nOK. Subscription table info:\r\n[{access_mode,read_write},{active_replicas,[subsman@localhost]},{arity,3},{attributes,[subscriber,subscribee]},{checkpoints,[]},{commit_work,[{index,bag,[{3,{ram,57378}}]}]},{cookie,{{1224,800064,900003},subsman@localhost}},{cstruct,{cstruct,subscription,bag,[],[subsman@localhost],[],0,read_write,[3],[],false,subscription,[subscriber,subscribee],[],[],{{1224,863164,904753},subsman@localhost},{{2,0},[]}}},{disc_copies,[subsman@localhost]},{disc_only_copies,[]},{frag_properties,[]},{index,[3]},{load_by_force,false},{load_node,subsman@localhost},{load_order,0},{load_reason,{dumper,create_table}},{local_content,false},{master_nodes,[]},{memory,288},{ram_copies,[]},{record_name,subscription},{record_validation,{subscription,3,bag}},{type,bag},{size,0},{snmp,[]},{storage_type,disc_copies},{subscribers,[]},{user_properties,[]},{version,{{2,0},[]}},{where_to_commit,[{subsman@localhost,disc_copies}]},{where_to_read,subsman@localhost},{where_to_write,[subsman@localhost]},{wild_pattern,{subscription,'_','_'}},{{index,3},57378}]\r\n\r\n{ok,&lt;0.105.0\u003E}\r\n(subsman@localhost)4\u003E rr(\"subsmanager.erl\").\r\n[state,subscription]\r\n(subsman@localhost)5\u003E subsmanager:add_subscriptions([ #subscription{subscriber=alice, subscribee=rj} ]).\r\nok\r\n(subsman@localhost)6\u003E subsmanager:add_subscriptions([ #subscription{subscriber=bob, subscribee=rj} ]).\r\nok\r\n(subsman@localhost)7\u003E subsmanager:get_subscribers(rj).\r\n[bob,alice]\r\n(subsman@localhost)8\u003E subsmanager:remove_subscriptions([ #subscription{subscriber=bob, subscribee=rj} ]).\r\nok\r\n(subsman@localhost)8\u003E subsmanager:get_subscribers(rj).\r\n[alice]\r\n(subsman@localhost)10\u003E subsmanager:get_subscribers(charlie).\r\n[]\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nМы будем использовать целочисленные Id, чтобы различать пользователей – но для этого теста я использовал атомы (rj, alice, bob) и предполагал, что alice и bob являются друзьями rj. Замечательно, что mnesia (и ets\u002Fdets) не заботится, какие типы Вы использовали – любой терм Erlang допустим. Это означает, что обновление для поддержки различных типов не вызовет труда. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EИзменение маршрутизатора\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nВместо того, чтобы адресовать сообщения определенным пользователям, то есть router:send(123, «Hello user 123»), мы «пометим» сообщения – человек, который сгенерировал сообщение – и есть маршрутизатор, который передает сообщение каждому подписанному пользователю. Другими словами API будет работать так: router:send(123, «Hello everyone subscribed to user 123»).\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n-module(router).\r\n-behaviour(gen_server).\r\n \r\n-export([start_link\u002F0]).\r\n-export([init\u002F1, handle_call\u002F3, handle_cast\u002F2, handle_info\u002F2,\r\n     terminate\u002F2, code_change\u002F3]).\r\n \r\n-export([send\u002F2, login\u002F2, logout\u002F1]).\r\n \r\n-define(SERVER, global:whereis_name(?MODULE)).\r\n \r\n% will hold bidirectional mapping between id &lt;–\u003E pid\r\n-record(state, {pid2id, id2pid}).\r\n \r\nstart_link() -\u003E\r\n    gen_server:start_link({global, ?MODULE}, ?MODULE, [], []).\r\n \r\n% sends Msg to anyone subscribed to Id\r\nsend(Id, Msg) -\u003E\r\n    gen_server:call(?SERVER, {send, Id, Msg}).\r\n \r\nlogin(Id, Pid) when is_pid(Pid) -\u003E\r\n    gen_server:call(?SERVER, {login, Id, Pid}).\r\n \r\nlogout(Pid) when is_pid(Pid) -\u003E\r\n    gen_server:call(?SERVER, {logout, Pid}).\r\n \r\n%%\r\n \r\ninit([]) -\u003E\r\n    % set this so we can catch death of logged in pids:\r\n    process_flag(trap_exit, true),\r\n    % use ets for routing tables\r\n    {ok, #state{\r\n                pid2id = ets:new(?MODULE, [bag]),\r\n                id2pid = ets:new(?MODULE, [bag])\r\n               }\r\n    }.\r\n \r\nhandle_call({login, Id, Pid}, _From, State) when is_pid(Pid) -\u003E\r\n    ets:insert(State#state.pid2id, {Pid, Id}),\r\n    ets:insert(State#state.id2pid, {Id, Pid}),\r\n    link(Pid), % tell us if they exit, so we can log them out\r\n    %io:format(\"~w logged in as ~w\\n\",[Pid, Id]),\r\n    {reply, ok, State};\r\n \r\nhandle_call({logout, Pid}, _From, State) when is_pid(Pid) -\u003E\r\n    unlink(Pid),\r\n    PidRows = ets:lookup(State#state.pid2id, Pid),\r\n    case PidRows of\r\n        [] -\u003E\r\n            ok;\r\n        _ -\u003E\r\n            IdRows = [ {I,P} || {P,I} &lt;- PidRows ], % invert tuples\r\n            ets:delete(State#state.pid2id, Pid),   % delete all pid-\u003Eid entries\r\n            [ ets:delete_object(State#state.id2pid, Obj) || Obj &lt;- IdRows ] % and all id-\u003Epid\r\n    end,\r\n    %io:format(\"pid ~w logged out\\n\",[Pid]),\r\n    {reply, ok, State};\r\n \r\nhandle_call({send, Id, Msg}, From, State) -\u003E\r\n    F = fun() -\u003E\r\n        % get users who are subscribed to Id:\r\n        Users = subsmanager:get_subscribers(Id),\r\n        io:format(\"Subscribers of ~w = ~w\\n\",[Id, Users]),\r\n        % get pids of anyone logged in from Users list:\r\n        Pids0 = lists:map(\r\n            fun(U)-\u003E\r\n                [ P || { _I, P } &lt;- ets:lookup(State#state.id2pid, U) ]\r\n            end,\r\n            [ Id | Users ] % we are always subscribed to ourselves\r\n        ),\r\n        Pids = lists:flatten(Pids0),\r\n        io:format(\"Pids: ~w\\n\", [Pids]),\r\n        % send Msg to them all\r\n        M = {router_msg, Msg},\r\n        [ Pid ! M || Pid &lt;- Pids ],\r\n        % respond with how many users saw the message\r\n        gen_server:reply(From, {ok, length(Pids)})\r\n    end,\r\n    spawn(F),\r\n    {noreply, State}.\r\n \r\n% handle death and cleanup of logged in processes\r\nhandle_info(Info, State) -\u003E\r\n    case Info of\r\n        {‘EXIT’, Pid, _Why} -\u003E\r\n            handle_call({logout, Pid}, blah, State);\r\n        Wtf -\u003E\r\n            io:format(\"Caught unhandled message: ~w\\n\", [Wtf])\r\n    end,\r\n    {noreply, State}.\r\n \r\nhandle_cast(_Msg, State) -\u003E\r\n    {noreply, State}.\r\nterminate(_Reason, _State) -\u003E\r\n    ok.\r\ncode_change(_OldVsn, State, _Extra) -\u003E\r\n    {ok, State}.\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНебольшой тест – я использовал атомы вместо id.\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n(subsman@localhost)1\u003E c(subsmanager), c(router), rr(\"subsmanager.erl\").\r\n(subsman@localhost)2\u003E subsmanager:start_link().\r\n(subsman@localhost)3\u003E router:start_link().\r\n(subsman@localhost)4\u003E Subs = [#subscription{subscriber=alice, subscribee=rj}, #subscription{subscriber=bob, subscribee=rj}].\r\n[#subscription{subscriber = alice,subscribee = rj},\r\n#subscription{subscriber = bob,subscribee = rj}]\r\n(subsman@localhost)5\u003E subsmanager:add_subscriptions(Subs).\r\nok\r\n(subsman@localhost)6\u003E router:send(rj, \"RJ did something\").\r\nSubscribers of rj = [bob,alice]\r\nPids: []\r\n{ok,0}\r\n(subsman@localhost)7\u003E router:login(alice, self()).\r\nok\r\n(subsman@localhost)8\u003E router:send(rj, \"RJ did something\").\r\nSubscribers of rj = [bob,alice]\r\nPids: [&lt;0.46.0\u003E]\r\n{ok,1}\r\n(subsman@localhost)9\u003E receive {router_msg, M} -\u003E io:format(\"~s\\n\",[M]) end.\r\nRJ did something\r\nok\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВидно, что alice может получать сообщения, когда кто-либо, на кого она подписана посылает сообщение, даже при том, что сообщение не было отправлено непосредственно alice. Вывод показывает, что маршрутизатор идентифицировал возможные цели как [alice, bob], но передал сообщение одному человеку, alice, потому что bob не был авторизован.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EГенерирование простого набор данных\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nМы можем сгенерировать много отношения наугад, но это не особенно реалистично. У социальных сетей обычно есть несколько суперпопулярных пользователей (у некоторых пользователей Twitter есть более чем 100 000 последователей), и много людей только с горсткой друзей.\u003Cbr\u002F\u003E\r\nЧтобы cгенерировать набор данных, я использовал модуль Python от превосходной библиотеки igraph:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\r\nimport igraph\r\ng = igraph.Graph.Barabasi(1000000, 15, directed=False)\r\nprint \"Edges: \" + str(g.ecount()) + \" Verticies: \" + str(g.vcount())\r\ng.write_edgelist(\"fakefriends.txt\")\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EЗагрузка данных в Mnesia\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nЭтот маленький модуль читает fakefriends.txt файл и создает список подписок.\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n-module(readfriends).\r\n-export([load\u002F1]).\r\n-record(subscription, {subscriber, subscribee}).\r\n \r\nload(Filename) -\u003E\r\n    for_each_line_in_file(Filename,\r\n        fun(Line, Acc) -\u003E\r\n            [As, Bs] = string:tokens(string:strip(Line, right, $\\n), \" \"),\r\n            {A, _} = string:to_integer(As),\r\n            {B, _} = string:to_integer(Bs),\r\n            [ #subscription{subscriber=A, subscribee=B} | Acc ]\r\n        end, [read], []).\r\n \r\n% via: http:\u002F\u002Fwww.trapexit.org\u002FReading_Lines_from_a_File\r\nfor_each_line_in_file(Name, Proc, Mode, Accum0) -\u003E\r\n    {ok, Device} = file:open(Name, Mode),\r\n    for_each_line(Device, Proc, Accum0).\r\n \r\nfor_each_line(Device, Proc, Accum) -\u003E\r\n    case io:get_line(Device, \"\") of\r\n        eof  -\u003E file:close(Device), Accum;\r\n        Line -\u003E NewAccum = Proc(Line, Accum),\r\n                    for_each_line(Device, Proc, NewAccum)\r\n    end.\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТеперь в оболочке subsmanager Вы можете читать из текстового файла и добавлять подписки:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n$ erl -name router@minifeeds4.gs2 +K true +A 128 -setcookie secretcookie -mnesia dump_log_write_threshold 50000 -mnesia dc_dump_limit 40\r\nerl\u003E c(readfriends), c(subsmanager).\r\nerl\u003E subsmanager:first_run().\r\nerl\u003E subsmanager:start_link().\r\nerl\u003E subsmanager:add_subscriptions( readfriends:load(\"fakefriends.txt\") ).\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nОтметьте дополнительные параметры – они помогут избежать сообщений «** WARNING ** Mnesia is overloaded». Документация Mnesia содержит много других настроек, достойных внимания.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003E1 000 000\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nСоздание миллиона tcp соединений от одного узла нетривиально. У меня есть чувство, что люди, которые делают это регулярно, на выделенных маленьких кластерах для моделирования большого количества соединений, вероятно используют реальный инструмент вроде Tsung. Даже с настройкой из Части 1, мы все еще упираемся в жесткий предел портов. При создании tcp соединения, клиентский порт выделяется из диапазона в \u002Fproc\u002Fsys\u002Fnet\u002Fipv4\u002Fip_local_port_range. Не имеет значения, если Вы задаете его вручную, или используете автоматический порт. В части 1 мы устанавливаем диапазон в «1024 65535», т.е. у нас 65535-1024 = 64511 непривилегированных доступных порта. Некоторые из них будут использоваться другими процессами, но мы никогда не перевалим за 64511 клиента, потому что мы исчерпаем порты.\u003Cbr\u002F\u003E\r\nЛокальный диапазон портов связан с IP, так, если мы будем делать исходящие соединения из различных локальных IP-адресов, то мы будем в состоянии открыть больше 64511 исходящих соединений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТак что давайте создадим 17 новых IP-адресов, чтобы сделать 62 000 соединений от каждого – это предоставит нам в общей сложности 1 054 000 соединений:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n$ for i in `seq 1 17`; do echo sudo ifconfig eth0:$i 10.0.0.$i up ; done\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЕсли Вы проверите ifconfig теперь, Вы должны видеть свои виртуальные интерфейсы: eth0:1, eth0:2 … eth0:17, каждый с различным IP-адресом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсе, что остается теперь, это изменить floodtest из Части 1, чтобы выбрать локальный IP. К сожалению, erlang http клиент не позволяет Вам определять исходный IP.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ci\u003EВ этой точке я рассматривал другую возможность: использовать 17 пар IP – один на сервере и один на клиенте – каждая пара в их собственной изолированной \u002F30 подсети. Я думаю, что, если бы я тогда заставил клиент соединиться с каким-либо IP сервера, он вынудил бы локальный адрес быть вторым из пары, потому что только один из локальных IP фактически будет в состоянии достигнуть IP сервера по данной подсети. В теории это означало бы объявлять, что локальный исходный IP на клиентской машине не будет необходим (хотя диапазон IP адресов сервера должен был бы быть определен). Я не знаю, сработало ли бы это или нет – это звучало вероятным в то время. В конце, я решил, что это было бы слишком извращенным.\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\ngen_tcp позволяет Вам определять исходный адрес, таким образом, я закончил тем, что использовал сырой клиент:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n-module(floodtest2).\r\n-compile(export_all).\r\n-define(SERVERADDR, \"10.1.2.3\"). % where mochiweb is running\r\n-define(SERVERPORT, 8000).\r\n \r\n% Generate the config in bash like so (chose some available address space):\r\n% EACH=62000; for i in `seq 1 17`; do echo \"{{10,0,0,$i}, $((($i-1)*$EACH+1)), $(($i*$EACH))}, \"; done\r\n \r\nrun(Interval) -\u003E\r\n        Config = [\r\n{{10,0,0,1}, 1, 62000},\r\n{{10,0,0,2}, 62001, 124000},\r\n{{10,0,0,3}, 124001, 186000},\r\n{{10,0,0,4}, 186001, 248000},\r\n{{10,0,0,5}, 248001, 310000},\r\n{{10,0,0,6}, 310001, 372000},\r\n{{10,0,0,7}, 372001, 434000},\r\n{{10,0,0,8}, 434001, 496000},\r\n{{10,0,0,9}, 496001, 558000},\r\n{{10,0,0,10}, 558001, 620000},\r\n{{10,0,0,11}, 620001, 682000},\r\n{{10,0,0,12}, 682001, 744000},\r\n{{10,0,0,13}, 744001, 806000},\r\n{{10,0,0,14}, 806001, 868000},\r\n{{10,0,0,15}, 868001, 930000},\r\n{{10,0,0,16}, 930001, 992000},\r\n{{10,0,0,17}, 992001, 1054000}],\r\n        start(Config, Interval).\r\n \r\nstart(Config, Interval) -\u003E\r\n        Monitor = monitor(),\r\n        AdjustedInterval = Interval \u002F length(Config),\r\n        [ spawn(fun start\u002F5, [Lower, Upper, Ip, AdjustedInterval, Monitor])\r\n          || {Ip, Lower, Upper}  &lt;- Config ],\r\n        ok.\r\n \r\nstart(LowerID, UpperID, _, _, _) when LowerID == UpperID -\u003E done;\r\nstart(LowerID, UpperID, LocalIP, Interval, Monitor) -\u003E\r\n        spawn(fun connect\u002F5, [?SERVERADDR, ?SERVERPORT, LocalIP, \"\u002Ftest\u002F\"++LowerID, Monitor]),\r\n        receive after Interval -\u003E start(LowerID + 1, UpperID, LocalIP, Interval, Monitor) end.\r\n \r\nconnect(ServerAddr, ServerPort, ClientIP, Path, Monitor) -\u003E\r\n        Opts = [binary, {packet, 0}, {ip, ClientIP}, {reuseaddr, true}, {active, false}],\r\n        {ok, Sock} = gen_tcp:connect(ServerAddr, ServerPort, Opts),\r\n        Monitor ! open,\r\n        ReqL = io_lib:format(\"GET ~s\\r\\nHost: ~s\\r\\n\\r\\n\", [Path, ServerAddr]),\r\n        Req = list_to_binary(ReqL),\r\n        ok = gen_tcp:send(Sock, [Req]),\r\n        do_recv(Sock, Monitor),\r\n        (catch gen_tcp:close(Sock)),\r\n        ok.\r\n \r\ndo_recv(Sock, Monitor)-\u003E\r\n        case gen_tcp:recv(Sock, 0) of\r\n                {ok, B} -\u003E\r\n                        Monitor ! {bytes, size(B)},\r\n                        io:format(\"Recvd ~s\\n\", [ binary_to_list(B)]),\r\n                        io:format(\"Recvd ~w bytes\\n\", [size(B)]),\r\n                        do_recv(Sock, Monitor);\r\n                {error, closed} -\u003E\r\n                        Monitor ! closed,\r\n                        closed;\r\n                Other -\u003E\r\n                        Monitor ! closed,\r\n                        io:format(\"Other:~w\\n\",[Other])\r\n        end.\r\n \r\n% Monitor process receives stats and reports how much data we received etc:\r\nmonitor() -\u003E\r\n        Pid = spawn(?MODULE, monitor0, [{0,0,0,0}]),\r\n        timer:send_interval(10000, Pid, report),\r\n        Pid.\r\n \r\nmonitor0({Open, Closed, Chunks, Bytes}=S) -\u003E\r\n        receive\r\n                report  -\u003E io:format(\"{Open, Closed, Chunks, Bytes} = ~w\\n\",[S]);\r\n                open    -\u003E monitor0({Open + 1, Closed, Chunks, Bytes});\r\n                closed  -\u003E monitor0({Open, Closed + 1, Chunks, Bytes});\r\n                chunk   -\u003E monitor0({Open, Closed, Chunks + 1, Bytes});\r\n                {bytes, B} -\u003E monitor0({Open, Closed, Chunks, Bytes + B})\r\n        end.\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nСперва я соединился с mochiweb приложением из Части 1 – оно просто отправляет одно сообщение каждому клиенту каждые 10 секунд.\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nerl\u003E c(floodtest2), floodtest2:run(20).\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EОно быстро съело всю мою память\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nОказывается, открытие большого количества соединений с помощью gen_tcp убивает много памяти. Я предполагаю, что потребовалось бы ~36GB, чтобы заставить это работать. Я не интересовался попыткой оптимизировать мой erlang http клиент, и единственной машиной с более 32Гб памяти, которую я мог достать, была одна из наших баз данных, и я не смог найти хорошее оправдание, чтобы выключить Last.fm, пока я балуюсь :)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ этот момент я решил вспомнить испытанный libevent, который, имеет HTTP API. У более новых версий также есть функция evhttp_connection_set_local_address в http API.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот http клиент на C, использующий libevent:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n#include &lt;sys\u002Ftypes.h\u003E\r\n#include &lt;sys\u002Ftime.h\u003E\r\n#include &lt;sys\u002Fqueue.h\u003E\r\n#include &lt;stdlib.h\u003E\r\n#include &lt;err.h\u003E\r\n#include &lt;event.h\u003E\r\n#include &lt;evhttp.h\u003E\r\n#include &lt;unistd.h\u003E\r\n#include &lt;stdio.h\u003E\r\n#include &lt;sys\u002Fsocket.h\u003E\r\n#include &lt;netinet\u002Fin.h\u003E\r\n#include &lt;time.h\u003E\r\n#include &lt;pthread.h\u003E\r\n \r\n#define BUFSIZE 4096\r\n#define NUMCONNS 62000\r\n#define SERVERADDR \"10.103.1.43\"\r\n#define SERVERPORT 8000\r\n#define SLEEP_MS 10\r\n \r\nchar buf[BUFSIZE];\r\n \r\nint bytes_recvd = 0;\r\nint chunks_recvd = 0;\r\nint closed = 0;\r\nint connected = 0;\r\n \r\n\u002F\u002F called per chunk received\r\nvoid chunkcb(struct evhttp_request * req, void * arg)\r\n{\r\n    int s = evbuffer_remove( req-\u003Einput_buffer, &amp;buf, BUFSIZE );\r\n    \u002F\u002Fprintf(\"Read %d bytes: %s\\n\", s, &amp;buf);\r\n    bytes_recvd += s;\r\n    chunks_recvd++;\r\n    if(connected \u003E= NUMCONNS &amp;&amp; chunks_recvd%10000==0)\r\n        printf(\"\u003EChunks: %d\\tBytes: %d\\tClosed: %d\\n\", chunks_recvd, bytes_recvd, closed);\r\n}\r\n \r\n\u002F\u002F gets called when request completes\r\nvoid reqcb(struct evhttp_request * req, void * arg)\r\n{\r\n    closed++;\r\n}\r\n \r\nint main(int argc, char **argv)\r\n{\r\n    event_init();\r\n    struct evhttp *evhttp_connection;\r\n    struct evhttp_request *evhttp_request;\r\n    char addr[16];\r\n    char path[32]; \u002F\u002F eg: \"\u002Ftest\u002F123\"\r\n    int i,octet;\r\n    for(octet=1; octet&lt;=17; octet++){\r\n        sprintf(&amp;addr, \"10.224.0.%d\", octet);\r\n        for(i=1;i&lt;=NUMCONNS;i++) {\r\n            evhttp_connection = evhttp_connection_new(SERVERADDR, SERVERPORT);\r\n            evhttp_connection_set_local_address(evhttp_connection, &amp;addr);\r\n            evhttp_set_timeout(evhttp_connection, 864000); \u002F\u002F 10 day timeout\r\n            evhttp_request = evhttp_request_new(reqcb, NULL);\r\n            evhttp_request-\u003Echunk_cb = chunkcb;\r\n            sprintf(&amp;path, \"\u002Ftest\u002F%d\", ++connected);\r\n            if(i%100==0)  printf(\"Req: %s\\t-\u003E\\t%s\\n\", addr, &amp;path);\r\n            evhttp_make_request( evhttp_connection, evhttp_request, EVHTTP_REQ_GET, path );\r\n            evhttp_connection_set_timeout(evhttp_request-\u003Eevcon, 864000);\r\n            event_loop( EVLOOP_NONBLOCK );\r\n            if( connected % 200 == 0 )\r\n                printf(\"\\nChunks: %d\\tBytes: %d\\tClosed: %d\\n\", chunks_recvd, bytes_recvd, closed);\r\n            usleep(SLEEP_MS*1000);\r\n        }\r\n    }\r\n    event_dispatch();\r\n    return 0;\r\n}\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nБольшинство параметров заданы жестко как #define, таким образом, Вы можете отредактировать его и перекомпилировать:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n$ gcc -o httpclient httpclient.c -levent\r\n$ .\u002Fhttpclient\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EОн все еще не в состоянии открыть больше 64 500 портов\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nЧтобы открыть больше 64 500 соединений, Вы должны определить локальный адрес и локальный порт самостоятельно, и управлять ими соответственно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nК сожалению, у libevent HTTP API нет опции, чтобы определить локальный порт. Я исправил libevent, чтобы добавить такую функцию:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nvoid evhttp_connection_set_local_port(struct evhttp_connection *evcon, u_short port);.\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЭто было удивительно приятным опытом: libevent кажется правильно написанным, и документация довольно приличная.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nС этим измененным libevent я смог добавить следующее в вышеупомянутом коде:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nevhttp_connection_set_local_port(evhttp_connection, 1024+i);\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТеперь многократные соединения от различных адресов смогли использовать тот же самый локальный номер порта, определенный для локального адреса. Я перекомпилировал клиент, и позволил ему работать некоторое время, чтобы удостовериться, что он пройдет барьер.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nNetstat подтверждает это:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n# netstat -n | awk '\u002F^tcp\u002F {t[$NF]++}END{for(state in t){print state, t[state]}}'\r\nTIME_WAIT 8\r\nESTABLISHED 118222\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЭто показывает, сколько портов открыто в различных состояниях. Нам наконец удалось открыть больше 2^16 соединения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь у нас есть инструмент, способный к открытию миллиона http соединений от единственного компьютера. Похоже, это использует приблизительно 2 Кб для каждого подключения, плюс то, что занимает ядро. Пора провести тест нашего mochiweb сервера.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EC1024K\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nДля этого теста я использовал 4 различных сервера. Главное различие между данным тестом и предыдущими – это модифицированный клиент, написанный на Си.\u003Cbr\u002F\u003E\r\nServer 1 – Quad-core 2GHz CPU, 16GB of RAM\u003Cbr\u002F\u003E\r\n• Запуск subsmanager\u003Cbr\u002F\u003E\r\n• Загрузка данных\u003Cbr\u002F\u003E\r\n• Запуск маршрутизатора\u003Cbr\u002F\u003E\r\nServer 2 – Dual Quad-core 2.8GHz CPU, 32GB of RAM\u003Cbr\u002F\u003E\r\n• Запуск Mochiweb приложения\u003Cbr\u002F\u003E\r\nServer 3 – Quad-core 2GHz CPU, 16GB of RAM\u003Cbr\u002F\u003E\r\n• Создание 17 выртиуальных IP адресов\u003Cbr\u002F\u003E\r\n• Установка libevent\u003Cbr\u002F\u003E\r\n• Запуск клиента: .\u002Fhttpclient (100 подключений в секунду)\u003Cbr\u002F\u003E\r\nServer 4 – Dual-core 2GHz, 2GB RAM\u003Cbr\u002F\u003E\r\n• Запуск msggen для отправки кучи сообщений\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИспользование памяти во время открытия соединений и в течении некоторого времени:\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fstorage\u002Fhabraeffect\u002F99\u002F0a\u002F990adb2b0b14d2c533856b20c5076859.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\nHttpClient имеет встроенную задержку 10мс между соединениями, поэтому потребовалось почти 3 часа, чтобы открыть миллион соединений. Потребовалосб окло 25Гб памяти. Вот как выглядит мой сервер глазами Ganglia:\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fstorage\u002Fhabraeffect\u002F18\u002F9e\u002F189ee7454e725aad11900dca00e9fa9a.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\nВы можете видеть, что требуется около 38GB, и дальше начинается подкачка. Я подозреваю, что разница в основном в потреблении ядра.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСообщения были сгенерированы, используя 1000 процессов, при среднем времени между сообщениями около 60мс на процесс, давая около 16666 сообщений в секунду:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nerl\u003E [ spawn( fun()-\u003Emsggen:start(1000000, 10+random:uniform(100), 1000000) end) || I &lt;- lists:seq(1,1000) ].\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nServer 4 в Ganglia:\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"http:\u002F\u002Fhabrastorage.org\u002Fstorage\u002Fhabraeffect\u002F05\u002Fa6\u002F05a6ca691576b310ff886ae946e7995b.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\nОколо 10 MB в секунду – 16,666 сообщений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКогда я начал посылать сообщения, загрузка на первом сервере осталась низкой. Потребление CPU на втором сервере возрастало:\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"http:\u002F\u002Fhabrastorage.org\u002Fstorage\u002Fhabraeffect\u002F9b\u002F4e\u002F9b4e632241b3342804a43e92156878af.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\nЕстественно, что т.к. процессы выходят из hibernate() для обработки сообщений, использование памяти увеличивается незначительно. Наличие всех открытых подключений без каких-либо сообщений являестя оптимальным в использования памяти. Неудивительно, что какие-либо действия требуют больше памяти.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТак где же течет память? Mochiweb требует 40 Гб оперативной памяти, чтобы держать открытыми 1 000 000 активных соединений. Под нагрузкой, до 30GB из памяти будет использоваться mochiweb, а остальные 10 Гб ядром. Другими словами, необходимо около 40Кб на соединение.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ ходе различных испытаний с большим количеством соединений, я закончил тем, что сделал некоторые дополнительные изменения в sysctl.conf. Я пришел к этому с помощью проб и ошибок, и я не знаю, какие значения менять. Моя политика была в ожидании ошибки, чтобы проверить \u002Fvar\u002Flog\u002Fkern.log и посмотреть, что мне скажет таинственная ошибка. Вот настройки:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nnet.core.rmem_max = 33554432\r\nnet.core.wmem_max = 33554432\r\nnet.ipv4.tcp_rmem = 4096 16384 33554432\r\nnet.ipv4.tcp_wmem = 4096 16384 33554432\r\nnet.ipv4.tcp_mem = 786432 1048576 26777216\r\nnet.ipv4.tcp_max_tw_buckets = 360000\r\nnet.core.netdev_max_backlog = 2500\r\nvm.min_free_kbytes = 65536\r\nvm.swappiness = 0\r\nnet.ipv4.ip_local_port_range = 1024 65535\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЯ хотел бы узнать больше о настройках TCP Linux, чтобы сделать более обоснованные объяснения. Почти наверняка, эти настройки не является оптимальными, но по крайней мере, этого было достаточно, чтобы достичь 1 000 000 соединений.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EУзел Erlang на Libevent\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nПосле вмешательства в HTTP API для libevent, казалось совершенно разумным провести сранение вышеописанного теста с libevent HTTPd, написанным на Cи.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЯ бы хотел как можно больше кода оставить на erlang, так что давайте делать минимум на Cи — только обработку HTTP соединений. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nLibevent имеет асинхронный HTTP API, что делает реализацию HTTP сервера тривиальной. Я также искал повод, чтобы попробовать интерфейс Си для Erlang. Это сервер HTTP с использованием libevent, который идентифицирует пользователей с помощью целого Id (как наше mochiweb приложение), а также действует как Erlang Си-узел.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОн подключается к назначенному Erlang узлу, прослушивает сообщения типа {123, &lt;&lt;«Hello user 123»\u003E\u003E}, отправляет “Hello user 123″ для пользователя 123, если он подключен. Сообщения для пользователей, которые не связаны отбрасываются, как и раньше.\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n#include &lt;sys\u002Ftypes.h\u003E\r\n#include &lt;sys\u002Ftime.h\u003E\r\n#include &lt;sys\u002Fqueue.h\u003E\r\n#include &lt;stdlib.h\u003E\r\n#include &lt;err.h\u003E\r\n#include &lt;event.h\u003E\r\n#include &lt;evhttp.h\u003E\r\n#include &lt;stdio.h\u003E\r\n#include &lt;sys\u002Fsocket.h\u003E\r\n#include &lt;netinet\u002Fin.h\u003E\r\n \r\n#include \"erl_interface.h\"\r\n#include \"ei.h\"\r\n \r\n#include &lt;pthread.h\u003E\r\n \r\n#define BUFSIZE 1024\r\n#define MAXUSERS (17*65536) \u002F\u002F C1024K\r\n \r\n\u002F\u002F List of current http requests by uid:\r\nstruct evhttp_request * clients[MAXUSERS+1];\r\n\u002F\u002F Memory to store uids passed to the cleanup callback:\r\nint slots[MAXUSERS+1];\r\n \r\n\u002F\u002F called when user disconnects\r\nvoid cleanup(struct evhttp_connection *evcon, void *arg)\r\n{\r\n    int *uidp = (int *) arg;\r\n    fprintf(stderr, \"disconnected uid %d\\n\", *uidp);\r\n    clients[*uidp] = NULL;\r\n}\r\n \r\n\u002F\u002F handles http connections, sets them up for chunked transfer,\r\n\u002F\u002F extracts the user id and registers in the global connection table,\r\n\u002F\u002F also sends a welcome chunk.\r\nvoid request_handler(struct evhttp_request *req, void *arg)\r\n{\r\n        struct evbuffer *buf;\r\n        buf = evbuffer_new();\r\n        if (buf == NULL){\r\n            err(1, \"failed to create response buffer\");\r\n        }\r\n \r\n        evhttp_add_header(req-\u003Eoutput_headers, \"Content-Type\", \"text\u002Fhtml; charset=utf-8\");\r\n \r\n        int uid = -1;\r\n        if(strncmp(evhttp_request_uri(req), \"\u002Ftest\u002F\", 6) == 0){\r\n            uid = atoi( 6+evhttp_request_uri(req) );\r\n        }\r\n \r\n        if(uid &lt;= 0){\r\n            evbuffer_add_printf(buf, \"User id not found, try \u002Ftest\u002F123 instead\");\r\n            evhttp_send_reply(req, HTTP_NOTFOUND, \"Not Found\", buf);\r\n            evbuffer_free(buf);\r\n            return;\r\n        }\r\n \r\n        if(uid \u003E MAXUSERS){\r\n            evbuffer_add_printf(buf, \"Max uid allowed is %d\", MAXUSERS);\r\n            evhttp_send_reply(req, HTTP_SERVUNAVAIL, \"We ran out of numbers\", buf);\r\n            evbuffer_free(buf);\r\n            return;\r\n        }\r\n \r\n        evhttp_send_reply_start(req, HTTP_OK, \"OK\");\r\n        \u002F\u002F Send welcome chunk:\r\n        evbuffer_add_printf(buf, \"Welcome, Url: ‘%s’ Id: %d\\n\", evhttp_request_uri(req), uid);\r\n        evhttp_send_reply_chunk(req, buf);\r\n        evbuffer_free(buf);\r\n \r\n        \u002F\u002F put reference into global uid-\u003Econnection table:\r\n        clients[uid] = req;\r\n        \u002F\u002F set close callback\r\n        evhttp_connection_set_closecb( req-\u003Eevcon, cleanup, &amp;slots[uid] );\r\n}\r\n \r\n \r\n\u002F\u002F runs in a thread – the erlang c-node stuff\r\n\u002F\u002F expects msgs like {uid, msg} and sends a a ‘msg’ chunk to uid if connected\r\nvoid cnode_run()\r\n{\r\n    int fd;                                  \u002F* fd to Erlang node *\u002F\r\n    int got;                                 \u002F* Result of receive *\u002F\r\n    unsigned char buf[BUFSIZE];              \u002F* Buffer for incoming message *\u002F\r\n    ErlMessage emsg;                         \u002F* Incoming message *\u002F\r\n \r\n    ETERM *uid, *msg;\r\n \r\n    erl_init(NULL, 0);\r\n \r\n    if (erl_connect_init(1, \"secretcookie\", 0) == -1)\r\n        erl_err_quit(\"erl_connect_init\");\r\n \r\n    if ((fd = erl_connect(\"httpdmaster@localhost\")) &lt; 0)\r\n        erl_err_quit(\"erl_connect\");\r\n \r\n    fprintf(stderr, \"Connected to httpdmaster@localhost\\n\\r\");\r\n \r\n    struct evbuffer *evbuf;\r\n \r\n    while (1) {\r\n        got = erl_receive_msg(fd, buf, BUFSIZE, &amp;emsg);\r\n        if (got == ERL_TICK) {\r\n            continue;\r\n        } else if (got == ERL_ERROR) {\r\n            fprintf(stderr, \"ERL_ERROR from erl_receive_msg.\\n\");\r\n            break;\r\n        } else {\r\n            if (emsg.type == ERL_REG_SEND) {\r\n                \u002F\u002F get uid and body data from eg: {123, &lt;&lt;\"Hello\"\u003E\u003E}\r\n                uid = erl_element(1, emsg.msg);\r\n                msg = erl_element(2, emsg.msg);\r\n                int userid = ERL_INT_VALUE(uid);\r\n                char *body = (char *) ERL_BIN_PTR(msg);\r\n                int body_len = ERL_BIN_SIZE(msg);\r\n                \u002F\u002F Is this userid connected?\r\n                if(clients[userid]){\r\n                    fprintf(stderr, \"Sending %d bytes to uid %d\\n\", body_len, userid);                \r\n                    evbuf = evbuffer_new();\r\n                    evbuffer_add(evbuf, (const void*)body, (size_t) body_len);\r\n                    evhttp_send_reply_chunk(clients[userid], evbuf);\r\n                    evbuffer_free(evbuf);\r\n                }else{\r\n                    fprintf(stderr, \"Discarding %d bytes to uid %d – user not connected\\n\", \r\n                            body_len, userid);                \r\n                    \u002F\u002F noop\r\n                }\r\n                erl_free_term(emsg.msg);\r\n                erl_free_term(uid); \r\n                erl_free_term(msg);\r\n            }\r\n        }\r\n    }\r\n    \u002F\u002F if we got here, erlang connection died.\r\n    \u002F\u002F this thread is supposed to run forever\r\n    \u002F\u002F TODO – gracefully handle failure \u002F reconnect \u002F etc\r\n    pthread_exit(0);\r\n}\r\n \r\nint main(int argc, char **argv)\r\n{\r\n    \u002F\u002F Launch the thread that runs the cnode:\r\n    pthread_attr_t tattr;\r\n    pthread_t helper;\r\n    int status;\r\n    pthread_create(&amp;helper, NULL, cnode_run, NULL);\r\n \r\n    int i;\r\n    for(i=0;i&lt;=MAXUSERS;i++) slots[i]=i;\r\n    \u002F\u002F Launch libevent httpd:\r\n    struct evhttp *httpd;\r\n    event_init();\r\n    httpd = evhttp_start(\"0.0.0.0\", 8000);\r\n    evhttp_set_gencb(httpd, request_handler, NULL);\r\n    event_dispatch();\r\n    \u002F\u002F Not reached, event_dispatch() shouldn’t return\r\n    evhttp_free(httpd);\r\n    return 0;\r\n}\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nМаксимальное количество пользователей задано с помощью #define, прослушивается порт 8000 и ожидаются пользователи. Также жестко задано имя Erlang узела cookie.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапустите узел, к которому будет подключатсясервер:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n$ erl -setcookie secretcookie -sname httpdmaster@localhost\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапустим Си-узел:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\n$ gcc -o httpdcnode httpdcnode.c -lerl_interface -lei -levent\r\n$ .\u002Fhttpdcnode\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПроверьте, что виден узел:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nerl\u003E nodes(hidden).\r\n[c1@localhost]\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nОткройте в своем браузере \u003Ca href=\"http:\u002F\u002Flocalhost\"\u003Elocalhost\u003C\u002Fa\u003E:8000\u002Ftest\u002F123. Вы должны увидеть приветственное сообщение.\u003Cbr\u002F\u003E\r\nДалее отправьте сообщение Си-узлу:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nerl\u003E {any, c1@localhost} ! {123, &lt;&lt;\"Hello Libevent World\"\u003E\u003E}.\r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nОбратите внимание, что мы не используем Pid — мы используем {procname, node}. Мы используем «any», как название процесса, который игнорируется Cи-узлом. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь вы в состоянии доставить сообщения через Erlang, но все соединения управляются libevent программой на Си, которая действует как узел Erlang.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле удаления отладочного вывода, я подключил 1 000 000 клиентов к httpdcnode серверу, используя тот же самый клиент, как и выше. Машина показала, в общей сложности чуть менее 10 Гб используемой памяти. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПамять сервера была стабильно около 2GB:\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" data-src=\"http:\u002F\u002Fhabrastorage.org\u002Fstorage\u002Fhabraeffect\u002Fe6\u002F68\u002Fe668ac6be86de46482d9a6d98af80b45.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EПорядка 2Кб на каждое подключение.\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСостояние памяти:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode\u003E\r\nMem: 32968672k total, 9636488k used, 23332184k free, 180k buffers \r\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТак kernel\u002F TCP стек берет дополнительные 8Кб за соединение, которые кажутся высокими, но у меня нет ничего для для сравнения. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот libevent-cnode сервер требует определенной дополнительной работы над собой. Не разумно обрабатывать несколько соединений от одного пользователя, и все еще присутствуют “race conditions”, если вы отключитесь тогда, когда сообщение было только отправлено.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНесмотря на это, мы использовали Erlang для всех интересных вещей, и Cи + libevent использовались для низкоуровневых операций. Программа на Cи может быть запущен в качестве драйвера или C-узла, а интерфейсы Erlang могут дать вам достойный API. У меня все еще осталось желание поэкспериментировать с этим.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EФинальные выводы\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУ меня есть достаточно данных сейчас судить, какое оборудование будет необходимо, если мы развернем большую систему масштаба Last.fm. Даже в худшем случае 40Кб за соединение является хорошим результатом — память довольно дешевая на данный момент, и 40GB для поддержки миллионов пользователей не является проблемой. 10GB еще лучше.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"mochiweb"},{"titleHtml":"erlang"},{"titleHtml":"libevent"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F111600\u002F031316c1b833b34d2b7880ddfe26181c\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F111600\u002F031316c1b833b34d2b7880ddfe26181c\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F111600\\\u002F\"},\"headline\":\"Comet–приложение для Mochiweb c нагрузкой в 1 000 000 пользователей. Часть 3\\\u002F3\",\"datePublished\":\"2011-01-10T23:30:57+03:00\",\"dateModified\":\"2011-01-11T03:34:52+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Андрей Кондратович\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили п...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F111600\\\u002F#post-content-body\",\"about\":[\"h_erlang\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fstorage\\\u002Fhabraeffect\\\u002F99\\\u002F0a\\\u002F990adb2b0b14d2c533856b20c5076859.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fstorage\\\u002Fhabraeffect\\\u002F18\\\u002F9e\\\u002F189ee7454e725aad11900dca00e9fa9a.png\",\"http:\\\u002F\\\u002Fhabrastorage.org\\\u002Fstorage\\\u002Fhabraeffect\\\u002F05\\\u002Fa6\\\u002F05a6ca691576b310ff886ae946e7995b.png\",\"http:\\\u002F\\\u002Fhabrastorage.org\\\u002Fstorage\\\u002Fhabraeffect\\\u002F9b\\\u002F4e\\\u002F9b4e632241b3342804a43e92156878af.png\",\"http:\\\u002F\\\u002Fhabrastorage.org\\\u002Fstorage\\\u002Fhabraeffect\\\u002Fe6\\\u002F68\\\u002Fe668ac6be86de46482d9a6d98af80b45.png\"]}","metaDescription":"Часть 1 и Часть 2 в этом цикле статей показали, как создать приложение, используя mochiweb, и как передавать сообщения подключенным пользователям. Мы уменьшили постребление памяти до 8 Кб для каждого...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"578690":{"id":"578690","timePublished":"2021-09-29T09:00:02+00:00","isCorporative":true,"lang":"ru","titleHtml":"Пишем драйвер виртуального EEPROM для STM32F030","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1705055","alias":"Neoprog","fullname":"Алексей","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F829\u002F06a\u002F3e1\u002F82906a3e13b5a04dee9b4deead9ffd8c.png","speciality":"Инженер-программист"},"statistics":{"commentsCount":16,"favoritesCount":44,"readingCount":1381,"score":33,"votesCount":35},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"19737","alias":"controllers","type":"collective","title":"Программирование микроконтроллеров","titleHtml":"Программирование микроконтроллеров","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F578690\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ftn\u002Fn0\u002Fm6\u002Ftnn0m62rtstlnjf-sl8axn3zves.png\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nКто хотел сохранять какие-либо данные в FLASH микроконтроллера во время работы устройства сталкивались с особенностями работы с этим видом памяти. Из-за необходимости стирания страницы большого объёма для перезаписи ячейки FLASH памяти, возникает угроза потери данных из-за отключения питания во время процесса обновления (один из вариантов). В этой статье я расскажу как можно упростить работу с FLASH, да и ещё с гарантией сохранения данных при прерывании процедуры обновления на любом этапе. Реализуем это на STM32F030.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"veeprom"},{"titleHtml":"flash-память"},{"titleHtml":"ruvds_статьи"},{"titleHtml":"программирование микроконтроллеров"}]},"578788":{"id":"578788","timePublished":"2021-09-28T17:03:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Принцип работы планировщика задач в Linux","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Eliran","originalUrl":"https:\u002F\u002Fcodingkaiser.blog\u002F2021\u002F09\u002F16\u002Fprocess-scheduling-in-linux\u002F"}}],"author":{"id":"2488151","alias":"Bright_Translate","fullname":"Дмитрий Брайт","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff9c\u002Fff9\u002F7d9\u002Ff9cff97d9c0677af28dab451897f88e4.jpg","speciality":"Переводчик"},"statistics":{"commentsCount":12,"favoritesCount":70,"readingCount":4820,"score":33,"votesCount":37},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true},{"relatedData":null,"id":"7289","alias":"nix","type":"collective","title":"*nix","titleHtml":"*nix","isProfiled":true},{"relatedData":null,"id":"19727","alias":"linux_dev","type":"collective","title":"Разработка под Linux","titleHtml":"Разработка под Linux","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F578788\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhf\u002Fx2\u002Fht\u002Fhfx2htdiptolxklsfgogcobnvkc.png\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПланирование – это процесс распределения ресурсов системы для выполнения задач. В статье мы рассмотрим его вариант, в котором ресурсом является одно или несколько ядер процессора, а задачи представлены потоками или процессами, которые нужно выполнить.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ruvds_перевод"},{"titleHtml":"linux"},{"titleHtml":"планировщик"}]},"579106":{"id":"579106","timePublished":"2021-09-29T09:02:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Геоанализ этажности Санкт-Петербурга алгоритмом KDE, или Как меняется облик города","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2652123","alias":"MaximML","fullname":"Максим","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F924\u002Fe65\u002Fe7f\u002F924e65e7f813ba32d53a7891fd45bc62.jpg","speciality":"Machine Learning"},"statistics":{"commentsCount":3,"favoritesCount":10,"readingCount":870,"score":12,"votesCount":16},"hubs":[{"relatedData":null,"id":"22390","alias":"citymobil","type":"corporative","title":"Блог компании Ситимобил","titleHtml":"Блог компании Ситимобил","isProfiled":false},{"relatedData":null,"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true},{"relatedData":null,"id":"17783","alias":"geo","type":"collective","title":"Геоинформационные сервисы","titleHtml":"Геоинформационные сервисы","isProfiled":true},{"relatedData":null,"id":"17795","alias":"bigdata","type":"collective","title":"Big Data","titleHtml":"Big Data","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВсем привет, меня зовут Максим Шаланкин, в Ситимобил я занимаюсь машинным обучением. Мы используем множество крутых алгоритмов для оптимизации наших сервисов и улучшения бизнес-процессов. В этой публикации я расскажу, как использовать в геоаналитике алгоритм ядерной оценки плотности (Kernel Density Estimation) и строить полигоны на карте, основываясь на распределении географических данных.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F68a\u002F80b\u002F38d\u002F68a80b38d498f5a6941119e81b1856b1.png","buttonTextHtml":"Врууум","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F68a\u002F80b\u002F38d\u002F68a80b38d498f5a6941119e81b1856b1.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"полигоны"},{"titleHtml":"аналитика"},{"titleHtml":"ядерная оценка плотности"},{"titleHtml":"kernel density estimation"},{"titleHtml":"kde"},{"titleHtml":"санкт-петербург"},{"titleHtml":"геоаналитика"},{"titleHtml":"геоданные"},{"titleHtml":"гео"}]},"579530":{"id":"579530","timePublished":"2021-09-29T00:18:17+00:00","isCorporative":true,"lang":"ru","titleHtml":"Лучше поздно, чем никогда: Microsoft решила продолжить историю Skype","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2413033","alias":"kkxen","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fdeb\u002Fc7f\u002Fe41\u002Fdebc7fe41d3a22ed05b308e454b3f3fd.jpg","speciality":"Influencer-marketing manager"},"statistics":{"commentsCount":58,"favoritesCount":8,"readingCount":16619,"score":37,"votesCount":41},"hubs":[{"relatedData":null,"id":"14740","alias":"selectel","type":"corporative","title":"Блог компании Selectel","titleHtml":"Блог компании Selectel","isProfiled":false},{"relatedData":null,"id":"92","alias":"instant_messaging","type":"collective","title":"Мессенджеры","titleHtml":"Мессенджеры","isProfiled":true},{"relatedData":null,"id":"20688","alias":"research","type":"collective","title":"Исследования и прогнозы в IT","titleHtml":"Исследования и прогнозы в IT","isProfiled":false},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F8fc\u002Ff2b\u002F5e4\u002F8fcf2b5e48070f436d4ac6f9d4fe6558.png\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nКорпорация Microsoft приобрела VoIP-сервис Skype в 2011 году, можно сказать, на пике его популярности, за $8,5 млрд. И сейчас это огромная даже по меркам IT-отрасли сумма, а в 2011 году она была еще более внушительной. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКомпания, по словам ее экс-руководителя Стива Баллмера, собиралась развивать вместе со Skype коммуникации, создав простую среду для общения друзей, родственников и коллег. В целом, все выглядело неплохо, ведь тогда количество пользователей составляло 663 млн человек, при должном старании Skype (а значит, и Microsoft) мог стать едва ли не монополистом среди коммуникационных инструментов. Но что-то пошло не так. \u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"skype"},{"titleHtml":"мессенджер"},{"titleHtml":"развитие"},{"titleHtml":"Microsoft"}]},"579626":{"id":"579626","timePublished":"2021-09-29T10:52:57+00:00","isCorporative":true,"lang":"ru","titleHtml":"Если крысе не давать спать, она умрёт через 3 недели — как работают мозг и сон","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2221530","alias":"Asya_Dyu","fullname":"Анастасия","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffec\u002F943\u002F098\u002Ffec943098e84d65a162934040de8b9ed.gif","speciality":"Иллюстратор"},"statistics":{"commentsCount":1,"favoritesCount":60,"readingCount":4317,"score":23,"votesCount":23},"hubs":[{"relatedData":null,"id":"17357","alias":"timeweb","type":"corporative","title":"Блог компании Timeweb","titleHtml":"Блог компании Timeweb","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21990","alias":"brain","type":"collective","title":"Мозг","titleHtml":"Мозг","isProfiled":false},{"relatedData":null,"id":"21996","alias":"health","type":"collective","title":"Здоровье","titleHtml":"Здоровье","isProfiled":false},{"relatedData":null,"id":"22750","alias":"biology","type":"collective","title":"Биология","titleHtml":"Биология","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8y\u002Fnt\u002Feg\u002F8ynteg9tee4b_rbudidreaw4ksm.gif\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nПосмотрела 2х-часовую \u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=Zdy9wy8N8Lo&amp;t=2s\" rel=\"nofollow noopener noreferrer\"\u003Eлекцию \u003C\u002Fa\u003Eпрофессора МГУ Вячеслава Дубынина про влияние сна на мозг и мозга на сон. Под катом конспект минут на 20 чтения. Если попытаться сжать до 1 минуты, то получится что-то вроде этого:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСколько нужно спать. Индивидуально, от 6 до 10 часов — для взрослого человека в пределах нормы.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#Example\"\u003EГигиена сна\u003C\u002Fa\u003E — правила, чтобы нормально засыпать и высыпаться. (Просто якорь на слайд-список).\u003C\u002Fli\u003E\r\n\u003Cli\u003EБиологические часы — реальный физиологический процесс, который ориентируется на циркадные ритмы. Смена часовых поясов и работа по сменам «расшатывает» механизмы биологических часов. \u003C\u002Fli\u003E\r\n\u003Cli\u003EСпать надо ложиться не позже, чем… — фигня. Просто в одно и то же время.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли вы спите днем, купите себе хорошие шторы. Мелатонин коррелирует с освещением. Если в глаза (даже закрытые) светит солнце, вы не отдыхаете полноценно.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСколько можно не спать. Без необратимых серьезных последствий взрослый человек выдержит до 4-х суток. \u003C\u002Fli\u003E\r\n\u003Cli\u003EСон делится на медленную и парадоксальную фазы. \u003C\u002Fli\u003E\r\n\u003Cli\u003EМедленная фаза сна — про очищение организма. Если нет медленной фазы сна, иммунитет, эндокринка, обменные процессы и гомеостаз идут лесом. Экспериментальные крысы умирают на 15-20 день без сна от воспаления, когда кишечные бактерии попадают в кровь.\u003C\u002Fli\u003E\r\n\u003Cli\u003EПарадоксальная фаза сна участвует в обработке информации. По уровню электрической активности мозга она близка к состоянию активного решения сложных задач. \u003C\u002Fli\u003E\r\n\u003Cli\u003EКогда правильно просыпаться. На переходе от парадоксальной фазы к медленной. \u003C\u002Fli\u003E\r\n\u003Cli\u003EКак определить на глаз, когда можно будить. Когда человек лежал спокойно и начал ворочаться, можно будить.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКофеин не позволяет организму получить сигнал об усталости, но не дает дополнительную энергию.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКак затормозить перевозбужденную нервную систему нежно. Фенобарбитал в малых дозах — корвалол, валокордин, валосердин. Противогистаминные препараты. \u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"здоровье"},{"titleHtml":"сон"},{"titleHtml":"мозг"},{"titleHtml":"нейрофизиология"},{"titleHtml":"нейробиология"},{"titleHtml":"нейроны"}]},"579960":{"id":"579960","timePublished":"2021-09-28T17:50:38+00:00","isCorporative":false,"lang":"ru","titleHtml":"Архитектура Вселенной, часть 1: Сознание","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"248181","alias":"SergioShpadi","fullname":"Сергей Шпадырев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F4c0\u002Fe3f\u002F7f3\u002F4c0e3f7f3dd535053b9bd3bbcc7fbfde.png","speciality":"Software Engineer"},"statistics":{"commentsCount":112,"favoritesCount":73,"readingCount":7405,"score":14,"votesCount":26},"hubs":[{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cem\u003E'По одной капле воды человек, умеющий мыслить логически, может сделать вывод о возможности существования Атлантического океана или Ниагарского водопада, даже если он не видал ни того, ни другого и никогда о них не слыхал' -&nbsp;Артур Конан-Дойль, «Этюд в багровых тонах».\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EМеня всегда восхищали древние философы, которые не имея никаких инструментов познания мира кроме собственного разума, бесстрашно погружались в пучины тайн мироздания. С помощью одних лишь только рассуждений они обретали исключительно глубокое понимание принципов работы механизма Вселенной, тем самым расширяя наши представления о мире.\u003C\u002Fp\u003E\u003Cp\u003EТрудно переоценить влияние философии на науку, так как наука произошла именно от философии. Использующаяся для формализации процесса рассуждений математика стала первенцем философии. Даже сами слова \"философия\" и \"математика\" произошли из терминов религиозной школы одного из величайших философов античности - Пифагора. Физика, названию которой мы обязаны другому великому античному философу - Аристотелю, примерно до XVIII века именовалась натуральной философией. Ему же мы обязаны появлением логики - науки о мышлении. Кроме того, философы, изучавшие процесс познания и его ограничения, создали важнейший инструмент исследования природы - научный метод. \u003C\u002Fp\u003E\u003Cp\u003EДаже многие научные открытия последних веков были вдохновлены философией. Иоганн Кеплер, Николай Коперник и Исаак Ньютон вдохновлялись теорией о гармонии мира Пифагора, о чем сами и писали в своих научных трудах. Альберт Эйнштейн был ярым приверженцем философии средневекового философа Бенедикта Спинозы, но также считал себя в некотором смысле платоником и пифагорейцем. Один из основоположников квантовой механики Эрвин Шрёдингер написал целую книгу о том, как его открытия в квантовой механике согласуются с индийской философией веданты. \u003C\u002Fp\u003E\u003Cp\u003EДо сих пор в западных университетах всем специалистам в точных и естественных науках, успешно защитившим свою диссертацию, присваивают почетное звание доктора философии - \u003Cem\u003EPhilosophiæ Doctor\u003C\u002Fem\u003E, часто сокращаемое в речи и на письме до простого PhD. Тем самым университеты подчеркивают, что философия лежит в самом основании всего человеческого знания. Но чем именно занимается философия, в чем состоит её роль?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd13\u002Fd45\u002F8ea\u002Fd13d458ea0fe8e643a0444a0133f0472.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd13\u002Fd45\u002F8ea\u002Fd13d458ea0fe8e643a0444a0133f0472.jpg","fit":"cover","positionY":53.409090909091,"positionX":3.974358974359}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"сознание"},{"titleHtml":"квалиа"},{"titleHtml":"философский зомби"},{"titleHtml":"цвет"},{"titleHtml":"дэвид чалмерс"},{"titleHtml":"шредингер"},{"titleHtml":"макс планк"},{"titleHtml":"спиноза"}]},"579972":{"id":"579972","timePublished":"2021-09-29T13:00:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Апскейл, который смог","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"410650","alias":"man_of_letters","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb59\u002Fd10\u002Fcc4\u002Fb59d10cc4887ce1d5ac2382e5f034940.png","speciality":"Человек смыслов"},"statistics":{"commentsCount":12,"favoritesCount":38,"readingCount":2437,"score":44,"votesCount":44},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"19439","alias":"machine_learning","type":"collective","title":"Машинное обучение","titleHtml":"Машинное обучение","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"Термин «апскейл» используется для обозначения процесса увеличения разрешения цифровых изображений с фокусом на создание иллюзии «настоящего» высокого разрешения. Правда, 90% таких продуктов — это барахло, больше намёк на перспективы, чем волшебство. Недавно мои ручки добрались до двух алгоритмов повышения чёткости, которые оказались настолько хороши, что появилась эта статья. Будут субъективные и объективные тесты алгоритма Real-ESRGAN для увеличения разрешения и алгоритма GFPGAN для детализации лиц.\u003Cbr\u003E\r\n\u003Cblockquote\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ETraffic_Warning:\u003C\u002Ffont\u003E\u003C\u002Fb\u003E в статье демонстрируется множество примеров.\u003C\u002Fblockquote\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F579972\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feg\u002F1j\u002Fkt\u002Feg1jktqrr0hcjrqsua4rsxqqio0.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ruvds_статьи"},{"titleHtml":"машинное обучение"},{"titleHtml":"нейросети"},{"titleHtml":"искусственный интеллект"},{"titleHtml":"machine learning"},{"titleHtml":"upscale"},{"titleHtml":"Lancoz"},{"titleHtml":"Topaz Gigapixe"},{"titleHtml":"Real-ESRGAN"}]},"580034":{"id":"580034","timePublished":"2021-09-28T17:18:57+00:00","isCorporative":false,"lang":"ru","titleHtml":"Пыль, пылевые клещи и их аллергены. Профилактика и защита","editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"1841275","alias":"steanlab","fullname":"Cергей Бесараб (Siarhei Besarab) EU1AEY","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F2d8\u002Fb91\u002F145\u002F2d8b911451a45b7d469e3eead16f750d.jpg","speciality":"Хабра-химик, турист, авантюрист и радиолюбитель :)"},"statistics":{"commentsCount":53,"favoritesCount":62,"readingCount":11105,"score":54,"votesCount":62},"hubs":[{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21996","alias":"health","type":"collective","title":"Здоровье","titleHtml":"Здоровье","isProfiled":false},{"relatedData":null,"id":"22010","alias":"Chemistry","type":"collective","title":"Химия","titleHtml":"Химия","isProfiled":false},{"relatedData":null,"id":"22012","alias":"Ecology","type":"collective","title":"Экология","titleHtml":"Экология","isProfiled":false},{"relatedData":null,"id":"22750","alias":"biology","type":"collective","title":"Биология","titleHtml":"Биология","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Пыль и пылевые клещи в ней есть практически везде и всегда. Уничтожить их удается возможно только в условиях «чистых комнат» на производстве полупроводников. Приходится с этим мириться, и жить допуская, что все что нам под силу — уменьшить их количество. Считается, что если концентрация клещей &lt; 100 штук на грамм пыли — аллергия у большинства не возникает. После того как пришлось пару-тройку минут чихать без остановки — у меня накопилось достаточно злобы, чтобы \u003Ca href=\"https:\u002F\u002Ft.me\u002Fjoinchat\u002FAAAAAFFhzPKyiLO85pRxUA\" rel=\"nofollow noopener noreferrer\"\u003Eрассмотреть\u003C\u002Fa\u003E, что же представляет из себя пыль в квартире и что и кто в этой пыли живет. А теперь вот нашлось время, чтобы познакомить с «нашими маленькими друзьями» и читателей Хабра. В заметке рассуждения о некоторых особенностях биологии вездесущего домашнего паразита и методикам его контроля. То, что под катом можешь смело давать почитать жене, %username%!\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F580034\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fw0\u002F9u\u002Fzv\u002Fw09uzvckqowxlqadjnpx414mf6y.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Дружно скажем НЕТ пыли и ее обитателям","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"пыль"},{"titleHtml":"пыль это"},{"titleHtml":"пыль под микроскопом"},{"titleHtml":"пыль аллергия"},{"titleHtml":"пыль бытовая"},{"titleHtml":"мебельные клещи"},{"titleHtml":"пыль в воздухе"},{"titleHtml":"пыль текстура"},{"titleHtml":"из чего состоит пыль"},{"titleHtml":"пыль откуда берется"},{"titleHtml":"пыль от постельного белья"},{"titleHtml":"пыль обветшания"},{"titleHtml":"пыль размер частиц"},{"titleHtml":"пыль уборка"},{"titleHtml":"пыль химический состав"},{"titleHtml":"пыль что это"},{"titleHtml":"что такое пыль"},{"titleHtml":"откуда берется пыль"},{"titleHtml":"пыль это кожа"},{"titleHtml":"пылевые клещи как избавиться"},{"titleHtml":"пылевые клещи аллергия"},{"titleHtml":"пылевые клещи размер"},{"titleHtml":"где живут пылевые клещи"},{"titleHtml":"пылевые клещи борьба с ними"},{"titleHtml":"пылевые клещи борьба"},{"titleHtml":"пылевые клещи боятся холода"},{"titleHtml":"клещи пылевые"},{"titleHtml":"пылевые клещи в подушках"},{"titleHtml":"в постели"},{"titleHtml":"в матрасе"},{"titleHtml":"в постельном белье"},{"titleHtml":"в мягких игрушках"},{"titleHtml":"в одежде"},{"titleHtml":"в каждом доме"},{"titleHtml":"в диване"},{"titleHtml":"в ковре"},{"titleHtml":"пылевые клещи вред"},{"titleHtml":"пылевые клещи дезинфекция"},{"titleHtml":"пылевые клещи и ультрафиолет"},{"titleHtml":"пылевые клещи избавление"},{"titleHtml":"пыль и пылевые клещи"},{"titleHtml":"пылевые клещи мороз"},{"titleHtml":"пылевые клещи обработка"},{"titleHtml":"пылевые клещи профилактика"},{"titleHtml":"клещи при стирке"},{"titleHtml":"средства от клещей"},{"titleHtml":"пылевые клещи температура"},{"titleHtml":"клещи озон"},{"titleHtml":"аллергия на пыль"},{"titleHtml":"плесень"},{"titleHtml":"Валлемия"},{"titleHtml":"микотоксины"},{"titleHtml":"никто не читает тэги"}]},"580118":{"id":"580118","timePublished":"2021-09-29T09:34:41+00:00","isCorporative":true,"lang":"ru","titleHtml":"Вычисляем на видеокартах. Технология OpenCL. Часть 1a. Как работает OpenCL","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2690813","alias":"xjossy","fullname":"Georgy Osipov","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5c1\u002Ff73\u002F5f3\u002F5c1f735f3c77ebd66743a8e2f38a98b2.png","speciality":"Пользователь"},"statistics":{"commentsCount":4,"favoritesCount":41,"readingCount":1454,"score":18,"votesCount":18},"hubs":[{"relatedData":null,"id":"22588","alias":"yandex_praktikum","type":"corporative","title":"Блог компании Яндекс.Практикум","titleHtml":"Блог компании Яндекс.Практикум","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"9233","alias":"gpgpu","type":"collective","title":"GPGPU","titleHtml":"GPGPU","isProfiled":true},{"relatedData":null,"id":"21944","alias":"videocards","type":"collective","title":"Видеокарты","titleHtml":"Видеокарты","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"22 июня автор курса \u003Ca href=\"https:\u002F\u002Fpracticum.yandex.ru\u002Fcpp?utm_source=pr&amp;utm_medium=content&amp;utm_content=28_09_21&amp;utm_campaign=pr_content_cpp_habr\" rel=\"nofollow noopener noreferrer\"\u003E«Разработчик C++» \u003C\u002Fa\u003Eв Яндекс.Практикуме Георгий Осипов провёл вебинар \u003Ca href=\"https:\u002F\u002Fyoutu.be\u002FyPCeYXxSLjA\" rel=\"nofollow noopener noreferrer\"\u003E«Вычисляем на видеокартах. Технология OpenCL».\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fyoutu.be\u002FyPCeYXxSLjA\" rel=\"nofollow noopener noreferrer\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fwq\u002Frf\u002Fap\u002Fwqrfaphypdz0hchnq36fsinwes8.png\"\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nМы подготовили для вас его текстовую версию, для удобства разбив её на смысловые блоки.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fyandex_praktikum\u002Fblog\u002F575484\u002F\"\u003E0. Зачем мы здесь собрались. Краткая история GPGPU.\u003C\u002Fa\u003E\u003Cbr\u003E\r\n \u003Cb\u003E1a. Как работает OpenCL.\u003C\u002Fb\u003E\u003Cbr\u003E\r\n 1b. Пишем для OpenCL.\u003Cbr\u003E\r\n 2. Алгоритмы в условиях массового параллелизма.\u003Cbr\u003E\r\n 3. Сравнение технологий.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nМы обещали, что разберём написание полноценной программы уже в этой части, но материала оказалось слишком много, и мы разбили эту часть надвое. В первой половине расскажем про основные принципы, которые должен знать каждый OpenCL-разработчик, а во второй напишем программу.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ci\u003EЕсть мнение, что для написания эффективного кода для GPU программист обязан понимать архитектуру видеокарты. И это мнение не чьё-нибудь там, а NVIDIA (см. \u003Ca href=\"https:\u002F\u002Fwww.nvidia.ru\u002Fcontent\u002FEMEAI\u002FCUDA\u002Flecture_documents\u002FLecture_11.pdf\" rel=\"nofollow noopener noreferrer\"\u003EЛекции NVIDIA по GPGPU\u003C\u002Fa\u003E). Не будем спорить и разберём базовые принципы работы видеокарты.\u003C\u002Fi\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"OpenCL"},{"titleHtml":"CUDA"},{"titleHtml":"GPU"},{"titleHtml":"GPGPU"},{"titleHtml":"NVIDIA"},{"titleHtml":"OpenGL"},{"titleHtml":"видеокарты"},{"titleHtml":"высокая производительность"},{"titleHtml":"курс Разработчик C++"},{"titleHtml":"высокопроизводительные"},{"titleHtml":"многопоточные вычисления"},{"titleHtml":"Яндекс Практикум"}]},"580296":{"id":"580296","timePublished":"2021-09-28T17:06:29+00:00","isCorporative":true,"lang":"ru","titleHtml":"О чём .NET-разработчикам расскажут на DotNext 2021 Moscow","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2238368","alias":"k_tultseva","fullname":"Christina","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F44b\u002Fd20\u002F52c\u002F44bd2052c476b5ee251ae790021fcde4.jpg","speciality":"Редактор"},"statistics":{"commentsCount":2,"favoritesCount":8,"readingCount":1447,"score":12,"votesCount":12},"hubs":[{"relatedData":null,"id":"18226","alias":"jugru","type":"corporative","title":"Блог компании JUG Ru Group","titleHtml":"Блог компании JUG Ru Group","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"546","alias":"net","type":"collective","title":".NET","titleHtml":".NET","isProfiled":true},{"relatedData":null,"id":"20754","alias":"tech_events","type":"collective","title":"Конференции","titleHtml":"Конференции","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"4","alias":"marketing","title":"Маркетинг"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПорой жизнь разработчика превращается в кошмар. Называться это может по-разному: «миграция большого проекта», «отладка асинхронного кода», «запущенное легаси» или даже «зоопарк технологий для распределённых приложений». Уже скоро мы проведем .NET-конференцию \u003Cstrong\u003E\u003Ca href=\"https:\u002F\u002Fdotnext-moscow.ru\u002F?utm_source=habr&amp;utm_medium=580296\"\u003E\u003Cu\u003EDotNext\u003C\u002Fu\u003E\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E, и поучаствовать в ней не только интересно, но и может помогать от кошмаров.\u003C\u002Fp\u003E\u003Cp\u003EСреди тем конференции — и низкоуровневый хардкор, и нестандартные подходы, и личные истории преодоления препятствий. А рассказывать обо всём этом будут яркие спикеры, уже знакомые многим .NET-разработчикам: например, Скотт Влашин, Дилан Битти, Стивен Тауб, Егор Богатов, Евгений Пешков.\u003C\u002Fp\u003E\u003Cp\u003EВ программу сейчас вносятся последние штрихи, так что возможны маленькие изменения, но в целом доклады будет такими, как описано под катом. А кроме докладов, будут ещё и активности от программного комитета (вроде игры в формате ЧГК), о них позже расскажем отдельно.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faee\u002F58c\u002F604\u002Faee58c604114791cf6e493e61c72f433.png","buttonTextHtml":"Смотреть программу","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faee\u002F58c\u002F604\u002Faee58c604114791cf6e493e61c72f433.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":".net"},{"titleHtml":".net development"},{"titleHtml":"конференция"},{"titleHtml":"dotnext"}]},"580392":{"id":"580392","timePublished":"2021-09-29T09:00:14+00:00","isCorporative":true,"lang":"ru","titleHtml":"Дообучаем готовую нейросеть для классификации данных","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2072505","alias":"MrNightSky","fullname":"Yaroslav Murzaev","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F9ce\u002F822\u002Fa59\u002F9ce822a590f5ae38e2ccd2507deaf9ef.jpg","speciality":"Data Scientist, ML engineer"},"statistics":{"commentsCount":0,"favoritesCount":36,"readingCount":806,"score":36,"votesCount":38},"hubs":[{"relatedData":null,"id":"18232","alias":"funcorp","type":"corporative","title":"Блог компании FUNCORP","titleHtml":"Блог компании FUNCORP","isProfiled":false},{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"19439","alias":"machine_learning","type":"collective","title":"Машинное обучение","titleHtml":"Машинное обучение","isProfiled":true},{"relatedData":null,"id":"22374","alias":"data_engineering","type":"collective","title":"Data Engineering","titleHtml":"Data Engineering","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Ffuncorp\u002Fblog\u002F576658\u002F\"\u003E\u003Cu\u003Eпрошлой статье\u003C\u002Fu\u003E\u003C\u002Fa\u003E мы научились классифицировать данные без разметки с помощью понижения размерности и методов кластеризации. По итогам получили первичную разметку данных и узнали, что это картинки. С такими начальными условиями можно придумать что-то более серьёзное, например, дообучить существующую нейросеть на наши классы, даже если до этого она их никогда не видела. В iFunny на первом уровне модерации мы выделяем три основных класса:&nbsp;\u003C\u002Fp\u003E\u003Cp\u003E• approved — картинки идут в раздел collective (развлекательный контент и мемы);\u003Cbr\u003E• not suitable — не попадают в общую ленту, но остаются в ленте пользователя (селфи, пейзажи и другие);\u003Cbr\u003E• risked — получают бан и удаляются из приложения (расизм, порнография, расчленёнка и всё, что попадает под определение «противоправный контент»).\u003C\u002Fp\u003E\u003Cp\u003EСегодня расскажу на наглядных примерах, как мы перестраивали модель под наши классы, обучали её и выделяли паттерны распознавания картинок. Технические подробности — под катом.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3d9\u002F2b4\u002F678\u002F3d92b46781695b6ccf2e69c5b4b4fe3c.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3d9\u002F2b4\u002F678\u002F3d92b46781695b6ccf2e69c5b4b4fe3c.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"обработка данных"},{"titleHtml":"машинное обучение"},{"titleHtml":"python"},{"titleHtml":"machine learning"},{"titleHtml":"data engineering"},{"titleHtml":"классификация изображений"},{"titleHtml":"нейросети"},{"titleHtml":"классификатор данных"},{"titleHtml":"data science"}]},"580516":{"id":"580516","timePublished":"2021-09-28T14:25:12+00:00","isCorporative":false,"lang":"ru","titleHtml":"Лучший язык программирования","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"8114","alias":"markshevchenko","fullname":"Марк Шевченко","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb16\u002F6c1\u002Fc82\u002Fb166c1c82387bf9406fcd39f40dc264e.jpg","speciality":"программист"},"statistics":{"commentsCount":87,"favoritesCount":182,"readingCount":39565,"score":154,"votesCount":168},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВопрос, который часто задают начинающие программисты&nbsp;— какой язык программирования изучать? Вопрос звучит разумно. Хочется выбрать самый лучший, чтобы потом не пришлось переучиваться.\u003C\u002Fp\u003E\u003Cp\u003EМожно ли на него ответить?\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"образование"},{"titleHtml":"языки программирования"}]},"580534":{"id":"580534","timePublished":"2021-09-28T16:33:56+00:00","isCorporative":false,"lang":"ru","titleHtml":"Виниловый проигрыватель своими руками","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"365505","alias":"Gromushka","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":61,"favoritesCount":21,"readingCount":6927,"score":15,"votesCount":25},"hubs":[{"relatedData":null,"id":"21976","alias":"DIY","type":"collective","title":"DIY или Сделай сам","titleHtml":"DIY или Сделай сам","isProfiled":false},{"relatedData":null,"id":"21988","alias":"sound","type":"collective","title":"Звук","titleHtml":"Звук","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EДля многих старый звук с пластинок - это ностальгия. Кому-то нравится просто вид вращающегося диска, другим нравится пощелкивание и поскрипывание в процессе проигрывания. \u003C\u002Fp\u003E\u003Cp\u003EСовременные пластмассовые балалайки - не выдерживают критики, редкие модели можно использовать действительно для извлечения звука, а не стонов. Более интересные модели - слишком дороги, а винтаж стар и требует внимания, кроме того, не каждый винтаж хорош, а действительно интересные предложения совсем не дешевые. \u003C\u002Fp\u003E\u003Cp\u003EА вот сделать самому, используя не сильно большой бюджет - вертушку с хорошими возможностями и всеми необходимыми функциями - это интересно. \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2a1\u002F9a0\u002F730\u002F2a19a073018436be3f5821b68c8cbe9f.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"винил"},{"titleHtml":"аудио"},{"titleHtml":"винтаж"},{"titleHtml":"звук"},{"titleHtml":"сделай сам"},{"titleHtml":"проигрыватель винила"},{"titleHtml":"проигрыватель пластинок"}]},"580560":{"id":"580560","timePublished":"2021-09-28T18:48:12+00:00","isCorporative":false,"lang":"ru","titleHtml":"Интересное применение WordCloud","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2784957","alias":"Arsem","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":0,"favoritesCount":16,"readingCount":1045,"score":12,"votesCount":12},"hubs":[{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИспользование WordCloud для создания облака слов из переписки.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2e2\u002Ff0f\u002F65b\u002F2e2f0f65b10692ce0e8e90d0b39459c6.jpeg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"wordcloud"}]},"580572":{"id":"580572","timePublished":"2021-09-29T03:42:38+00:00","isCorporative":false,"lang":"ru","titleHtml":"Байконур, часть 4: МИК «Протонов»","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"368687","alias":"lozga","fullname":"Филипп Терехов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F817\u002F6fa\u002Fd6b\u002F8176fad6ba9b8839f4372de9d0187146.png","speciality":"Тестировщик и популяризатор космонавтики"},"statistics":{"commentsCount":1,"favoritesCount":5,"readingCount":3841,"score":16,"votesCount":16},"hubs":[{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EУже после того, как модуль \"Наука\" отправился на старт, мы получили возможность зайти в монтажно-испытательный комплекс (МИК), где его устанавливали на ракету-носитель. Нам несколько раз говорили, что мы стали первыми посторонними посетителями этого МИКа. И по количеству просьб не снимать эта локация заняла первое место со значительным отрывом.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F707\u002Fc87\u002Fa1c\u002F707c87a1cd773efcc1e03242fdd40502.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F707\u002Fc87\u002Fa1c\u002F707c87a1cd773efcc1e03242fdd40502.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Космодром Байконур"},{"titleHtml":"ракеты-носители"},{"titleHtml":"ракета &quot;Протон&quot;"},{"titleHtml":"репортаж"},{"titleHtml":"экскурсия"}]},"580582":{"id":"580582","timePublished":"2021-09-29T06:19:53+00:00","isCorporative":false,"lang":"ru","titleHtml":"Конфиденциальность пользователей Telegram снова нарушена. Представители мессенджера требуют не раскрывать подробностей","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1800409","alias":"ne555","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":71,"favoritesCount":28,"readingCount":29276,"score":181,"votesCount":191},"hubs":[{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"92","alias":"instant_messaging","type":"collective","title":"Мессенджеры","titleHtml":"Мессенджеры","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ конце февраля 2021 года выходит обновленный релиз клиента Telegram с заголовком: ‘\u003Cem\u003EАвтоудаление, виджеты и временные ссылки для приглашений’.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EНа красивой, художественной \u003Ca href=\"https:\u002F\u002Ftelegram.org\u002Ffile\u002F464001519\u002F2\u002Fpw2YpXpzBFk.222382\u002F9ec672b0125c50ad34\" rel=\"noopener noreferrer nofollow\"\u003Eобложке\u003C\u002Fa\u003E к пресс-релизу новой верси Tg-мессенджера пользователи видят корзину с таймером и уничтоженными данными, а так же лицезреют главных героев из культового хакерского сериала \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9C%D0%B8%D1%81%D1%82%D0%B5%D1%80_%D0%A0%D0%BE%D0%B1%D0%BE%D1%82#%D0%9D%D0%B0%D0%B3%D1%80%D0%B0%D0%B4%D1%8B_%D0%B8_%D0%BD%D0%BE%D0%BC%D0%B8%D0%BD%D0%B0%D1%86%D0%B8%D0%B8\" rel=\"noopener noreferrer nofollow\"\u003EМистер Робот\u003C\u002Fa\u003E. Но действительно ли все так круто с зачисткой следов как и в сериале? Подробности об одной щекотливой bug bounty в этой статье.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1e9\u002F2a3\u002F6cc\u002F1e92a36cc8aeb8ec3f80bd8c3dd26b44.jpeg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1e9\u002F2a3\u002F6cc\u002F1e92a36cc8aeb8ec3f80bd8c3dd26b44.jpeg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"telegram"},{"titleHtml":"уязвимость"}]},"580588":{"id":"580588","timePublished":"2021-09-29T07:57:53+00:00","isCorporative":true,"lang":"ru","titleHtml":"Техподдержка без бюрократии: автоматизации под капотом ServiceDesk Яндекса","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2792513","alias":"arvidasgafiulin","fullname":"Арвидас Гафиулин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F463\u002Fe51\u002Ff5d\u002F463e51f5d7d8eaf0704e3db17fdee1e5.jpg","speciality":"Руководитель отдела эксплуатации и развития"},"statistics":{"commentsCount":6,"favoritesCount":10,"readingCount":1397,"score":17,"votesCount":17},"hubs":[{"relatedData":null,"id":"4991","alias":"yandex","type":"corporative","title":"Блог компании Яндекс","titleHtml":"Блог компании Яндекс","isProfiled":false},{"relatedData":null,"id":"17739","alias":"crm","type":"collective","title":"CRM-системы","titleHtml":"CRM-системы","isProfiled":true},{"relatedData":null,"id":"19369","alias":"service_desk","type":"collective","title":"Service Desk","titleHtml":"Service Desk","isProfiled":true},{"relatedData":null,"id":"21904","alias":"office","type":"collective","title":"Офисы IT-компаний","titleHtml":"Офисы IT-компаний","isProfiled":false},{"relatedData":null,"id":"22026","alias":"itcompanies","type":"collective","title":"IT-компании","titleHtml":"IT-компании","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Привет! Меня зовут Арвидас Гафиулин, я руководитель отдела эксплуатации и развития ИТ-инфраструктуры в Яндексе. Важнейшее направление работы отдела — наша внутренняя служба поддержки, ServiceDesk. Именно команда SD отвечает за то, чтобы у сотрудников компании была возможность работать из офиса или на удалёнке со всеми необходимыми доступами, оборудованием и комфортом. В среднем служба получает 10 тысяч запросов каждую неделю и постоянно работает над тем, чтобы решать их качественнее и быстрее, а также предотвращать новые инциденты, устраняя корни проблем. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nМы уже писали на Хабр о том, как работает \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fyandex\u002Fblog\u002F487078\u002F\"\u003Eвендомат ServiceDesk\u003C\u002Fa\u003E, выдающий расходники и компьютерные аксессуары без согласований и бумажек, а сегодня расскажем, как выглядит работа службы изнутри и какие технические решения живут у ServiceDesk «под капотом», помогая нам автоматизировать львиную долю задач. Добро пожаловать под кат, если вам интересно, откуда техподдержка знает, кому уже пора апгрейдить технику, а кому придётся ещё немного подождать, у кого устарела версия ОС или доживает последние дни жёсткий диск, какие автоматизации мы можем создавать на основе пользовательских данных, а главное — от скольких часов ожидания и кругов согласований это избавляет сотрудников Яндекса.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fao\u002Fg-\u002Fgv\u002Faog-gvbfx0gynbv_nderxmcmooi.jpeg\"\u003E\u003Cbr\u003E\r\n\u003Csup\u003EWelcome-зона службы ИТ-поддержки в одном из офисов\u003C\u002Fsup\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"служба поддержки"},{"titleHtml":"service desk"},{"titleHtml":"автоматизация"},{"titleHtml":"data lake"},{"titleHtml":"crm"},{"titleHtml":"api"}]},"580604":{"id":"580604","timePublished":"2021-09-29T08:11:26+00:00","isCorporative":false,"lang":"ru","titleHtml":"Поговорим о высшем образовании, требованиях и ожиданиях","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"56016","alias":"onlinehead","fullname":"Anton Kostenko","avatarUrl":"","speciality":"DevOps\u002FSRE"},"statistics":{"commentsCount":18,"favoritesCount":13,"readingCount":2718,"score":14,"votesCount":18},"hubs":[{"relatedData":null,"id":"20696","alias":"study","type":"collective","title":"Учебный процесс в IT","titleHtml":"Учебный процесс в IT","isProfiled":false},{"relatedData":null,"id":"20740","alias":"career","type":"collective","title":"Карьера в IT-индустрии","titleHtml":"Карьера в IT-индустрии","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EОчень много комментариев собрал \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\u002Fhttps:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eпост\u003C\u002Fa\u003E молодого человека, первокурсника, пришедшего учиться на \"программиста\", но получившего несколько не то, что он ожидал. Я сам 15 лет назад поступил в региональный университет на \"айтишную\" специальность и мне это близко. \u003C\u002Fp\u003E\u003Cp\u003EКак это обычно и бывает для постов, поднявших весьма больную тему, комментарии оказались как бы не интереснее самого поста. \u003C\u002Fp\u003E\u003Cp\u003EВ них эдаким лейтмотивом проходит несколько мыслей, которые я бы и хотел выделить, обсудить и в некотором роде постараться опровергнуть или, как минимум, поставить под сомнение.\u003C\u002Fp\u003E\u003Cp\u003EЯ заранее извиняюсь у авторов комментариев за то, что не буду упоминать их ники. Одна и та же мысль могла быть высказана десятки раз в разных формах и я не вижу никакой разумной возможности найти и упомянуть их всех, поэтому ограничусь или переформулированной идеей, или небольшой прямой цитатой там, где это совершенно необходимо.\u003C\u002Fp\u003E\u003Cp\u003EАналогично, я оговорюсь, что в некоторых ВУЗах все может быть по-другому. Частные случаи хорошо подсвечивают проблему, но никак не отменяют её наличия.\u003C\u002Fp\u003E\u003Cp\u003EКроме этого, я бы не хотел рассуждать о причинах проблем и\\или предлагать какие-либо способы решения. Но, конечно же, это всегда можно обсудить в комментариях.\u003C\u002Fp\u003E\u003Cp\u003EИтак, примем к рассмотрению следующие тезисы, которые достаточно массово высказывались в комментариях:\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3a1\u002Fe0c\u002F854\u002F3a1e0c854b5d502922bcbb9528301fc1.jpg","buttonTextHtml":"Три тезиса, о которых мы поговорим","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3a1\u002Fe0c\u002F854\u002F3a1e0c854b5d502922bcbb9528301fc1.jpg","fit":"cover","positionY":89.772727272727,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"высшее образование"},{"titleHtml":"проблемы образования"},{"titleHtml":"проблемы профессии it"},{"titleHtml":"образование в ит"},{"titleHtml":"образование в it"},{"titleHtml":"образование"},{"titleHtml":"государство"},{"titleHtml":"государственные учереждения"}]},"580618":{"id":"580618","timePublished":"2021-09-29T08:38:40+00:00","isCorporative":false,"lang":"ru","titleHtml":"Заметки о дельта-роботе. Часть 1. Историческая справка и обзор научных работ","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2647083","alias":"multiengineer","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":1,"favoritesCount":6,"readingCount":947,"score":11,"votesCount":11},"hubs":[{"relatedData":null,"id":"19309","alias":"lib","type":"collective","title":"Профессиональная литература","titleHtml":"Профессиональная литература","isProfiled":false},{"relatedData":null,"id":"19735","alias":"robo_dev","type":"collective","title":"Разработка робототехники","titleHtml":"Разработка робототехники","isProfiled":true},{"relatedData":null,"id":"21902","alias":"robot","type":"collective","title":"Робототехника","titleHtml":"Робототехника","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭтой публикацией я начинаю цикл статей о дельта-роботе. Здесь поговорим об истории этого механизма и я расскажу немного об интересных работах по этой тематике. В следующих статьях будут материалы, посвящённые его теоретическому анализу, построению рабочей зоны, выбору приводов, конструированию, изготовлению, сборке и созданию системы управления.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd7f\u002Fe6f\u002Fa2e\u002Fd7fe6fa2ea118b8426f3aa4c479345e2.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd7f\u002Fe6f\u002Fa2e\u002Fd7fe6fa2ea118b8426f3aa4c479345e2.png","fit":"cover","positionY":0,"positionX":60.128205128205}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дельта-робот"},{"titleHtml":"манипулятор"},{"titleHtml":"робототехника"},{"titleHtml":"роботостроение"}]},"580620":{"id":"580620","timePublished":"2021-09-29T09:30:34+00:00","isCorporative":false,"lang":"ru","titleHtml":"Членимая калейдоскопическая сложность. Об устройстве и потенциале фасеточного глаза","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2534007","alias":"OlegSivchenko","fullname":"Олег Сивченко","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F27b\u002Ff35\u002Ff6f\u002F27bf35f6f595fc136b70c384752ba387.jpg","speciality":"Переводчик, PM, автор, просветитель-любитель"},"statistics":{"commentsCount":3,"favoritesCount":11,"readingCount":1464,"score":11,"votesCount":13},"hubs":[{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21912","alias":"biotech","type":"collective","title":"Биотехнологии","titleHtml":"Биотехнологии","isProfiled":false},{"relatedData":null,"id":"21946","alias":"video_tech","type":"collective","title":"Видеотехника","titleHtml":"Видеотехника","isProfiled":false},{"relatedData":null,"id":"21968","alias":"physics","type":"collective","title":"Физика","titleHtml":"Физика","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНекоторое время назад я планировал разместить здесь откровенно антирелигиозную статью и пройтись по излюбленному примеру креационистов, связанному с \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9D%D0%B5%D1%87%D0%BB%D0%B5%D0%BD%D0%B8%D0%BC%D0%B0%D1%8F_%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D1%8C\" rel=\"noopener noreferrer nofollow\"\u003Eнечленимой сложностью\u003C\u002Fa\u003E. Я хотел разобрать казус с отказом признавать эволюцию глаз, но обнаружил на Хабре \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F387101\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eпревосходную статью\u003C\u002Fa\u003E Вячеслава Пуговкина @\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fusers\u002Fra3vdx\u002F\" rel=\"noopener noreferrer nofollow\"\u003Era3vdx\u003C\u002Fa\u003E, в которой разобрана именно эта проблема. Поэтому я решил изменить акценты и развернуть не менее интересную тему: рассказать об устройстве и бионическом потенциале фасеточного глаза. Давайте об этом поговорим – и начну я, пожалуй, с ваятельницы Лин, главной героини гротескного романа, написанного Чайной Мьевилем. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbd1\u002Fe25\u002F23a\u002Fbd1e2523aa1cbf2a4cf144122e6f1382.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbd1\u002Fe25\u002F23a\u002Fbd1e2523aa1cbf2a4cf144122e6f1382.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"бионика"},{"titleHtml":"фотоника"},{"titleHtml":"омматидии"},{"titleHtml":"оптика"},{"titleHtml":"обработка изображений"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["580582","580516","580034","579972","579530","580392","578690","578788","579626","580118","580588","580572","580534","580604","579960","579106","580560","580296","580620","580618"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":3},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["535594","482398","466697"],"similarListRefs":{"466697":{"id":"466697","timePublished":"2019-09-09T16:01:01+00:00","isCorporative":false,"lang":"ru","titleHtml":"Монады в Erlang","editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"431026","alias":"mr_elzor","fullname":"Максим Молчанов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5e8\u002F812\u002Fdd9\u002F5e8812dd98b9135ac792907e22e66cd4.jpg","speciality":"Senior Software Engineer, MS, PGCHE"},"statistics":{"commentsCount":5,"favoritesCount":27,"readingCount":4352,"score":19,"votesCount":19},"hubs":[{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"id":"8238","alias":"erlang","type":"collective","title":"Erlang\u002FOTP","titleHtml":"Erlang\u002FOTP","isProfiled":true},{"id":"17853","alias":"funcprog","type":"collective","title":"Функциональное программирование","titleHtml":"Функциональное программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fuu\u002F-w\u002Fxm\u002Fuu-wxmn1samfdcrveqdv27zpvvm.jpeg\"\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EНа Хабре можно найти много публикаций, раскрывающих как теорию монад, так и практику их применения. Большинство этих статей ожидаемо про Haskell. Я не буду в n-й раз пересказывать теорию. Сегодня мы поговорим про некоторые проблемы Erlang, способы их решения с помощью монад, частичного применения функций и синтаксического сахара из \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Frabbitmq\u002Ferlando\"\u003Eerlando\u003C\u002Fa\u003E – классной библиотеки от команды RabbitMQ. \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"status":"published","plannedPublishTime":null,"checked":null},"482398":{"id":"482398","timePublished":"2019-12-29T14:22:23+00:00","isCorporative":false,"lang":"ru","titleHtml":"Логическая репликация из PostgreSQL в Erlang","editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2245630","alias":"mish_gun","fullname":"Mikhail Kalashnikov","avatarUrl":null,"speciality":"Software Engineer"},"statistics":{"commentsCount":4,"favoritesCount":26,"readingCount":4394,"score":20,"votesCount":22},"hubs":[{"id":"358","alias":"postgresql","type":"collective","title":"PostgreSQL","titleHtml":"PostgreSQL","isProfiled":true},{"id":"8238","alias":"erlang","type":"collective","title":"Erlang\u002FOTP","titleHtml":"Erlang\u002FOTP","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EДовольно типичная схема при разработке системы, когда основная логика обработки сосредоточена в приложении (в нашем случае Erlang), а данные для работы этого приложения (настройки, профили пользователей и т. д.) в базе данных (PostgreSQL). Приложение Erlang кэширует настройки в ETS для ускорения обработки и снижения нагрузки на БД путём отказа от постоянных запросов. При этом изменение этих данных происходит через отдельный (возможно, внешний) сервис. \u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ таких ситуациях встаёт задача поддержания закэшированных данных в актуальном состоянии. Есть разные подходы для решения этой задачи. Один из них — это логическая репликация PostgreSQL. О нем и пойдёт речь ниже.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null},"535594":{"id":"535594","timePublished":"2020-12-30T07:00:05+00:00","isCorporative":false,"lang":"ru","titleHtml":"Отправляем SMS из Erlang\u002FElixir. Короткая инструкция","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"431026","alias":"mr_elzor","fullname":"Максим Молчанов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5e8\u002F812\u002Fdd9\u002F5e8812dd98b9135ac792907e22e66cd4.jpg","speciality":"Senior Software Engineer, MS, PGCHE"},"statistics":{"commentsCount":3,"favoritesCount":19,"readingCount":3277,"score":11,"votesCount":11},"hubs":[{"id":"8238","alias":"erlang","type":"collective","title":"Erlang\u002FOTP","titleHtml":"Erlang\u002FOTP","isProfiled":true},{"id":"17853","alias":"funcprog","type":"collective","title":"Функциональное программирование","titleHtml":"Функциональное программирование","isProfiled":true},{"id":"20906","alias":"elixirphoenix","type":"collective","title":"Elixir\u002FPhoenix","titleHtml":"Elixir\u002FPhoenix","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffp\u002Ffz\u002Ftj\u002Ffpfztjgjnclwk_ylpwhcjldk8sc.jpeg\"\u003E\u003Cbr\u003E\r\nPhoto by \u003Ca href=\"https:\u002F\u002Funsplash.com\u002F@scienceinhd\" rel=\"nofollow\"\u003EScience in HD\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EЕсли вам когда-либо приходилось решать задачу отправки SMS из кода вашего приложения, скорее всего, вы использовали готовое REST API поставщика дополнительных услуг. Но что происходит после того, как поставщик получит ваш запрос? Какие протоколы используются и какой путь проходит текст сообщения, прежде чем оказаться на экране мобильного терминала пользователя?\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВ этой статье вы найдёте:\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EНемного теории и терминологии SMPP-протокола: SMSC, ESME, PDU, MO\u002FMT SM.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКраткий обзор существующих библиотек для работы с SMPP в Erlang\u002FElixir.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002FElzor\u002Fsmpp_in_erlang\" rel=\"nofollow\"\u003EПример реализации\u003C\u002Fa\u003E асинхронного клиента при помощи библиотеки \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ffunbox\u002Fsmppex\" rel=\"nofollow\"\u003ESMPPEX\u003C\u002Fa\u003E. Возможно, он будет полезен тем, кто ещё не использовал Elixir-библиотеки в Erlang-проектах.\u003C\u002Fli\u003E\r\n\u003Cli\u003EИнформацию по обработке deliver_sm, MO SM.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u003E\r\n\u003Cp\u003EЧего тут точно нет, так это информации по отправке коротких сообщений через SIGTRAN.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"cursed":{"scoreStats":{"score":102.7,"votesCount":152},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"60428","alias":"cursed","fullname":"Андрей Кондратович","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fee2\u002Fd9d\u002F439\u002Fee2d9d439b8e4ca737f1119d22a63601.png","speciality":null}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
