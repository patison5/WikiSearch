<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Java-ассемблер, мета-программирование и JPA / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/91239\/"},"headline":"Java-ассемблер, мета-программирование и JPA","datePublished":"2010-04-17T01:29:35+04:00","dateModified":"2010-04-18T05:29:15+04:00","author":{"@type":"Person","name":"Сергей Владимиров"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"В этом топике хочу поделиться первым опытом по написанию системы генерации кода &laquo;на лету&raquo;. В коде реализуются некоторые идеи, описанные в предыдущем топике, а са...","url":"https:\/\/habr.com\/ru\/post\/91239\/#post-content-body","about":["h_java","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/91239\/c6e2b9b04feed86b8c68cf939c1901e4\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Java-ассемблер, мета-программирование и JPA" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Java-ассемблер, мета-программирование и JPA" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Java-ассемблер, мета-программирование и JPA" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные в предыдущем топике, а сам код используется в одной старой, но..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные в предыдущем топике, а сам код используется в одной старой, но..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные в предыдущем топике, а сам код используется в одной старой, но..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные в предыдущем топике, а сам код используется в одной старой, но..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные в предыдущем топике, а сам код используется в одной старой, но..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/91239/c6e2b9b04feed86b8c68cf939c1901e4/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/91239/c6e2b9b04feed86b8c68cf939c1901e4/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/91239/c6e2b9b04feed86b8c68cf939c1901e4/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/91239/c6e2b9b04feed86b8c68cf939c1901e4/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/91239/c6e2b9b04feed86b8c68cf939c1901e4/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="91239" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2010-04-16T21:29:35.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/91239/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/91239/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/91239/c6e2b9b04feed86b8c68cf939c1901e4/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/vlsergey/" title="vlsergey" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.cee85629.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/vlsergey/" class="tm-user-info__username">
      vlsergey
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2010-04-16T21:29:35.000Z" title="2010-04-17, 01:29">17  апреля  2010 в 01:29</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Java-ассемблер, мета-программирование и JPA</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/java/" class="tm-article-snippet__hubs-item-link"><span>Java</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные <a href="http://habrahabr.ru/blogs/java/90528/">в предыдущем топике</a>, а сам код используется в одной старой, но работающей <a href="https://sourceforge.net/projects/arpsite/">системе управления сайтами</a>.<br/>
<br/>
Краткая постановка задачи:<br/>
<ul>
<li>Есть набор виртуальных «классов» в понятии бизнес-пользователя. Например, «сайт», «папка», «новость», и т.д. Каждый из таких классов имеет набор полей (аттрибутов).</li>
<li>Пока что у нас нет наследования классов, а поля ограничены примитивными String/Integer/Long/Enum/Boolean, даже без multiple, но с возможными заданными значениями по умолчанию</li>
<li>Каждый класс записывается в отдельную таблицу, например, objects_sites, objects_news, objects_folder, etc. Таблица всегда содержит ID объекта, а также колонки для полей.</li>
<li>Нужно сделать так, чтобы загрузка этих объектов работала через JPA (Hibernate), с использованием необходимого кэширования/транзакций/Lazy-loading'а и других вкусностей, которые нам даёт JPA.</li>
</ul><br/>
Для выполнения данной задачи использовалось:<br/>
<ul>
<li>В качестве баз данных — MySQL 5.0, InnoDB, три схемы базы данных (разные типы могут лежать в разных схемах, чтобы отделить системные типы от пользовательских)</li>
<li>Sun JDK 6.0 </li>
<li><a href="http://tomcat.apache.org/tomcat-6.0-doc/">Tomcat 6 </a>+ <a href="http://wiki.jotm.ow2.org/xwiki/bin/view/News/JOTM_2_1_9">JOTM 2.1.9</a> + <a href="http://in.relation.to/Bloggers/Hibernate350FinalRelease">Hibernate 3.5.0-Final</a> (<a href="http://arpsite.svn.sourceforge.net/viewvc/arpsite/trunk/modules/bundles/hibernate-core-patched/">patched</a>)</li>
<li>Для создания классов использовалась связка <a href="http://cglib.sourceforge.net/">CGLib 2.2</a> (входящая в Hibernate) и <a href="http://asm.ow2.org/">ASM 3.2</a> (в Hibernate входит 3.1)</li>
</ul><br/>
<a name="habracut"></a><br/>
<h5>Метамодель</h5><br/>
С чего начать. Начинается всё с построения объектной мета-модели (не путать с бизнес-моделью). Пока решено остановиться на следующей модели:<br/>
<pre>
- Configuration (complex types)
- Type
 -- Simple Type (simpletypetype - string/long/int/enum, enum class)
 -- ComplexType (attributes, some properties)
- Attribute (name, type, some properties, some JPA properties)
</pre><br/>
При этом для тестирования и вообще для красоты сделан класс, который позволяет построить эту конфигурацию из XML Schema (идеология которой и бралась за основу). Например из такой:<br/>
<code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><blockquote><font color="black"><ol>
<li><font color="#0000ff">&lt;?</font><font color="#800000">xml</font> <font color="#ff0000">version</font><font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font><font color="#0000ff">="utf-8"</font> ?<font color="#0000ff">></font></li>
<li><font color="#0000ff">&lt;</font><font color="#800000">xs:schema</font> <font color="#ff0000">xmlns:xs</font><font color="#0000ff">="http://www.w3.org/2001/XMLSchema"</font> <font color="#ff0000">xmlns:meta</font><font color="#0000ff">="http://www.arptek.ru/core/meta"</font></li>
<li>  <font color="#ff0000">targetNamespace</font><font color="#0000ff">="http://www.arptek.ru/core/meta/test"</font><font color="#0000ff">></font></li>
<li> </li>
<li>  <font color="#0000ff">&lt;</font><font color="#800000">xs:complexType</font> <font color="#ff0000">name</font><font color="#0000ff">="Test"</font><font color="#0000ff">></font></li>
<li>    <font color="#0000ff">&lt;</font><font color="#800000">xs:annotation</font><font color="#0000ff">></font></li>
<li>      <font color="#0000ff">&lt;</font><font color="#800000">xs:appinfo</font><font color="#0000ff">></font></li>
<li>        <font color="#0000ff">&lt;</font><font color="#800000">meta:java.interface</font><font color="#0000ff">></font>ru.arptek.meta.SomeInterface<font color="#0000ff">&lt;/</font><font color="#800000">meta:java.interface</font><font color="#0000ff">></font></li>
<li>      <font color="#0000ff">&lt;/</font><font color="#800000">xs:appinfo</font><font color="#0000ff">></font></li>
<li>    <font color="#0000ff">&lt;/</font><font color="#800000">xs:annotation</font><font color="#0000ff">></font></li>
<li>    <font color="#0000ff">&lt;</font><font color="#800000">xs:sequence</font><font color="#0000ff">></font></li>
<li>      <font color="#0000ff">&lt;</font><font color="#800000">xs:element</font> <font color="#ff0000">name</font><font color="#0000ff">="id"</font> <font color="#ff0000">type</font><font color="#0000ff">="xs:int"</font> <font color="#ff0000">meta:jpa</font>.<font color="#ff0000">Id</font><font color="#0000ff">="true"</font> <font color="#0000ff">/></font></li>
<li> </li>
<li>      <font color="#0000ff">&lt;</font><font color="#800000">xs:element</font> <font color="#ff0000">name</font><font color="#0000ff">="string"</font> <font color="#ff0000">type</font><font color="#0000ff">="xs:string"</font> <font color="#0000ff">/></font></li>
<li>      <font color="#0000ff">&lt;</font><font color="#800000">xs:element</font> <font color="#ff0000">name</font><font color="#0000ff">="boolean"</font> <font color="#ff0000">type</font><font color="#0000ff">="xs:boolean"</font> <font color="#0000ff">/></font></li>
<li>      <font color="#0000ff">&lt;</font><font color="#800000">xs:element</font> <font color="#ff0000">name</font><font color="#0000ff">="integer"</font> <font color="#ff0000">type</font><font color="#0000ff">="xs:int"</font> <font color="#0000ff">/></font></li>
<li>      <font color="#0000ff">&lt;</font><font color="#800000">xs:element</font> <font color="#ff0000">name</font><font color="#0000ff">="long"</font> <font color="#ff0000">type</font><font color="#0000ff">="xs:long"</font> <font color="#0000ff">/></font></li>
<li>    <font color="#0000ff">&lt;/</font><font color="#800000">xs:sequence</font><font color="#0000ff">></font></li>
<li>  <font color="#0000ff">&lt;/</font><font color="#800000">xs:complexType</font><font color="#0000ff">></font></li>
<li> </li>
<li><font color="#0000ff">&lt;/</font><font color="#800000">xs:schema</font><font color="#0000ff">></font></li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></blockquote><br/>
</code><br/>
Кстати, обратите внимание на использование дополнительных атрибутов и элементов в пространстве имён «http: // www.arptek.ru/core/meta». Так и только так — дополнительные атрибуты всегда должны быть в отдельном пространстве имён, а элементы — так и вообще помещены в xs:annotation / xs:appinfo. Код, который преобразует эту схему в конфигурацию можно увидеть <a href="http://arpsite.svn.sourceforge.net/viewvc/arpsite/trunk/modules/core/meta/src/main/java/ru/arptek/meta/configuration/XmlSchemaUtils.java?revision=714&amp;view=markup">тут</a>.<br/>
<br/>
<h5>Генерация классов-бинов</h5><br/>
Код по генерации выполняет три задачи:<br/>
<ul>
<li>Генерирует get/set методы для всех атрибутов, с учётом нужных типов. Это нужно для доступа к данным как со стороны Hibernate, так и со стороны кода, который знает о структуре конкретных типов</li>
<li>Также генерирует внутренние классы Fields, экземпляры которых помещаются в коллекцию для каждого объекта. В результате можно работать со списком полей не зная заранее, какие именно поля есть у объекта. Это удобно для написания редакторов объектов (одного на почти все типы).</li>
<li>Также код нужно не забыть снабдить аннотациями для корректной работы JPA</li>
</ul><br/>
Некоторые замечания перед началом разбора кода:<br/>
<ul>
<li>Java является средой исполнения байт-кода. Байт-код является единственным кодом, который понимает Java-машина (почти). Он записан в двоичном виде в файлах классов (*.class). Обычно он получается из Java-файлов (*.java), которые компилируются в байт-код компилятором javac.</li>
<li>Байт код представляет собой набор инструкций, управляющих работой <a href="http://www.osp.ru/os/1999/01/179635/_p1.html">стековой машины</a>. Инструкции включают загрузку локальных переменных, констант, полей класса в стек, операции над ними (арифметические, логические, преобразования типов), вызов методов классов и интерфейсов.</li>
<li>Любая операция выполняется над тем, что уже есть в стеке. Вы хотите сложить два числа? они должны быть помещены в стек. Вызвать метод объекта? Ссылка на объект и его параметры должны быть помещены в стек.</li>
<li>Сложные объекты помещаются в «кучу», а в стек кладётся лишь указатель на объект. Надеюсь, вы хорошо учили C/C++ :-) </li>
</ul><br/>
Нам потребуется знание того, как выполнить простые операции, соответствующие тому или иному Java-коду на языке ассемблера. Например, команда<br/>
<pre>return this.a;</pre><br/>
должна быть преобразована в следующий код:<br/>
<pre>
    0  aload_0
    1  getfield имякласса.a
    4  lreturn
</pre><br/>
При этом конкретные коды операций зависят от того, какие типы имеют аргументы. Для int/boolean/long используются разные коды операций. Но хорошо то, что CGLib и ASM скрывают от нас данные особенности реализации Java-машины и сами контролируют, какие именно типы имеют аргументы и какие коды операций нужно использовать. Например, если мы определили переменную:<br/>
<pre> ce.declare_field(Constants.ACC_PROTECTED, fieldName, type, null);</pre><br/>
То CGLib/ASM запомнят её тип, и, когда мы будет генерировать код с помощью команд<br/>
<pre>
    codeEmitter.load_this(); 
    codeEmitter.getfield(constantName); 
    codeEmitter.return_value(); 
</pre><br/>
Сгенерированный код будет иметь именно те операнды, которые работают с заданным нами типом переменной. Итак, возврат значения поля класса было выше. Точнее, этот код можно разбить на две части. Помещение значения поля в стек:<br/>
<pre>
    codeEmitter.load_this(); 
    codeEmitter.getfield(constantName); 
</pre><br/>
и возврат верхнего значения стека:<br/>
<pre>
    codeEmitter.return_value(); 
</pre><br/>
Помещение в стек первого аргумента функции (для дальнейшего присваивания чему-либо):<br/>
<pre>
    codeEmitter.load_arg(0);
</pre><br/>
НО! Проблема в том, что при выполнении операции putfield сверху стека должно быть значение, а ниже — ссылка на объект-владелец поля. Поэтому сначала мы получаем ссылку на объект, потом добавляем аргумент в стек, а уже потом — присваиваем значение полю:<br/>
<pre>
         codeEmitter.load_this(); 
         codeEmitter.load_arg(0); 
         codeEmitter.putfield(fieldName); 
         codeEmitter.return_value(); 
</pre><br/>
Вызов метода. Для этого в стеке должны быть ссылка на объект и аргументы (аргументы сверху):<br/>
<pre>
                codeEmitter.invoke_virtual(parentClass, new Signature(
                        getterName, fieldValueType, TYPES_EMPTY));
</pre><br/>
При этом для вызова статических методов используется invoke_static, для вызовов методов, которые определены в интерфейсе (parentClass — интерфейс) используется invoke_interface, а для вызова конструктора — invoke_special (где имя метода — "&lt;init>"). Кстати, создание объекта и вызов конструктора — это разные операции, и они вполне могут быть разделены чем-нибудь. Вот, например, создание LinkedHashMap:<br/>
<pre>
        Local local = e.make_local(TYPE_LINKED_HASH_MAP);

        e.new_instance(TYPE_LINKED_HASH_MAP);
        e.dup();
        e.push(fieldClasses.size());
        e.push(10);
        e.push(1f);
        e.invoke_constructor(TYPE_LINKED_HASH_MAP, SIG_MAP_INIT_INT_FLOAT);
        e.store_local(local);
</pre><br/>
Подготавливаем локальную переменную, где будем хранить map. После чего создаём новый объект в куче (выделяем ему память). Далее дублируем верхний аргумент стека операцией dup() — так как после вызова конструктора одна из ссылок уйдёт, а нам ещё сохранять значение нужно. Помещаем также в стек аргументы вызова конструктора (чётко соблюдая тип, автоконвертация int->float тут не сработает), и вызываем конструктор с помощью invoke_constructor (он будет преобразован в invoke_special). В последней строке — сохраняем результат в локальную переменную. После этого у нас стек — пустой.<br/>
<br/>
Итак, генерация класса:<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li>ClassWriter cw = <font color="#0000ff">new</font> DebuggingClassWriter(</li>
<li>    ClassWriter.COMPUTE_FRAMES);</li>
<li>ClassEmitter ce = <font color="#0000ff">new</font> ClassEmitter(cw);</li>
<li> </li>
<li>Type[] interfaces = getInterfacesTypes(complexType);</li>
<li> </li>
<li>ce.begin_class(Constants.V1_6, Constants.ACC_PUBLIC, className,</li>
<li>    Type.getType(complexType.getSuperClass()), interfaces,</li>
<li>    Constants.SOURCE_FILE);</li>
<li> </li>
<li><font color="#0000ff">if</font> (complexType.isJpaEntity()) {</li>
<li>  ce.visitAnnotation(ANNOTATION_DESCRIPTOR_ENTITY, <font color="#0000ff">true</font>)</li>
<li>      .visitEnd();</li>
<li>}</li>
<li> </li>
<li><font color="#0000ff">if</font> (StringUtils.isNotEmpty(complexType.getJpaTableName())) {</li>
<li>  final AnnotationVisitor av = ce.visitAnnotation(</li>
<li>      ANNOTATION_DESCRIPTOR_TABLE, <font color="#0000ff">true</font>);</li>
<li>  av.visit(<font color="#A31515">"name"</font>, complexType.getJpaTableName());</li>
<li>  av.visitEnd();</li>
<li>}</li>
<li> </li>
<li>{</li>
<li>  <font color="#0000ff">if</font> (options.generateFieldAccessors) {</li>
<li>    final String fieldsMapFieldName = <font color="#A31515">"$fields$"</font>;</li>
<li> </li>
<li>    ce.declare_field(Constants.ACC_PRIVATE</li>
<li>        | Constants.ACC_FINAL, fieldsMapFieldName,</li>
<li>        TYPE_MAP, <font color="#0000ff">null</font>);</li>
<li> </li>
<li>    generateConstructorWithFieldsInit(mainClass, ce,</li>
<li>        fieldClasses, fieldsMapFieldName);</li>
<li>    generateGetFieldsMethod(ce, fieldsMapFieldName);</li>
<li>    generateGetFieldMethod(ce, fieldsMapFieldName);</li>
<li>  } <font color="#0000ff">else</font> {</li>
<li>    EmitUtils.null_constructor(ce);</li>
<li>  }</li>
<li> </li>
<li>  <font color="#0000ff">for</font> (Attribute attribute : complexType.getAttributes()) {</li>
<li>    processAttribute(ce, attribute);</li>
<li>  }</li>
<li>}</li>
<li>ce.end_class();</li>
<li> </li>
<li>{</li>
<li>  <font color="#0000ff">byte</font>[] bs = cw.toByteArray();</li>
<li>  log.info(<font color="#A31515">"Generated class '"</font> + className + <font color="#A31515">"' of "</font> + bs.length</li>
<li>      + <font color="#A31515">" bytes"</font>);</li>
<li>  result.put(className, bs);</li>
<li>}</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
Первые и последняя строки организуют цепочку ClassEmitter -> ClassWriter -> ByteArrayOutputStream -> bytes. При генерации кода класса мы используем ClassEmitter, для методов — CodeEmitter, а для аннотаций — подобного нет и используется AnnotationVisitor (важно не забывать его также закрывать через visitEnd()).<br/>
<br/>
Для создания класса выбираем ему имя, версию, родительских класс, интерфейсы и прочее, как будто мы пишем обычный класс, но на другом языке. Нужно однако не забывать, что в отличии от обычного Java-кода подобный код вполне может скомпилироваться, но не заработать — ибо вы что-то забыли или не так сделали. Например, забыли добавить код возврата из процедуры… класс сгенерируется, но работать не будет. То есть ошибки в подобном коде отследить на этапе компиляции невозможно и нужно обязательно делать тест-кейсы. Хотя те, кто уже готов к восприятию ассемблера уже знают об этом :)<br/>
<br/>
Строки 11-21 добавляют к классу JPA аннотации  <a href="https://habrahabr.ru/users/entity/" class="user_link">Entity</a> и  <a href="https://habrahabr.ru/users/table/" class="user_link">Table</a>. Важное замечание, которое бы могло сэкономить мне много времени — метод visitAnnotation принимает строку, но не имя класса аннотации, а его description во внутреннем формате Java. Например, для javax.persistence.Entity это будет «Ljavax/persistence/Entity;». Но их можно легко получить с помощью класса Type (он используется чуть ли не в каждой строке):<br/>
<font color="Teal">  1 </font>    <font color="Blue">private</font> <font color="Blue">static</font> <font color="Blue">final</font> String ANNOTATION_DESCRIPTOR_ENTITY = Type.getType( <br/>
<font color="Teal">  2 </font>            Entity.<font color="Blue">class</font>).getDescriptor();<br/>
<br/>
Строка 36 нужна для добавления простого конструктора (другой случай чуть позже). Ну а в цикле 39-41 мы добавляем новые поля, методы get/set и константы значений по умолчанию для каждого из аттрибутов:<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li><font color="#0000ff">if</font> (attribute.getType() instanceof EmptyType)</li>
<li>  <font color="#0000ff">return</font>;</li>
<li> </li>
<li>String fieldName = attribute.getFieldName();</li>
<li>String getterName = attribute.getGetterName();</li>
<li>String setterName = attribute.getSetterName();</li>
<li> </li>
<li>final String javaMethodNamePart = WordUtils.capitalize(</li>
<li>    attribute.getAttrName(), <font color="#0000ff">new</font> <font color="#0000ff">char</font>[] { <font color="#A31515">'_'</font> }).replace(<font color="#A31515">"_"</font>, <font color="#A31515">""</font>);</li>
<li> </li>
<li>final Type type = getTypeFromXmlSchemaTypeName(attribute.getType());</li>
<li> </li>
<li><font color="#0000ff">if</font> (fieldName == <font color="#0000ff">null</font>)</li>
<li>  fieldName = <font color="#A31515">"m$"</font> + StringUtils.uncapitalize(javaMethodNamePart);</li>
<li><font color="#0000ff">if</font> (getterName == <font color="#0000ff">null</font>)</li>
<li>  getterName = <font color="#A31515">"get"</font> + javaMethodNamePart;</li>
<li><font color="#0000ff">if</font> (setterName == <font color="#0000ff">null</font>)</li>
<li>  setterName = <font color="#A31515">"set"</font> + javaMethodNamePart;</li>
<li> </li>
<li>final boolean jpaId = attribute.isJpaId();</li>
<li> </li>
<li>final String strDefaultValue;</li>
<li><font color="#0000ff">if</font> (!jpaId) {</li>
<li>  strDefaultValue = attribute.getStrDefaultValue();</li>
<li>} <font color="#0000ff">else</font> {</li>
<li>  strDefaultValue = <font color="#0000ff">null</font>;</li>
<li>}</li>
<li> </li>
<li><font color="#0000ff">if</font> (strDefaultValue == <font color="#0000ff">null</font>) {</li>
<li>  ce.declare_field(Constants.ACC_PRIVATE, fieldName, type, <font color="#0000ff">null</font>);</li>
<li> </li>
<li>  {</li>
<li>    <font color="#008000">// create getter</font></li>
<li>    CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,</li>
<li>        <font color="#0000ff">new</font> Signature(getterName, type, TYPES_EMPTY),</li>
<li>        TYPES_EMPTY);</li>
<li> </li>
<li>    proceedAttributeJpaColumnName(attribute, codeEmitter);</li>
<li>    proceedAttributeJpaLob(attribute, codeEmitter);</li>
<li>    proceedAttributeJpaId(attribute, codeEmitter);</li>
<li> </li>
<li>    codeEmitter.load_this();</li>
<li>    codeEmitter.getfield(fieldName);</li>
<li>    codeEmitter.return_value();</li>
<li>    codeEmitter.end_method();</li>
<li>  }</li>
<li> </li>
<li>  {</li>
<li>    <font color="#008000">// create null safe setter</font></li>
<li>    CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,</li>
<li>        <font color="#0000ff">new</font> Signature(setterName, Type.VOID_TYPE,</li>
<li>            <font color="#0000ff">new</font> Type[] { type }), TYPES_EMPTY);</li>
<li>    codeEmitter.load_this();</li>
<li>    codeEmitter.load_arg(0);</li>
<li>    codeEmitter.putfield(fieldName);</li>
<li>    codeEmitter.return_value();</li>
<li>    codeEmitter.end_method();</li>
<li>  }</li>
<li>} <font color="#0000ff">else</font> {</li>
<li>  final Object defaultValue = toValue(type, strDefaultValue);</li>
<li>  final String constantName = <font color="#A31515">"DEFAULT_"</font> + fieldName;</li>
<li> </li>
<li>  ce.declare_field(Constants.ACC_PROTECTED | Constants.ACC_FINAL</li>
<li>      | Constants.ACC_STATIC, constantName, type, <font color="#0000ff">null</font>);</li>
<li> </li>
<li>  {</li>
<li>    CodeEmitter staticHook = ce.getStaticHook();</li>
<li>    EmitUtils.push_object(staticHook, defaultValue);</li>
<li>    staticHook.putfield(constantName);</li>
<li>  }</li>
<li> </li>
<li>  ce.declare_field(Constants.ACC_PROTECTED, fieldName, type, <font color="#0000ff">null</font>);</li>
<li> </li>
<li>  {</li>
<li>    <font color="#008000">// create getter</font></li>
<li>    final Signature signature = <font color="#0000ff">new</font> Signature(getterName, type,</li>
<li>        TYPES_EMPTY);</li>
<li>    final CodeEmitter codeEmitter = ce.begin_method(</li>
<li>        Constants.ACC_PUBLIC, signature, TYPES_EMPTY);</li>
<li> </li>
<li>    proceedAttributeJpaColumnName(attribute, codeEmitter);</li>
<li>    proceedAttributeJpaLob(attribute, codeEmitter);</li>
<li> </li>
<li>    codeEmitter.load_this();</li>
<li>    codeEmitter.getfield(fieldName);</li>
<li> </li>
<li>    Label ifNull = codeEmitter.make_label();</li>
<li> </li>
<li>    codeEmitter.ifnull(ifNull);</li>
<li>    {</li>
<li>      codeEmitter.load_this();</li>
<li>      codeEmitter.getfield(fieldName);</li>
<li>      codeEmitter.return_value();</li>
<li>    }</li>
<li>    codeEmitter.mark(ifNull);</li>
<li>    {</li>
<li>      codeEmitter.load_this();</li>
<li>      codeEmitter.getfield(constantName);</li>
<li>      codeEmitter.return_value();</li>
<li>    }</li>
<li>    codeEmitter.end_method();</li>
<li>  }</li>
<li> </li>
<li>  {</li>
<li>    <font color="#008000">// create setter</font></li>
<li>    final Signature signature = <font color="#0000ff">new</font> Signature(setterName,</li>
<li>        Type.VOID_TYPE, <font color="#0000ff">new</font> Type[] { type });</li>
<li>    final CodeEmitter codeEmitter = ce.begin_method(</li>
<li>        Constants.ACC_PUBLIC, signature, TYPES_EMPTY);</li>
<li> </li>
<li>    codeEmitter.load_this();</li>
<li>    codeEmitter.load_arg(0);</li>
<li>    codeEmitter.putfield(fieldName);</li>
<li>    codeEmitter.return_value();</li>
<li>    codeEmitter.end_method();</li>
<li>  }</li>
<li> </li>
<li>}</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
Проверка 1-2 нужна на случай, если поле «пустое». Такие поля позволяют сделать включить в класс атрибут, который не будет сохраняться в той же таблице, а, например, будет сам управлять своим состоянием. В строках 4-18 идёт инициализация переменных и определяются будущие имена для внутренних переменных и методов. Обратите внимание, что для методов и переменных, которые генерируются компьютером, принято использовать знак "$", тогда как в пользовательском коде его рекомендуется избегать. Разумеется, методы get/set оставлены без этого знака, так как они будут вызываться из Hibernate и бизнес-кода.<br/>
<br/>
Для JPA ID не используются значения по умолчанию, поэтому на всякий случай проверим, что его не задали, в строках 23-27. Генерация кода для случая, когда значение по умолчанию задано и нет, различна. Случай, когда его нет, разумеется проще и прямолинейнее — само поле добавляется в класс в строке 30, метод get в строках 32-46, set — 48-58.<br/>
<br/>
Случай же со значениями по умолчанию требует:<br/>
<ul>
<li>Определить константу со значением по умолчанию (строки 60-61)</li>
<li>Причём для сложных типов (а к ним относится и Boolean/Integer/Long) нужно использовать static-код для инициализации констант. Когда мы пишем обычный код это не нужно — ибо компилятор делает это за нас. Но тут нужно сделать это вручную. В строках 66-70 мы и добавляем в StaticHook новые строки. Потом, когда мы закончим работать с классом, все строки из StaticHook будут перенесены в блок static инициализации класса (ну, почти… интересующиеся деталями могут дизассемблировать и посмотреть, что на самом деле там происходит.)</li>
<li>Метод set достаточно простой (строки 104-116)</li>
<li>А вот в методе get я добавил ветвление. Его может и не быть — если вы в конструкторе класса инициализируете переменные значениями по умолчанию (как работать с конструктором — ниже). Но мне хотелось, что если переменная внутри класса установлена в null, то возвращалось бы значение константы. Для организации ветвления мы создаём новую ссылку (label). По ней мы будем осуществлять переход, если значение равно нулю. Потом используем команду условного перехода (строка 89). Ещё раз — мы не проверяем условие прямо сейчас — мы добавляем проверку этого условия в код метода. Если условие выполнено — происходит переход до того места в коде, которое помечего (mark) меткой (строка 95). Если не выполнено — выполняется обычная ветка 91-93. При этом каждая из веток исполнения кода содержит код возврата результирующего значения.</li>
</ul><br/>
<br/>
<h5>Доступ к набору полей</h5><br/>
Код выше успешно (надеюсь) сгенерировал «бин» — класс с полями и методами get/set. Но ещё нужно сгерировать два метода: getField(name) и getFields(). Эти методы должны давать доступ к полям объекта через коллекцию, но при этом не должно быть никакого reflection'а, чтобы не замедлять работу системы вызовом native-методов.<br/>
Для этого для каждого аттрибута объекта мы дополнительно сгенерируем класс, который содержит два метода — getValue() и setValue(), которые делегируют эти вызовы основному классу. Генерация такого класса достаточно простая, но интересная тем, что теперь конструктор класса не пустой, а принимает единственный параметр — ссылку на родительский объект:<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li>    final String holderFieldName = <font color="#A31515">"$parent$"</font>;</li>
<li> </li>
<li>    ce.declare_field(Constants.ACC_PRIVATE | Constants.ACC_FINAL,</li>
<li>        holderFieldName, parentClass, <font color="#0000ff">null</font>);</li>
<li> </li>
<li>    {</li>
<li>      CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC,</li>
<li>          <font color="#0000ff">new</font> Signature(<font color="#A31515">"&lt;init>"</font>, Type.VOID_TYPE,</li>
<li>              <font color="#0000ff">new</font> Type[] { parentClass }), <font color="#0000ff">null</font>);</li>
<li>      e.load_this();</li>
<li>      e.super_invoke_constructor();</li>
<li> </li>
<li>      e.load_this();</li>
<li>      e.load_arg(0);</li>
<li>      e.putfield(holderFieldName);</li>
<li> </li>
<li>      e.return_value();</li>
<li>      e.end_method();</li>
<li>    }</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
<br/>
Сама ссылка сохраняется в переменной $parent$. Методы get/set делаются достаточно просто:<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li>    {</li>
<li>      <font color="#008000">// create getter</font></li>
<li>      CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,</li>
<li>          <font color="#0000ff">new</font> Signature(<font color="#A31515">"getValue"</font>, fieldValueType, TYPES_EMPTY),</li>
<li>          TYPES_EMPTY);</li>
<li> </li>
<li>      codeEmitter.load_this();</li>
<li>      codeEmitter.getfield(holderFieldName);</li>
<li> </li>
<li>      codeEmitter.invoke_virtual(parentClass, <font color="#0000ff">new</font> Signature(</li>
<li>          getterName, fieldValueType, TYPES_EMPTY));</li>
<li> </li>
<li>      codeEmitter.return_value();</li>
<li>      codeEmitter.end_method();</li>
<li>    }</li>
<li> </li>
<li>    {</li>
<li>      <font color="#008000">// create null safe setter</font></li>
<li>      CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,</li>
<li>          <font color="#0000ff">new</font> Signature(<font color="#A31515">"setValue"</font>, Type.VOID_TYPE,</li>
<li>              <font color="#0000ff">new</font> Type[] { fieldValueType }), TYPES_EMPTY);</li>
<li>      codeEmitter.load_this();</li>
<li>      codeEmitter.getfield(holderFieldName);</li>
<li>      codeEmitter.load_arg(0);</li>
<li> </li>
<li>      codeEmitter.invoke_virtual(parentClass, <font color="#0000ff">new</font> Signature(</li>
<li>          setterName, Type.VOID_TYPE,</li>
<li>          <font color="#0000ff">new</font> Type[] { fieldValueType }));</li>
<li> </li>
<li>      codeEmitter.return_value();</li>
<li>      codeEmitter.end_method();</li>
<li>    }</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
<br/>
Эти классы для каждого атрибута генерируются в цикле и сохраняются в Map&lt;Attribute, String=имя класса>:<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li>        ClassWriter cw = <font color="#0000ff">new</font> DebuggingClassWriter(</li>
<li>            ClassWriter.COMPUTE_FRAMES);</li>
<li>        ClassEmitter ce = <font color="#0000ff">new</font> ClassEmitter(cw);</li>
<li> </li>
<li>        String fieldClassName = processAttributeField(className,</li>
<li>            mainClass, ce, attribute);</li>
<li> </li>
<li>        fieldClasses.put(attribute, ce.getClassType());</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
<br/>
Зачем? Чтобы потом в конструкторе родительского класса создать экземпляры дочерних объектов и поместить их во внутреннее поле $fields$:<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> generateConstructorWithFieldsInit(final Type mainClass,</li>
<li>      ClassEmitter ce, Map&lt;Attribute, Type> fieldClasses,</li>
<li>      final String fieldsMapFieldName) {</li>
<li>    CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC, TypeUtils</li>
<li>        .parseConstructor(<font color="#A31515">""</font>), <font color="#0000ff">null</font>);</li>
<li>    e.load_this();</li>
<li>    e.super_invoke_constructor();</li>
<li> </li>
<li>    Local local = e.make_local(TYPE_LINKED_HASH_MAP);</li>
<li> </li>
<li>    e.new_instance(TYPE_LINKED_HASH_MAP);</li>
<li>    e.dup();</li>
<li>    e.push(fieldClasses.size());</li>
<li>    e.push(1f);</li>
<li>    e.invoke_constructor(TYPE_LINKED_HASH_MAP, SIG_MAP_INIT_INT_FLOAT);</li>
<li>    e.store_local(local);</li>
<li> </li>
<li>    <font color="#0000ff">for</font> (Entry&lt;Attribute, Type> fieldTypes : fieldClasses.entrySet()) {</li>
<li>      e.load_local(local);</li>
<li>      e.push(fieldTypes.getKey().getAttrName());</li>
<li> </li>
<li>      <font color="#008000">// = new &lt;...>Field(this);</font></li>
<li>      e.new_instance(fieldTypes.getValue());</li>
<li>      e.dup();</li>
<li>      e.load_this();</li>
<li>      e.invoke_constructor(fieldTypes.getValue(), <font color="#0000ff">new</font> Signature(<font color="#A31515">"&lt;init>"</font>,</li>
<li>          Type.VOID_TYPE, <font color="#0000ff">new</font> Type[] { mainClass }));</li>
<li> </li>
<li>      <font color="#008000">// $fields$.put(fieldName, field);</font></li>
<li>      e.invoke_virtual(TYPE_LINKED_HASH_MAP, SIG_MAP_PUT);</li>
<li>    }</li>
<li> </li>
<li>    e.load_this();</li>
<li>    e.load_local(local);</li>
<li>    e.invoke_static(TYPE_COLLECTIONS, SIG_COLLECTIONS_UNMODIFIABLEMAP);</li>
<li>    e.putfield(fieldsMapFieldName);</li>
<li> </li>
<li>    e.return_value();</li>
<li>    e.end_method();</li>
<li>  }</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
<br/>
В первых строках мы создаём LinkedHashMap (при этом на параметризацию с помощью Generic мы забиваем — её почти нет в ассемблере). Потом наполняем её дочерними объектами Fields, ну а потом, на всякий случай, оборачиваем в Collections.unmodifiableMap и сохраняем в final поле. Кстати, обратите внимание, что последний метод вызывается с помощью invoke_static, и даже конструктор завершается операцией return_value, хотя в соответствии со спецификацией (строки 4-5) возвращает VOID.<br/>
<br/>
Ну и напоследок создадим методы getField(name) и getFields(), не забыв снабдить их аннотацией  <a href="https://habrahabr.ru/users/transient/" class="user_link">Transient</a>, чтобы JPA не думал, что это поля объекта:<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> generateGetFieldMethod(ClassEmitter ce,</li>
<li>      final String fieldsMapFieldName) {</li>
<li>    CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC,</li>
<li>        SIG_FIELDSHOLDER_GETFIELD, <font color="#0000ff">null</font>);</li>
<li>    e.visitAnnotation(ANNOTATION_DESCRIPTOR_TRANSIENT, <font color="#0000ff">true</font>).visitEnd();</li>
<li> </li>
<li>    e.load_this();</li>
<li>    e.getfield(fieldsMapFieldName);</li>
<li> </li>
<li>    e.load_arg(0);</li>
<li> </li>
<li>    e.checkcast(TYPE_OBJECT);</li>
<li>    e.invoke_interface(TYPE_MAP, SIG_MAP_GET);</li>
<li>    e.checkcast(TYPE_FIELD);</li>
<li> </li>
<li>    e.return_value();</li>
<li>    e.end_method();</li>
<li>  }</li>
<li> </li>
<li>  <font color="#0000ff">public</font> <font color="#0000ff">void</font> generateGetFieldsMethod(ClassEmitter ce,</li>
<li>      final String fieldsMapFieldName) {</li>
<li>    CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC,</li>
<li>        SIG_FIELDSHOLDER_GETFIELDS, <font color="#0000ff">null</font>);</li>
<li>    e.visitAnnotation(ANNOTATION_DESCRIPTOR_TRANSIENT, <font color="#0000ff">true</font>).visitEnd();</li>
<li> </li>
<li>    e.load_this();</li>
<li>    e.getfield(fieldsMapFieldName);</li>
<li>    e.return_value();</li>
<li>    e.end_method();</li>
<li>  }</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
<br/>
<h5>Загрузка полученных классов</h5><br/>
После генерации byte[] для каждого класса нужно их загрузить в память. Это делается с помощью определения своего ClassLoader'а (ну или можно сохранить на диск и загрузить оттуда с помощью какого-нибудь URLClassLoader'а):<br/>
<blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a><font color="black"><ol>
<li>  <font color="#0000ff">protected</font> Map&lt;String, Class&lt;?>> loadClasses(</li>
<li>      final Map&lt;String, <font color="#0000ff">byte</font>[]> generated) {</li>
<li> </li>
<li>    final Thread currentThread = Thread.currentThread();</li>
<li>    final ClassLoader classLoader = currentThread.getContextClassLoader();</li>
<li>    final Map&lt;String, Class&lt;?>> classes = <font color="#0000ff">new</font> ClassLoader(classLoader) {</li>
<li>      <font color="#0000ff">protected</font> Map&lt;String, Class&lt;?>> loadClasses() {</li>
<li>        Map&lt;String, Class&lt;?>> result = <font color="#0000ff">new</font> LinkedHashMap&lt;String, Class&lt;?>>(</li>
<li>            generated.size());</li>
<li>        <font color="#0000ff">for</font> (Entry&lt;String, <font color="#0000ff">byte</font>[]> entry : generated.entrySet()) {</li>
<li>          final String className = entry.getKey();</li>
<li>          final <font color="#0000ff">byte</font>[] byteCode = entry.getValue();</li>
<li> </li>
<li>          log.info(<font color="#A31515">"Defining class "</font> + className + <font color="#A31515">"..."</font>);</li>
<li>          final Class&lt;?> cls = defineClass(className, byteCode, 0,</li>
<li>              byteCode.length);</li>
<li>          result.put(cls.getName(), cls);</li>
<li>        }</li>
<li> </li>
<li>        <font color="#0000ff">return</font> result;</li>
<li>      }</li>
<li>    }.loadClasses();</li>
<li>    <font color="#0000ff">return</font> classes;</li>
<li>  }</li>
</ol></font><font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font>.</font></code></blockquote><br/>
Кстати забывать про этот ClassLoader не стоит — он вам понадобится позже, для загрузки этих классов в Hibernate, ибо он не будет работать, если текущий ClassLoader не сможет загрузить те классы, что передаются ему в качестве параметров.<br/>
<br/>
<h5>Использование на практике</h5><br/>
Некоторые ссылки, которые могут быть интересны для дальнейшего изучения:<br/>
<ul>
<li><a href="http://arpsite.svn.sourceforge.net/viewvc/arpsite/trunk/modules/core/infospace/src/main/files/etc/config-infospace.xml?revision=714&amp;view=markup">Пример реальной конфигурации классов</a></li>
<li><a href="http://arpsite.svn.sourceforge.net/viewvc/arpsite/trunk/modules/core/kernel/src/main/java/ru/arptek/arpsite/content/DefaultRegistry.java?revision=749&amp;view=markup">Класс, отвечающий за преобразование конфигурации в meta-configuration, генерацию классов и создание коллекции entityclass'ов</a></li>
<li><a href="http://arpsite.svn.sourceforge.net/viewvc/arpsite/trunk/modules/core/kernel/src/main/java/ru/arptek/arpsite/data/jpa/DefaultEntityManagerHolder.java?revision=748&amp;view=markup">Класс, отвечающий за загрузку EntityFactory</a></li>
<li><a href="http://arpsite.svn.sourceforge.net/viewvc/arpsite/trunk/modules/core/kernel/src/main/java/ru/arptek/arpsite/content/WebObjectFieldsHolderLoader.java?revision=750&amp;view=markup">Класс, отвечающий за загрузку классов из базы данных через JPA</a></li>
<li><a href="http://fvl.fizteh.ru/">Пример сайта, который работает на этом движке</a> (не мой :) )</li>
</ul><br/>
<h5>В результате</h5><br/>
<ul>
<li>Операциями с данными теперь занимается Hibernate. Сам заботится о загрузке и сохранении. Есть поддержка batch-операций по загрузке, поддержка кешей и транзакций. Меньше велосипедов это всегда хорошо.</li>
<li>Кешированием также занимается Hibernate (хотя и на основе нашего clustered soft reference cache). Наблюдать за состоянием кешей можно из JConsole.</li>
<li>Производительность повысилась за счёт оптимизации загрузки данных (возможно batch-загрузки из базы данных сразу нескольких объектов одним SQL-ем)</li>
<li>Бизнес-код стало писать намного удобнее и приятнее :)</li>
</ul></code></div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%5D" class="tm-article-body__tags-item-link">модель данных</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjava%5D" class="tm-article-body__tags-item-link">java</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjpa%5D" class="tm-article-body__tags-item-link">jpa</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bhibernate%5D" class="tm-article-body__tags-item-link">hibernate</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bassembler%5D" class="tm-article-body__tags-item-link">assembler</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bcglib%5D" class="tm-article-body__tags-item-link">cglib</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/java/" class="tm-article-body__tags-item-link">
                  Java
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 42: ↑33 и ↓9</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 42: ↑33 и ↓9" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+24</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    48
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/91239/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      24
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/vlsergey/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_pink"><!----> <use xlink:href="/img/megazord-v24.cee85629.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 228 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    72.7
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><span class="tm-user-card__name">Сергей Владимиров</span> <a href="/ru/users/vlsergey/" class="tm-user-card__nickname">
          @vlsergey
        </a> <!----></div> <p class="tm-user-card__short-info">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/91239/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 24 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-08-12T11:09:54.000Z" title="2021-08-12, 14:09">12  августа   в 14:09</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/haulmont/blog/572574/" class="tm-article-title__link"><span>Kotlin + Hibernate: всё сложно</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 18: ↑16 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 18: ↑16 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+14</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">5.5K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    53
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/haulmont/blog/572574/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      4
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-04-28T13:03:59.000Z" title="2021-04-28, 16:03">28  апреля   в 16:03</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/haulmont/blog/554720/" class="tm-article-title__link"><span>Hibernate и Spring Boot: кто отвечает за имена таблиц?</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 17: ↑16 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 17: ↑16 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+15</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.4K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    43
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/haulmont/blog/554720/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      2
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-04-16T08:11:11.000Z" title="2021-04-16, 11:11">16  апреля   в 11:11</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/551902/" class="tm-article-title__link"><span>Почему следует избегать использования JPA/Hibernate в продакшене</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 28: ↑22 и ↓6</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 28: ↑22 и ↓6" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+16</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">9.1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    80
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/551902/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      24
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T16:41:21.000Z" title="2021-09-27, 19:41">вчера в 19:41</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/lamptest/blog/580228/" class="tm-article-title__link"><span>Идеальная светодиодная лампа за 21 рубль</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 154: ↑152 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 154: ↑152 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+150</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">30K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    112
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/lamptest/blog/580228/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      60
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T13:03:14.000Z" title="2021-09-27, 16:03">вчера в 16:03</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580124/" class="tm-article-title__link"><span>Электролюминесцентные индикаторы из прошлого</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 104: ↑104 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 104: ↑104 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+104</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">8.8K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    43
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580124/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      29
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T12:53:02.000Z" title="2021-09-27, 15:53">вчера в 15:53</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580210/" class="tm-article-title__link"><span>PHP Дайджест № 212 (13 – 27 сентября 2021)</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 54: ↑54 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 54: ↑54 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+54</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">5.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    16
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580210/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      1
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T07:08:30.000Z" title="2021-09-28, 10:08">сегодня в 10:08</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/nlmk/blog/580270/" class="tm-article-title__link"><span>Варим суп из стали: оптимизация логистики ковшей и как устроен цех КЦ № 2</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 39: ↑39 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 39: ↑39 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+39</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    14
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/nlmk/blog/580270/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      14
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T08:07:48.000Z" title="2021-09-28, 11:07">сегодня в 11:07</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/domclick/blog/575686/" class="tm-article-title__link"><span>Когда сделаете доработку?</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 33: ↑33 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 33: ↑33 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+33</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.6K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    18
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/domclick/blog/575686/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      3
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="91239" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/91239/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/91239/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"91239":{"id":"91239","timePublished":"2010-04-16T21:29:35+00:00","isCorporative":false,"lang":"ru","titleHtml":"Java-ассемблер, мета-программирование и JPA","leadData":{"textHtml":"В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные \u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Fjava\u002F90528\u002F\"\u003Eв предыдущем топике\u003C\u002Fa\u003E, а сам код используется в одной старой, но работающей \u003Ca href=\"https:\u002F\u002Fsourceforge.net\u002Fprojects\u002Farpsite\u002F\"\u003Eсистеме управления сайтами\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКраткая постановка задачи:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЕсть набор виртуальных «классов» в понятии бизнес-пользователя. Например, «сайт», «папка», «новость», и т.д. Каждый из таких классов имеет набор полей (аттрибутов).\u003C\u002Fli\u003E\r\n\u003Cli\u003EПока что у нас нет наследования классов, а поля ограничены примитивными String\u002FInteger\u002FLong\u002FEnum\u002FBoolean, даже без multiple, но с возможными заданными значениями по умолчанию\u003C\u002Fli\u003E\r\n\u003Cli\u003EКаждый класс записывается в отдельную таблицу, например, objects_sites, objects_news, objects_folder, etc. Таблица всегда содержит ID объекта, а также колонки для полей.\u003C\u002Fli\u003E\r\n\u003Cli\u003EНужно сделать так, чтобы загрузка этих объектов работала через JPA (Hibernate), с использованием необходимого кэширования\u002Fтранзакций\u002FLazy-loading'а и других вкусностей, которые нам даёт JPA.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nДля выполнения данной задачи использовалось:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EВ качестве баз данных — MySQL 5.0, InnoDB, три схемы базы данных (разные типы могут лежать в разных схемах, чтобы отделить системные типы от пользовательских)\u003C\u002Fli\u003E\r\n\u003Cli\u003ESun JDK 6.0 \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Ftomcat.apache.org\u002Ftomcat-6.0-doc\u002F\"\u003ETomcat 6 \u003C\u002Fa\u003E+ \u003Ca href=\"http:\u002F\u002Fwiki.jotm.ow2.org\u002Fxwiki\u002Fbin\u002Fview\u002FNews\u002FJOTM_2_1_9\"\u003EJOTM 2.1.9\u003C\u002Fa\u003E + \u003Ca href=\"http:\u002F\u002Fin.relation.to\u002FBloggers\u002FHibernate350FinalRelease\"\u003EHibernate 3.5.0-Final\u003C\u002Fa\u003E (\u003Ca href=\"http:\u002F\u002Farpsite.svn.sourceforge.net\u002Fviewvc\u002Farpsite\u002Ftrunk\u002Fmodules\u002Fbundles\u002Fhibernate-core-patched\u002F\"\u003Epatched\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\r\n\u003Cli\u003EДля создания классов использовалась связка \u003Ca href=\"http:\u002F\u002Fcglib.sourceforge.net\u002F\"\u003ECGLib 2.2\u003C\u002Fa\u003E (входящая в Hibernate) и \u003Ca href=\"http:\u002F\u002Fasm.ow2.org\u002F\"\u003EASM 3.2\u003C\u002Fa\u003E (в Hibernate входит 3.1)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":72.7,"votesCount":228},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"42070","alias":"vlsergey","fullname":"Сергей Владимиров","avatarUrl":null,"speciality":"Пользователь"},"statistics":{"commentsCount":24,"favoritesCount":48,"readingCount":8781,"score":24,"votesCount":42},"hubs":[{"relatedData":null,"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EВ этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные \u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Fjava\u002F90528\u002F\"\u003Eв предыдущем топике\u003C\u002Fa\u003E, а сам код используется в одной старой, но работающей \u003Ca href=\"https:\u002F\u002Fsourceforge.net\u002Fprojects\u002Farpsite\u002F\"\u003Eсистеме управления сайтами\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКраткая постановка задачи:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EЕсть набор виртуальных «классов» в понятии бизнес-пользователя. Например, «сайт», «папка», «новость», и т.д. Каждый из таких классов имеет набор полей (аттрибутов).\u003C\u002Fli\u003E\r\n\u003Cli\u003EПока что у нас нет наследования классов, а поля ограничены примитивными String\u002FInteger\u002FLong\u002FEnum\u002FBoolean, даже без multiple, но с возможными заданными значениями по умолчанию\u003C\u002Fli\u003E\r\n\u003Cli\u003EКаждый класс записывается в отдельную таблицу, например, objects_sites, objects_news, objects_folder, etc. Таблица всегда содержит ID объекта, а также колонки для полей.\u003C\u002Fli\u003E\r\n\u003Cli\u003EНужно сделать так, чтобы загрузка этих объектов работала через JPA (Hibernate), с использованием необходимого кэширования\u002Fтранзакций\u002FLazy-loading'а и других вкусностей, которые нам даёт JPA.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nДля выполнения данной задачи использовалось:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EВ качестве баз данных — MySQL 5.0, InnoDB, три схемы базы данных (разные типы могут лежать в разных схемах, чтобы отделить системные типы от пользовательских)\u003C\u002Fli\u003E\r\n\u003Cli\u003ESun JDK 6.0 \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Ftomcat.apache.org\u002Ftomcat-6.0-doc\u002F\"\u003ETomcat 6 \u003C\u002Fa\u003E+ \u003Ca href=\"http:\u002F\u002Fwiki.jotm.ow2.org\u002Fxwiki\u002Fbin\u002Fview\u002FNews\u002FJOTM_2_1_9\"\u003EJOTM 2.1.9\u003C\u002Fa\u003E + \u003Ca href=\"http:\u002F\u002Fin.relation.to\u002FBloggers\u002FHibernate350FinalRelease\"\u003EHibernate 3.5.0-Final\u003C\u002Fa\u003E (\u003Ca href=\"http:\u002F\u002Farpsite.svn.sourceforge.net\u002Fviewvc\u002Farpsite\u002Ftrunk\u002Fmodules\u002Fbundles\u002Fhibernate-core-patched\u002F\"\u003Epatched\u003C\u002Fa\u003E)\u003C\u002Fli\u003E\r\n\u003Cli\u003EДля создания классов использовалась связка \u003Ca href=\"http:\u002F\u002Fcglib.sourceforge.net\u002F\"\u003ECGLib 2.2\u003C\u002Fa\u003E (входящая в Hibernate) и \u003Ca href=\"http:\u002F\u002Fasm.ow2.org\u002F\"\u003EASM 3.2\u003C\u002Fa\u003E (в Hibernate входит 3.1)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch5\u003EМетамодель\u003C\u002Fh5\u003E\u003Cbr\u002F\u003E\r\nС чего начать. Начинается всё с построения объектной мета-модели (не путать с бизнес-моделью). Пока решено остановиться на следующей модели:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n- Configuration (complex types)\n- Type\n -- Simple Type (simpletypetype - string\u002Flong\u002Fint\u002Fenum, enum class)\n -- ComplexType (attributes, some properties)\n- Attribute (name, type, some properties, some JPA properties)\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПри этом для тестирования и вообще для красоты сделан класс, который позволяет построить эту конфигурацию из XML Schema (идеология которой и бралась за основу). Например из такой:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cblockquote\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003E&lt;?\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exml\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Eversion\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"1.0\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Eencoding\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"utf-8\"\u003C\u002Ffont\u003E ?\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:schema\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Exmlns:xs\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"http:\u002F\u002Fwww.w3.org\u002F2001\u002FXMLSchema\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Exmlns:meta\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"http:\u002F\u002Fwww.arptek.ru\u002Fcore\u002Fmeta\"\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#ff0000\"\u003EtargetNamespace\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"http:\u002F\u002Fwww.arptek.ru\u002Fcore\u002Fmeta\u002Ftest\"\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:complexType\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Ename\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"Test\"\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:annotation\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:appinfo\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E        \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Emeta:java.interface\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003Eru.arptek.meta.SomeInterface\u003Cfont color=\"#0000ff\"\u003E&lt;\u002F\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Emeta:java.interface\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003E&lt;\u002F\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:appinfo\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#0000ff\"\u003E&lt;\u002F\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:annotation\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:sequence\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:element\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Ename\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"id\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Etype\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"xs:int\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Emeta:jpa\u003C\u002Ffont\u003E.\u003Cfont color=\"#ff0000\"\u003EId\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"true\"\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003E\u002F\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:element\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Ename\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"string\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Etype\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"xs:string\"\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003E\u002F\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:element\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Ename\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"boolean\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Etype\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"xs:boolean\"\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003E\u002F\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:element\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Ename\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"integer\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Etype\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"xs:int\"\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003E\u002F\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003E&lt;\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:element\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Ename\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"long\"\u003C\u002Ffont\u003E \u003Cfont color=\"#ff0000\"\u003Etype\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E=\"xs:long\"\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003E\u002F\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#0000ff\"\u003E&lt;\u002F\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:sequence\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003E&lt;\u002F\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:complexType\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003E&lt;\u002F\u003C\u002Ffont\u003E\u003Cfont color=\"#800000\"\u003Exs:schema\u003C\u002Ffont\u003E\u003Cfont color=\"#0000ff\"\u003E\u003E\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nКстати, обратите внимание на использование дополнительных атрибутов и элементов в пространстве имён «http: \u002F\u002F www.arptek.ru\u002Fcore\u002Fmeta». Так и только так — дополнительные атрибуты всегда должны быть в отдельном пространстве имён, а элементы — так и вообще помещены в xs:annotation \u002F xs:appinfo. Код, который преобразует эту схему в конфигурацию можно увидеть \u003Ca href=\"http:\u002F\u002Farpsite.svn.sourceforge.net\u002Fviewvc\u002Farpsite\u002Ftrunk\u002Fmodules\u002Fcore\u002Fmeta\u002Fsrc\u002Fmain\u002Fjava\u002Fru\u002Farptek\u002Fmeta\u002Fconfiguration\u002FXmlSchemaUtils.java?revision=714&amp;view=markup\"\u003Eтут\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch5\u003EГенерация классов-бинов\u003C\u002Fh5\u003E\u003Cbr\u002F\u003E\r\nКод по генерации выполняет три задачи:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EГенерирует get\u002Fset методы для всех атрибутов, с учётом нужных типов. Это нужно для доступа к данным как со стороны Hibernate, так и со стороны кода, который знает о структуре конкретных типов\u003C\u002Fli\u003E\r\n\u003Cli\u003EТакже генерирует внутренние классы Fields, экземпляры которых помещаются в коллекцию для каждого объекта. В результате можно работать со списком полей не зная заранее, какие именно поля есть у объекта. Это удобно для написания редакторов объектов (одного на почти все типы).\u003C\u002Fli\u003E\r\n\u003Cli\u003EТакже код нужно не забыть снабдить аннотациями для корректной работы JPA\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nНекоторые замечания перед началом разбора кода:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EJava является средой исполнения байт-кода. Байт-код является единственным кодом, который понимает Java-машина (почти). Он записан в двоичном виде в файлах классов (*.class). Обычно он получается из Java-файлов (*.java), которые компилируются в байт-код компилятором javac.\u003C\u002Fli\u003E\r\n\u003Cli\u003EБайт код представляет собой набор инструкций, управляющих работой \u003Ca href=\"http:\u002F\u002Fwww.osp.ru\u002Fos\u002F1999\u002F01\u002F179635\u002F_p1.html\"\u003Eстековой машины\u003C\u002Fa\u003E. Инструкции включают загрузку локальных переменных, констант, полей класса в стек, операции над ними (арифметические, логические, преобразования типов), вызов методов классов и интерфейсов.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЛюбая операция выполняется над тем, что уже есть в стеке. Вы хотите сложить два числа? они должны быть помещены в стек. Вызвать метод объекта? Ссылка на объект и его параметры должны быть помещены в стек.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСложные объекты помещаются в «кучу», а в стек кладётся лишь указатель на объект. Надеюсь, вы хорошо учили C\u002FC++ :-) \u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nНам потребуется знание того, как выполнить простые операции, соответствующие тому или иному Java-коду на языке ассемблера. Например, команда\u003Cbr\u002F\u003E\r\n\u003Cpre\u003Ereturn this.a;\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nдолжна быть преобразована в следующий код:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n    0  aload_0\n    1  getfield имякласса.a\n    4  lreturn\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПри этом конкретные коды операций зависят от того, какие типы имеют аргументы. Для int\u002Fboolean\u002Flong используются разные коды операций. Но хорошо то, что CGLib и ASM скрывают от нас данные особенности реализации Java-машины и сами контролируют, какие именно типы имеют аргументы и какие коды операций нужно использовать. Например, если мы определили переменную:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E ce.declare_field(Constants.ACC_PROTECTED, fieldName, type, null);\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТо CGLib\u002FASM запомнят её тип, и, когда мы будет генерировать код с помощью команд\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n    codeEmitter.load_this(); \n    codeEmitter.getfield(constantName); \n    codeEmitter.return_value(); \n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nСгенерированный код будет иметь именно те операнды, которые работают с заданным нами типом переменной. Итак, возврат значения поля класса было выше. Точнее, этот код можно разбить на две части. Помещение значения поля в стек:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n    codeEmitter.load_this(); \n    codeEmitter.getfield(constantName); \n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nи возврат верхнего значения стека:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n    codeEmitter.return_value(); \n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПомещение в стек первого аргумента функции (для дальнейшего присваивания чему-либо):\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n    codeEmitter.load_arg(0);\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nНО! Проблема в том, что при выполнении операции putfield сверху стека должно быть значение, а ниже — ссылка на объект-владелец поля. Поэтому сначала мы получаем ссылку на объект, потом добавляем аргумент в стек, а уже потом — присваиваем значение полю:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n         codeEmitter.load_this(); \n         codeEmitter.load_arg(0); \n         codeEmitter.putfield(fieldName); \n         codeEmitter.return_value(); \n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВызов метода. Для этого в стеке должны быть ссылка на объект и аргументы (аргументы сверху):\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n                codeEmitter.invoke_virtual(parentClass, new Signature(\n                        getterName, fieldValueType, TYPES_EMPTY));\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПри этом для вызова статических методов используется invoke_static, для вызовов методов, которые определены в интерфейсе (parentClass — интерфейс) используется invoke_interface, а для вызова конструктора — invoke_special (где имя метода — \"&lt;init\u003E\"). Кстати, создание объекта и вызов конструктора — это разные операции, и они вполне могут быть разделены чем-нибудь. Вот, например, создание LinkedHashMap:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\n        Local local = e.make_local(TYPE_LINKED_HASH_MAP);\n\n        e.new_instance(TYPE_LINKED_HASH_MAP);\n        e.dup();\n        e.push(fieldClasses.size());\n        e.push(10);\n        e.push(1f);\n        e.invoke_constructor(TYPE_LINKED_HASH_MAP, SIG_MAP_INIT_INT_FLOAT);\n        e.store_local(local);\n\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПодготавливаем локальную переменную, где будем хранить map. После чего создаём новый объект в куче (выделяем ему память). Далее дублируем верхний аргумент стека операцией dup() — так как после вызова конструктора одна из ссылок уйдёт, а нам ещё сохранять значение нужно. Помещаем также в стек аргументы вызова конструктора (чётко соблюдая тип, автоконвертация int-\u003Efloat тут не сработает), и вызываем конструктор с помощью invoke_constructor (он будет преобразован в invoke_special). В последней строке — сохраняем результат в локальную переменную. После этого у нас стек — пустой.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, генерация класса:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003EClassWriter cw = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E DebuggingClassWriter(\u003C\u002Fli\u003E\r\n\u003Cli\u003E    ClassWriter.COMPUTE_FRAMES);\u003C\u002Fli\u003E\r\n\u003Cli\u003EClassEmitter ce = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E ClassEmitter(cw);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003EType[] interfaces = getInterfacesTypes(complexType);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003Ece.begin_class(Constants.V1_6, Constants.ACC_PUBLIC, className,\u003C\u002Fli\u003E\r\n\u003Cli\u003E    Type.getType(complexType.getSuperClass()), interfaces,\u003C\u002Fli\u003E\r\n\u003Cli\u003E    Constants.SOURCE_FILE);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (complexType.isJpaEntity()) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E  ce.visitAnnotation(ANNOTATION_DESCRIPTOR_ENTITY, \u003Cfont color=\"#0000ff\"\u003Etrue\u003C\u002Ffont\u003E)\u003C\u002Fli\u003E\r\n\u003Cli\u003E      .visitEnd();\u003C\u002Fli\u003E\r\n\u003Cli\u003E}\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (StringUtils.isNotEmpty(complexType.getJpaTableName())) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E  final AnnotationVisitor av = ce.visitAnnotation(\u003C\u002Fli\u003E\r\n\u003Cli\u003E      ANNOTATION_DESCRIPTOR_TABLE, \u003Cfont color=\"#0000ff\"\u003Etrue\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E  av.visit(\u003Cfont color=\"#A31515\"\u003E\"name\"\u003C\u002Ffont\u003E, complexType.getJpaTableName());\u003C\u002Fli\u003E\r\n\u003Cli\u003E  av.visitEnd();\u003C\u002Fli\u003E\r\n\u003Cli\u003E}\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E{\u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (options.generateFieldAccessors) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    final String fieldsMapFieldName = \u003Cfont color=\"#A31515\"\u003E\"$fields$\"\u003C\u002Ffont\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    ce.declare_field(Constants.ACC_PRIVATE\u003C\u002Fli\u003E\r\n\u003Cli\u003E        | Constants.ACC_FINAL, fieldsMapFieldName,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        TYPE_MAP, \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    generateConstructorWithFieldsInit(mainClass, ce,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        fieldClasses, fieldsMapFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    generateGetFieldsMethod(ce, fieldsMapFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    generateGetFieldMethod(ce, fieldsMapFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E  } \u003Cfont color=\"#0000ff\"\u003Eelse\u003C\u002Ffont\u003E {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    EmitUtils.null_constructor(ce);\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Efor\u003C\u002Ffont\u003E (Attribute attribute : complexType.getAttributes()) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    processAttribute(ce, attribute);\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E}\u003C\u002Fli\u003E\r\n\u003Cli\u003Ece.end_class();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E{\u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Ebyte\u003C\u002Ffont\u003E[] bs = cw.toByteArray();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  log.info(\u003Cfont color=\"#A31515\"\u003E\"Generated class '\"\u003C\u002Ffont\u003E + className + \u003Cfont color=\"#A31515\"\u003E\"' of \"\u003C\u002Ffont\u003E + bs.length\u003C\u002Fli\u003E\r\n\u003Cli\u003E      + \u003Cfont color=\"#A31515\"\u003E\" bytes\"\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E  result.put(className, bs);\u003C\u002Fli\u003E\r\n\u003Cli\u003E}\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nПервые и последняя строки организуют цепочку ClassEmitter -\u003E ClassWriter -\u003E ByteArrayOutputStream -\u003E bytes. При генерации кода класса мы используем ClassEmitter, для методов — CodeEmitter, а для аннотаций — подобного нет и используется AnnotationVisitor (важно не забывать его также закрывать через visitEnd()).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля создания класса выбираем ему имя, версию, родительских класс, интерфейсы и прочее, как будто мы пишем обычный класс, но на другом языке. Нужно однако не забывать, что в отличии от обычного Java-кода подобный код вполне может скомпилироваться, но не заработать — ибо вы что-то забыли или не так сделали. Например, забыли добавить код возврата из процедуры… класс сгенерируется, но работать не будет. То есть ошибки в подобном коде отследить на этапе компиляции невозможно и нужно обязательно делать тест-кейсы. Хотя те, кто уже готов к восприятию ассемблера уже знают об этом :)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСтроки 11-21 добавляют к классу JPA аннотации  \u003Ca href=\"https:\u002F\u002Fhabrahabr.ru\u002Fusers\u002Fentity\u002F\" class=\"user_link\"\u003EEntity\u003C\u002Fa\u003E и  \u003Ca href=\"https:\u002F\u002Fhabrahabr.ru\u002Fusers\u002Ftable\u002F\" class=\"user_link\"\u003ETable\u003C\u002Fa\u003E. Важное замечание, которое бы могло сэкономить мне много времени — метод visitAnnotation принимает строку, но не имя класса аннотации, а его description во внутреннем формате Java. Например, для javax.persistence.Entity это будет «Ljavax\u002Fpersistence\u002FEntity;». Но их можно легко получить с помощью класса Type (он используется чуть ли не в каждой строке):\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"Teal\"\u003E  1 \u003C\u002Ffont\u003E    \u003Cfont color=\"Blue\"\u003Eprivate\u003C\u002Ffont\u003E \u003Cfont color=\"Blue\"\u003Estatic\u003C\u002Ffont\u003E \u003Cfont color=\"Blue\"\u003Efinal\u003C\u002Ffont\u003E String ANNOTATION_DESCRIPTOR_ENTITY = Type.getType( \u003Cbr\u002F\u003E\r\n\u003Cfont color=\"Teal\"\u003E  2 \u003C\u002Ffont\u003E            Entity.\u003Cfont color=\"Blue\"\u003Eclass\u003C\u002Ffont\u003E).getDescriptor();\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСтрока 36 нужна для добавления простого конструктора (другой случай чуть позже). Ну а в цикле 39-41 мы добавляем новые поля, методы get\u002Fset и константы значений по умолчанию для каждого из аттрибутов:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (attribute.getType() instanceof EmptyType)\u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Ereturn\u003C\u002Ffont\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003EString fieldName = attribute.getFieldName();\u003C\u002Fli\u003E\r\n\u003Cli\u003EString getterName = attribute.getGetterName();\u003C\u002Fli\u003E\r\n\u003Cli\u003EString setterName = attribute.getSetterName();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003Efinal String javaMethodNamePart = WordUtils.capitalize(\u003C\u002Fli\u003E\r\n\u003Cli\u003E    attribute.getAttrName(), \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003Echar\u003C\u002Ffont\u003E[] { \u003Cfont color=\"#A31515\"\u003E'_'\u003C\u002Ffont\u003E }).replace(\u003Cfont color=\"#A31515\"\u003E\"_\"\u003C\u002Ffont\u003E, \u003Cfont color=\"#A31515\"\u003E\"\"\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003Efinal Type type = getTypeFromXmlSchemaTypeName(attribute.getType());\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (fieldName == \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E)\u003C\u002Fli\u003E\r\n\u003Cli\u003E  fieldName = \u003Cfont color=\"#A31515\"\u003E\"m$\"\u003C\u002Ffont\u003E + StringUtils.uncapitalize(javaMethodNamePart);\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (getterName == \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E)\u003C\u002Fli\u003E\r\n\u003Cli\u003E  getterName = \u003Cfont color=\"#A31515\"\u003E\"get\"\u003C\u002Ffont\u003E + javaMethodNamePart;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (setterName == \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E)\u003C\u002Fli\u003E\r\n\u003Cli\u003E  setterName = \u003Cfont color=\"#A31515\"\u003E\"set\"\u003C\u002Ffont\u003E + javaMethodNamePart;\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003Efinal boolean jpaId = attribute.isJpaId();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003Efinal String strDefaultValue;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (!jpaId) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E  strDefaultValue = attribute.getStrDefaultValue();\u003C\u002Fli\u003E\r\n\u003Cli\u003E} \u003Cfont color=\"#0000ff\"\u003Eelse\u003C\u002Ffont\u003E {\u003C\u002Fli\u003E\r\n\u003Cli\u003E  strDefaultValue = \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003E}\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cfont color=\"#0000ff\"\u003Eif\u003C\u002Ffont\u003E (strDefaultValue == \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E  ce.declare_field(Constants.ACC_PRIVATE, fieldName, type, \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#008000\"\u003E\u002F\u002F create getter\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(getterName, type, TYPES_EMPTY),\u003C\u002Fli\u003E\r\n\u003Cli\u003E        TYPES_EMPTY);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    proceedAttributeJpaColumnName(attribute, codeEmitter);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    proceedAttributeJpaLob(attribute, codeEmitter);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    proceedAttributeJpaId(attribute, codeEmitter);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.getfield(fieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#008000\"\u003E\u002F\u002F create null safe setter\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(setterName, Type.VOID_TYPE,\u003C\u002Fli\u003E\r\n\u003Cli\u003E            \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Type[] { type }), TYPES_EMPTY);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.load_arg(0);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.putfield(fieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E} \u003Cfont color=\"#0000ff\"\u003Eelse\u003C\u002Ffont\u003E {\u003C\u002Fli\u003E\r\n\u003Cli\u003E  final Object defaultValue = toValue(type, strDefaultValue);\u003C\u002Fli\u003E\r\n\u003Cli\u003E  final String constantName = \u003Cfont color=\"#A31515\"\u003E\"DEFAULT_\"\u003C\u002Ffont\u003E + fieldName;\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  ce.declare_field(Constants.ACC_PROTECTED | Constants.ACC_FINAL\u003C\u002Fli\u003E\r\n\u003Cli\u003E      | Constants.ACC_STATIC, constantName, type, \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    CodeEmitter staticHook = ce.getStaticHook();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    EmitUtils.push_object(staticHook, defaultValue);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    staticHook.putfield(constantName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  ce.declare_field(Constants.ACC_PROTECTED, fieldName, type, \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#008000\"\u003E\u002F\u002F create getter\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    final Signature signature = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(getterName, type,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        TYPES_EMPTY);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    final CodeEmitter codeEmitter = ce.begin_method(\u003C\u002Fli\u003E\r\n\u003Cli\u003E        Constants.ACC_PUBLIC, signature, TYPES_EMPTY);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    proceedAttributeJpaColumnName(attribute, codeEmitter);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    proceedAttributeJpaLob(attribute, codeEmitter);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.getfield(fieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    Label ifNull = codeEmitter.make_label();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.ifnull(ifNull);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    {\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.getfield(fieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    }\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.mark(ifNull);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    {\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.getfield(constantName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    }\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#008000\"\u003E\u002F\u002F create setter\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E    final Signature signature = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(setterName,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        Type.VOID_TYPE, \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Type[] { type });\u003C\u002Fli\u003E\r\n\u003Cli\u003E    final CodeEmitter codeEmitter = ce.begin_method(\u003C\u002Fli\u003E\r\n\u003Cli\u003E        Constants.ACC_PUBLIC, signature, TYPES_EMPTY);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.load_arg(0);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.putfield(fieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    codeEmitter.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E}\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nПроверка 1-2 нужна на случай, если поле «пустое». Такие поля позволяют сделать включить в класс атрибут, который не будет сохраняться в той же таблице, а, например, будет сам управлять своим состоянием. В строках 4-18 идёт инициализация переменных и определяются будущие имена для внутренних переменных и методов. Обратите внимание, что для методов и переменных, которые генерируются компьютером, принято использовать знак \"$\", тогда как в пользовательском коде его рекомендуется избегать. Разумеется, методы get\u002Fset оставлены без этого знака, так как они будут вызываться из Hibernate и бизнес-кода.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля JPA ID не используются значения по умолчанию, поэтому на всякий случай проверим, что его не задали, в строках 23-27. Генерация кода для случая, когда значение по умолчанию задано и нет, различна. Случай, когда его нет, разумеется проще и прямолинейнее — само поле добавляется в класс в строке 30, метод get в строках 32-46, set — 48-58.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСлучай же со значениями по умолчанию требует:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EОпределить константу со значением по умолчанию (строки 60-61)\u003C\u002Fli\u003E\r\n\u003Cli\u003EПричём для сложных типов (а к ним относится и Boolean\u002FInteger\u002FLong) нужно использовать static-код для инициализации констант. Когда мы пишем обычный код это не нужно — ибо компилятор делает это за нас. Но тут нужно сделать это вручную. В строках 66-70 мы и добавляем в StaticHook новые строки. Потом, когда мы закончим работать с классом, все строки из StaticHook будут перенесены в блок static инициализации класса (ну, почти… интересующиеся деталями могут дизассемблировать и посмотреть, что на самом деле там происходит.)\u003C\u002Fli\u003E\r\n\u003Cli\u003EМетод set достаточно простой (строки 104-116)\u003C\u002Fli\u003E\r\n\u003Cli\u003EА вот в методе get я добавил ветвление. Его может и не быть — если вы в конструкторе класса инициализируете переменные значениями по умолчанию (как работать с конструктором — ниже). Но мне хотелось, что если переменная внутри класса установлена в null, то возвращалось бы значение константы. Для организации ветвления мы создаём новую ссылку (label). По ней мы будем осуществлять переход, если значение равно нулю. Потом используем команду условного перехода (строка 89). Ещё раз — мы не проверяем условие прямо сейчас — мы добавляем проверку этого условия в код метода. Если условие выполнено — происходит переход до того места в коде, которое помечего (mark) меткой (строка 95). Если не выполнено — выполняется обычная ветка 91-93. При этом каждая из веток исполнения кода содержит код возврата результирующего значения.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch5\u003EДоступ к набору полей\u003C\u002Fh5\u003E\u003Cbr\u002F\u003E\r\nКод выше успешно (надеюсь) сгенерировал «бин» — класс с полями и методами get\u002Fset. Но ещё нужно сгерировать два метода: getField(name) и getFields(). Эти методы должны давать доступ к полям объекта через коллекцию, но при этом не должно быть никакого reflection'а, чтобы не замедлять работу системы вызовом native-методов.\u003Cbr\u002F\u003E\r\nДля этого для каждого аттрибута объекта мы дополнительно сгенерируем класс, который содержит два метода — getValue() и setValue(), которые делегируют эти вызовы основному классу. Генерация такого класса достаточно простая, но интересная тем, что теперь конструктор класса не пустой, а принимает единственный параметр — ссылку на родительский объект:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E    final String holderFieldName = \u003Cfont color=\"#A31515\"\u003E\"$parent$\"\u003C\u002Ffont\u003E;\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    ce.declare_field(Constants.ACC_PRIVATE | Constants.ACC_FINAL,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        holderFieldName, parentClass, \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    {\u003C\u002Fli\u003E\r\n\u003Cli\u003E      CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC,\u003C\u002Fli\u003E\r\n\u003Cli\u003E          \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(\u003Cfont color=\"#A31515\"\u003E\"&lt;init\u003E\"\u003C\u002Ffont\u003E, Type.VOID_TYPE,\u003C\u002Fli\u003E\r\n\u003Cli\u003E              \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Type[] { parentClass }), \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.super_invoke_constructor();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.load_arg(0);\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.putfield(holderFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    }\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСама ссылка сохраняется в переменной $parent$. Методы get\u002Fset делаются достаточно просто:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E    {\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#008000\"\u003E\u002F\u002F create getter\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,\u003C\u002Fli\u003E\r\n\u003Cli\u003E          \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(\u003Cfont color=\"#A31515\"\u003E\"getValue\"\u003C\u002Ffont\u003E, fieldValueType, TYPES_EMPTY),\u003C\u002Fli\u003E\r\n\u003Cli\u003E          TYPES_EMPTY);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.getfield(holderFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.invoke_virtual(parentClass, \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(\u003C\u002Fli\u003E\r\n\u003Cli\u003E          getterName, fieldValueType, TYPES_EMPTY));\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    {\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#008000\"\u003E\u002F\u002F create null safe setter\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      CodeEmitter codeEmitter = ce.begin_method(Constants.ACC_PUBLIC,\u003C\u002Fli\u003E\r\n\u003Cli\u003E          \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(\u003Cfont color=\"#A31515\"\u003E\"setValue\"\u003C\u002Ffont\u003E, Type.VOID_TYPE,\u003C\u002Fli\u003E\r\n\u003Cli\u003E              \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Type[] { fieldValueType }), TYPES_EMPTY);\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.getfield(holderFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.load_arg(0);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.invoke_virtual(parentClass, \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(\u003C\u002Fli\u003E\r\n\u003Cli\u003E          setterName, Type.VOID_TYPE,\u003C\u002Fli\u003E\r\n\u003Cli\u003E          \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Type[] { fieldValueType }));\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      codeEmitter.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    }\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭти классы для каждого атрибута генерируются в цикле и сохраняются в Map&lt;Attribute, String=имя класса\u003E:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E        ClassWriter cw = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E DebuggingClassWriter(\u003C\u002Fli\u003E\r\n\u003Cli\u003E            ClassWriter.COMPUTE_FRAMES);\u003C\u002Fli\u003E\r\n\u003Cli\u003E        ClassEmitter ce = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E ClassEmitter(cw);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E        String fieldClassName = processAttributeField(className,\u003C\u002Fli\u003E\r\n\u003Cli\u003E            mainClass, ce, attribute);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E        fieldClasses.put(attribute, ce.getClassType());\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗачем? Чтобы потом в конструкторе родительского класса создать экземпляры дочерних объектов и поместить их во внутреннее поле $fields$:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Epublic\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003Evoid\u003C\u002Ffont\u003E generateConstructorWithFieldsInit(final Type mainClass,\u003C\u002Fli\u003E\r\n\u003Cli\u003E      ClassEmitter ce, Map&lt;Attribute, Type\u003E fieldClasses,\u003C\u002Fli\u003E\r\n\u003Cli\u003E      final String fieldsMapFieldName) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC, TypeUtils\u003C\u002Fli\u003E\r\n\u003Cli\u003E        .parseConstructor(\u003Cfont color=\"#A31515\"\u003E\"\"\u003C\u002Ffont\u003E), \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.super_invoke_constructor();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    Local local = e.make_local(TYPE_LINKED_HASH_MAP);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.new_instance(TYPE_LINKED_HASH_MAP);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.dup();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.push(fieldClasses.size());\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.push(1f);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.invoke_constructor(TYPE_LINKED_HASH_MAP, SIG_MAP_INIT_INT_FLOAT);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.store_local(local);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#0000ff\"\u003Efor\u003C\u002Ffont\u003E (Entry&lt;Attribute, Type\u003E fieldTypes : fieldClasses.entrySet()) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.load_local(local);\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.push(fieldTypes.getKey().getAttrName());\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#008000\"\u003E\u002F\u002F = new &lt;...\u003EField(this);\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.new_instance(fieldTypes.getValue());\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.dup();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.invoke_constructor(fieldTypes.getValue(), \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Signature(\u003Cfont color=\"#A31515\"\u003E\"&lt;init\u003E\"\u003C\u002Ffont\u003E,\u003C\u002Fli\u003E\r\n\u003Cli\u003E          Type.VOID_TYPE, \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E Type[] { mainClass }));\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#008000\"\u003E\u002F\u002F $fields$.put(fieldName, field);\u003C\u002Ffont\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E      e.invoke_virtual(TYPE_LINKED_HASH_MAP, SIG_MAP_PUT);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.load_local(local);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.invoke_static(TYPE_COLLECTIONS, SIG_COLLECTIONS_UNMODIFIABLEMAP);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.putfield(fieldsMapFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ первых строках мы создаём LinkedHashMap (при этом на параметризацию с помощью Generic мы забиваем — её почти нет в ассемблере). Потом наполняем её дочерними объектами Fields, ну а потом, на всякий случай, оборачиваем в Collections.unmodifiableMap и сохраняем в final поле. Кстати, обратите внимание, что последний метод вызывается с помощью invoke_static, и даже конструктор завершается операцией return_value, хотя в соответствии со спецификацией (строки 4-5) возвращает VOID.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНу и напоследок создадим методы getField(name) и getFields(), не забыв снабдить их аннотацией  \u003Ca href=\"https:\u002F\u002Fhabrahabr.ru\u002Fusers\u002Ftransient\u002F\" class=\"user_link\"\u003ETransient\u003C\u002Fa\u003E, чтобы JPA не думал, что это поля объекта:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Epublic\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003Evoid\u003C\u002Ffont\u003E generateGetFieldMethod(ClassEmitter ce,\u003C\u002Fli\u003E\r\n\u003Cli\u003E      final String fieldsMapFieldName) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        SIG_FIELDSHOLDER_GETFIELD, \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.visitAnnotation(ANNOTATION_DESCRIPTOR_TRANSIENT, \u003Cfont color=\"#0000ff\"\u003Etrue\u003C\u002Ffont\u003E).visitEnd();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.getfield(fieldsMapFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.load_arg(0);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.checkcast(TYPE_OBJECT);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.invoke_interface(TYPE_MAP, SIG_MAP_GET);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.checkcast(TYPE_FIELD);\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Epublic\u003C\u002Ffont\u003E \u003Cfont color=\"#0000ff\"\u003Evoid\u003C\u002Ffont\u003E generateGetFieldsMethod(ClassEmitter ce,\u003C\u002Fli\u003E\r\n\u003Cli\u003E      final String fieldsMapFieldName) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E    CodeEmitter e = ce.begin_method(Constants.ACC_PUBLIC,\u003C\u002Fli\u003E\r\n\u003Cli\u003E        SIG_FIELDSHOLDER_GETFIELDS, \u003Cfont color=\"#0000ff\"\u003Enull\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.visitAnnotation(ANNOTATION_DESCRIPTOR_TRANSIENT, \u003Cfont color=\"#0000ff\"\u003Etrue\u003C\u002Ffont\u003E).visitEnd();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.load_this();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.getfield(fieldsMapFieldName);\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.return_value();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    e.end_method();\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch5\u003EЗагрузка полученных классов\u003C\u002Fh5\u003E\u003Cbr\u002F\u003E\r\nПосле генерации byte[] для каждого класса нужно их загрузить в память. Это делается с помощью определения своего ClassLoader'а (ну или можно сохранить на диск и загрузить оттуда с помощью какого-нибудь URLClassLoader'а):\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fvirtser.net\u002Fblog\u002Fpost\u002Fsource-code-highlighter.aspx\"\u003E\u003C\u002Fa\u003E\u003Cfont color=\"black\"\u003E\u003Col\u003E\r\n\u003Cli\u003E  \u003Cfont color=\"#0000ff\"\u003Eprotected\u003C\u002Ffont\u003E Map&lt;String, Class&lt;?\u003E\u003E loadClasses(\u003C\u002Fli\u003E\r\n\u003Cli\u003E      final Map&lt;String, \u003Cfont color=\"#0000ff\"\u003Ebyte\u003C\u002Ffont\u003E[]\u003E generated) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E    final Thread currentThread = Thread.currentThread();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    final ClassLoader classLoader = currentThread.getContextClassLoader();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    final Map&lt;String, Class&lt;?\u003E\u003E classes = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E ClassLoader(classLoader) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E      \u003Cfont color=\"#0000ff\"\u003Eprotected\u003C\u002Ffont\u003E Map&lt;String, Class&lt;?\u003E\u003E loadClasses() {\u003C\u002Fli\u003E\r\n\u003Cli\u003E        Map&lt;String, Class&lt;?\u003E\u003E result = \u003Cfont color=\"#0000ff\"\u003Enew\u003C\u002Ffont\u003E LinkedHashMap&lt;String, Class&lt;?\u003E\u003E(\u003C\u002Fli\u003E\r\n\u003Cli\u003E            generated.size());\u003C\u002Fli\u003E\r\n\u003Cli\u003E        \u003Cfont color=\"#0000ff\"\u003Efor\u003C\u002Ffont\u003E (Entry&lt;String, \u003Cfont color=\"#0000ff\"\u003Ebyte\u003C\u002Ffont\u003E[]\u003E entry : generated.entrySet()) {\u003C\u002Fli\u003E\r\n\u003Cli\u003E          final String className = entry.getKey();\u003C\u002Fli\u003E\r\n\u003Cli\u003E          final \u003Cfont color=\"#0000ff\"\u003Ebyte\u003C\u002Ffont\u003E[] byteCode = entry.getValue();\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E          log.info(\u003Cfont color=\"#A31515\"\u003E\"Defining class \"\u003C\u002Ffont\u003E + className + \u003Cfont color=\"#A31515\"\u003E\"...\"\u003C\u002Ffont\u003E);\u003C\u002Fli\u003E\r\n\u003Cli\u003E          final Class&lt;?\u003E cls = defineClass(className, byteCode, 0,\u003C\u002Fli\u003E\r\n\u003Cli\u003E              byteCode.length);\u003C\u002Fli\u003E\r\n\u003Cli\u003E          result.put(cls.getName(), cls);\u003C\u002Fli\u003E\r\n\u003Cli\u003E        }\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003C\u002Fli\u003E\r\n\u003Cli\u003E        \u003Cfont color=\"#0000ff\"\u003Ereturn\u003C\u002Ffont\u003E result;\u003C\u002Fli\u003E\r\n\u003Cli\u003E      }\u003C\u002Fli\u003E\r\n\u003Cli\u003E    }.loadClasses();\u003C\u002Fli\u003E\r\n\u003Cli\u003E    \u003Cfont color=\"#0000ff\"\u003Ereturn\u003C\u002Ffont\u003E classes;\u003C\u002Fli\u003E\r\n\u003Cli\u003E  }\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"gray\"\u003E* This source code was highlighted with \u003Cfont color=\"gray\"\u003ESource Code Highlighter\u003C\u002Ffont\u003E.\u003C\u002Ffont\u003E\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nКстати забывать про этот ClassLoader не стоит — он вам понадобится позже, для загрузки этих классов в Hibernate, ибо он не будет работать, если текущий ClassLoader не сможет загрузить те классы, что передаются ему в качестве параметров.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch5\u003EИспользование на практике\u003C\u002Fh5\u003E\u003Cbr\u002F\u003E\r\nНекоторые ссылки, которые могут быть интересны для дальнейшего изучения:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Farpsite.svn.sourceforge.net\u002Fviewvc\u002Farpsite\u002Ftrunk\u002Fmodules\u002Fcore\u002Finfospace\u002Fsrc\u002Fmain\u002Ffiles\u002Fetc\u002Fconfig-infospace.xml?revision=714&amp;view=markup\"\u003EПример реальной конфигурации классов\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Farpsite.svn.sourceforge.net\u002Fviewvc\u002Farpsite\u002Ftrunk\u002Fmodules\u002Fcore\u002Fkernel\u002Fsrc\u002Fmain\u002Fjava\u002Fru\u002Farptek\u002Farpsite\u002Fcontent\u002FDefaultRegistry.java?revision=749&amp;view=markup\"\u003EКласс, отвечающий за преобразование конфигурации в meta-configuration, генерацию классов и создание коллекции entityclass'ов\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Farpsite.svn.sourceforge.net\u002Fviewvc\u002Farpsite\u002Ftrunk\u002Fmodules\u002Fcore\u002Fkernel\u002Fsrc\u002Fmain\u002Fjava\u002Fru\u002Farptek\u002Farpsite\u002Fdata\u002Fjpa\u002FDefaultEntityManagerHolder.java?revision=748&amp;view=markup\"\u003EКласс, отвечающий за загрузку EntityFactory\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Farpsite.svn.sourceforge.net\u002Fviewvc\u002Farpsite\u002Ftrunk\u002Fmodules\u002Fcore\u002Fkernel\u002Fsrc\u002Fmain\u002Fjava\u002Fru\u002Farptek\u002Farpsite\u002Fcontent\u002FWebObjectFieldsHolderLoader.java?revision=750&amp;view=markup\"\u003EКласс, отвечающий за загрузку классов из базы данных через JPA\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Ffvl.fizteh.ru\u002F\"\u003EПример сайта, который работает на этом движке\u003C\u002Fa\u003E (не мой :) )\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Ch5\u003EВ результате\u003C\u002Fh5\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EОперациями с данными теперь занимается Hibernate. Сам заботится о загрузке и сохранении. Есть поддержка batch-операций по загрузке, поддержка кешей и транзакций. Меньше велосипедов это всегда хорошо.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКешированием также занимается Hibernate (хотя и на основе нашего clustered soft reference cache). Наблюдать за состоянием кешей можно из JConsole.\u003C\u002Fli\u003E\r\n\u003Cli\u003EПроизводительность повысилась за счёт оптимизации загрузки данных (возможно batch-загрузки из базы данных сразу нескольких объектов одним SQL-ем)\u003C\u002Fli\u003E\r\n\u003Cli\u003EБизнес-код стало писать намного удобнее и приятнее :)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003C\u002Fcode\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"модель данных"},{"titleHtml":"java"},{"titleHtml":"jpa"},{"titleHtml":"hibernate"},{"titleHtml":"assembler"},{"titleHtml":"cglib"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F91239\u002Fc6e2b9b04feed86b8c68cf939c1901e4\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F91239\u002Fc6e2b9b04feed86b8c68cf939c1901e4\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F91239\\\u002F\"},\"headline\":\"Java-ассемблер, мета-программирование и JPA\",\"datePublished\":\"2010-04-17T01:29:35+04:00\",\"dateModified\":\"2010-04-18T05:29:15+04:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Сергей Владимиров\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"В этом топике хочу поделиться первым опытом по написанию системы генерации кода &laquo;на лету&raquo;. В коде реализуются некоторые идеи, описанные в предыдущем топике, а са...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F91239\\\u002F#post-content-body\",\"about\":[\"h_java\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F91239\\\u002Fc6e2b9b04feed86b8c68cf939c1901e4\\\u002F\"]}","metaDescription":"В этом топике хочу поделиться первым опытом по написанию системы генерации кода «на лету». В коде реализуются некоторые идеи, описанные в предыдущем топике, а сам код используется в одной старой, но...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"572164":{"id":"572164","timePublished":"2021-09-27T11:37:23+00:00","isCorporative":false,"lang":"ru","titleHtml":"Первые шаги в ОТО: прецессия орбиты Меркурия","editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"1832999","alias":"Yermack","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F690\u002F140\u002F823\u002F690140823f555d03574a59d46f648d24.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":15,"favoritesCount":37,"readingCount":5157,"score":21,"votesCount":23},"hubs":[{"relatedData":null,"id":"18840","alias":"julia","type":"collective","title":"Julia","titleHtml":"Julia","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21968","alias":"physics","type":"collective","title":"Физика","titleHtml":"Физика","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКогда речь заходит о теории относительности, частенько на ровном месте разрастаются споры, которые были занесены в почву непонимания и обильно удобрены мифами, недосказанностью и недостаточной математической подготовкой. Даже на лекциях от некоторых профессоров можно услышать, что детище гения Эйнштейна не имеет практической пользы, а на робкие попытки пролепетать что-то про спутниковые системы навигации они пренебрежительно отмахиваются, дескать, там все сложно и двояко. \u003C\u002Fp\u003E\u003Cp\u003EТак что совершенно естественно желание попробовать провести некоторые расчеты самолично, потрогать формулы, покрутить параметры, чтобы постепенно заложить интуицию в столь горячей теме.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"прецессия"},{"titleHtml":"меркурий"},{"titleHtml":"теория относительности"},{"titleHtml":"уравнения эйнштейна"},{"titleHtml":"метрики"},{"titleHtml":"спасибо scihub"},{"titleHtml":"спасибо mathpix"},{"titleHtml":"астрология_точная_наука"}]},"575686":{"id":"575686","timePublished":"2021-09-28T08:07:48+00:00","isCorporative":true,"lang":"ru","titleHtml":"Когда сделаете доработку?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1097452","alias":"Turundur","fullname":"Станислав Малышев","avatarUrl":"","speciality":"Разработчик"},"statistics":{"commentsCount":3,"favoritesCount":18,"readingCount":1595,"score":33,"votesCount":33},"hubs":[{"relatedData":null,"id":"22422","alias":"domclick","type":"corporative","title":"Блог компании ДомКлик","titleHtml":"Блог компании ДомКлик","isProfiled":false},{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EДовольно часто я попадаю в ситуацию, когда мне нужно в моменте оценить длительность реализации реализации бизнес-фичи. Обычно это какая-нибудь рядовая встреча, на которой инициатор бизнес-идеи, резво размахивая руками в воздухе, рассказывает о своем предложении. В конце своего выступления, в котором часто много слов (но не цифр) сказано о том, зачем это фича нужна и какой эффект она даст, всегда звучит сакральный вопрос: «Когда сделаете эту великолепную доработку?»\u003C\u002Fp\u003E\u003Cp\u003EЯ хотел бы поделиться с читателем ходом своих рассуждений, которые позволяют мне довольно точно оценивать сроки реализации даже в самых запущенных случаях.\u003C\u002Fp\u003E\u003Cp\u003EРазумеется, я не смогу предусмотреть и учесть все нюансы и специфики, принятые в различных компаниях в процессе разработки и вывода новой функциональности в эксплуатацию. Однако я верю, что описанные ниже практики будут полезны и вы сможете их адаптировать под свою ситуацию.\u003C\u002Fp\u003E\u003Cp\u003EСразу упомяну, что речь идет в первую очередь о продуктовых компаниях, где нет жесткого учета рабочего времени и можно подумать о качестве и поддерживаемости новой функциональности. В случае заказной разработки всё обычно гораздо сложнее и требует более детальной проработки.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb36\u002F6f1\u002Fe84\u002Fb366f1e845d886daf41be0f315b7c9a6.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb36\u002F6f1\u002Fe84\u002Fb366f1e845d886daf41be0f315b7c9a6.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"разработка"},{"titleHtml":"оценка"},{"titleHtml":"заказчик"}]},"579590":{"id":"579590","timePublished":"2021-09-27T23:58:49+00:00","isCorporative":true,"lang":"ru","titleHtml":"Seeed XIAO RP2040: микроконтроллер с отличными возможностями за $5","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Les Pounder","originalUrl":"https:\u002F\u002Fwww.tomshardware.com\u002Freviews\u002Fseeed-xiao-rp2040-review-dollar5-brain-food"}}],"author":{"id":"2071241","alias":"Deluar","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F1a5\u002F707\u002F699\u002F1a5707699dc1770d6a9cdd5d777d5bb0.jpg","speciality":"Разработчик"},"statistics":{"commentsCount":7,"favoritesCount":13,"readingCount":5629,"score":14,"votesCount":20},"hubs":[{"relatedData":null,"id":"14740","alias":"selectel","type":"corporative","title":"Блог компании Selectel","titleHtml":"Блог компании Selectel","isProfiled":false},{"relatedData":null,"id":"19737","alias":"controllers","type":"collective","title":"Программирование микроконтроллеров","titleHtml":"Программирование микроконтроллеров","isProfiled":true},{"relatedData":null,"id":"21894","alias":"gadgets","type":"collective","title":"Гаджеты","titleHtml":"Гаджеты","isProfiled":false},{"relatedData":null,"id":"21976","alias":"DIY","type":"collective","title":"DIY или Сделай сам","titleHtml":"DIY или Сделай сам","isProfiled":false},{"relatedData":null,"id":"22016","alias":"easyelectronics","type":"collective","title":"Электроника для начинающих","titleHtml":"Электроника для начинающих","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F53b\u002F390\u002F960\u002F53b39096013cb151e161ebf489fcca96.jpg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНа первый взгляд Seeed XIAO RP2040 не выглядит многообещающим. Но это обманчивое впечатление. Возможностей у него много. Благо, у компании есть опыт разработки подобных систем, ведь это не первый микроконтроллер от Seeed. Более того, ранее компания выпускала устройство на базе Seeeduino XIAO, которое выглядит близнецом XIAO RP2040, да и стоит столько же — $5.40. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНо у XIAO RP2040 другой чип — здесь мы имеем дело с RP2040 SoC, так что этот микроконтроллер гораздо более мощный, чем предыдущая система. Причем доплачивать не нужно — стоимость та же. Стоит ли новинка пяти долларов? Забегая наперед, скажу — да, стоит. \u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"микроконтроллеры"},{"titleHtml":"гаджеты"},{"titleHtml":"устройства"},{"titleHtml":"электроника"}]},"579778":{"id":"579778","timePublished":"2021-09-28T08:51:05+00:00","isCorporative":true,"lang":"ru","titleHtml":"YARL: как Яндекс построил распределённый Rate Limiter с нулевым влиянием на время ответа сервисов","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"91003","alias":"DenKoren","fullname":"Кореневский Денис","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F1a3\u002F2cd\u002F706\u002F1a32cd706b2d50526638707e3d3cdacc.png","speciality":"Release Engineer"},"statistics":{"commentsCount":5,"favoritesCount":8,"readingCount":1141,"score":28,"votesCount":28},"hubs":[{"relatedData":null,"id":"4991","alias":"yandex","type":"corporative","title":"Блог компании Яндекс","titleHtml":"Блог компании Яндекс","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"7504","alias":"refactoring","type":"collective","title":"Проектирование и рефакторинг","titleHtml":"Проектирование и рефакторинг","isProfiled":true},{"relatedData":null,"id":"8880","alias":"server_side_optimization","type":"collective","title":"Серверная оптимизация","titleHtml":"Серверная оптимизация","isProfiled":true},{"relatedData":null,"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EYandex Rate Limiter (далее просто YARL) — это сервис лимитирования нагрузки для распределённых сервисов. Его особенность в том, что он способен работать с миллионами квот, имея при этом очень низкие накладные расходы на проверку квоты. Если совсем кратко, это система распределённых \u003Ca href=\"https:\u002F\u002Fwww.wikiwand.com\u002Fen\u002FLeaky_bucket\" rel=\"nofollow noopener noreferrer\"\u003ELeaky Bucket'ов\u003C\u002Fa\u003E, с помощью которых можно ограничивать разные величины, связанные со временем: скорость передачи данных по сети, запросы в секунду и т. п.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdg\u002Fte\u002F--\u002Fdgte--d9wm8qyawhplaw4c87mky.jpeg\"\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EМеня зовут Денис Кореневский, я работаю в службе разработки внутреннего хранилища Яндекса, и сегодня я расскажу, как YARL устроен внутри, почему мы вообще написали своё решение и с какими трудностями нам пришлось столкнуться в процессе создания. Добро пожаловать под кат.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"rate limiter"},{"titleHtml":"балансировка нагрузки"}]},"579780":{"id":"579780","timePublished":"2021-09-28T08:46:27+00:00","isCorporative":true,"lang":"ru","titleHtml":"Упала связь, обрыв на линии и причем тут собака","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2788341","alias":"fregatmf","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":5,"favoritesCount":2,"readingCount":1076,"score":10,"votesCount":10},"hubs":[{"relatedData":null,"id":"5160","alias":"megafon","type":"corporative","title":"Блог компании МегаФон","titleHtml":"Блог компании МегаФон","isProfiled":false},{"relatedData":null,"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"relatedData":null,"id":"17201","alias":"wireless","type":"collective","title":"Беспроводные технологии","titleHtml":"Беспроводные технологии","isProfiled":true},{"relatedData":null,"id":"19429","alias":"network_standarts","type":"collective","title":"Стандарты связи","titleHtml":"Стандарты связи","isProfiled":false},{"relatedData":null,"id":"22008","alias":"cellular","type":"collective","title":"Сотовая связь","titleHtml":"Сотовая связь","isProfiled":false}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИнсайты телекома. Легкий и позитивный контент для тех, кому интересно погрузиться в будни инженеров МегаФона и узнать, как работает связь. Почему LTE становится EDGE, когда очень нужно.\u003C\u002Fp\u003E\u003Cp\u003EСпойлер: любишь истории со счастливым концом - дочитай до конца :) \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc16\u002F434\u002F175\u002Fc16434175e01aaecb6ca80e709c31f3c.jpg","buttonTextHtml":"Читать","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc16\u002F434\u002F175\u002Fc16434175e01aaecb6ca80e709c31f3c.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"волс"},{"titleHtml":"волс проектирование"},{"titleHtml":"связь"},{"titleHtml":"мегафон"},{"titleHtml":"собака"}]},"580124":{"id":"580124","timePublished":"2021-09-27T13:03:14+00:00","isCorporative":true,"lang":"ru","titleHtml":"Электролюминесцентные индикаторы из прошлого","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"146371","alias":"radiolok","fullname":"Артем Кашканов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa46\u002Fc6a\u002F151\u002Fa46c6a15193f7c0cac79d2736b107358.jpg","speciality":"Релейно-декатронный маньяк"},"statistics":{"commentsCount":29,"favoritesCount":43,"readingCount":8757,"score":104,"votesCount":104},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false},{"relatedData":null,"id":"21930","alias":"antikvariat","type":"collective","title":"Старое железо","titleHtml":"Старое железо","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Сегодня речь пойдёт об электролюминесцентных индикаторах. Но, не о тех, которые окружают вас повсюду и к которым вы привыкли, а о других — получивших огромную популярность в 60-е годы прошлого века, и так же стремительно канувших в небытие. Заодно запущу свою коллекцию индикаторов, как серийно выпускавшихся, так и уникальных опытных и даже — лабораторных образцов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F523004\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F94e\u002F51f\u002F459\u002F94e51f459ae59c9d2fe6c448cb07bcca.gif\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Индикатор"},{"titleHtml":"электролюминесцентность"},{"titleHtml":"ruvds_статьи"}]},"580164":{"id":"580164","timePublished":"2021-09-27T11:17:58+00:00","isCorporative":true,"lang":"ru","titleHtml":"Измеряем производительность String.format() в Java","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"@cowtowncoder","originalUrl":"https:\u002F\u002Fcowtowncoder.medium.com\u002Fmeasuring-performance-of-java-string-format-or-lack-thereof-2e1c6a13362c"}}],"author":{"id":"2571061","alias":"GolovinDS","fullname":"Дмитрий Головин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd27\u002Fccd\u002F743\u002Fd27ccd743d8bccbf1a885e5dadaa7ffe.jpg","speciality":"Контент-маркетолог"},"statistics":{"commentsCount":1,"favoritesCount":19,"readingCount":2545,"score":12,"votesCount":14},"hubs":[{"relatedData":null,"id":"21052","alias":"otus","type":"corporative","title":"Блог компании OTUS","titleHtml":"Блог компании OTUS","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЯ раньше считал, что JDK в целом хорошо оптимизирована, и если в JDK есть простой способ решения какой-то задачи, то он вполне подойдет для большинства ситуаций и будет работать хорошо.\u003C\u002Fp\u003E\u003Cp\u003EНо я обнаружил, что иногда некоторые классы или методы работают на удивление плохо. Знание таких аномалий полезно при работе с требовательным к производительности кодом.\u003C\u002Fp\u003E\u003Cp\u003EВ этом посте рассмотрим один из подобных кейсов: поразительно низкая производительность \u003Ccode\u003EString.format()\u003C\u002Fcode\u003E при простой конкатенации строк.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fed4\u002F612\u002F7ef\u002Fed46127ef6d1b8f8d650482dfd335220.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fed4\u002F612\u002F7ef\u002Fed46127ef6d1b8f8d650482dfd335220.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"java"},{"titleHtml":"performance"},{"titleHtml":"jdk"}]},"580170":{"id":"580170","timePublished":"2021-09-28T10:36:25+00:00","isCorporative":true,"lang":"ru","titleHtml":"Дитя конверсии: обзор ноутбука IBM ThinkPad iSeries 1400","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"154372","alias":"ereinion","fullname":"Виталий Прокофьев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F53d\u002F8ec\u002F1fb\u002F53d8ec1fb1d65d37bb85b94c51b17167.jpg","speciality":"Руководитель отдела услуг администрирования"},"statistics":{"commentsCount":0,"favoritesCount":0,"readingCount":891,"score":10,"votesCount":10},"hubs":[{"relatedData":null,"id":"14740","alias":"selectel","type":"corporative","title":"Блог компании Selectel","titleHtml":"Блог компании Selectel","isProfiled":false},{"relatedData":null,"id":"21898","alias":"hardware","type":"collective","title":"Компьютерное железо","titleHtml":"Компьютерное железо","isProfiled":false},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false},{"relatedData":null,"id":"21930","alias":"antikvariat","type":"collective","title":"Старое железо","titleHtml":"Старое железо","isProfiled":false},{"relatedData":null,"id":"21952","alias":"notebooks","type":"collective","title":"Ноутбуки","titleHtml":"Ноутбуки","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsn\u002Fs4\u002F4f\u002Fsns44fybis21deyqyx_mrkwrkie.png\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nКогда компания пытается войти в новый для себя сегмент рынка, часто получаются очень необычные и забавные девайсы. Яркие примеры — почти электромобиль BMW i3, самолет HondaJet, постсоветские мясорубки и соковыжималки, которые после обработки напильником требовали лицензии на ношение, и ноутбуки IBM ThinkPad iSeries. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЗадуманные как недорогие машины для домашнего применения и крайне малого бизнеса, эти машины стали примером неоднозначных решений и странного дизайна. Но со временем превратились в большую редкость, не сразу понятую и принятую коллекционерами, но теперь — очень желанную.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ноутбук"},{"titleHtml":"лэптоп"},{"titleHtml":"старое железо"},{"titleHtml":"история ИТ"},{"titleHtml":"celeron"},{"titleHtml":"intel"},{"titleHtml":"thinkpad"},{"titleHtml":"ibm"},{"titleHtml":"lenovo"}]},"580172":{"id":"580172","timePublished":"2021-09-27T11:45:49+00:00","isCorporative":true,"lang":"ru","titleHtml":"Небинарный ngIf*","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1050218","alias":"Waterplea","fullname":"Александр Инкин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa70\u002F569\u002Ff31\u002Fa70569f31346559ce2b8b875e7f97480.jpg","speciality":"Google Developer Expert | Angular"},"statistics":{"commentsCount":2,"favoritesCount":21,"readingCount":1379,"score":18,"votesCount":20},"hubs":[{"relatedData":null,"id":"17420","alias":"tinkoff","type":"corporative","title":"Блог компании TINKOFF","titleHtml":"Блог компании TINKOFF","isProfiled":false},{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"18109","alias":"angular","type":"collective","title":"Angular","titleHtml":"Angular","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВам когда-нибудь хотелось отобразить состояние загрузки, пока \u003Ccode\u003EngIf\u003C\u002Fcode\u003E ждет ответа от \u003Ccode\u003Easync\u003C\u002Fcode\u003E-пайпа? Или, может, вы мечтали передать в \u003Ccode\u003EngFor\u003C\u002Fcode\u003E шаблон для пустого массива? Возможно, вы бросили это, потому что вам не хотелось реализовывать базовую логику этих директив самому. На самом деле в этом нет нужды! Один и тот же селектор может подцепить несколько директив, что позволяет расширить функциональность встроенных директив дополнительной логикой.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"template"},{"titleHtml":"directive"},{"titleHtml":"angular"},{"titleHtml":"structural"}]},"580194":{"id":"580194","timePublished":"2021-09-27T12:36:12+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сотрудники на карте: отвечаем на 10 важных вопросов о трекинге","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1254716","alias":"Axelus","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F118\u002Fc4f\u002F08f\u002F118c4f08ffa66438ad6be22e205d563d.png","speciality":"Разработчик"},"statistics":{"commentsCount":0,"favoritesCount":13,"readingCount":1734,"score":13,"votesCount":15},"hubs":[{"relatedData":null,"id":"20758","alias":"regionsoft","type":"corporative","title":"Блог компании RegionSoft","titleHtml":"Блог компании RegionSoft","isProfiled":false},{"relatedData":null,"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"relatedData":null,"id":"12365","alias":"saas","type":"collective","title":"SaaS \u002F S+S","titleHtml":"SaaS \u002F S+S","isProfiled":true},{"relatedData":null,"id":"17783","alias":"geo","type":"collective","title":"Геоинформационные сервисы","titleHtml":"Геоинформационные сервисы","isProfiled":true},{"relatedData":null,"id":"20736","alias":"hr_management","type":"collective","title":"Управление персоналом","titleHtml":"Управление персоналом","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛюбой контроль сотрудников — опасный и болезненный вопрос, особенно в небольших компаниях. Часто в дружеские и открытые отношения компании не вписывается ни одна из форм контроля, рассчитывать можно только на доверие. Но пресловутый ковид и здесь внёс свои коррективы: расширение удалённой работы, увеличение штата мобильных сотрудников, частичная занятость пополнили ряды полевых сисадминов, аутсорсеров поддержки и остальных «разъездных» работников. Увы, люди разные и вслед за приятными плодами и бонусами удалёнки пришли негативные истории про поведение курьеров, опоздания и откровенные нарушения сотрудников на территории клиентов, неявки на работу или к заказчику и т.д. С этим столкнулись и ритейл, и ИТ, и любая сфера с мобильными сотрудниками. Очень хочется верить в лучшее, но без минимального контроля можно просто потерять бизнес — и тогда пострадают коллеги нерадивых сотрудников.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"geomonitor"},{"titleHtml":"геолокация"},{"titleHtml":"геозона"},{"titleHtml":"трекинг"}]},"580204":{"id":"580204","timePublished":"2021-09-27T12:31:54+00:00","isCorporative":false,"lang":"ru","titleHtml":"Почему с using namespace std; может быть очень плохо","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"sbi, Greg Hewgill","originalUrl":"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F1452721\u002Fwhy-is-using-namespace-std-considered-bad-practice"}}],"author":{"id":"936030","alias":"F0iL","fullname":"K. just K.","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fbcd\u002F9c7\u002F270\u002Fbcd9c7270c0727e164ac404a7f929971.jpg","speciality":"Разработчик"},"statistics":{"commentsCount":24,"favoritesCount":19,"readingCount":10700,"score":23,"votesCount":33},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"524","alias":"complete_code","type":"collective","title":"Совершенный код","titleHtml":"Совершенный код","isProfiled":true},{"relatedData":null,"id":"559","alias":"cpp","type":"collective","title":"C++","titleHtml":"C++","isProfiled":true},{"relatedData":null,"id":"17188","alias":"compilers","type":"collective","title":"Компиляторы","titleHtml":"Компиляторы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EТо, что написано ниже, для многих квалифицированных C++ разработчиков будет прекрасно известной и очевидной вещью, но тем не менее, я периодически встречаю using namespace std; в коде различных проектов, а недавно в \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\" rel=\"noopener noreferrer nofollow\"\u003Eнашумевшей статье про впечатления от высшего образования\u003C\u002Fa\u003E было упомянуто, что студентов так учат писать код в вузах, поэтому давайте повторим очевидное еще раз.\u003C\u002Fp\u003E\u003Cp\u003EИтак... многие слышали, что \u003Cstrong\u003Eusing namespace std;\u003C\u002Fstrong\u003E в C++ считается плохой практикой. Касательно недопустимости использования using namespace в header-файлах вопросов обычно не возникает, если мы хоть немного понимаем, как работает препроцессор компилятора: .hpp-файлы при использовании директивы #include вставляются в код \"как есть\", и соответственно using автоматически распространится на все затронутые  .hpp- и .cpp-файлы, если файл с ним был заинклюден хоть в одном звене цепочки (на одном из сайтов это метко обозвали как \"заболевание, передающеемя половым путем\"). Но вот про .cpp-файлы все не так очевидно, так что давайте еще раз разберем, что же именно здесь не так.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F662\u002F8a9\u002Fe33\u002F6628a9e3322ab1dbca4e4976098da83d.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F662\u002F8a9\u002Fe33\u002F6628a9e3322ab1dbca4e4976098da83d.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"с++"},{"titleHtml":"namespace"},{"titleHtml":"namespaces"},{"titleHtml":"best practices"},{"titleHtml":"антипаттерны"}]},"580206":{"id":"580206","timePublished":"2021-09-27T12:51:03+00:00","isCorporative":false,"lang":"ru","titleHtml":"МТС отказался от скрытых мобильных подписок?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2467147","alias":"Plusodin","fullname":"Владимир","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F343\u002Fb77\u002Fd12\u002F343b77d12f047368849a9880276f936e.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":39,"favoritesCount":9,"readingCount":8474,"score":21,"votesCount":23},"hubs":[{"relatedData":null,"id":"22008","alias":"cellular","type":"collective","title":"Сотовая связь","titleHtml":"Сотовая связь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПривет, Хабр!\u003C\u002Fp\u003E\u003Cp\u003EНу что, подходит к концу первый сезон сериала «О скрытых мобильных подписках и операторах связи». Предыдущие три серии: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F550448\u002F\" rel=\"noopener noreferrer nofollow\"\u003EМегафон\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F563260\u002F\" rel=\"noopener noreferrer nofollow\"\u003EБилайн\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F571256\u002F\" rel=\"noopener noreferrer nofollow\"\u003ETele2\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EНу и вишенка на этом торте – МТС.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"мтс"},{"titleHtml":"мобильные подписки"},{"titleHtml":"подписки"},{"titleHtml":"оператор связи"},{"titleHtml":"теле2"},{"titleHtml":"мегафон"},{"titleHtml":"билайн"}]},"580210":{"id":"580210","timePublished":"2021-09-27T12:53:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"PHP Дайджест № 212 (13 – 27 сентября 2021)","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"100489","alias":"pronskiy","fullname":"Роман Пронский","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F27f\u002Fb99\u002Feb3\u002F27fb99eb3e30e3221c5839e88be02395.jpg","speciality":"PHP"},"statistics":{"commentsCount":1,"favoritesCount":16,"readingCount":5624,"score":54,"votesCount":54},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"477","alias":"symfony","type":"collective","title":"Symfony","titleHtml":"Symfony","isProfiled":true},{"relatedData":null,"id":"9554","alias":"yii","type":"collective","title":"Yii","titleHtml":"Yii","isProfiled":true},{"relatedData":null,"id":"18812","alias":"laravel","type":"collective","title":"Laravel","titleHtml":"Laravel","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fek\u002F6r\u002Fr1\u002Fek6rr1odvyzb89tfv0lq4cmfxi4.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nПодборка свежих новостей и материалов из мира PHP.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВышел PHP 8.1 RC2 и уже доступен первый пакет с использованием перечислений, будет сделан форк Magento, новый тип стандартов PER в дополнение к PSR, стартовала PhpStorm 2021.3 EAP, Symfony 6 будет полностью типизирован — как обновляться?\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nДля PHP 8.2 предложены новые оптимизированные структуры данных.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nТакже в выпуске порция инструментов, полезные статьи, видео и анонсы двух митапов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПриятного чтения!\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дайджест"},{"titleHtml":"php-дайджест"},{"titleHtml":"PHP"},{"titleHtml":"Symfony"},{"titleHtml":"Laravel"},{"titleHtml":"Magento"},{"titleHtml":"PHPUnit"},{"titleHtml":"PHP 8.1"},{"titleHtml":"PHP 8.2"}]},"580214":{"id":"580214","timePublished":"2021-09-28T03:06:01+00:00","isCorporative":false,"lang":"ru","titleHtml":"Как выбрать подложку для СВЧ плат?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2759195","alias":"Leka_engineer","fullname":"Олеся","avatarUrl":"","speciality":"инженер-разработчик СВЧ устройств"},"statistics":{"commentsCount":11,"favoritesCount":12,"readingCount":965,"score":13,"votesCount":17},"hubs":[{"relatedData":null,"id":"19395","alias":"netdev","type":"collective","title":"Разработка систем связи","titleHtml":"Разработка систем связи","isProfiled":true},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"22016","alias":"easyelectronics","type":"collective","title":"Электроника для начинающих","titleHtml":"Электроника для начинающих","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭтой статьёй я продолжаю цикл (надеюсь, что получится несколько) статей про особенности проектирования и изготовления СВЧ-плат. Эта  статья очень простая, так что, скорее всего, большинство читателей-СВЧшников не найдёт в ней ничего нового. Однако, я надеюсь, что статья будет полезна начинающим разработчикам.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"свч"},{"titleHtml":"свч-техника"},{"titleHtml":"печатная плата"},{"titleHtml":"производство электроники"},{"titleHtml":"разработка электроники"},{"titleHtml":"приложения для android"}]},"580228":{"id":"580228","timePublished":"2021-09-27T16:41:21+00:00","isCorporative":true,"lang":"ru","titleHtml":"Идеальная светодиодная лампа за 21 рубль","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"108988","alias":"AlexeyNadezhin","fullname":"Алексей Надежин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffdc\u002F3ac\u002F9a2\u002Ffdc3ac9a2dc0107cc956f1bd0cf5fc2b.jpg","speciality":"Блогер"},"statistics":{"commentsCount":60,"favoritesCount":112,"readingCount":29608,"score":150,"votesCount":154},"hubs":[{"relatedData":null,"id":"21646","alias":"lamptest","type":"corporative","title":"Блог компании LampTest","titleHtml":"Блог компании LampTest","isProfiled":false},{"relatedData":null,"id":"21894","alias":"gadgets","type":"collective","title":"Гаджеты","titleHtml":"Гаджеты","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Удивительно осознавать, что достаточно сложное электронное устройство, которым является светодиодная лампочка, может стоить 21 рубль. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЕщё сложнее поверить, что эта лампочка безукоризненна по всем параметрам.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F849\u002Ffcd\u002F20f849fcd6a3891f506676fc87223bdf.jpg\"\u003E\u003C\u002Fdiv\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"led"},{"titleHtml":"светодиодные лампы"},{"titleHtml":"тест"}]},"580270":{"id":"580270","timePublished":"2021-09-28T07:08:30+00:00","isCorporative":true,"lang":"ru","titleHtml":"Варим суп из стали: оптимизация логистики ковшей и как устроен цех КЦ № 2","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2790193","alias":"AlexanderSkorniakov","fullname":"Александр Скорняков","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fcbf\u002F737\u002F072\u002Fcbf737072762c9fe82994575e36e0c25.jpg","speciality":"Руководитель цифровых продуктов"},"statistics":{"commentsCount":14,"favoritesCount":14,"readingCount":2138,"score":39,"votesCount":39},"hubs":[{"relatedData":null,"id":"22816","alias":"nlmk","type":"corporative","title":"Блог компании Блог компании Группа НЛМК","titleHtml":"Блог компании Блог компании Группа НЛМК","isProfiled":false},{"relatedData":null,"id":"397","alias":"analysis_design","type":"collective","title":"Анализ и проектирование систем","titleHtml":"Анализ и проектирование систем","isProfiled":true},{"relatedData":null,"id":"18816","alias":"industrial_control_system","type":"collective","title":"Промышленное программирование","titleHtml":"Промышленное программирование","isProfiled":true},{"relatedData":null,"id":"20682","alias":"pm","type":"collective","title":"Управление проектами","titleHtml":"Управление проектами","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"Привет из конвертерного цеха металлургического комбината! Смотрите, у нас тут есть вот такой суп в ковше, стоящем на сталевозе:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fdh\u002F3m\u002Fmn\u002Fdh3mmn_3v_fbdyt4k2hs3fhfnjm.jpeg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Ci\u003EТаких ковшей на 320 тонн стали в цехе 40 штук, и они медленно остывают. Этой стали грустно и одиноко, она подмерзает. Через эти ковши проходит 10 миллионов тонн стали в год, это 14% стали России\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНа входе в цех у нас жидкий чугун и металлолом, на выходе надо получить сляб — большой слиток стали. Контур системы диспетчеризации «Гефест» начинается с конвертера, где мы продуваем чугун кислородом, таким образом окисляем и удаляем ненужные нам примеси. После конвертера получается «стальной бульон» для супа, в который уже можно добавлять основные ингредиенты, чтобы получались разные марки стали. За смену мы выплавляем несколько заказов, и каждая сталь требует своего рецепта — это разные добавки, разные техпроцессы, разные температуры и разные последовательности действий. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fiv\u002Fmh\u002Fdj\u002Fivmhdjdffezd6k7p1kmw38_akcu.jpeg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Ci\u003EНа участке аргонной установки\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nУзким местом, в зависимости от сорта стали, может стать любой технологический узел на пути плавки от конвертера до разливки — агрегаты внепечной обработки, мостовые краны или сталевозы для перемещения ковшей могут оказаться в какой-то конкретный момент перегружены. Раньше графики последовательности действий составлялись в блокноте человеком и были недостаточно оптимизированы. Плюс непредсказуемость: графики с довольно широкими временными границами дают большие потери производительности, а графики с узкими границами — не дают прореагировать на возможную поломку, задержку в процессе или вынужденную остановку. Не знаю, сколько стоит у вас простой прода, но у нас один остывший не к месту ковш запросто может нанести ущерба на несколько миллионов рублей. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ общем, мы написали систему, которая не только оптимизирует загрузку этого участка производства, но и регулярно (во время смены) пересчитывает всю логистику ковшей.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНо давайте начну с, собственно, рассказа про то, что же именно оптимизируется в цехе.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"сталь"},{"titleHtml":"производство"},{"titleHtml":"оптимизация"},{"titleHtml":"металл"},{"titleHtml":"металлургия"},{"titleHtml":"диспетчеризация"}]},"580304":{"id":"580304","timePublished":"2021-09-27T18:31:25+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как сделать 248MP фотографию Солнца","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Simon Tang","originalUrl":"https:\u002F\u002Fpetapixel.com\u002F2021\u002F09\u002F15\u002Fa-closer-look-how-i-created-a-248mp-photo-of-the-sun\u002F"}}],"author":{"id":"2192534","alias":"Itelma","fullname":"T-800","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc3a\u002Fd1e\u002F43d\u002Fc3ad1e43d500046c3228c9494b510912.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":10,"favoritesCount":11,"readingCount":3403,"score":15,"votesCount":15},"hubs":[{"relatedData":null,"id":"22356","alias":"itelma","type":"corporative","title":"Блог компании НПП ИТЭЛМА","titleHtml":"Блог компании НПП ИТЭЛМА","isProfiled":false},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21932","alias":"photo","type":"collective","title":"Фототехника","titleHtml":"Фототехника","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fe02\u002F643\u002Fa55\u002Fe02643a550e20aa10c366e20956e4b40.jpg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ci\u003EЭто изображение диска нашего Солнца создано с помощью большого рефракторного (линзового) телескопа и высокоскоростной монохромной CMOS-камеры.\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКаждый день над нашими головами висит большой шар света. Он там всегда, и никто не обращает на него внимания. Разумеется, мы не советуем вам долго смотреть на него и при этом ослепнуть, тем не менее, наука дала нам возможность смотреть прямо на солнце совершенно безопасно.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПоскольку техника стала более доступной, обычный человек может заглянуть в многочисленные слои Солнца с помощью специального оборудования, которое может купить в любом хорошем магазине телескопов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ этой статье мы подробно рассмотрим слой, известный как хромосфера: область Солнца, видимая в оранжево-красном спектре. При помощи специального фильтра это устройство блокирует весь нежелательный свет, пропуская при этом определенный диапазон частот, который нас интересует.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"обработка изображений"},{"titleHtml":"фототехника"}]},"580336":{"id":"580336","timePublished":"2021-09-28T05:40:43+00:00","isCorporative":false,"lang":"ru","titleHtml":"DOM, который построил Chrome. Или не построил? Или не Chrome? Или не DOM?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2671923","alias":"Maxim_from_HW","fullname":"Максим","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F33e\u002F1a0\u002F5ba\u002F33e1a05ba0d2d651cc292ce76ad45ee1.png","speciality":"CEO"},"statistics":{"commentsCount":18,"favoritesCount":36,"readingCount":2881,"score":17,"votesCount":17},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"524","alias":"complete_code","type":"collective","title":"Совершенный код","titleHtml":"Совершенный код","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EОбычный, теневой, виртуальный, инкрементальный… Как получилось, что простой программный интерфейс доступа к элементам веб-страниц обзавелся таким количеством «родственников»? Чем современные фреймворки не устраивает стандартная объектная модель документа или просто DOM? Что и как на самом деле отрисовывает браузер в процессе рендера веб-страницы?\u003C\u002Fp\u003E\u003Cp\u003EВсем привет, это \u003Ca href=\"https:\u002F\u002Fwww.facebook.com\u002Fmy.kravets\" rel=\"noopener noreferrer nofollow\"\u003EМакс Кравец\u003C\u002Fa\u003E из Holyweb. Помните сцену из Матрицы, в которой один из юных кандидатов в Избранные наставляет Нео: «Не пытайся согнуть ложку. Первое, что ты должен понять — ложки не существует!»? Давайте переформулирую: «Не пытайся изменить DOM...». А вот о том, что прячется под многоточием, мы сегодня и поговорим.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5c9\u002F1cb\u002Fe9b\u002F5c91cbe9b4674ea479fed0a55f81fb7c.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5c9\u002F1cb\u002Fe9b\u002F5c91cbe9b4674ea479fed0a55f81fb7c.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"dom"},{"titleHtml":"google chrome"},{"titleHtml":"javascript"},{"titleHtml":"css"}]},"580348":{"id":"580348","timePublished":"2021-09-28T08:18:27+00:00","isCorporative":true,"lang":"ru","titleHtml":"Самый большой космический телескоп Джеймс Уэбб должен изменить наши представления о космосе","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"64252","alias":"Cloud4Y","fullname":"Cloud4Y","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc2d\u002Fd0d\u002Fc05\u002Fc2dd0dc05834aebeb86bb76e35caeaab.png","speciality":"Корпоративный облачный провайдер"},"statistics":{"commentsCount":10,"favoritesCount":3,"readingCount":1763,"score":16,"votesCount":18},"hubs":[{"relatedData":null,"id":"17352","alias":"cloud4y","type":"corporative","title":"Блог компании Cloud4Y","titleHtml":"Блог компании Cloud4Y","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИзучение новых миров,  понимание происхождения Вселенной, поиск жизни вне Земли. Всё это — задачи космического телескопа \"Джеймс Уэбб\", долгожданного преемника Хаббла.  Телескоп больше и легче Хаббла, зато в 100 раз мощнее,  а приборы — в семь раз чувствительнее. \u003C\u002Fp\u003E\u003Cp\u003EДжеймс Уэбб — это устройство для поиска ответов на неотвеченные вопросы о Вселенной, для изучения того, что до сих пор оставалось неизведанным. Что же такого в этом телескопе?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ed\u002F24e\u002Fd75\u002F0ed24ed759f6e945b81c1ce1beedd228.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ed\u002F24e\u002Fd75\u002F0ed24ed759f6e945b81c1ce1beedd228.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Телескоп"},{"titleHtml":"уэбб"},{"titleHtml":"космос"},{"titleHtml":"технологии"}]},"580360":{"id":"580360","timePublished":"2021-09-28T07:27:40+00:00","isCorporative":true,"lang":"ru","titleHtml":"Вы используете больше Open Source-софта, чем думаете","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Klint Finley","originalUrl":"https:\u002F\u002Fgithub.com\u002Freadme\u002Ffeatured\u002Funseen-oss"}}],"author":{"id":"16172","alias":"shurup","fullname":"Дмитрий Шурупов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F062\u002Fc85\u002F607\u002F062c85607fbe4aaa29e1ad2076cd13a0.jpg","speciality":"Open Source geek"},"statistics":{"commentsCount":1,"favoritesCount":2,"readingCount":1669,"score":24,"votesCount":28},"hubs":[{"relatedData":null,"id":"20940","alias":"flant","type":"corporative","title":"Блог компании Флант","titleHtml":"Блог компании Флант","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"144","alias":"open_source","type":"collective","title":"Open source","titleHtml":"Open source","isProfiled":true},{"relatedData":null,"id":"20688","alias":"research","type":"collective","title":"Исследования и прогнозы в IT","titleHtml":"Исследования и прогнозы в IT","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cstrong\u003E\u003Cem\u003EПрим. перев.\u003C\u002Fem\u003E\u003C\u002Fstrong\u003E\u003Cem\u003E: оригинал этой статьи был опубликован минувшим летом в рамках проекта ReadME. Он создан в GitHub с целью стать своеобразной трибуной для многочисленных Open Source-разработчиков, предоставив им возможность поделиться с широким сообществом актуальными для них проблемами. Данный материал несет в себе призыв «перестать воспринимать Open Source как должное» и раскрывает те сложности, с которыми сталкиваются многие авторы свободного ПО, применяемого буквально повсеместно.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EТобиас Копперс (Tobias Koppers) не работает в Instagram. И никогда не работал. Но с 2014 года он отвечает за поддержку важного компонента веб-версии Instagram. Копперс является создателем webpack — Open Source-инструмента для сборки (или «бандлинга») кода JavaScript.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"open source"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["580228","580124","580210","580270","575686","579778","580360","580204","580206","572164","580172","580336","580348","580304","579590","580214","580194","580164","580170","579780"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":4},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["572574","554720","551902"],"similarListRefs":{"551902":{"id":"551902","timePublished":"2021-04-16T08:11:11+00:00","isCorporative":false,"lang":"ru","titleHtml":"Почему следует избегать использования JPA\u002FHibernate в продакшене","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"206178","alias":"jdev","fullname":"Алексей","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa58\u002F0e3\u002F59d\u002Fa580e359d9077a16b184be67721bc8e4.jpg","speciality":"ТехЛид"},"statistics":{"commentsCount":24,"favoritesCount":80,"readingCount":9123,"score":16,"votesCount":28},"hubs":[{"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true},{"id":"17719","alias":"oop","type":"collective","title":"ООП","titleHtml":"ООП","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EJPA безусловно самая распространённая технология работы с базами данных на платформе Java. Но она же и наименее пригодна для разработки быстрых и поддерживаемых систем. В этой статье я расскажу почему JPA лучше не использовать в продакшене и что можно использовать вместо неё.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc01\u002Ffc4\u002Fe42\u002Fc01fc4e42cf1bd112c29d778c50fc0e1.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc01\u002Ffc4\u002Fe42\u002Fc01fc4e42cf1bd112c29d778c50fc0e1.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null},"554720":{"id":"554720","timePublished":"2021-04-28T13:03:59+00:00","isCorporative":true,"lang":"ru","titleHtml":"Hibernate и Spring Boot: кто отвечает за имена таблиц?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2598355","alias":"andreyoganesyan","fullname":"Andrey Oganesyan","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8c6\u002Fcd7\u002F0f3\u002F8c6cd70f3f351c17346a7ce4dc0e00ae.jpg","speciality":"User"},"statistics":{"commentsCount":2,"favoritesCount":43,"readingCount":4378,"score":15,"votesCount":17},"hubs":[{"id":"18694","alias":"haulmont","type":"corporative","title":"Блог компании Haulmont","titleHtml":"Блог компании Haulmont","isProfiled":false},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКогда мы добавляем зависимость в проект, мы подписываем контракт. Зачастую, многие условия в нем «написаны мелким шрифтом». В этой статье мы рассмотрим кое-что, что легко&nbsp; пропустить при подписании трехстороннего контракта между вами, Hibernate и Spring Boot. Речь пойдет о стратегиях именования.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd9d\u002F1ff\u002F956\u002Fd9d1ff956ce23e4a169fedc17810d097.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd9d\u002F1ff\u002F956\u002Fd9d1ff956ce23e4a169fedc17810d097.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null},"572574":{"id":"572574","timePublished":"2021-08-12T11:09:54+00:00","isCorporative":true,"lang":"ru","titleHtml":"Kotlin + Hibernate: всё сложно","editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"2598355","alias":"andreyoganesyan","fullname":"Andrey Oganesyan","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8c6\u002Fcd7\u002F0f3\u002F8c6cd70f3f351c17346a7ce4dc0e00ae.jpg","speciality":"User"},"statistics":{"commentsCount":4,"favoritesCount":53,"readingCount":5506,"score":14,"votesCount":18},"hubs":[{"id":"18694","alias":"haulmont","type":"corporative","title":"Блог компании Haulmont","titleHtml":"Блог компании Haulmont","isProfiled":false},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true},{"id":"19441","alias":"kotlin","type":"collective","title":"Kotlin","titleHtml":"Kotlin","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНевозможно представить JPA без сущностей. Однако, их определение в Котлине таит некоторое количество подводных камней. Давайте посмотрим, как избежать распространенных ошибок и использовать возможности Котлина на максимум. Внимание спойлер! Классы данных — не лучший вариант для сущностей.\u003C\u002Fp\u003E\u003Cp\u003EВ этой статье основное внимание будет уделено Hibernate, поскольку он является несомненным лидером среди всех реализаций JPA.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9d0\u002F53e\u002F81d\u002F9d053e81d6ef70bb7e87e997f0054121.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9d0\u002F53e\u002F81d\u002F9d053e81d6ef70bb7e87e997f0054121.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"vlsergey":{"scoreStats":{"score":72.7,"votesCount":228},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"42070","alias":"vlsergey","fullname":"Сергей Владимиров","avatarUrl":null,"speciality":"Пользователь"}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
