<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Настройка PPPoE с шейпингом трафика для небольшой сети / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/111399\/"},"headline":"Настройка PPPoE с шейпингом трафика для небольшой сети","datePublished":"2011-01-07T18:26:19+03:00","dateModified":"2011-01-07T18:26:19+03:00","author":{"@type":"Person","name":"kest"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточн...","url":"https:\/\/habr.com\/ru\/post\/111399\/#post-content-body","about":["h_linux","f_admin"],"image":["https:\/\/habr.com\/share\/publication\/111399\/f58ef6c02df0f6ce8d108a59d073014e\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Настройка PPPoE с шейпингом трафика для небольшой сети" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Настройка PPPoE с шейпингом трафика для небольшой сети" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Настройка PPPoE с шейпингом трафика для небольшой сети" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/111399/f58ef6c02df0f6ce8d108a59d073014e/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/111399/f58ef6c02df0f6ce8d108a59d073014e/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/111399/f58ef6c02df0f6ce8d108a59d073014e/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/111399/f58ef6c02df0f6ce8d108a59d073014e/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/111399/f58ef6c02df0f6ce8d108a59d073014e/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="111399" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2011-01-07T15:26:19.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/111399/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/111399/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/111399/f58ef6c02df0f6ce8d108a59d073014e/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/kest/" title="kest" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/8c5/1eb/a96/8c51eba96a2c4a5a45ab56241c15c729.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/kest/" class="tm-user-info__username">
      kest
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2011-01-07T15:26:19.000Z" title="2011-01-07, 18:26">7  января  2011 в 18:26</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Настройка PPPoE с шейпингом трафика для небольшой сети</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/linux/" class="tm-article-snippet__hubs-item-link"><span>Настройка Linux</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Из песочницы
      </span></div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было принято решение использовать собственное на базе Debian Linux. Опытом его поднятия я хочу поделиться с вами в этом посте, но приведенные здесь версии могли немного устареть с момента написания мануала «для себя», так что нужно проявить некоторую внимательность. Также, нужно учитывать, что приведенное решение далеко от идеального и профессионального. Оно поможет скорее тем, кому нужно быстро поднять у себя сервер, раздающий интернет. В конце у нас будет раздача интернета через PPPoE с назначением внутренних IP клиентам, шейпинг трафика, DNS сервер и простой мониторинг текущих сессий из консоли.<br/>
<a name="habracut"></a><br/>
<br/>
<h4>Подготовка системы</h4><br/>
<code>aptitude update<br/>
aptitude install openssh-server mc mtr tracert nano tcpdump bind9 pppoe freeradius radiusclient1 rcconf php5</code><br/>
<br/>
<h4>Настройка DNS-сервера</h4><br/>
Выполняем<br/>
<code>nano /etc/bind/named.conf.options</code><br/>
<br/>
Добавляем в конец файла:<br/>
<code>allow-transfer { none; };<br/>
allow-query { 10.128.0.0/16; localhost; }; //подсеть наших пользователей<br/>
allow-recursion { 10.128.0.0/16; localhost; }; //рекурсия только локальным<br/>
version "My ISP DNS"; //скрыли информацию о версии сервера<br/>
</code><br/>
<br/>
Начнем настраивать chroot-окружение для нашего сервера DNS. Создадим каталоги корневой файловой системы сервера DNS — root-dns:<br/>
<code>mkdir -p /root-dns/etc<br/>
mkdir /root-dns/dev<br/>
mkdir -p /root-dns/var/cache/bind<br/>
mkdir -p /root-dns/var/run/bind/run<br/>
/etc/init.d/bind9 stop<br/>
nano /etc/default/bind9</code><br/>
<br/>
Нашли строчку «OPTIONS=» и заменили:<br/>
<code>OPTIONS="-u bind -t /root-dns"</code><br/>
<br/>
<code>mv /etc/bind /root-dns/etc<br/>
ln -s /root-dns/etc/bind /etc/bind<br/>
nano /etc/init.d/bind9<br/>
</code><br/>
<br/>
Нашли строчку «OPTIONS=» и заменили:<br/>
<code>OPTIONS="-u bind -t /root-dns"</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/init.d/rsyslogd</code><br/>
<br/>
Нашли «RSYSLOGD_OPTIONS» и заменили:<br/>
<code>RSYSLOGD_OPTIONS="-c3 -a /root-dns/dev/log"</code><br/>
<br/>
Защитим от редактирования и удаления файл конфигурации named.conf:<br/>
<code>chattr +i /root-dns/etc/bind/named.conf</code><br/>
<br/>
Примечание. Не забудьте снять атрибут «i» перед редактированием файла конфигурации (chattr -i …)<br/>
<br/>
<code>mknod /root-dns/dev/null c 1 3<br/>
mknod /root-dns/dev/random c 1 8<br/>
chmod 666 /root-dns/dev/null /root-dns/dev/random<br/>
chown -R bind:bind /root-dns/var/*<br/>
chown -R bind:bind /root-dns/etc/bind<br/>
/etc/init.d/bind9 start<br/>
</code><br/>
<br/>
<h4>Сервер PPPoE</h4><br/>
<code>cd /tmp<br/>
apt-get build-dep pppoe<br/>
apt-get source pppoe<br/>
cd rp-pppoe-3.8/src<br/>
./configure<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>nano config.h</code><br/>
<br/>
Теперь в только что созданном файле config.h нужно заменить строчку:<br/>
<code>/* #undef HAVE_LINUX_KERNEL_PPPOE */</code><br/>
<br/>
на строчку:<br/>
<code>#define HAVE_LINUX_KERNEL_PPPOE 1</code><br/>
<br/>
Выполняем:<br/>
<code>cd ..<br/>
./debian/rules PLUGIN_PATH=/usr/lib/pppd/2.4.4/rp-pppoe.so<br/>
./debian/rules binary<br/>
cd ..<br/>
dpkg -i pppoe_3.8-3_i386.deb<br/>
</code><br/>
<br/>
Заморозим пакет в системе, чтобы предотвратить его автоматическое обновление:<br/>
<code>echo pppoe hold | dpkg —set-selections</code><br/>
<br/>
С этого момента нужно как минимум при каждом обновлении системы просматривать список обновлений. Если для pppoe будет выпущено обновление, закрывающее уязвимость, необходимо будет собрать пакет из свежих исходников заново, снять фиксацию пакета в системе с помощью команды:<br/>
<code>echo pppoe install | dpkg --set-selections</code><br/>
<br/>
Теперь в системе установлен пакет с PPPoE-сервером, позволяющим поддерживать PPPoE-соединения на уровне ядра. Для запуска сервера в этом режиме, к команде описанной в предыдущем разделе нужно добавить опцию -k: pppoe-server -I eth1 -L 192.168.0.1 -k<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/ppp/pppoe-server-options</code><br/>
<br/>
Вставляем:<br/>
<code>logfile /var/log/pppoe.log<br/>
debug<br/>
mtu 1472<br/>
mru 1472<br/>
auth<br/>
require-pap<br/>
#require-chap<br/>
default-asyncmap<br/>
ktune<br/>
lcp-echo-interval 20<br/>
lcp-echo-failure 2<br/>
ms-dns 10.128.0.1<br/>
plugin radius.so<br/>
plugin radattr.so<br/>
10.128.0.1:<br/>
nobsdcomp<br/>
noccp<br/>
noendpoint<br/>
noipdefault<br/>
noipx<br/>
novj<br/>
receive-all</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/ppp/options</code><br/>
<br/>
В конфиге /etc/ppp/options: убираем всё, ставим:<br/>
<code>lock</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/init.d/pppoe-server<br/>
</code><br/>
<br/>
Скрипт:<br/>
<code>#!/bin/bash<br/>
# init file for rp-pppoe server<br/>
#<br/>
# description: PPPOE kernel mode server<br/>
#<br/>
# processname: pppoe-server<br/>
# chkconfig: - 45 45<br/>
# source function library<br/>
#. /etc/rc.status<br/>
case "$1" in<br/>
start)<br/>
echo -n "Starting PPPOE server: "<br/>
/usr/sbin/pppoe-server -I eth0 -L 10.128.0.1 -R 10.128.1.1 -k<br/>
#Здесь eth0 — интерфейс, который смотрит в локальную сеть<br/>
#10.128.0.1 - IP PPPoE сервера<br/>
#10.128.1.1 - Первый IP адрес клиента<br/>
#touch /var/lock/subsys/pppoed<br/>
#rc_status -v<br/>
;;<br/>
stop)<br/>
echo -n "Shutting down PPPOE server: "<br/>
pkill pppoe-server<br/>
#rm -f /var/lock/subsys/pppoed<br/>
#rc_status -v<br/>
;;<br/>
restart)<br/>
$0 stop<br/>
$0 start<br/>
;;<br/>
status)<br/>
status pppoe-server<br/>
;;<br/>
*)<br/>
echo "Usage: pppoed {start|stop|restart|status}"<br/>
exit 1<br/>
esac<br/>
exit 0<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>rcconf</code><br/>
<br/>
Отключаем bind. Потом туда опять заходим и видим что он вообще исчез из списка. Внизу он таки есть, а рядом наш pppoe-server. Включили и то и то. Вышли. <br/>
<br/>
<code>cd /root-dns/etc/bind<br/>
rndc-confgen -r /dev/urandom -a<br/>
chgrp bind rndc.key<br/>
chmod +r rndc.key<br/>
nano named.conf.options<br/>
</code><br/>
<br/>
В конце файла добавляем:<br/>
<code>controls {<br/>
 inet 127.0.0.1 allow { localhost; } keys { rndc-key; };<br/>
};<br/>
include "/etc/bind/rndc.key";<br/>
</code><br/>
<br/>
Теперь ещё нужно включить форвардинг в ядре и сделать подхват правил iptables. Конфигурация пока будет тестовой.<br/>
<br/>
<h4>Параметры sysctl.conf, iptables, настройки сетевых интерфейсов</h4><br/>
Запускаем:<br/>
<code>nano /etc/sysctl.conf</code><br/>
<br/>
Раскомментировали, добавили чего небыло:<br/>
<code>net.ipv4.conf.default.rp_filter=1<br/>
net.ipv4.conf.all.rp_filter=1<br/>
net.ipv4.tcp_syncookies=1<br/>
net.ipv4.ip_forward=1<br/>
kernel.panic = 1<br/>
kernel.panic_on_oops = 1<br/>
kernel.panic_on_io_nmi = 1<br/>
kernel.panic_on_unrecovered_nmi = 1</code><br/>
<br/>
Последние 4 строчки — это перезагрузка при различных падениях системы, чтобы не ездить ради перезагрузки куда-то в другой город. Сохранили, далее делаем тестовый конфиг для iptables:<br/>
<code>iptables -t nat -F<br/>
iptables-save > /etc/firewall.conf<br/>
nano rc.local<br/>
</code><br/>
<br/>
Теперь в rc.local у нас будет:<br/>
<code>ifconfig eth0 up<br/>
iptables-restore &lt;/etc/firewall.conf<br/>
</code><br/>
<br/>
Далее, конфигурируем /etc/network/interfaces — тут eth0 получился локальным, для него ничего вообще не пишем, разве что auto eth0. А по поводу eth1 — если это интернет — я бы задумался о статическом внешнем айпи, в противном случае нельзя использовать SNAT, а только MASQUERADE, а он сильнее грузит систему.<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/network/interfaces</code><br/>
<br/>
Конфиг:<br/>
<code>auto lo<br/>
iface lo inet loopback<br/>
auto eth0<br/>
auto eth1<br/>
<br/>
allow-hotplug eth0 eth1<br/>
iface eth1 inet dhcp<br/>
</code><br/>
<br/>
В данном листинге eth1 — интернет через NAT и DHCP конфиг.<br/>
<br/>
<h4>Пробный запуск сервера PPPoE</h4><br/>
Далее надо протестировать PPPoE без радиуса. Для этого комментируем 2 строчки плагинов в /etc/ppp/pppoe-server-options.<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/ppp/pppoe-server-options</code><br/>
<br/>
Конфиг:<br/>
<code>#plugin radius.so<br/>
#plugin radattr.so<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/ppp/pap-secrets</code><br/>
<br/>
Дописываем в конец либо заменяем полностью содержимое:<br/>
<code>test * test 10.128.2.10</code><br/>
<br/>
Запускаем pppoe-server: <br/>
<code>/etc/init.d/pppoe-server start</code><br/>
<br/>
Перезагрузили сервер, проверили PPPoE и инет. На любом клиенте создаем PPPoE соединение и подключаемся, используя логин и пароль test. Для того чтобы инет работал у клиента, нужно включить маскарадинг:<br/>
<code>iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE</code><br/>
<br/>
Работает? Хорошо, вернули как было:<br/>
<code>iptables -t nat -F</code><br/>
<br/>
<h4>FreeRadius</h4><br/>
Запускаем:<br/>
<code>nano /etc/radiusclient/servers</code><br/>
<br/>
Заменяем содержимое файла:<br/>
<code>127.0.0.1 my-isp-radius</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/radiusclient/radiusclient.conf</code><br/>
<br/>
Заменяем содержимое файла:<br/>
<code>auth_order radius,local <br/>
login_tries 4 <br/>
login_timeout 60 <br/>
nologin /etc/nologin <br/>
issue /etc/radiusclient/issue <br/>
# RADIUS settings <br/>
authserver localhost:1812 <br/>
acctserver localhost:1812 <br/>
servers /etc/radiusclient/servers <br/>
dictionary /etc/radiusclient/dictionary <br/>
login_radius /usr/sbin/login.radius <br/>
# RADIUS server <br/>
seqfile /var/run/radius.seq <br/>
mapfile /etc/radiusclient/port-id-map <br/>
default_realm <br/>
radius_timeout 10 <br/>
radius_retries 3 <br/>
login_local /bin/login <br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/freeradius/radiusd.conf</code><br/>
<br/>
Заменяем содержимое файла:<br/>
<code>prefix = /usr<br/>
exec_prefix = /usr<br/>
sysconfdir = /etc<br/>
localstatedir = /var<br/>
sbindir = ${exec_prefix}/sbin<br/>
logdir = /var/log/freeradius<br/>
raddbdir = /etc/freeradius<br/>
radacctdir = ${logdir}/radacct<br/>
# Месторасположение конфигурационных и лог файлов.<br/>
confdir = ${raddbdir}<br/>
run_dir = ${localstatedir}/run/freeradius<br/>
# Каталог с подгружаемыми модулями.<br/>
libdir = ${exec_prefix}/lib<br/>
# Месторасположение pid-файла. Содержащего идентификатор процесса.<br/>
pidfile = ${run_dir}/freeradius.pid<br/>
# Имя пользователя и группа от которых запускается FreeRADIUS<br/>
user = freerad<br/>
group = freerad<br/>
# Максимальное время (в секундах) используемое для обработки запроса.<br/>
max_request_time = 30<br/>
# Удалить запросы которые обрабатываются более чем max_request_time<br/>
delete_blocked_requests = no<br/>
# Время ожидания (в секундах) перед очисткой reply запроса отправленного NAS.<br/>
cleanup_delay = 5<br/>
# Максимальное количество запросов хранимых сервером. Это число должно быть равно<br/>
# количеству клиентов помноженному на 256.<br/>
# К примеру для четырех клиентов оно будет 1024.<br/>
max_requests = 5120<br/>
# Закрепить за ip адресом. По умолчанию RADIUS сервер при старте принимает<br/>
# запросы со всех ip адресов.<br/>
bind_address = 127.0.0.1<br/>
# Закрепить за FreeRADIUS конкретный port. Если указан ноль,<br/>
# то значение берется из /etc/services<br/>
port = 0<br/>
# Запретить/разрешить ip адреса в dns имена.<br/>
# Включение этой опции может сильно снизить производительность.<br/>
hostname_lookups = no<br/>
# Создавать/несоздавать отладочные файлы при падении сервера.<br/>
allow_core_dumps = no<br/>
# Разрешить использование регулярных выражений.<br/>
regular_expressions = yes<br/>
extended_expressions = yes<br/>
# Записывать полный User-Name аттрибут если найден в запросе.<br/>
log_stripped_names = no<br/>
# Записывать в лог попытки авторизации.<br/>
log_auth = yes<br/>
# Записывать в логи пароли при авторизации.<br/>
# log_auth_badpass - не корректные пароли<br/>
# log_auth_goodpass - корректные пароли<br/>
log_auth_badpass = yes<br/>
log_auth_goodpass = no<br/>
# Включить/выключить коллизию пользователей.<br/>
usercollide = no<br/>
# конвертировать логин и/или пароль до или после авторизации.<br/>
lower_user = no<br/>
lower_pass = no<br/>
# удалить пробелы в логине и/или пароле.<br/>
nospace_user = no<br/>
nospace_pass = no<br/>
# настройки безопасности от возможных DoS аттак.<br/>
security {<br/>
# Максимальное допустимое количество аттрибутов в RADIUS пакете.<br/>
max_attributes = 200<br/>
# Задержка (в секундах) перед отправкой Access-Reject пакета.<br/>
reject_delay = 1<br/>
# Не отвечать на запросы Status-Server<br/>
status_server = no<br/>
}<br/>
# Конфигрурация клиентов RADIUS сервера.<br/>
# Описывается в отдельном файле.<br/>
$INCLUDE ${confdir}/clients.conf<br/>
# Отключить snmp поддержку.<br/>
snmp=no<br/>
# Настрока пула процессов.<br/>
thread pool {<br/>
# количество первоначально запущенных процессов.<br/>
start_servers = 5<br/>
# Максимально возможное количество процессов.<br/>
max_servers = 32<br/>
# Динамическая регулировка количества процессов.<br/>
min_spare_servers = 3<br/>
max_spare_servers = 10<br/>
<br/>
# Количество принимаемых запросов процессом. МОжет помочь при утечках памяти в<br/>
# RADIUS сервере. Если выставить 300, процессы будут периодически перегружаться<br/>
# для уборки мусора.<br/>
max_requests_per_server = 0<br/>
}<br/>
<br/>
# Секция конфигурации динамических модулей.<br/>
modules {<br/>
# Модуль PAP авторизации.<br/>
# Необходим для обработки запросов с PAP авторизацией.<br/>
# encryption_scheme указывает в каком виде хранятся пароли.<br/>
# clear - подразумевает в открытом виде.<br/>
pap {<br/>
encryption_scheme = clear<br/>
}<br/>
# Модуль CHAP авторизации.<br/>
# Необходим для обработки запросов с CHAP авторизацией.<br/>
# authtype подразумевает обработку запросов только с аттрибутом Auth-Type=CHAP<br/>
chap {<br/>
authtype = CHAP<br/>
}<br/>
# Модуль преобработки запросов.<br/>
# Т.е. перед авторизацией пакета.<br/>
preprocess {<br/>
# huntgroups - хинт группы см. файл huntgoups.<br/>
# hints - хинты.<br/>
huntgroups = ${confdir}/huntgroups<br/>
hints = ${confdir}/hints<br/>
<br/>
# Обработка Cisco VSA.<br/>
with_cisco_vsa_hack = no<br/>
}<br/>
# Модуль Microsoft CHAP авторизации.<br/>
# Поддерживает так же еще и Microsoft CHAP v2<br/>
# authtype подразумевает обработку запросов только с аттрибутом Auth-Type=MS-CHAP<br/>
# use_mppe = no указывает на отсутствие компресии VPN туннеля.<br/>
mschap {<br/>
authtype = MS-CHAP<br/>
use_mppe = no<br/>
}<br/>
# Модуль записей Livingston RADIUS типа.<br/>
# usersfile содержит авторизационные записи пользователей.<br/>
# Рекомендуется использовать только для тестов и выставления значений по умолчанию.<br/>
# acctusersfile содержит пользователей подлежащих учету (аккаунтингу).<br/>
# compat - совместимость. При использовании файлов только FreeRADIUS можно отключить.<br/>
files {<br/>
usersfile = ${confdir}/users<br/>
compat = no<br/>
}<br/>
<br/>
# Запись детального лога аккаунтинговых пакетов.<br/>
detail {<br/>
detailfile = ${radacctdir}/%{Client-IP-Address}/detail-%Y%m%d<br/>
detailperm = 0600<br/>
}<br/>
<br/>
# Запись детального лога пакетов авторизации.<br/>
detail auth_log {<br/>
detailfile = ${radacctdir}/%{Client-IP-Address}/auth-detail-%Y%m%d<br/>
detailperm = 0600<br/>
}<br/>
<br/>
# Запись детального лога reply пакетов.<br/>
detail reply_log {<br/>
detailfile = ${radacctdir}/%{Client-IP-Address}/reply-detail-%Y%m%d<br/>
detailperm = 0600<br/>
}<br/>
<br/>
# Создать уникальный ключ для аккаунтинг сессии.<br/>
# Многие NAS повторно используют Acct-Session-ID.<br/>
# key перечисление аттрибутов для генерации Acct-Session-ID<br/>
acct_unique {<br/>
key = "User-Name, Acct-Session-Id, NAS-IP-Address, Client-IP-Address, NAS-Port-Id"<br/>
}<br/>
<br/>
# Конфигурация авторизации и аккаунтинга посредством СУБД<br/>
# содержится в отдельном файле cakesql.conf<br/>
#$INCLUDE ${confdir}/sql.conf<br/>
#$INCLUDE ${confdir}/sql/mysql/counter.conf<br/>
}<br/>
<br/>
# Авторизация<br/>
# сначала идет пакет передается в preprocess<br/>
# где может быть модифицирован.<br/>
# Далее chap mschap обрабатывают chap и mschap авторизацию.<br/>
authorize {<br/>
preprocess<br/>
chap<br/>
mschap<br/>
# Не ведем логи пакетов авторизации.<br/>
# auth_log<br/>
files<br/>
#sql<br/>
}<br/>
# Аунтификация<br/>
# Секция содержит модули доступные, для аунтификации.<br/>
authenticate {<br/>
Auth-Type PAP {<br/>
pap<br/>
}<br/>
<br/>
Auth-Type CHAP {<br/>
chap<br/>
}<br/>
<br/>
Auth-Type MS-CHAP {<br/>
mschap<br/>
}<br/>
<br/>
}<br/>
# Преобразование аккаунтинговых пакетов.<br/>
preacct {<br/>
preprocess<br/>
}<br/>
# Секция ведения аккаунтинга.<br/>
accounting {<br/>
# Создание Acct-Session-Id если ваш NAS генрит их вполне корректно можете убрать.<br/>
acct_unique<br/>
# Не создаем detail лог.<br/>
detail<br/>
# Помещать аккаунтинговые пакеты в СУБД<br/>
#sql<br/>
}<br/>
# Секция ведения логов reply-пакетов.<br/>
post-auth {<br/>
# Не ведем детальный лог репли пакетов.<br/>
reply_log<br/>
} <br/>
log {<br/>
 destination = files<br/>
 file = ${logdir}/radius.log<br/>
 syslog_facility = daemon<br/>
 stripped_names = no<br/>
 auth = no<br/>
 auth_badpass = no<br/>
 auth_goodpass = no<br/>
}<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/freeradius/clients.conf</code><br/>
<br/>
Заменяем содержимое файла:<br/>
<code>client localhost {<br/>
 ipaddr = 127.0.0.1<br/>
 secret = my-isp-radius<br/>
 require_message_authenticator = no<br/>
 nastype = other<br/>
}<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/freeradius/users</code><br/>
<br/>
Конфиг:<br/>
<code>steve Cleartext-Password := "testing"<br/>
 Service-Type = Framed-User,<br/>
 Framed-Protocol = PPP,<br/>
 Framed-IP-Address = 10.128.13.3,<br/>
 Framed-IP-Netmask = 255.255.0.0,<br/>
 Framed-Routing = Broadcast-Listen,<br/>
 Framed-Filter-Id = "std.ppp",<br/>
 Framed-MTU = 1500,<br/>
 Framed-Compression = Van-Jacobsen-TCP-IP<br/>
<br/>
# тут остальные юзеры по такому же принципу<br/>
<br/>
DEFAULT Framed-Protocol == PPP<br/>
 Framed-Protocol = PPP,<br/>
 Framed-Compression = Van-Jacobson-TCP-IP<br/>
<br/>
DEFAULT Hint == "CSLIP"<br/>
 Framed-Protocol = SLIP,<br/>
 Framed-Compression = Van-Jacobson-TCP-IP<br/>
<br/>
DEFAULT Hint == "SLIP"<br/>
 Framed-Protocol = SLIP<br/>
</code><br/>
<br/>
Вообще в будущем вам нужно будет настроить связку с MySQL, но на данном этапе это не критично. При добавлении пользователя нужно перезапустить Freeradius:<br/>
<code>/etc/init.d/freeradius restart</code><br/>
<br/>
Теперь нужно разобраться с шейпингом трафика. Идея такова, что скорость должна регулироваться индивидуально для каждого пользователя и передаваться в виде атрибута от Radius-сервера серверу NAT. Зачем? Для того чтобы в последствии было возможно расширить структуру и распределить нагрузку между несколькими NAS. <br/>
<br/>
<h4>Шейпинг трафика</h4><br/>
Итак, подготовка. Установим Wondershaper:<br/>
<code>aptitude install wondershaper</code><br/>
<br/>
Этот пакет представляет собой один скрипт, работающий с CBQ/HTB приоритезацией и имеющий вменяемый формат вызова. При желании можно протестировать его работу до внедрения:<br/>
<code>wondershaper ppp0 512 512</code><br/>
<br/>
Естественно, ppp0 должен существовать и быть результатом соединения клиента с нашим сервером. После того как команда выполнена, можно веб-браузером клиента зайти на любой сайт, измеряющий скорость, типа <a href="http://speedtest.net/">speedtest.net</a> — и убедиться что она таки режется шейпером. Для сброса настроек без рассоединения с клиентом (кика то есть), делаем<br/>
<code>wondershaper clear ppp0</code><br/>
<br/>
и убеждаемся в том, что скорость опять нормальная (то есть равна скорости, которую мы берем от «старшего брата» на WAN интерфейсе. Добавление ограничений скорости нужно автоматизировать, используя простой парсер файлов /var/run/radattr.ppp*, которые появляются при успешном ppp соединении и содержат все атрибуты, передаваемые Radius-сервером серверу PPPoE. Займемся атрибутами. Дополняем содержимое файла дополнительных атрибутов /etc/freeradius/dictionary вот этим:<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/freeradius/dictionary</code><br/>
<br/>
Конфиг:<br/>
<code># Limit session traffic<br/>
ATTRIBUTE Session-Octets-Limit 227 integer<br/>
# What to assume as limit - 0 in+out, 1 in, 2 out, 3 max(in,out)<br/>
ATTRIBUTE Octets-Direction 228 integer<br/>
# Connection Speed Limit<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit 230 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit 231 integer<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit-1 232 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit-1 233 integer<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit-2 234 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit-2 235 integer<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit-3 236 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit-3 237 integer<br/>
ATTRIBUTE Acct-Interim-Interval 85 integer</code><br/>
<br/>
Далее, эти же атрибуты нужно добавить в словарь Raduisclient-а. Редактируем /etc/radiusclient/dictionary, в конце добавляем то же самое:<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/radiusclient/dictionary</code><br/>
<br/>
Конфиг:<br/>
<code># Limit session traffic<br/>
ATTRIBUTE Session-Octets-Limit 227 integer<br/>
# What to assume as limit - 0 in+out, 1 in, 2 out, 3 max(in,out)<br/>
ATTRIBUTE Octets-Direction 228 integer<br/>
# Connection Speed Limit<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit 230 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit 231 integer<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit-1 232 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit-1 233 integer<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit-2 234 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit-2 235 integer<br/>
ATTRIBUTE PPPD-Upstream-Speed-Limit-3 236 integer<br/>
ATTRIBUTE PPPD-Downstream-Speed-Limit-3 237 integer<br/>
ATTRIBUTE Acct-Interim-Interval 85 integer<br/>
</code><br/>
<br/>
Всё отлично, теперь они (FreeRadius и RadiusClient) друг друга поймут. Соответственно, в настройках пользователей freeradius-а появятся дополнительные строчки с указанием лимита входящей и исходящей скорости (но не обязательные). Пример /etc/freeradius/users с учетом изменений:<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/freeradius/users</code><br/>
<br/>
Конфиг:<br/>
<code>steve Cleartext-Password := "testing"<br/>
 Service-Type = Framed-User,<br/>
 Framed-Protocol = PPP,<br/>
 Framed-IP-Address = 10.128.13.3,<br/>
 Framed-IP-Netmask = 255.255.0.0,<br/>
 Framed-Routing = Broadcast-Listen,<br/>
 Framed-Filter-Id = "std.ppp",<br/>
 Framed-MTU = 1500,<br/>
 Framed-Compression = Van-Jacobsen-TCP-IP<br/>
 <b> PPPD-Downstream-Speed-Limit = 1024,<br/>
 PPPD-Upstream-Speed-Limit = 1024<br/>
</b><br/>
# тут остальные юзеры по такому же принципу<br/>
<br/>
DEFAULT Framed-Protocol == PPP<br/>
 Framed-Protocol = PPP,<br/>
 Framed-Compression = Van-Jacobson-TCP-IP<br/>
<br/>
DEFAULT Hint == "CSLIP"<br/>
 Framed-Protocol = SLIP,<br/>
 Framed-Compression = Van-Jacobson-TCP-IP<br/>
<br/>
DEFAULT Hint == "SLIP"<br/>
 Framed-Protocol = SLIP</code><br/>
<br/>
Теперь NAS получает сведения о скорости, но не умеет их обрабатывать. Делаем два скрипта, выполняющих парсинг переданных атрибутов при установлении соединения:<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/ppp/ip-up.d/0001shaper</code><br/>
<br/>
Скрипт:<br/>
<code>#!/bin/sh<br/>
/root-scripts/shape-on $1 $5<br/>
exit 0</code><br/>
<br/>
Запускаем:<br/>
<code>nano /etc/ppp/ip-down.d/0001shaper</code><br/>
<br/>
Скрипт:<br/>
<code>#!/bin/sh<br/>
/root-scripts/shape-off $1 $5<br/>
exit 0</code><br/>
<br/>
Как видно из этих листингов, вызывается некий скрипт, применяющий и отменяющий шейпинг. С этого момента — поподробнее. $1 — это переданное имя интерфейса, то есть ppp0 к примеру, $5 — это Framed-IP, то есть IP клиента PPP. Создадим заветный каталог и положим в него два файла:<br/>
<code>mkdir /root-scripts<br/>
nano /root-scripts/shape-on</code><br/>
<br/>
Скрипт:<br/>
<code>#!/bin/sh<br/>
if [ -f /var/run/radattr.$1 ]<br/>
 then<br/>
 DOWNSPEED=`awk '/PPPD-Downstream-Speed-Limit/ {print $2}' /var/run/radattr.$1`<br/>
 UPSPEED=`awk '/PPPD-Upstream-Speed-Limit/ {print $2}' /var/run/radattr.$1`<br/>
 wondershaper $1 $DOWNSPEED $UPSPEED<br/>
fi<br/>
iptables -A FORWARD -s $2 -j ACCEPT<br/>
iptables -A INPUT -s $2 -j ACCEPT<br/>
iptables -t nat -A POSTROUTING -s $2 -o eth1 -j MASQUERADE<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>nano /root-scripts/shape-off</code><br/>
<br/>
Скрипт:<br/>
<code>#!/bin/sh<br/>
iptables -D FORWARD -s $2 -j ACCEPT <br/>
iptables -D INPUT -s $2 -j ACCEPT<br/>
iptables -t nat -D POSTROUTING -s $2 -o eth1 -j MASQUERADE<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>chmod +x /root-scripts/*</code><br/>
<br/>
В листингах eth1 — это всё ещё WAN интерфейс. Итак, что мы получаем в результате: Клиент соединяется с сервером PPP, получает IP адрес. Автоматически вызывается скрипт, настраивающий шейпинг на клиентском PPP интерфейсе и включающий для него маскарадинг. При рассоединении правило маскарадинга удаляется также автоматически. Вроде как wondershaper не нужно принудительно отцеплять от pppx, во всяком случае мануалы об этом молчат и всё нормально работает на практике. <br/>
<br/>
<h4>Простая защита на основе iptables</h4><br/>
Теперь уделим немножко внимания iptables и безопасности сервера. Заменим /etc/firewall.conf:<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/firewall.conf</code><br/>
<br/>
Скрипт:<br/>
<code>#!/bin/bash<br/>
<br/>
#reset all<br/>
iptables -F<br/>
iptables -Z<br/>
iptables -t nat -F<br/>
iptables -t nat -Z<br/>
<br/>
#iface config<br/>
INET_IFACE="eth1" <br/>
LO_IFACE="lo" <br/>
LO_IP="127.0.0.1" <br/>
<br/>
#kernel modules<br/>
modprobe ip_tables <br/>
modprobe ip_conntrack <br/>
modprobe iptable_filter <br/>
modprobe iptable_mangle <br/>
modprobe iptable_nat <br/>
modprobe ipt_LOG <br/>
modprobe ipt_limit <br/>
modprobe ipt_state <br/>
modprobe ipt_MASQUERADE <br/>
modprobe ip_conntrack_ftp <br/>
modprobe ip_conntrack_irc <br/>
modprobe ip_nat_ftp <br/>
modprobe ip_nat_irc <br/>
<br/>
#default policy<br/>
iptables -P INPUT DROP <br/>
iptables -P OUTPUT DROP <br/>
iptables -P FORWARD DROP<br/>
<br/>
#user chains<br/>
iptables -N bad_tcp_packets <br/>
iptables -N allowed <br/>
iptables -N tcp_packets <br/>
iptables -N udp_packets <br/>
iptables -N icmp_packets<br/>
iptables -N blocksshd<br/>
blocksshd --start<br/>
<br/>
###bad_tcp_packets chain<br/>
iptables -A bad_tcp_packets -p tcp --tcp-flags SYN,ACK SYN,ACK -m state --state NEW -j REJECT --reject-with tcp-reset <br/>
#iptables -A bad_tcp_packets -p tcp ! --syn -m state --state NEW -j LOG --log-prefix "New not syn:" <br/>
iptables -A bad_tcp_packets -p tcp ! --syn -m state --state NEW -j DROP <br/>
<br/>
###allowed chain<br/>
iptables -A allowed -p TCP --syn -j ACCEPT <br/>
iptables -A allowed -p TCP -m state --state ESTABLISHED,RELATED -j ACCEPT <br/>
iptables -A allowed -p TCP -j DROP<br/>
<br/>
###tcp_packets chain<br/>
iptables -A tcp_packets -p TCP -s 0/0 --dport 22 -j blocksshd<br/>
iptables -A tcp_packets -p TCP -s 0/0 --dport 22 -j allowed <br/>
iptables -A tcp_packets -p TCP -s 0/0 --dport 25 -j allowed <br/>
#iptables -A tcp_packets -p TCP -s 0/0 --dport 80 -j allowed<br/>
<br/>
###udp_packets chain<br/>
iptables -A udp_packets -p UDP -s 0/0 --destination-port 53 -j ACCEPT<br/>
<br/>
###icmp chain<br/>
iptables -A icmp_packets -p ICMP -s 0/0 --icmp-type 8 -j ACCEPT <br/>
iptables -A icmp_packets -p ICMP -s 0/0 --icmp-type 11 -j ACCEPT<br/>
<br/>
###input chain<br/>
iptables -A INPUT -p TCP -j bad_tcp_packets <br/>
iptables -A INPUT -p ALL -i $LO_IFACE -j ACCEPT<br/>
iptables -A INPUT -p ALL -m state --state ESTABLISHED,RELATED -j ACCEPT <br/>
iptables -A INPUT -p TCP -i $INET_IFACE -j tcp_packets <br/>
iptables -A INPUT -p UDP -i $INET_IFACE -j udp_packets <br/>
iptables -A INPUT -p ICMP -i $INET_IFACE -j icmp_packets <br/>
#iptables -A INPUT -m limit --limit 3/minute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix "IPT INPUT packet died: " <br/>
<br/>
###forward chain <br/>
iptables -A FORWARD -p tcp -j bad_tcp_packets <br/>
#custom rules<br/>
#iptables -A FORWARD -s 10.128.0.10/32 -d 192.168.1.1/32 -p tcp -j ACCEPT<br/>
<b>iptables -A FORWARD -s 10.128.0.0/16 -d 192.168.1.1/32 -p tcp -j DROP</b> <br/>
#/custom rules<br/>
iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT <br/>
#iptables -A FORWARD -m limit --limit 3/minute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix "IPT FORWARD packet died: " <br/>
<br/>
###OUTPUT chain <br/>
iptables -A OUTPUT -p tcp -j bad_tcp_packets <br/>
iptables -A OUTPUT -p ALL -j ACCEPT <br/>
#iptables -A OUTPUT -m limit --limit 3/minute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix "IPT OUTPUT packet died: "<br/>
<br/>
###mangle<br/>
iptables -t mangle -A POSTROUTING -o $INET_IFACE -j TTL --ttl-set 64<br/>
</code><br/>
<br/>
Что мы тут видим? Во-первых, выделенное правило. Оно будет отличаться в реальной конфигурации или просто отсутствовать за ненадобностью, но смысл таков: если шлюзом для сервера является ADSL модем или подобный девайс с веб-админкой, нам не нужно выдумывать хитрые пароли для входа туда. Вместо этого, мы запрещаем к ним обращаться из клиентских туннелей, но одному таки разрешаем — это будет сервисная учетная запись, которой можно на него ломиться. Само собой, она не для клиентов. Далее. Добавлены команды, включающие защиту от брутфорсинга SSH сервера. Для их работы нужно настроить blocksshd.<br/>
<br/>
<h4>BlockSSHd</h4><br/>
 Для начала его нужно скачать с <a href="http://blocksshd.sourceforge.net/">blocksshd.sourceforge.net</a> и разархивировать файлы куда-нибудь. Я использовал для закачки wget, но путь — понятное дело — вырезал со странички SourceForge, то есть он будет скорее всего другим:<br/>
<code><a href="http://downloads.sourceforge.net/project/blocksshd/blocksshd/BlockSSHD%201.3/blocksshd-1.3.tar.gz?use_mirror=kent"></a>cd /tmp<br/>
wget downloads.sourceforge.net/project/blocksshd/blocksshd/BlockSSHD%201.3/blocksshd-1.3.tar.gz?use_mirror=kent<br/>
</code><br/>
<br/>
Этот скрипт написан на Perl и требует некоторых дополнительных модулей для работы. Итак, займемся модулями:<br/>
<code>cpan<br/>
upgrade<br/>
install Sys::Syslog<br/>
install Sys::Hostname<br/>
install File::Tail<br/>
install Tie::File<br/>
install Net::DNS<br/>
install Net::Subnets<br/>
install Getopt::Long<br/>
exit<br/>
</code><br/>
<br/>
Обращаю внимание на то, что всё это одним махом не нужно копировать и вставлять в терминал. Это потому что каждая операция требует большого количества времени для выполнения и в процессе всей установки Cpan будет задавать вопросы. На все вопросы можно просто нажимать Enter, там по умолчанию всё правильно, как ни странно.<br/>
<br/>
Теперь нужно распаковать blocksshd и установить его:<br/>
<code>cd /tmp<br/>
tar -xvzf ./blocksshd-1.3.tar.gz<br/>
cd blocksshd-1.3<br/>
make install<br/>
</code><br/>
<br/>
Ну и естественно, версия на момент написания мануала была именно эта, а может быть любая, так что нужно внимательно всё сделать а не копипастить в консоль. Осталось отредактировать конфигурацию blocksshd:<br/>
<br/>
Запускаем:<br/>
<code>nano /etc/blocksshd.conf</code><br/>
<br/>
Конфиг:<br/>
<code>$cfg = {<br/>
 os => 'linux', # Target OS - either linux or bsd<br/>
 chain => 'blocksshd', # Name of iptables or pf chain<br/>
 logfile => '/var/log/secure', # Log file to monitor<br/>
 logcheck => '10', # How often to check the log file<br/>
<b> max_attempts => '4', # Max number of failures</b><br/>
 timeout => '360', # Reset IP count if no activity after time out in seconds<br/>
<b> unblock => '1', # Enable unblocking<br/>
 unblock_timeout => '43200', # Time in seconds after which to unblock a blocked IP address<br/>
</b> restore_blocked => '0', # Turn on checking for previously blocked IPs<br/>
 log_ips => '/etc/blocksshd.list', # Log file for blocked IPs<br/>
 pid_file => '/var/run/blocksshd.pid', # Location of PID file<br/>
<b> send_email => '0', # Enable the sending of email notifications</b><br/>
 email => 'root', # Email address to send notifications<br/>
 mail => '/bin/mail', # Location of mail binary<br/>
 email_whois_lookup => '1', # enable whois lookup of the blocked ip addres in the sent email<br/>
 whois => '/usr/bin/whois', # location of the whois binary<br/>
 sed => '/bin/sed', # location of the sed binary<br/>
 iptables => '/sbin/iptables', # Location of iptables binary - only for Linux<br/>
 pfctl => '/sbin/pfctl', # Location of pfctl binary - only for BSD<br/>
 whitelist => [qw{<br/>
 127.0.0.1/32<br/>
 }], # whitelist - list of IPs that will never be blocked - IPs must be specified in the form ad$<br/>
};<br/>
<br/>
#leave 1; here!<br/>
1;<br/>
</code><br/>
<br/>
В этом листинге нужно обратить внимание на выделенные строчки. Первая — максимальное число попыток входа с одного адреса, вторая — нужно ли разблокировать забаненный айпи по истечении времени в секундах, указанного в третьей строчке. Четвертая — оповещать ли по email о попытках взлома.<br/>
Теперь можно перезагрузить сервер и тестировать то что получилось.<br/>
<br/>
<h4>Простейший мониторинг</h4><br/>
 Для удобства мониторинга активных сессий можно использовать скрипт, написанный «на коленке». Создадим его и настроим симлинк для простого запуска, ну и проверим конечно:<br/>
<br/>
Запускаем:<br/>
<code>nano /root-scripts/clients</code><br/>
<br/>
Скрипт:<br/>
<code>#!/usr/bin/php<br/>
&lt;?<br/>
function time_since($original) {<br/>
 $chunks = array(<br/>
 array(60 * 60 * 24 , 'D '),<br/>
 array(60 * 60 , 'h:'),<br/>
 array(60 , 'min'),<br/>
 );<br/>
 $today = time();<br/>
 $since = $today - $original;<br/>
 for ($i = 0, $j = count($chunks); $i &lt; $j; $i++) {<br/>
 $seconds = $chunks[$i][0];<br/>
 $name = $chunks[$i][1];<br/>
 if (($count = floor($since / $seconds)) != 0) {<br/>
 break;<br/>
 }<br/>
 }<br/>
 $print = "$count{$name}";<br/>
 if ($i + 1 &lt; $j) {<br/>
 $seconds2 = $chunks[$i + 1][0];<br/>
 $name2 = $chunks[$i + 1][1];<br/>
 if (($count2 = floor(($since - ($seconds * $count)) / $seconds2)) != 0) {<br/>
 $print .= "$count2{$name2}";<br/>
 }<br/>
 }<br/>
 return $print;<br/>
}<br/>
<br/>
function execShellCmdRaw($cmd) {<br/>
 ob_start();<br/>
 passthru($cmd);<br/>
 $buffer = ob_get_contents();<br/>
 ob_end_clean();<br/>
 return $buffer;<br/>
}<br/>
<br/>
function rawToArray($buffer) {<br/>
 return empty($buffer)?array():preg_split('/[\r\n]+/', $buffer, -1, PREG_SPLIT_NO_EMPTY);<br/>
}<br/>
<br/>
function execShellCmd($cmd) {<br/>
 return rawToArray(execShellCmdRaw($cmd));<br/>
}<br/>
<br/>
function getNATSources() {<br/>
 $nat = execShellCmd('iptables -t nat -L | grep MASQUERADE');<br/>
 $nats = array();<br/>
 foreach ($nat as $s) {<br/>
 $pos_start = strpos($s, '--') + 2;<br/>
 $pos_end = strpos($s, 'anywhere');<br/>
 $n = trim(substr($s, $pos_start, $pos_end - $pos_start));<br/>
 $nats[$n] = $n;<br/>
 }<br/>
 return $nats;<br/>
}<br/>
<br/>
function getTunnelMacAddr($pid) {<br/>
 $pppdc = execShellCmd('ps -p '.$pid.' -f | grep pppd');<br/>
 $pppdc = $pppdc[0];<br/>
 $pos_start = strpos($pppdc, '-e ') + 3;<br/>
 $pos_end = strpos($pppdc, '-S \'\'');<br/>
 return trim(substr($pppdc, $pos_start, $pos_end - $pos_start));<br/>
}<br/>
<br/>
function getPPPTunnels() {<br/>
 $ifc = execShellCmd('ifconfig -a');<br/>
 $tunnels = array();<br/>
 $nat = getNATSources();<br/>
 foreach ($ifc as $i => $s) {<br/>
 if (substr($s, 0, 3) == 'ppp') {<br/>
 $ppp = array();<br/>
 $ppp['interface'] = substr($s, 0, 4);<br/>
 $ppp['framed_ip'] = trim(substr($ifc[$i+1], strpos($ifc[$i+1], 'P-t-P:') + 6, 12));<br/>
 $RXpos_start = strpos($ifc[$i+6], '(') + 1;<br/>
 $RXpos_end = strpos($ifc[$i+6], ')');<br/>
 $ppp['tx'] = substr($ifc[$i+6], $RXpos_start, $RXpos_end - $RXpos_start); //TX(user) = RX(server)<br/>
 $tx_sub = substr($ifc[$i+6], $RXpos_end + 1);<br/>
 $TXpos_start = strpos($tx_sub, '(') + 1;<br/>
 $TXpos_end = strpos($tx_sub, ')');<br/>
 $ppp['rx'] = substr($tx_sub, $TXpos_start, $TXpos_end - $TXpos_start);<br/>
 $ppp['nat'] = array_key_exists($ppp['framed_ip'], $nat)?'on':'off';<br/>
 $pidf = '/var/run/'.$ppp['interface'].'.pid';<br/>
 if (file_exists($pidf)) {<br/>
 $ppp['uptime'] = time_since(filemtime($pidf));<br/>
 $ppp['pid'] = trim(file_get_contents($pidf));<br/>
 $ppp['mac_addr'] = getTunnelMacAddr($ppp['pid']);<br/>
 $ppp['username'] = 'detectedusername';<br/>
 $tunnels[] = $ppp;<br/>
 }<br/>
 }<br/>
 }<br/>
 return $tunnels;<br/>
}<br/>
<br/>
function clientTable($tunnels) {<br/>
 printf("\n");<br/>
 printf(" %15s | ","IP Address");<br/>
 printf("%20s | ","MAC Address ");<br/>
 printf("%3s | ","NAT");<br/>
 printf("%16s | ","User name ");<br/>
 printf("%9s | ","TX (up)");<br/>
 printf("%9s | ","RX (down)");<br/>
 printf("%11s","Uptime ");<br/>
 printf("\n ");<br/>
 for ($i = 0; $i &lt; 101; $i++) printf("-");<br/>
 printf("\n");<br/>
 foreach($tunnels as $tun) {<br/>
 printf(" %15s | ",$tun['framed_ip']);<br/>
 printf("%20s | ",$tun['mac_addr']);<br/>
 printf("%3s | ",$tun['nat']);<br/>
 printf("%16s | ",$tun['username']);<br/>
 printf("%9s | ",$tun['tx']);<br/>
 printf("%9s | ",$tun['rx']);<br/>
 printf("%11s",$tun['uptime']);<br/>
 printf("\n");<br/>
 }<br/>
 printf("\n");<br/>
}<br/>
<br/>
function addRadParams(&amp;$tunnels = NULL) {<br/>
 $radusers = rawToArray(file_get_contents('/etc/freeradius/users'));<br/>
 $users = array();<br/>
 foreach ($radusers as $i => $s) {<br/>
 if (strpos($s, 'Cleartext-Password') !== FALSE) {<br/>
 $user = array();<br/>
 $user['username'] = trim(substr($s, 0, strpos($s, 'Cleartext-Password')));<br/>
 $si = $i + 1;<br/>
 while (strpos($radusers[$si], 'Framed-IP-Address') == FALSE) $si++;<br/>
 $ip_raw = explode('=', $radusers[$si]);<br/>
 $ip_raw = $ip_raw[1];<br/>
 $users[trim($ip_raw, ' ,')] = $user;<br/>
 }<br/>
 }<br/>
 foreach ($tunnels as $i => $tun) {<br/>
 $tunnels[$i]['username'] = $users[$tun['framed_ip']]['username'];<br/>
 }<br/>
 return $tunnels;<br/>
}<br/>
<br/>
$t = getPPPTunnels();<br/>
addRadParams($t);<br/>
clientTable($t);<br/>
</code><br/>
<br/>
Запускаем:<br/>
<code>chmod +x /root-scripts/clients<br/>
ln -s /root-scripts/clients /usr/bin/clients<br/>
clients<br/>
</code><br/>
<br/>
Получим что-то типа:<br/>
<br/>
<code> IP Address | MAC Address | NAT | User name | TX (up) | RX (down) | Uptime<br/>
 -----------------------------------------------------------------------------------------------------<br/>
 10.128.1.7 | 1:00:19:66:df:39:26 | on | room56 | 507.4 MiB | 445.5 MiB | 16h:31min<br/>
 10.128.1.3 | 23:00:13:8f:70:30:03 | on | room47 | 8.2 MiB | 137.8 MiB | 1h:14min<br/>
 10.128.1.5 | 3:00:a1:b0:11:74:cf | on | room50 | 19.2 MiB | 500.2 MiB | 16h:30min<br/>
</code><br/>
<br/>
Вот и всё, наш сервер готов к использованию. По своим наблюдениям могу сказать, что простого системника с 1 гб DDR1 и 2 ГГц процессором хватает для раздачи 16-мегабитного канала для 30 пользователей (больше просто не нужно было) и ощутимой нагрузки система не испытывает.<br/>
<br/>
Удачи начинающим провайдерам!</div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpppoe%5D" class="tm-article-body__tags-item-link">pppoe</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bdns%5D" class="tm-article-body__tags-item-link">dns</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%88%D0%B5%D0%B9%D0%BF%D0%B8%D0%BD%D0%B3%5D" class="tm-article-body__tags-item-link">шейпинг</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bwondershaper%5D" class="tm-article-body__tags-item-link">wondershaper</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bnat%5D" class="tm-article-body__tags-item-link">nat</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Biptables%5D" class="tm-article-body__tags-item-link">iptables</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%5D" class="tm-article-body__tags-item-link">сервер</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/linux/" class="tm-article-body__tags-item-link">
                  Настройка Linux
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 56: ↑44 и ↓12</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 56: ↑44 и ↓12" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+32</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    142
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/111399/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      27
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/kest/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/8c5/1eb/a96/8c51eba96a2c4a5a45ab56241c15c729.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 15 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    11
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><!----> <a href="/ru/users/kest/" class="tm-user-card__nickname">
          @kest
        </a> <!----></div> <p class="tm-user-card__short-info">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/111399/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 27 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-25T10:02:04.000Z" title="2021-09-25, 13:02">25  сентября   в 13:02</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/579924/" class="tm-article-title__link"><span>Как запустить свой сервер с белым ip из локальной домашней сети</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 41: ↑28 и ↓13</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 41: ↑28 и ↓13" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+15</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">24K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    142
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/579924/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      61
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2017-07-24T12:21:19.000Z" title="2017-07-24, 15:21">24  июля  2017 в 15:21</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/333996/" class="tm-article-title__link"><span>Вынос локального сервера в сеть с помощью другого внешнего сервера</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 9: ↑5 и ↓4</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 9: ↑5 и ↓4" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+1</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">13K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    68
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/333996/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      10
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-29T06:19:53.000Z" title="2021-09-29, 09:19">сегодня в 09:19</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580582/" class="tm-article-title__link"><span>Конфиденциальность пользователей Telegram снова нарушена. Представители мессенджера требуют не раскрывать подробностей</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 188: ↑184 и ↓4</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 188: ↑184 и ↓4" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+180</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">29K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    28
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580582/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      71
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T14:25:12.000Z" title="2021-09-28, 17:25">вчера в 17:25</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580516/" class="tm-article-title__link"><span>Лучший язык программирования</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 168: ↑161 и ↓7</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 168: ↑161 и ↓7" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+154</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">39K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    182
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580516/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      87
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-28T17:18:57.000Z" title="2021-09-28, 20:18">вчера в 20:18</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580034/" class="tm-article-title__link"><span>Пыль, пылевые клещи и их аллергены. Профилактика и защита</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 62: ↑58 и ↓4</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 62: ↑58 и ↓4" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+54</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">11K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    62
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580034/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      53
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-29T13:00:01.000Z" title="2021-09-29, 16:00">сегодня в 16:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/579972/" class="tm-article-title__link"><span>Апскейл, который смог</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 41: ↑41 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 41: ↑41 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+41</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2.2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    34
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/579972/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      10
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-29T00:18:17.000Z" title="2021-09-29, 03:18">сегодня в 03:18</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/selectel/blog/579530/" class="tm-article-title__link"><span>Лучше поздно, чем никогда: Microsoft решила продолжить историю Skype</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 41: ↑39 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 41: ↑39 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+37</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">17K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    8
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/selectel/blog/579530/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      58
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="111399" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/111399/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/111399/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"111399":{"id":"111399","timePublished":"2011-01-07T15:26:19+00:00","isCorporative":false,"lang":"ru","titleHtml":"Настройка PPPoE с шейпингом трафика для небольшой сети","leadData":{"textHtml":"Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было принято решение использовать собственное на базе Debian Linux. Опытом его поднятия я хочу поделиться с вами в этом посте, но приведенные здесь версии могли немного устареть с момента написания мануала «для себя», так что нужно проявить некоторую внимательность. Также, нужно учитывать, что приведенное решение далеко от идеального и профессионального. Оно поможет скорее тем, кому нужно быстро поднять у себя сервер, раздающий интернет. В конце у нас будет раздача интернета через PPPoE с назначением внутренних IP клиентам, шейпинг трафика, DNS сервер и простой мониторинг текущих сессий из консоли.\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"scoreStats":{"score":11,"votesCount":15},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"60539","alias":"kest","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8c5\u002F1eb\u002Fa96\u002F8c51eba96a2c4a5a45ab56241c15c729.png","speciality":null},"statistics":{"commentsCount":27,"favoritesCount":142,"readingCount":36543,"score":32,"votesCount":56},"hubs":[{"relatedData":null,"id":"36","alias":"linux","type":"collective","title":"Настройка Linux","titleHtml":"Настройка Linux","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EОднажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было принято решение использовать собственное на базе Debian Linux. Опытом его поднятия я хочу поделиться с вами в этом посте, но приведенные здесь версии могли немного устареть с момента написания мануала «для себя», так что нужно проявить некоторую внимательность. Также, нужно учитывать, что приведенное решение далеко от идеального и профессионального. Оно поможет скорее тем, кому нужно быстро поднять у себя сервер, раздающий интернет. В конце у нас будет раздача интернета через PPPoE с назначением внутренних IP клиентам, шейпинг трафика, DNS сервер и простой мониторинг текущих сессий из консоли.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EПодготовка системы\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eaptitude update\u003Cbr\u002F\u003E\r\naptitude install openssh-server mc mtr tracert nano tcpdump bind9 pppoe freeradius radiusclient1 rcconf php5\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EНастройка DNS-сервера\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nВыполняем\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fbind\u002Fnamed.conf.options\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДобавляем в конец файла:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eallow-transfer { none; };\u003Cbr\u002F\u003E\r\nallow-query { 10.128.0.0\u002F16; localhost; }; \u002F\u002Fподсеть наших пользователей\u003Cbr\u002F\u003E\r\nallow-recursion { 10.128.0.0\u002F16; localhost; }; \u002F\u002Fрекурсия только локальным\u003Cbr\u002F\u003E\r\nversion \"My ISP DNS\"; \u002F\u002Fскрыли информацию о версии сервера\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНачнем настраивать chroot-окружение для нашего сервера DNS. Создадим каталоги корневой файловой системы сервера DNS — root-dns:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Emkdir -p \u002Froot-dns\u002Fetc\u003Cbr\u002F\u003E\r\nmkdir \u002Froot-dns\u002Fdev\u003Cbr\u002F\u003E\r\nmkdir -p \u002Froot-dns\u002Fvar\u002Fcache\u002Fbind\u003Cbr\u002F\u003E\r\nmkdir -p \u002Froot-dns\u002Fvar\u002Frun\u002Fbind\u002Frun\u003Cbr\u002F\u003E\r\n\u002Fetc\u002Finit.d\u002Fbind9 stop\u003Cbr\u002F\u003E\r\nnano \u002Fetc\u002Fdefault\u002Fbind9\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНашли строчку «OPTIONS=» и заменили:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EOPTIONS=\"-u bind -t \u002Froot-dns\"\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Emv \u002Fetc\u002Fbind \u002Froot-dns\u002Fetc\u003Cbr\u002F\u003E\r\nln -s \u002Froot-dns\u002Fetc\u002Fbind \u002Fetc\u002Fbind\u003Cbr\u002F\u003E\r\nnano \u002Fetc\u002Finit.d\u002Fbind9\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНашли строчку «OPTIONS=» и заменили:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EOPTIONS=\"-u bind -t \u002Froot-dns\"\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Finit.d\u002Frsyslogd\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНашли «RSYSLOGD_OPTIONS» и заменили:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ERSYSLOGD_OPTIONS=\"-c3 -a \u002Froot-dns\u002Fdev\u002Flog\"\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗащитим от редактирования и удаления файл конфигурации named.conf:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Echattr +i \u002Froot-dns\u002Fetc\u002Fbind\u002Fnamed.conf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПримечание. Не забудьте снять атрибут «i» перед редактированием файла конфигурации (chattr -i …)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Emknod \u002Froot-dns\u002Fdev\u002Fnull c 1 3\u003Cbr\u002F\u003E\r\nmknod \u002Froot-dns\u002Fdev\u002Frandom c 1 8\u003Cbr\u002F\u003E\r\nchmod 666 \u002Froot-dns\u002Fdev\u002Fnull \u002Froot-dns\u002Fdev\u002Frandom\u003Cbr\u002F\u003E\r\nchown -R bind:bind \u002Froot-dns\u002Fvar\u002F*\u003Cbr\u002F\u003E\r\nchown -R bind:bind \u002Froot-dns\u002Fetc\u002Fbind\u003Cbr\u002F\u003E\r\n\u002Fetc\u002Finit.d\u002Fbind9 start\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EСервер PPPoE\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ecd \u002Ftmp\u003Cbr\u002F\u003E\r\napt-get build-dep pppoe\u003Cbr\u002F\u003E\r\napt-get source pppoe\u003Cbr\u002F\u003E\r\ncd rp-pppoe-3.8\u002Fsrc\u003Cbr\u002F\u003E\r\n.\u002Fconfigure\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano config.h\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь в только что созданном файле config.h нужно заменить строчку:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u002F* #undef HAVE_LINUX_KERNEL_PPPOE *\u002F\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nна строчку:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#define HAVE_LINUX_KERNEL_PPPOE 1\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВыполняем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ecd ..\u003Cbr\u002F\u003E\r\n.\u002Fdebian\u002Frules PLUGIN_PATH=\u002Fusr\u002Flib\u002Fpppd\u002F2.4.4\u002Frp-pppoe.so\u003Cbr\u002F\u003E\r\n.\u002Fdebian\u002Frules binary\u003Cbr\u002F\u003E\r\ncd ..\u003Cbr\u002F\u003E\r\ndpkg -i pppoe_3.8-3_i386.deb\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗаморозим пакет в системе, чтобы предотвратить его автоматическое обновление:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eecho pppoe hold | dpkg —set-selections\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nС этого момента нужно как минимум при каждом обновлении системы просматривать список обновлений. Если для pppoe будет выпущено обновление, закрывающее уязвимость, необходимо будет собрать пакет из свежих исходников заново, снять фиксацию пакета в системе с помощью команды:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eecho pppoe install | dpkg --set-selections\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь в системе установлен пакет с PPPoE-сервером, позволяющим поддерживать PPPoE-соединения на уровне ядра. Для запуска сервера в этом режиме, к команде описанной в предыдущем разделе нужно добавить опцию -k: pppoe-server -I eth1 -L 192.168.0.1 -k\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fppp\u002Fpppoe-server-options\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВставляем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Elogfile \u002Fvar\u002Flog\u002Fpppoe.log\u003Cbr\u002F\u003E\r\ndebug\u003Cbr\u002F\u003E\r\nmtu 1472\u003Cbr\u002F\u003E\r\nmru 1472\u003Cbr\u002F\u003E\r\nauth\u003Cbr\u002F\u003E\r\nrequire-pap\u003Cbr\u002F\u003E\r\n#require-chap\u003Cbr\u002F\u003E\r\ndefault-asyncmap\u003Cbr\u002F\u003E\r\nktune\u003Cbr\u002F\u003E\r\nlcp-echo-interval 20\u003Cbr\u002F\u003E\r\nlcp-echo-failure 2\u003Cbr\u002F\u003E\r\nms-dns 10.128.0.1\u003Cbr\u002F\u003E\r\nplugin radius.so\u003Cbr\u002F\u003E\r\nplugin radattr.so\u003Cbr\u002F\u003E\r\n10.128.0.1:\u003Cbr\u002F\u003E\r\nnobsdcomp\u003Cbr\u002F\u003E\r\nnoccp\u003Cbr\u002F\u003E\r\nnoendpoint\u003Cbr\u002F\u003E\r\nnoipdefault\u003Cbr\u002F\u003E\r\nnoipx\u003Cbr\u002F\u003E\r\nnovj\u003Cbr\u002F\u003E\r\nreceive-all\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fppp\u002Foptions\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ конфиге \u002Fetc\u002Fppp\u002Foptions: убираем всё, ставим:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Elock\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Finit.d\u002Fpppoe-server\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#!\u002Fbin\u002Fbash\u003Cbr\u002F\u003E\r\n# init file for rp-pppoe server\u003Cbr\u002F\u003E\r\n#\u003Cbr\u002F\u003E\r\n# description: PPPOE kernel mode server\u003Cbr\u002F\u003E\r\n#\u003Cbr\u002F\u003E\r\n# processname: pppoe-server\u003Cbr\u002F\u003E\r\n# chkconfig: - 45 45\u003Cbr\u002F\u003E\r\n# source function library\u003Cbr\u002F\u003E\r\n#. \u002Fetc\u002Frc.status\u003Cbr\u002F\u003E\r\ncase \"$1\" in\u003Cbr\u002F\u003E\r\nstart)\u003Cbr\u002F\u003E\r\necho -n \"Starting PPPOE server: \"\u003Cbr\u002F\u003E\r\n\u002Fusr\u002Fsbin\u002Fpppoe-server -I eth0 -L 10.128.0.1 -R 10.128.1.1 -k\u003Cbr\u002F\u003E\r\n#Здесь eth0 — интерфейс, который смотрит в локальную сеть\u003Cbr\u002F\u003E\r\n#10.128.0.1 - IP PPPoE сервера\u003Cbr\u002F\u003E\r\n#10.128.1.1 - Первый IP адрес клиента\u003Cbr\u002F\u003E\r\n#touch \u002Fvar\u002Flock\u002Fsubsys\u002Fpppoed\u003Cbr\u002F\u003E\r\n#rc_status -v\u003Cbr\u002F\u003E\r\n;;\u003Cbr\u002F\u003E\r\nstop)\u003Cbr\u002F\u003E\r\necho -n \"Shutting down PPPOE server: \"\u003Cbr\u002F\u003E\r\npkill pppoe-server\u003Cbr\u002F\u003E\r\n#rm -f \u002Fvar\u002Flock\u002Fsubsys\u002Fpppoed\u003Cbr\u002F\u003E\r\n#rc_status -v\u003Cbr\u002F\u003E\r\n;;\u003Cbr\u002F\u003E\r\nrestart)\u003Cbr\u002F\u003E\r\n$0 stop\u003Cbr\u002F\u003E\r\n$0 start\u003Cbr\u002F\u003E\r\n;;\u003Cbr\u002F\u003E\r\nstatus)\u003Cbr\u002F\u003E\r\nstatus pppoe-server\u003Cbr\u002F\u003E\r\n;;\u003Cbr\u002F\u003E\r\n*)\u003Cbr\u002F\u003E\r\necho \"Usage: pppoed {start|stop|restart|status}\"\u003Cbr\u002F\u003E\r\nexit 1\u003Cbr\u002F\u003E\r\nesac\u003Cbr\u002F\u003E\r\nexit 0\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ercconf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОтключаем bind. Потом туда опять заходим и видим что он вообще исчез из списка. Внизу он таки есть, а рядом наш pppoe-server. Включили и то и то. Вышли. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ecd \u002Froot-dns\u002Fetc\u002Fbind\u003Cbr\u002F\u003E\r\nrndc-confgen -r \u002Fdev\u002Furandom -a\u003Cbr\u002F\u003E\r\nchgrp bind rndc.key\u003Cbr\u002F\u003E\r\nchmod +r rndc.key\u003Cbr\u002F\u003E\r\nnano named.conf.options\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ конце файла добавляем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Econtrols {\u003Cbr\u002F\u003E\r\n inet 127.0.0.1 allow { localhost; } keys { rndc-key; };\u003Cbr\u002F\u003E\r\n};\u003Cbr\u002F\u003E\r\ninclude \"\u002Fetc\u002Fbind\u002Frndc.key\";\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь ещё нужно включить форвардинг в ядре и сделать подхват правил iptables. Конфигурация пока будет тестовой.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EПараметры sysctl.conf, iptables, настройки сетевых интерфейсов\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fsysctl.conf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРаскомментировали, добавили чего небыло:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enet.ipv4.conf.default.rp_filter=1\u003Cbr\u002F\u003E\r\nnet.ipv4.conf.all.rp_filter=1\u003Cbr\u002F\u003E\r\nnet.ipv4.tcp_syncookies=1\u003Cbr\u002F\u003E\r\nnet.ipv4.ip_forward=1\u003Cbr\u002F\u003E\r\nkernel.panic = 1\u003Cbr\u002F\u003E\r\nkernel.panic_on_oops = 1\u003Cbr\u002F\u003E\r\nkernel.panic_on_io_nmi = 1\u003Cbr\u002F\u003E\r\nkernel.panic_on_unrecovered_nmi = 1\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПоследние 4 строчки — это перезагрузка при различных падениях системы, чтобы не ездить ради перезагрузки куда-то в другой город. Сохранили, далее делаем тестовый конфиг для iptables:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eiptables -t nat -F\u003Cbr\u002F\u003E\r\niptables-save \u003E \u002Fetc\u002Ffirewall.conf\u003Cbr\u002F\u003E\r\nnano rc.local\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь в rc.local у нас будет:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eifconfig eth0 up\u003Cbr\u002F\u003E\r\niptables-restore &lt;\u002Fetc\u002Ffirewall.conf\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДалее, конфигурируем \u002Fetc\u002Fnetwork\u002Finterfaces — тут eth0 получился локальным, для него ничего вообще не пишем, разве что auto eth0. А по поводу eth1 — если это интернет — я бы задумался о статическом внешнем айпи, в противном случае нельзя использовать SNAT, а только MASQUERADE, а он сильнее грузит систему.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fnetwork\u002Finterfaces\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфиг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eauto lo\u003Cbr\u002F\u003E\r\niface lo inet loopback\u003Cbr\u002F\u003E\r\nauto eth0\u003Cbr\u002F\u003E\r\nauto eth1\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nallow-hotplug eth0 eth1\u003Cbr\u002F\u003E\r\niface eth1 inet dhcp\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ данном листинге eth1 — интернет через NAT и DHCP конфиг.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EПробный запуск сервера PPPoE\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nДалее надо протестировать PPPoE без радиуса. Для этого комментируем 2 строчки плагинов в \u002Fetc\u002Fppp\u002Fpppoe-server-options.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fppp\u002Fpppoe-server-options\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфиг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#plugin radius.so\u003Cbr\u002F\u003E\r\n#plugin radattr.so\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fppp\u002Fpap-secrets\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДописываем в конец либо заменяем полностью содержимое:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Etest * test 10.128.2.10\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем pppoe-server: \u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u002Fetc\u002Finit.d\u002Fpppoe-server start\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПерезагрузили сервер, проверили PPPoE и инет. На любом клиенте создаем PPPoE соединение и подключаемся, используя логин и пароль test. Для того чтобы инет работал у клиента, нужно включить маскарадинг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eiptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРаботает? Хорошо, вернули как было:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eiptables -t nat -F\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EFreeRadius\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fradiusclient\u002Fservers\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗаменяем содержимое файла:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E127.0.0.1 my-isp-radius\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fradiusclient\u002Fradiusclient.conf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗаменяем содержимое файла:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eauth_order radius,local \u003Cbr\u002F\u003E\r\nlogin_tries 4 \u003Cbr\u002F\u003E\r\nlogin_timeout 60 \u003Cbr\u002F\u003E\r\nnologin \u002Fetc\u002Fnologin \u003Cbr\u002F\u003E\r\nissue \u002Fetc\u002Fradiusclient\u002Fissue \u003Cbr\u002F\u003E\r\n# RADIUS settings \u003Cbr\u002F\u003E\r\nauthserver localhost:1812 \u003Cbr\u002F\u003E\r\nacctserver localhost:1812 \u003Cbr\u002F\u003E\r\nservers \u002Fetc\u002Fradiusclient\u002Fservers \u003Cbr\u002F\u003E\r\ndictionary \u002Fetc\u002Fradiusclient\u002Fdictionary \u003Cbr\u002F\u003E\r\nlogin_radius \u002Fusr\u002Fsbin\u002Flogin.radius \u003Cbr\u002F\u003E\r\n# RADIUS server \u003Cbr\u002F\u003E\r\nseqfile \u002Fvar\u002Frun\u002Fradius.seq \u003Cbr\u002F\u003E\r\nmapfile \u002Fetc\u002Fradiusclient\u002Fport-id-map \u003Cbr\u002F\u003E\r\ndefault_realm \u003Cbr\u002F\u003E\r\nradius_timeout 10 \u003Cbr\u002F\u003E\r\nradius_retries 3 \u003Cbr\u002F\u003E\r\nlogin_local \u002Fbin\u002Flogin \u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Ffreeradius\u002Fradiusd.conf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗаменяем содержимое файла:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eprefix = \u002Fusr\u003Cbr\u002F\u003E\r\nexec_prefix = \u002Fusr\u003Cbr\u002F\u003E\r\nsysconfdir = \u002Fetc\u003Cbr\u002F\u003E\r\nlocalstatedir = \u002Fvar\u003Cbr\u002F\u003E\r\nsbindir = ${exec_prefix}\u002Fsbin\u003Cbr\u002F\u003E\r\nlogdir = \u002Fvar\u002Flog\u002Ffreeradius\u003Cbr\u002F\u003E\r\nraddbdir = \u002Fetc\u002Ffreeradius\u003Cbr\u002F\u003E\r\nradacctdir = ${logdir}\u002Fradacct\u003Cbr\u002F\u003E\r\n# Месторасположение конфигурационных и лог файлов.\u003Cbr\u002F\u003E\r\nconfdir = ${raddbdir}\u003Cbr\u002F\u003E\r\nrun_dir = ${localstatedir}\u002Frun\u002Ffreeradius\u003Cbr\u002F\u003E\r\n# Каталог с подгружаемыми модулями.\u003Cbr\u002F\u003E\r\nlibdir = ${exec_prefix}\u002Flib\u003Cbr\u002F\u003E\r\n# Месторасположение pid-файла. Содержащего идентификатор процесса.\u003Cbr\u002F\u003E\r\npidfile = ${run_dir}\u002Ffreeradius.pid\u003Cbr\u002F\u003E\r\n# Имя пользователя и группа от которых запускается FreeRADIUS\u003Cbr\u002F\u003E\r\nuser = freerad\u003Cbr\u002F\u003E\r\ngroup = freerad\u003Cbr\u002F\u003E\r\n# Максимальное время (в секундах) используемое для обработки запроса.\u003Cbr\u002F\u003E\r\nmax_request_time = 30\u003Cbr\u002F\u003E\r\n# Удалить запросы которые обрабатываются более чем max_request_time\u003Cbr\u002F\u003E\r\ndelete_blocked_requests = no\u003Cbr\u002F\u003E\r\n# Время ожидания (в секундах) перед очисткой reply запроса отправленного NAS.\u003Cbr\u002F\u003E\r\ncleanup_delay = 5\u003Cbr\u002F\u003E\r\n# Максимальное количество запросов хранимых сервером. Это число должно быть равно\u003Cbr\u002F\u003E\r\n# количеству клиентов помноженному на 256.\u003Cbr\u002F\u003E\r\n# К примеру для четырех клиентов оно будет 1024.\u003Cbr\u002F\u003E\r\nmax_requests = 5120\u003Cbr\u002F\u003E\r\n# Закрепить за ip адресом. По умолчанию RADIUS сервер при старте принимает\u003Cbr\u002F\u003E\r\n# запросы со всех ip адресов.\u003Cbr\u002F\u003E\r\nbind_address = 127.0.0.1\u003Cbr\u002F\u003E\r\n# Закрепить за FreeRADIUS конкретный port. Если указан ноль,\u003Cbr\u002F\u003E\r\n# то значение берется из \u002Fetc\u002Fservices\u003Cbr\u002F\u003E\r\nport = 0\u003Cbr\u002F\u003E\r\n# Запретить\u002Fразрешить ip адреса в dns имена.\u003Cbr\u002F\u003E\r\n# Включение этой опции может сильно снизить производительность.\u003Cbr\u002F\u003E\r\nhostname_lookups = no\u003Cbr\u002F\u003E\r\n# Создавать\u002Fнесоздавать отладочные файлы при падении сервера.\u003Cbr\u002F\u003E\r\nallow_core_dumps = no\u003Cbr\u002F\u003E\r\n# Разрешить использование регулярных выражений.\u003Cbr\u002F\u003E\r\nregular_expressions = yes\u003Cbr\u002F\u003E\r\nextended_expressions = yes\u003Cbr\u002F\u003E\r\n# Записывать полный User-Name аттрибут если найден в запросе.\u003Cbr\u002F\u003E\r\nlog_stripped_names = no\u003Cbr\u002F\u003E\r\n# Записывать в лог попытки авторизации.\u003Cbr\u002F\u003E\r\nlog_auth = yes\u003Cbr\u002F\u003E\r\n# Записывать в логи пароли при авторизации.\u003Cbr\u002F\u003E\r\n# log_auth_badpass - не корректные пароли\u003Cbr\u002F\u003E\r\n# log_auth_goodpass - корректные пароли\u003Cbr\u002F\u003E\r\nlog_auth_badpass = yes\u003Cbr\u002F\u003E\r\nlog_auth_goodpass = no\u003Cbr\u002F\u003E\r\n# Включить\u002Fвыключить коллизию пользователей.\u003Cbr\u002F\u003E\r\nusercollide = no\u003Cbr\u002F\u003E\r\n# конвертировать логин и\u002Fили пароль до или после авторизации.\u003Cbr\u002F\u003E\r\nlower_user = no\u003Cbr\u002F\u003E\r\nlower_pass = no\u003Cbr\u002F\u003E\r\n# удалить пробелы в логине и\u002Fили пароле.\u003Cbr\u002F\u003E\r\nnospace_user = no\u003Cbr\u002F\u003E\r\nnospace_pass = no\u003Cbr\u002F\u003E\r\n# настройки безопасности от возможных DoS аттак.\u003Cbr\u002F\u003E\r\nsecurity {\u003Cbr\u002F\u003E\r\n# Максимальное допустимое количество аттрибутов в RADIUS пакете.\u003Cbr\u002F\u003E\r\nmax_attributes = 200\u003Cbr\u002F\u003E\r\n# Задержка (в секундах) перед отправкой Access-Reject пакета.\u003Cbr\u002F\u003E\r\nreject_delay = 1\u003Cbr\u002F\u003E\r\n# Не отвечать на запросы Status-Server\u003Cbr\u002F\u003E\r\nstatus_server = no\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Конфигрурация клиентов RADIUS сервера.\u003Cbr\u002F\u003E\r\n# Описывается в отдельном файле.\u003Cbr\u002F\u003E\r\n$INCLUDE ${confdir}\u002Fclients.conf\u003Cbr\u002F\u003E\r\n# Отключить snmp поддержку.\u003Cbr\u002F\u003E\r\nsnmp=no\u003Cbr\u002F\u003E\r\n# Настрока пула процессов.\u003Cbr\u002F\u003E\r\nthread pool {\u003Cbr\u002F\u003E\r\n# количество первоначально запущенных процессов.\u003Cbr\u002F\u003E\r\nstart_servers = 5\u003Cbr\u002F\u003E\r\n# Максимально возможное количество процессов.\u003Cbr\u002F\u003E\r\nmax_servers = 32\u003Cbr\u002F\u003E\r\n# Динамическая регулировка количества процессов.\u003Cbr\u002F\u003E\r\nmin_spare_servers = 3\u003Cbr\u002F\u003E\r\nmax_spare_servers = 10\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Количество принимаемых запросов процессом. МОжет помочь при утечках памяти в\u003Cbr\u002F\u003E\r\n# RADIUS сервере. Если выставить 300, процессы будут периодически перегружаться\u003Cbr\u002F\u003E\r\n# для уборки мусора.\u003Cbr\u002F\u003E\r\nmax_requests_per_server = 0\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Секция конфигурации динамических модулей.\u003Cbr\u002F\u003E\r\nmodules {\u003Cbr\u002F\u003E\r\n# Модуль PAP авторизации.\u003Cbr\u002F\u003E\r\n# Необходим для обработки запросов с PAP авторизацией.\u003Cbr\u002F\u003E\r\n# encryption_scheme указывает в каком виде хранятся пароли.\u003Cbr\u002F\u003E\r\n# clear - подразумевает в открытом виде.\u003Cbr\u002F\u003E\r\npap {\u003Cbr\u002F\u003E\r\nencryption_scheme = clear\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Модуль CHAP авторизации.\u003Cbr\u002F\u003E\r\n# Необходим для обработки запросов с CHAP авторизацией.\u003Cbr\u002F\u003E\r\n# authtype подразумевает обработку запросов только с аттрибутом Auth-Type=CHAP\u003Cbr\u002F\u003E\r\nchap {\u003Cbr\u002F\u003E\r\nauthtype = CHAP\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Модуль преобработки запросов.\u003Cbr\u002F\u003E\r\n# Т.е. перед авторизацией пакета.\u003Cbr\u002F\u003E\r\npreprocess {\u003Cbr\u002F\u003E\r\n# huntgroups - хинт группы см. файл huntgoups.\u003Cbr\u002F\u003E\r\n# hints - хинты.\u003Cbr\u002F\u003E\r\nhuntgroups = ${confdir}\u002Fhuntgroups\u003Cbr\u002F\u003E\r\nhints = ${confdir}\u002Fhints\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Обработка Cisco VSA.\u003Cbr\u002F\u003E\r\nwith_cisco_vsa_hack = no\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Модуль Microsoft CHAP авторизации.\u003Cbr\u002F\u003E\r\n# Поддерживает так же еще и Microsoft CHAP v2\u003Cbr\u002F\u003E\r\n# authtype подразумевает обработку запросов только с аттрибутом Auth-Type=MS-CHAP\u003Cbr\u002F\u003E\r\n# use_mppe = no указывает на отсутствие компресии VPN туннеля.\u003Cbr\u002F\u003E\r\nmschap {\u003Cbr\u002F\u003E\r\nauthtype = MS-CHAP\u003Cbr\u002F\u003E\r\nuse_mppe = no\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Модуль записей Livingston RADIUS типа.\u003Cbr\u002F\u003E\r\n# usersfile содержит авторизационные записи пользователей.\u003Cbr\u002F\u003E\r\n# Рекомендуется использовать только для тестов и выставления значений по умолчанию.\u003Cbr\u002F\u003E\r\n# acctusersfile содержит пользователей подлежащих учету (аккаунтингу).\u003Cbr\u002F\u003E\r\n# compat - совместимость. При использовании файлов только FreeRADIUS можно отключить.\u003Cbr\u002F\u003E\r\nfiles {\u003Cbr\u002F\u003E\r\nusersfile = ${confdir}\u002Fusers\u003Cbr\u002F\u003E\r\ncompat = no\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Запись детального лога аккаунтинговых пакетов.\u003Cbr\u002F\u003E\r\ndetail {\u003Cbr\u002F\u003E\r\ndetailfile = ${radacctdir}\u002F%{Client-IP-Address}\u002Fdetail-%Y%m%d\u003Cbr\u002F\u003E\r\ndetailperm = 0600\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Запись детального лога пакетов авторизации.\u003Cbr\u002F\u003E\r\ndetail auth_log {\u003Cbr\u002F\u003E\r\ndetailfile = ${radacctdir}\u002F%{Client-IP-Address}\u002Fauth-detail-%Y%m%d\u003Cbr\u002F\u003E\r\ndetailperm = 0600\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Запись детального лога reply пакетов.\u003Cbr\u002F\u003E\r\ndetail reply_log {\u003Cbr\u002F\u003E\r\ndetailfile = ${radacctdir}\u002F%{Client-IP-Address}\u002Freply-detail-%Y%m%d\u003Cbr\u002F\u003E\r\ndetailperm = 0600\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Создать уникальный ключ для аккаунтинг сессии.\u003Cbr\u002F\u003E\r\n# Многие NAS повторно используют Acct-Session-ID.\u003Cbr\u002F\u003E\r\n# key перечисление аттрибутов для генерации Acct-Session-ID\u003Cbr\u002F\u003E\r\nacct_unique {\u003Cbr\u002F\u003E\r\nkey = \"User-Name, Acct-Session-Id, NAS-IP-Address, Client-IP-Address, NAS-Port-Id\"\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Конфигурация авторизации и аккаунтинга посредством СУБД\u003Cbr\u002F\u003E\r\n# содержится в отдельном файле cakesql.conf\u003Cbr\u002F\u003E\r\n#$INCLUDE ${confdir}\u002Fsql.conf\u003Cbr\u002F\u003E\r\n#$INCLUDE ${confdir}\u002Fsql\u002Fmysql\u002Fcounter.conf\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# Авторизация\u003Cbr\u002F\u003E\r\n# сначала идет пакет передается в preprocess\u003Cbr\u002F\u003E\r\n# где может быть модифицирован.\u003Cbr\u002F\u003E\r\n# Далее chap mschap обрабатывают chap и mschap авторизацию.\u003Cbr\u002F\u003E\r\nauthorize {\u003Cbr\u002F\u003E\r\npreprocess\u003Cbr\u002F\u003E\r\nchap\u003Cbr\u002F\u003E\r\nmschap\u003Cbr\u002F\u003E\r\n# Не ведем логи пакетов авторизации.\u003Cbr\u002F\u003E\r\n# auth_log\u003Cbr\u002F\u003E\r\nfiles\u003Cbr\u002F\u003E\r\n#sql\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Аунтификация\u003Cbr\u002F\u003E\r\n# Секция содержит модули доступные, для аунтификации.\u003Cbr\u002F\u003E\r\nauthenticate {\u003Cbr\u002F\u003E\r\nAuth-Type PAP {\u003Cbr\u002F\u003E\r\npap\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nAuth-Type CHAP {\u003Cbr\u002F\u003E\r\nchap\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nAuth-Type MS-CHAP {\u003Cbr\u002F\u003E\r\nmschap\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Преобразование аккаунтинговых пакетов.\u003Cbr\u002F\u003E\r\npreacct {\u003Cbr\u002F\u003E\r\npreprocess\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Секция ведения аккаунтинга.\u003Cbr\u002F\u003E\r\naccounting {\u003Cbr\u002F\u003E\r\n# Создание Acct-Session-Id если ваш NAS генрит их вполне корректно можете убрать.\u003Cbr\u002F\u003E\r\nacct_unique\u003Cbr\u002F\u003E\r\n# Не создаем detail лог.\u003Cbr\u002F\u003E\r\ndetail\u003Cbr\u002F\u003E\r\n# Помещать аккаунтинговые пакеты в СУБД\u003Cbr\u002F\u003E\r\n#sql\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n# Секция ведения логов reply-пакетов.\u003Cbr\u002F\u003E\r\npost-auth {\u003Cbr\u002F\u003E\r\n# Не ведем детальный лог репли пакетов.\u003Cbr\u002F\u003E\r\nreply_log\u003Cbr\u002F\u003E\r\n} \u003Cbr\u002F\u003E\r\nlog {\u003Cbr\u002F\u003E\r\n destination = files\u003Cbr\u002F\u003E\r\n file = ${logdir}\u002Fradius.log\u003Cbr\u002F\u003E\r\n syslog_facility = daemon\u003Cbr\u002F\u003E\r\n stripped_names = no\u003Cbr\u002F\u003E\r\n auth = no\u003Cbr\u002F\u003E\r\n auth_badpass = no\u003Cbr\u002F\u003E\r\n auth_goodpass = no\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Ffreeradius\u002Fclients.conf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗаменяем содержимое файла:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eclient localhost {\u003Cbr\u002F\u003E\r\n ipaddr = 127.0.0.1\u003Cbr\u002F\u003E\r\n secret = my-isp-radius\u003Cbr\u002F\u003E\r\n require_message_authenticator = no\u003Cbr\u002F\u003E\r\n nastype = other\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Ffreeradius\u002Fusers\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфиг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Esteve Cleartext-Password := \"testing\"\u003Cbr\u002F\u003E\r\n Service-Type = Framed-User,\u003Cbr\u002F\u003E\r\n Framed-Protocol = PPP,\u003Cbr\u002F\u003E\r\n Framed-IP-Address = 10.128.13.3,\u003Cbr\u002F\u003E\r\n Framed-IP-Netmask = 255.255.0.0,\u003Cbr\u002F\u003E\r\n Framed-Routing = Broadcast-Listen,\u003Cbr\u002F\u003E\r\n Framed-Filter-Id = \"std.ppp\",\u003Cbr\u002F\u003E\r\n Framed-MTU = 1500,\u003Cbr\u002F\u003E\r\n Framed-Compression = Van-Jacobsen-TCP-IP\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n# тут остальные юзеры по такому же принципу\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nDEFAULT Framed-Protocol == PPP\u003Cbr\u002F\u003E\r\n Framed-Protocol = PPP,\u003Cbr\u002F\u003E\r\n Framed-Compression = Van-Jacobson-TCP-IP\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nDEFAULT Hint == \"CSLIP\"\u003Cbr\u002F\u003E\r\n Framed-Protocol = SLIP,\u003Cbr\u002F\u003E\r\n Framed-Compression = Van-Jacobson-TCP-IP\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nDEFAULT Hint == \"SLIP\"\u003Cbr\u002F\u003E\r\n Framed-Protocol = SLIP\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВообще в будущем вам нужно будет настроить связку с MySQL, но на данном этапе это не критично. При добавлении пользователя нужно перезапустить Freeradius:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u002Fetc\u002Finit.d\u002Ffreeradius restart\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь нужно разобраться с шейпингом трафика. Идея такова, что скорость должна регулироваться индивидуально для каждого пользователя и передаваться в виде атрибута от Radius-сервера серверу NAT. Зачем? Для того чтобы в последствии было возможно расширить структуру и распределить нагрузку между несколькими NAS. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EШейпинг трафика\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nИтак, подготовка. Установим Wondershaper:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eaptitude install wondershaper\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот пакет представляет собой один скрипт, работающий с CBQ\u002FHTB приоритезацией и имеющий вменяемый формат вызова. При желании можно протестировать его работу до внедрения:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ewondershaper ppp0 512 512\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕстественно, ppp0 должен существовать и быть результатом соединения клиента с нашим сервером. После того как команда выполнена, можно веб-браузером клиента зайти на любой сайт, измеряющий скорость, типа \u003Ca href=\"http:\u002F\u002Fspeedtest.net\u002F\"\u003Espeedtest.net\u003C\u002Fa\u003E — и убедиться что она таки режется шейпером. Для сброса настроек без рассоединения с клиентом (кика то есть), делаем\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ewondershaper clear ppp0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nи убеждаемся в том, что скорость опять нормальная (то есть равна скорости, которую мы берем от «старшего брата» на WAN интерфейсе. Добавление ограничений скорости нужно автоматизировать, используя простой парсер файлов \u002Fvar\u002Frun\u002Fradattr.ppp*, которые появляются при успешном ppp соединении и содержат все атрибуты, передаваемые Radius-сервером серверу PPPoE. Займемся атрибутами. Дополняем содержимое файла дополнительных атрибутов \u002Fetc\u002Ffreeradius\u002Fdictionary вот этим:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Ffreeradius\u002Fdictionary\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфиг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E# Limit session traffic\u003Cbr\u002F\u003E\r\nATTRIBUTE Session-Octets-Limit 227 integer\u003Cbr\u002F\u003E\r\n# What to assume as limit - 0 in+out, 1 in, 2 out, 3 max(in,out)\u003Cbr\u002F\u003E\r\nATTRIBUTE Octets-Direction 228 integer\u003Cbr\u002F\u003E\r\n# Connection Speed Limit\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit 230 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit 231 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit-1 232 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit-1 233 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit-2 234 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit-2 235 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit-3 236 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit-3 237 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE Acct-Interim-Interval 85 integer\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДалее, эти же атрибуты нужно добавить в словарь Raduisclient-а. Редактируем \u002Fetc\u002Fradiusclient\u002Fdictionary, в конце добавляем то же самое:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fradiusclient\u002Fdictionary\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфиг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E# Limit session traffic\u003Cbr\u002F\u003E\r\nATTRIBUTE Session-Octets-Limit 227 integer\u003Cbr\u002F\u003E\r\n# What to assume as limit - 0 in+out, 1 in, 2 out, 3 max(in,out)\u003Cbr\u002F\u003E\r\nATTRIBUTE Octets-Direction 228 integer\u003Cbr\u002F\u003E\r\n# Connection Speed Limit\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit 230 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit 231 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit-1 232 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit-1 233 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit-2 234 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit-2 235 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Upstream-Speed-Limit-3 236 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE PPPD-Downstream-Speed-Limit-3 237 integer\u003Cbr\u002F\u003E\r\nATTRIBUTE Acct-Interim-Interval 85 integer\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсё отлично, теперь они (FreeRadius и RadiusClient) друг друга поймут. Соответственно, в настройках пользователей freeradius-а появятся дополнительные строчки с указанием лимита входящей и исходящей скорости (но не обязательные). Пример \u002Fetc\u002Ffreeradius\u002Fusers с учетом изменений:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Ffreeradius\u002Fusers\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфиг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Esteve Cleartext-Password := \"testing\"\u003Cbr\u002F\u003E\r\n Service-Type = Framed-User,\u003Cbr\u002F\u003E\r\n Framed-Protocol = PPP,\u003Cbr\u002F\u003E\r\n Framed-IP-Address = 10.128.13.3,\u003Cbr\u002F\u003E\r\n Framed-IP-Netmask = 255.255.0.0,\u003Cbr\u002F\u003E\r\n Framed-Routing = Broadcast-Listen,\u003Cbr\u002F\u003E\r\n Framed-Filter-Id = \"std.ppp\",\u003Cbr\u002F\u003E\r\n Framed-MTU = 1500,\u003Cbr\u002F\u003E\r\n Framed-Compression = Van-Jacobsen-TCP-IP\u003Cbr\u002F\u003E\r\n \u003Cb\u003E PPPD-Downstream-Speed-Limit = 1024,\u003Cbr\u002F\u003E\r\n PPPD-Upstream-Speed-Limit = 1024\u003Cbr\u002F\u003E\r\n\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n# тут остальные юзеры по такому же принципу\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nDEFAULT Framed-Protocol == PPP\u003Cbr\u002F\u003E\r\n Framed-Protocol = PPP,\u003Cbr\u002F\u003E\r\n Framed-Compression = Van-Jacobson-TCP-IP\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nDEFAULT Hint == \"CSLIP\"\u003Cbr\u002F\u003E\r\n Framed-Protocol = SLIP,\u003Cbr\u002F\u003E\r\n Framed-Compression = Van-Jacobson-TCP-IP\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nDEFAULT Hint == \"SLIP\"\u003Cbr\u002F\u003E\r\n Framed-Protocol = SLIP\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь NAS получает сведения о скорости, но не умеет их обрабатывать. Делаем два скрипта, выполняющих парсинг переданных атрибутов при установлении соединения:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fppp\u002Fip-up.d\u002F0001shaper\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#!\u002Fbin\u002Fsh\u003Cbr\u002F\u003E\r\n\u002Froot-scripts\u002Fshape-on $1 $5\u003Cbr\u002F\u003E\r\nexit 0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fppp\u002Fip-down.d\u002F0001shaper\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#!\u002Fbin\u002Fsh\u003Cbr\u002F\u003E\r\n\u002Froot-scripts\u002Fshape-off $1 $5\u003Cbr\u002F\u003E\r\nexit 0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак видно из этих листингов, вызывается некий скрипт, применяющий и отменяющий шейпинг. С этого момента — поподробнее. $1 — это переданное имя интерфейса, то есть ppp0 к примеру, $5 — это Framed-IP, то есть IP клиента PPP. Создадим заветный каталог и положим в него два файла:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Emkdir \u002Froot-scripts\u003Cbr\u002F\u003E\r\nnano \u002Froot-scripts\u002Fshape-on\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#!\u002Fbin\u002Fsh\u003Cbr\u002F\u003E\r\nif [ -f \u002Fvar\u002Frun\u002Fradattr.$1 ]\u003Cbr\u002F\u003E\r\n then\u003Cbr\u002F\u003E\r\n DOWNSPEED=`awk '\u002FPPPD-Downstream-Speed-Limit\u002F {print $2}' \u002Fvar\u002Frun\u002Fradattr.$1`\u003Cbr\u002F\u003E\r\n UPSPEED=`awk '\u002FPPPD-Upstream-Speed-Limit\u002F {print $2}' \u002Fvar\u002Frun\u002Fradattr.$1`\u003Cbr\u002F\u003E\r\n wondershaper $1 $DOWNSPEED $UPSPEED\u003Cbr\u002F\u003E\r\nfi\u003Cbr\u002F\u003E\r\niptables -A FORWARD -s $2 -j ACCEPT\u003Cbr\u002F\u003E\r\niptables -A INPUT -s $2 -j ACCEPT\u003Cbr\u002F\u003E\r\niptables -t nat -A POSTROUTING -s $2 -o eth1 -j MASQUERADE\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Froot-scripts\u002Fshape-off\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#!\u002Fbin\u002Fsh\u003Cbr\u002F\u003E\r\niptables -D FORWARD -s $2 -j ACCEPT \u003Cbr\u002F\u003E\r\niptables -D INPUT -s $2 -j ACCEPT\u003Cbr\u002F\u003E\r\niptables -t nat -D POSTROUTING -s $2 -o eth1 -j MASQUERADE\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Echmod +x \u002Froot-scripts\u002F*\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ листингах eth1 — это всё ещё WAN интерфейс. Итак, что мы получаем в результате: Клиент соединяется с сервером PPP, получает IP адрес. Автоматически вызывается скрипт, настраивающий шейпинг на клиентском PPP интерфейсе и включающий для него маскарадинг. При рассоединении правило маскарадинга удаляется также автоматически. Вроде как wondershaper не нужно принудительно отцеплять от pppx, во всяком случае мануалы об этом молчат и всё нормально работает на практике. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EПростая защита на основе iptables\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\nТеперь уделим немножко внимания iptables и безопасности сервера. Заменим \u002Fetc\u002Ffirewall.conf:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Ffirewall.conf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#!\u002Fbin\u002Fbash\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n#reset all\u003Cbr\u002F\u003E\r\niptables -F\u003Cbr\u002F\u003E\r\niptables -Z\u003Cbr\u002F\u003E\r\niptables -t nat -F\u003Cbr\u002F\u003E\r\niptables -t nat -Z\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n#iface config\u003Cbr\u002F\u003E\r\nINET_IFACE=\"eth1\" \u003Cbr\u002F\u003E\r\nLO_IFACE=\"lo\" \u003Cbr\u002F\u003E\r\nLO_IP=\"127.0.0.1\" \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n#kernel modules\u003Cbr\u002F\u003E\r\nmodprobe ip_tables \u003Cbr\u002F\u003E\r\nmodprobe ip_conntrack \u003Cbr\u002F\u003E\r\nmodprobe iptable_filter \u003Cbr\u002F\u003E\r\nmodprobe iptable_mangle \u003Cbr\u002F\u003E\r\nmodprobe iptable_nat \u003Cbr\u002F\u003E\r\nmodprobe ipt_LOG \u003Cbr\u002F\u003E\r\nmodprobe ipt_limit \u003Cbr\u002F\u003E\r\nmodprobe ipt_state \u003Cbr\u002F\u003E\r\nmodprobe ipt_MASQUERADE \u003Cbr\u002F\u003E\r\nmodprobe ip_conntrack_ftp \u003Cbr\u002F\u003E\r\nmodprobe ip_conntrack_irc \u003Cbr\u002F\u003E\r\nmodprobe ip_nat_ftp \u003Cbr\u002F\u003E\r\nmodprobe ip_nat_irc \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n#default policy\u003Cbr\u002F\u003E\r\niptables -P INPUT DROP \u003Cbr\u002F\u003E\r\niptables -P OUTPUT DROP \u003Cbr\u002F\u003E\r\niptables -P FORWARD DROP\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n#user chains\u003Cbr\u002F\u003E\r\niptables -N bad_tcp_packets \u003Cbr\u002F\u003E\r\niptables -N allowed \u003Cbr\u002F\u003E\r\niptables -N tcp_packets \u003Cbr\u002F\u003E\r\niptables -N udp_packets \u003Cbr\u002F\u003E\r\niptables -N icmp_packets\u003Cbr\u002F\u003E\r\niptables -N blocksshd\u003Cbr\u002F\u003E\r\nblocksshd --start\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###bad_tcp_packets chain\u003Cbr\u002F\u003E\r\niptables -A bad_tcp_packets -p tcp --tcp-flags SYN,ACK SYN,ACK -m state --state NEW -j REJECT --reject-with tcp-reset \u003Cbr\u002F\u003E\r\n#iptables -A bad_tcp_packets -p tcp ! --syn -m state --state NEW -j LOG --log-prefix \"New not syn:\" \u003Cbr\u002F\u003E\r\niptables -A bad_tcp_packets -p tcp ! --syn -m state --state NEW -j DROP \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###allowed chain\u003Cbr\u002F\u003E\r\niptables -A allowed -p TCP --syn -j ACCEPT \u003Cbr\u002F\u003E\r\niptables -A allowed -p TCP -m state --state ESTABLISHED,RELATED -j ACCEPT \u003Cbr\u002F\u003E\r\niptables -A allowed -p TCP -j DROP\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###tcp_packets chain\u003Cbr\u002F\u003E\r\niptables -A tcp_packets -p TCP -s 0\u002F0 --dport 22 -j blocksshd\u003Cbr\u002F\u003E\r\niptables -A tcp_packets -p TCP -s 0\u002F0 --dport 22 -j allowed \u003Cbr\u002F\u003E\r\niptables -A tcp_packets -p TCP -s 0\u002F0 --dport 25 -j allowed \u003Cbr\u002F\u003E\r\n#iptables -A tcp_packets -p TCP -s 0\u002F0 --dport 80 -j allowed\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###udp_packets chain\u003Cbr\u002F\u003E\r\niptables -A udp_packets -p UDP -s 0\u002F0 --destination-port 53 -j ACCEPT\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###icmp chain\u003Cbr\u002F\u003E\r\niptables -A icmp_packets -p ICMP -s 0\u002F0 --icmp-type 8 -j ACCEPT \u003Cbr\u002F\u003E\r\niptables -A icmp_packets -p ICMP -s 0\u002F0 --icmp-type 11 -j ACCEPT\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###input chain\u003Cbr\u002F\u003E\r\niptables -A INPUT -p TCP -j bad_tcp_packets \u003Cbr\u002F\u003E\r\niptables -A INPUT -p ALL -i $LO_IFACE -j ACCEPT\u003Cbr\u002F\u003E\r\niptables -A INPUT -p ALL -m state --state ESTABLISHED,RELATED -j ACCEPT \u003Cbr\u002F\u003E\r\niptables -A INPUT -p TCP -i $INET_IFACE -j tcp_packets \u003Cbr\u002F\u003E\r\niptables -A INPUT -p UDP -i $INET_IFACE -j udp_packets \u003Cbr\u002F\u003E\r\niptables -A INPUT -p ICMP -i $INET_IFACE -j icmp_packets \u003Cbr\u002F\u003E\r\n#iptables -A INPUT -m limit --limit 3\u002Fminute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix \"IPT INPUT packet died: \" \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###forward chain \u003Cbr\u002F\u003E\r\niptables -A FORWARD -p tcp -j bad_tcp_packets \u003Cbr\u002F\u003E\r\n#custom rules\u003Cbr\u002F\u003E\r\n#iptables -A FORWARD -s 10.128.0.10\u002F32 -d 192.168.1.1\u002F32 -p tcp -j ACCEPT\u003Cbr\u002F\u003E\r\n\u003Cb\u003Eiptables -A FORWARD -s 10.128.0.0\u002F16 -d 192.168.1.1\u002F32 -p tcp -j DROP\u003C\u002Fb\u003E \u003Cbr\u002F\u003E\r\n#\u002Fcustom rules\u003Cbr\u002F\u003E\r\niptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT \u003Cbr\u002F\u003E\r\n#iptables -A FORWARD -m limit --limit 3\u002Fminute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix \"IPT FORWARD packet died: \" \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###OUTPUT chain \u003Cbr\u002F\u003E\r\niptables -A OUTPUT -p tcp -j bad_tcp_packets \u003Cbr\u002F\u003E\r\niptables -A OUTPUT -p ALL -j ACCEPT \u003Cbr\u002F\u003E\r\n#iptables -A OUTPUT -m limit --limit 3\u002Fminute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix \"IPT OUTPUT packet died: \"\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n###mangle\u003Cbr\u002F\u003E\r\niptables -t mangle -A POSTROUTING -o $INET_IFACE -j TTL --ttl-set 64\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто мы тут видим? Во-первых, выделенное правило. Оно будет отличаться в реальной конфигурации или просто отсутствовать за ненадобностью, но смысл таков: если шлюзом для сервера является ADSL модем или подобный девайс с веб-админкой, нам не нужно выдумывать хитрые пароли для входа туда. Вместо этого, мы запрещаем к ним обращаться из клиентских туннелей, но одному таки разрешаем — это будет сервисная учетная запись, которой можно на него ломиться. Само собой, она не для клиентов. Далее. Добавлены команды, включающие защиту от брутфорсинга SSH сервера. Для их работы нужно настроить blocksshd.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EBlockSSHd\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\n Для начала его нужно скачать с \u003Ca href=\"http:\u002F\u002Fblocksshd.sourceforge.net\u002F\"\u003Eblocksshd.sourceforge.net\u003C\u002Fa\u003E и разархивировать файлы куда-нибудь. Я использовал для закачки wget, но путь — понятное дело — вырезал со странички SourceForge, то есть он будет скорее всего другим:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\u003Ca href=\"http:\u002F\u002Fdownloads.sourceforge.net\u002Fproject\u002Fblocksshd\u002Fblocksshd\u002FBlockSSHD%201.3\u002Fblocksshd-1.3.tar.gz?use_mirror=kent\"\u003E\u003C\u002Fa\u003Ecd \u002Ftmp\u003Cbr\u002F\u003E\r\nwget downloads.sourceforge.net\u002Fproject\u002Fblocksshd\u002Fblocksshd\u002FBlockSSHD%201.3\u002Fblocksshd-1.3.tar.gz?use_mirror=kent\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот скрипт написан на Perl и требует некоторых дополнительных модулей для работы. Итак, займемся модулями:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ecpan\u003Cbr\u002F\u003E\r\nupgrade\u003Cbr\u002F\u003E\r\ninstall Sys::Syslog\u003Cbr\u002F\u003E\r\ninstall Sys::Hostname\u003Cbr\u002F\u003E\r\ninstall File::Tail\u003Cbr\u002F\u003E\r\ninstall Tie::File\u003Cbr\u002F\u003E\r\ninstall Net::DNS\u003Cbr\u002F\u003E\r\ninstall Net::Subnets\u003Cbr\u002F\u003E\r\ninstall Getopt::Long\u003Cbr\u002F\u003E\r\nexit\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОбращаю внимание на то, что всё это одним махом не нужно копировать и вставлять в терминал. Это потому что каждая операция требует большого количества времени для выполнения и в процессе всей установки Cpan будет задавать вопросы. На все вопросы можно просто нажимать Enter, там по умолчанию всё правильно, как ни странно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь нужно распаковать blocksshd и установить его:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ecd \u002Ftmp\u003Cbr\u002F\u003E\r\ntar -xvzf .\u002Fblocksshd-1.3.tar.gz\u003Cbr\u002F\u003E\r\ncd blocksshd-1.3\u003Cbr\u002F\u003E\r\nmake install\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНу и естественно, версия на момент написания мануала была именно эта, а может быть любая, так что нужно внимательно всё сделать а не копипастить в консоль. Осталось отредактировать конфигурацию blocksshd:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Fetc\u002Fblocksshd.conf\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКонфиг:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E$cfg = {\u003Cbr\u002F\u003E\r\n os =\u003E 'linux', # Target OS - either linux or bsd\u003Cbr\u002F\u003E\r\n chain =\u003E 'blocksshd', # Name of iptables or pf chain\u003Cbr\u002F\u003E\r\n logfile =\u003E '\u002Fvar\u002Flog\u002Fsecure', # Log file to monitor\u003Cbr\u002F\u003E\r\n logcheck =\u003E '10', # How often to check the log file\u003Cbr\u002F\u003E\r\n\u003Cb\u003E max_attempts =\u003E '4', # Max number of failures\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n timeout =\u003E '360', # Reset IP count if no activity after time out in seconds\u003Cbr\u002F\u003E\r\n\u003Cb\u003E unblock =\u003E '1', # Enable unblocking\u003Cbr\u002F\u003E\r\n unblock_timeout =\u003E '43200', # Time in seconds after which to unblock a blocked IP address\u003Cbr\u002F\u003E\r\n\u003C\u002Fb\u003E restore_blocked =\u003E '0', # Turn on checking for previously blocked IPs\u003Cbr\u002F\u003E\r\n log_ips =\u003E '\u002Fetc\u002Fblocksshd.list', # Log file for blocked IPs\u003Cbr\u002F\u003E\r\n pid_file =\u003E '\u002Fvar\u002Frun\u002Fblocksshd.pid', # Location of PID file\u003Cbr\u002F\u003E\r\n\u003Cb\u003E send_email =\u003E '0', # Enable the sending of email notifications\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n email =\u003E 'root', # Email address to send notifications\u003Cbr\u002F\u003E\r\n mail =\u003E '\u002Fbin\u002Fmail', # Location of mail binary\u003Cbr\u002F\u003E\r\n email_whois_lookup =\u003E '1', # enable whois lookup of the blocked ip addres in the sent email\u003Cbr\u002F\u003E\r\n whois =\u003E '\u002Fusr\u002Fbin\u002Fwhois', # location of the whois binary\u003Cbr\u002F\u003E\r\n sed =\u003E '\u002Fbin\u002Fsed', # location of the sed binary\u003Cbr\u002F\u003E\r\n iptables =\u003E '\u002Fsbin\u002Fiptables', # Location of iptables binary - only for Linux\u003Cbr\u002F\u003E\r\n pfctl =\u003E '\u002Fsbin\u002Fpfctl', # Location of pfctl binary - only for BSD\u003Cbr\u002F\u003E\r\n whitelist =\u003E [qw{\u003Cbr\u002F\u003E\r\n 127.0.0.1\u002F32\u003Cbr\u002F\u003E\r\n }], # whitelist - list of IPs that will never be blocked - IPs must be specified in the form ad$\u003Cbr\u002F\u003E\r\n};\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n#leave 1; here!\u003Cbr\u002F\u003E\r\n1;\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ этом листинге нужно обратить внимание на выделенные строчки. Первая — максимальное число попыток входа с одного адреса, вторая — нужно ли разблокировать забаненный айпи по истечении времени в секундах, указанного в третьей строчке. Четвертая — оповещать ли по email о попытках взлома.\u003Cbr\u002F\u003E\r\nТеперь можно перезагрузить сервер и тестировать то что получилось.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch4\u003EПростейший мониторинг\u003C\u002Fh4\u003E\u003Cbr\u002F\u003E\r\n Для удобства мониторинга активных сессий можно использовать скрипт, написанный «на коленке». Создадим его и настроим симлинк для простого запуска, ну и проверим конечно:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enano \u002Froot-scripts\u002Fclients\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСкрипт:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E#!\u002Fusr\u002Fbin\u002Fphp\u003Cbr\u002F\u003E\r\n&lt;?\u003Cbr\u002F\u003E\r\nfunction time_since($original) {\u003Cbr\u002F\u003E\r\n $chunks = array(\u003Cbr\u002F\u003E\r\n array(60 * 60 * 24 , 'D '),\u003Cbr\u002F\u003E\r\n array(60 * 60 , 'h:'),\u003Cbr\u002F\u003E\r\n array(60 , 'min'),\u003Cbr\u002F\u003E\r\n );\u003Cbr\u002F\u003E\r\n $today = time();\u003Cbr\u002F\u003E\r\n $since = $today - $original;\u003Cbr\u002F\u003E\r\n for ($i = 0, $j = count($chunks); $i &lt; $j; $i++) {\u003Cbr\u002F\u003E\r\n $seconds = $chunks[$i][0];\u003Cbr\u002F\u003E\r\n $name = $chunks[$i][1];\u003Cbr\u002F\u003E\r\n if (($count = floor($since \u002F $seconds)) != 0) {\u003Cbr\u002F\u003E\r\n break;\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n $print = \"$count{$name}\";\u003Cbr\u002F\u003E\r\n if ($i + 1 &lt; $j) {\u003Cbr\u002F\u003E\r\n $seconds2 = $chunks[$i + 1][0];\u003Cbr\u002F\u003E\r\n $name2 = $chunks[$i + 1][1];\u003Cbr\u002F\u003E\r\n if (($count2 = floor(($since - ($seconds * $count)) \u002F $seconds2)) != 0) {\u003Cbr\u002F\u003E\r\n $print .= \"$count2{$name2}\";\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n return $print;\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction execShellCmdRaw($cmd) {\u003Cbr\u002F\u003E\r\n ob_start();\u003Cbr\u002F\u003E\r\n passthru($cmd);\u003Cbr\u002F\u003E\r\n $buffer = ob_get_contents();\u003Cbr\u002F\u003E\r\n ob_end_clean();\u003Cbr\u002F\u003E\r\n return $buffer;\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction rawToArray($buffer) {\u003Cbr\u002F\u003E\r\n return empty($buffer)?array():preg_split('\u002F[\\r\\n]+\u002F', $buffer, -1, PREG_SPLIT_NO_EMPTY);\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction execShellCmd($cmd) {\u003Cbr\u002F\u003E\r\n return rawToArray(execShellCmdRaw($cmd));\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction getNATSources() {\u003Cbr\u002F\u003E\r\n $nat = execShellCmd('iptables -t nat -L | grep MASQUERADE');\u003Cbr\u002F\u003E\r\n $nats = array();\u003Cbr\u002F\u003E\r\n foreach ($nat as $s) {\u003Cbr\u002F\u003E\r\n $pos_start = strpos($s, '--') + 2;\u003Cbr\u002F\u003E\r\n $pos_end = strpos($s, 'anywhere');\u003Cbr\u002F\u003E\r\n $n = trim(substr($s, $pos_start, $pos_end - $pos_start));\u003Cbr\u002F\u003E\r\n $nats[$n] = $n;\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n return $nats;\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction getTunnelMacAddr($pid) {\u003Cbr\u002F\u003E\r\n $pppdc = execShellCmd('ps -p '.$pid.' -f | grep pppd');\u003Cbr\u002F\u003E\r\n $pppdc = $pppdc[0];\u003Cbr\u002F\u003E\r\n $pos_start = strpos($pppdc, '-e ') + 3;\u003Cbr\u002F\u003E\r\n $pos_end = strpos($pppdc, '-S \\'\\'');\u003Cbr\u002F\u003E\r\n return trim(substr($pppdc, $pos_start, $pos_end - $pos_start));\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction getPPPTunnels() {\u003Cbr\u002F\u003E\r\n $ifc = execShellCmd('ifconfig -a');\u003Cbr\u002F\u003E\r\n $tunnels = array();\u003Cbr\u002F\u003E\r\n $nat = getNATSources();\u003Cbr\u002F\u003E\r\n foreach ($ifc as $i =\u003E $s) {\u003Cbr\u002F\u003E\r\n if (substr($s, 0, 3) == 'ppp') {\u003Cbr\u002F\u003E\r\n $ppp = array();\u003Cbr\u002F\u003E\r\n $ppp['interface'] = substr($s, 0, 4);\u003Cbr\u002F\u003E\r\n $ppp['framed_ip'] = trim(substr($ifc[$i+1], strpos($ifc[$i+1], 'P-t-P:') + 6, 12));\u003Cbr\u002F\u003E\r\n $RXpos_start = strpos($ifc[$i+6], '(') + 1;\u003Cbr\u002F\u003E\r\n $RXpos_end = strpos($ifc[$i+6], ')');\u003Cbr\u002F\u003E\r\n $ppp['tx'] = substr($ifc[$i+6], $RXpos_start, $RXpos_end - $RXpos_start); \u002F\u002FTX(user) = RX(server)\u003Cbr\u002F\u003E\r\n $tx_sub = substr($ifc[$i+6], $RXpos_end + 1);\u003Cbr\u002F\u003E\r\n $TXpos_start = strpos($tx_sub, '(') + 1;\u003Cbr\u002F\u003E\r\n $TXpos_end = strpos($tx_sub, ')');\u003Cbr\u002F\u003E\r\n $ppp['rx'] = substr($tx_sub, $TXpos_start, $TXpos_end - $TXpos_start);\u003Cbr\u002F\u003E\r\n $ppp['nat'] = array_key_exists($ppp['framed_ip'], $nat)?'on':'off';\u003Cbr\u002F\u003E\r\n $pidf = '\u002Fvar\u002Frun\u002F'.$ppp['interface'].'.pid';\u003Cbr\u002F\u003E\r\n if (file_exists($pidf)) {\u003Cbr\u002F\u003E\r\n $ppp['uptime'] = time_since(filemtime($pidf));\u003Cbr\u002F\u003E\r\n $ppp['pid'] = trim(file_get_contents($pidf));\u003Cbr\u002F\u003E\r\n $ppp['mac_addr'] = getTunnelMacAddr($ppp['pid']);\u003Cbr\u002F\u003E\r\n $ppp['username'] = 'detectedusername';\u003Cbr\u002F\u003E\r\n $tunnels[] = $ppp;\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n return $tunnels;\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction clientTable($tunnels) {\u003Cbr\u002F\u003E\r\n printf(\"\\n\");\u003Cbr\u002F\u003E\r\n printf(\" %15s | \",\"IP Address\");\u003Cbr\u002F\u003E\r\n printf(\"%20s | \",\"MAC Address \");\u003Cbr\u002F\u003E\r\n printf(\"%3s | \",\"NAT\");\u003Cbr\u002F\u003E\r\n printf(\"%16s | \",\"User name \");\u003Cbr\u002F\u003E\r\n printf(\"%9s | \",\"TX (up)\");\u003Cbr\u002F\u003E\r\n printf(\"%9s | \",\"RX (down)\");\u003Cbr\u002F\u003E\r\n printf(\"%11s\",\"Uptime \");\u003Cbr\u002F\u003E\r\n printf(\"\\n \");\u003Cbr\u002F\u003E\r\n for ($i = 0; $i &lt; 101; $i++) printf(\"-\");\u003Cbr\u002F\u003E\r\n printf(\"\\n\");\u003Cbr\u002F\u003E\r\n foreach($tunnels as $tun) {\u003Cbr\u002F\u003E\r\n printf(\" %15s | \",$tun['framed_ip']);\u003Cbr\u002F\u003E\r\n printf(\"%20s | \",$tun['mac_addr']);\u003Cbr\u002F\u003E\r\n printf(\"%3s | \",$tun['nat']);\u003Cbr\u002F\u003E\r\n printf(\"%16s | \",$tun['username']);\u003Cbr\u002F\u003E\r\n printf(\"%9s | \",$tun['tx']);\u003Cbr\u002F\u003E\r\n printf(\"%9s | \",$tun['rx']);\u003Cbr\u002F\u003E\r\n printf(\"%11s\",$tun['uptime']);\u003Cbr\u002F\u003E\r\n printf(\"\\n\");\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n printf(\"\\n\");\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nfunction addRadParams(&amp;$tunnels = NULL) {\u003Cbr\u002F\u003E\r\n $radusers = rawToArray(file_get_contents('\u002Fetc\u002Ffreeradius\u002Fusers'));\u003Cbr\u002F\u003E\r\n $users = array();\u003Cbr\u002F\u003E\r\n foreach ($radusers as $i =\u003E $s) {\u003Cbr\u002F\u003E\r\n if (strpos($s, 'Cleartext-Password') !== FALSE) {\u003Cbr\u002F\u003E\r\n $user = array();\u003Cbr\u002F\u003E\r\n $user['username'] = trim(substr($s, 0, strpos($s, 'Cleartext-Password')));\u003Cbr\u002F\u003E\r\n $si = $i + 1;\u003Cbr\u002F\u003E\r\n while (strpos($radusers[$si], 'Framed-IP-Address') == FALSE) $si++;\u003Cbr\u002F\u003E\r\n $ip_raw = explode('=', $radusers[$si]);\u003Cbr\u002F\u003E\r\n $ip_raw = $ip_raw[1];\u003Cbr\u002F\u003E\r\n $users[trim($ip_raw, ' ,')] = $user;\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n foreach ($tunnels as $i =\u003E $tun) {\u003Cbr\u002F\u003E\r\n $tunnels[$i]['username'] = $users[$tun['framed_ip']]['username'];\u003Cbr\u002F\u003E\r\n }\u003Cbr\u002F\u003E\r\n return $tunnels;\u003Cbr\u002F\u003E\r\n}\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n$t = getPPPTunnels();\u003Cbr\u002F\u003E\r\naddRadParams($t);\u003Cbr\u002F\u003E\r\nclientTable($t);\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапускаем:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Echmod +x \u002Froot-scripts\u002Fclients\u003Cbr\u002F\u003E\r\nln -s \u002Froot-scripts\u002Fclients \u002Fusr\u002Fbin\u002Fclients\u003Cbr\u002F\u003E\r\nclients\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПолучим что-то типа:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E IP Address | MAC Address | NAT | User name | TX (up) | RX (down) | Uptime\u003Cbr\u002F\u003E\r\n -----------------------------------------------------------------------------------------------------\u003Cbr\u002F\u003E\r\n 10.128.1.7 | 1:00:19:66:df:39:26 | on | room56 | 507.4 MiB | 445.5 MiB | 16h:31min\u003Cbr\u002F\u003E\r\n 10.128.1.3 | 23:00:13:8f:70:30:03 | on | room47 | 8.2 MiB | 137.8 MiB | 1h:14min\u003Cbr\u002F\u003E\r\n 10.128.1.5 | 3:00:a1:b0:11:74:cf | on | room50 | 19.2 MiB | 500.2 MiB | 16h:30min\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот и всё, наш сервер готов к использованию. По своим наблюдениям могу сказать, что простого системника с 1 гб DDR1 и 2 ГГц процессором хватает для раздачи 16-мегабитного канала для 30 пользователей (больше просто не нужно было) и ощутимой нагрузки система не испытывает.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУдачи начинающим провайдерам!\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"pppoe"},{"titleHtml":"dns"},{"titleHtml":"шейпинг"},{"titleHtml":"wondershaper"},{"titleHtml":"nat"},{"titleHtml":"iptables"},{"titleHtml":"сервер"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F111399\u002Ff58ef6c02df0f6ce8d108a59d073014e\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F111399\u002Ff58ef6c02df0f6ce8d108a59d073014e\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F111399\\\u002F\"},\"headline\":\"Настройка PPPoE с шейпингом трафика для небольшой сети\",\"datePublished\":\"2011-01-07T18:26:19+03:00\",\"dateModified\":\"2011-01-07T18:26:19+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"kest\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточн...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F111399\\\u002F#post-content-body\",\"about\":[\"h_linux\",\"f_admin\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F111399\\\u002Ff58ef6c02df0f6ce8d108a59d073014e\\\u002F\"]}","metaDescription":"Однажды возникла задача настроить раздачу интернета на пару десятков компьютеров (офисные и домашние). Коробочные решения оказались либо платными, либо достаточно сложно настраиваемыми, поэтому было...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"578690":{"id":"578690","timePublished":"2021-09-29T09:00:02+00:00","isCorporative":true,"lang":"ru","titleHtml":"Пишем драйвер виртуального EEPROM для STM32F030","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"1705055","alias":"Neoprog","fullname":"Алексей","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F829\u002F06a\u002F3e1\u002F82906a3e13b5a04dee9b4deead9ffd8c.png","speciality":"Инженер-программист"},"statistics":{"commentsCount":16,"favoritesCount":44,"readingCount":1364,"score":33,"votesCount":35},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"19737","alias":"controllers","type":"collective","title":"Программирование микроконтроллеров","titleHtml":"Программирование микроконтроллеров","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F578690\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ftn\u002Fn0\u002Fm6\u002Ftnn0m62rtstlnjf-sl8axn3zves.png\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nКто хотел сохранять какие-либо данные в FLASH микроконтроллера во время работы устройства сталкивались с особенностями работы с этим видом памяти. Из-за необходимости стирания страницы большого объёма для перезаписи ячейки FLASH памяти, возникает угроза потери данных из-за отключения питания во время процесса обновления (один из вариантов). В этой статье я расскажу как можно упростить работу с FLASH, да и ещё с гарантией сохранения данных при прерывании процедуры обновления на любом этапе. Реализуем это на STM32F030.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"veeprom"},{"titleHtml":"flash-память"},{"titleHtml":"ruvds_статьи"},{"titleHtml":"программирование микроконтроллеров"}]},"578788":{"id":"578788","timePublished":"2021-09-28T17:03:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Принцип работы планировщика задач в Linux","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Eliran","originalUrl":"https:\u002F\u002Fcodingkaiser.blog\u002F2021\u002F09\u002F16\u002Fprocess-scheduling-in-linux\u002F"}}],"author":{"id":"2488151","alias":"Bright_Translate","fullname":"Дмитрий Брайт","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ff9c\u002Fff9\u002F7d9\u002Ff9cff97d9c0677af28dab451897f88e4.jpg","speciality":"Переводчик"},"statistics":{"commentsCount":12,"favoritesCount":70,"readingCount":4793,"score":33,"votesCount":37},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true},{"relatedData":null,"id":"7289","alias":"nix","type":"collective","title":"*nix","titleHtml":"*nix","isProfiled":true},{"relatedData":null,"id":"19727","alias":"linux_dev","type":"collective","title":"Разработка под Linux","titleHtml":"Разработка под Linux","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F578788\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fhf\u002Fx2\u002Fht\u002Fhfx2htdiptolxklsfgogcobnvkc.png\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПланирование – это процесс распределения ресурсов системы для выполнения задач. В статье мы рассмотрим его вариант, в котором ресурсом является одно или несколько ядер процессора, а задачи представлены потоками или процессами, которые нужно выполнить.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ruvds_перевод"},{"titleHtml":"linux"},{"titleHtml":"планировщик"}]},"579106":{"id":"579106","timePublished":"2021-09-29T09:02:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Геоанализ этажности Санкт-Петербурга алгоритмом KDE, или Как меняется облик города","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2652123","alias":"MaximML","fullname":"Максим","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F924\u002Fe65\u002Fe7f\u002F924e65e7f813ba32d53a7891fd45bc62.jpg","speciality":"Machine Learning"},"statistics":{"commentsCount":3,"favoritesCount":10,"readingCount":862,"score":12,"votesCount":16},"hubs":[{"relatedData":null,"id":"22390","alias":"citymobil","type":"corporative","title":"Блог компании Ситимобил","titleHtml":"Блог компании Ситимобил","isProfiled":false},{"relatedData":null,"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true},{"relatedData":null,"id":"17783","alias":"geo","type":"collective","title":"Геоинформационные сервисы","titleHtml":"Геоинформационные сервисы","isProfiled":true},{"relatedData":null,"id":"17795","alias":"bigdata","type":"collective","title":"Big Data","titleHtml":"Big Data","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВсем привет, меня зовут Максим Шаланкин, в Ситимобил я занимаюсь машинным обучением. Мы используем множество крутых алгоритмов для оптимизации наших сервисов и улучшения бизнес-процессов. В этой публикации я расскажу, как использовать в геоаналитике алгоритм ядерной оценки плотности (Kernel Density Estimation) и строить полигоны на карте, основываясь на распределении географических данных.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F68a\u002F80b\u002F38d\u002F68a80b38d498f5a6941119e81b1856b1.png","buttonTextHtml":"Врууум","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F68a\u002F80b\u002F38d\u002F68a80b38d498f5a6941119e81b1856b1.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"полигоны"},{"titleHtml":"аналитика"},{"titleHtml":"ядерная оценка плотности"},{"titleHtml":"kernel density estimation"},{"titleHtml":"kde"},{"titleHtml":"санкт-петербург"},{"titleHtml":"геоаналитика"},{"titleHtml":"геоданные"},{"titleHtml":"гео"}]},"579530":{"id":"579530","timePublished":"2021-09-29T00:18:17+00:00","isCorporative":true,"lang":"ru","titleHtml":"Лучше поздно, чем никогда: Microsoft решила продолжить историю Skype","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2413033","alias":"kkxen","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fdeb\u002Fc7f\u002Fe41\u002Fdebc7fe41d3a22ed05b308e454b3f3fd.jpg","speciality":"Influencer-marketing manager"},"statistics":{"commentsCount":58,"favoritesCount":8,"readingCount":16525,"score":37,"votesCount":41},"hubs":[{"relatedData":null,"id":"14740","alias":"selectel","type":"corporative","title":"Блог компании Selectel","titleHtml":"Блог компании Selectel","isProfiled":false},{"relatedData":null,"id":"92","alias":"instant_messaging","type":"collective","title":"Мессенджеры","titleHtml":"Мессенджеры","isProfiled":true},{"relatedData":null,"id":"20688","alias":"research","type":"collective","title":"Исследования и прогнозы в IT","titleHtml":"Исследования и прогнозы в IT","isProfiled":false},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F8fc\u002Ff2b\u002F5e4\u002F8fcf2b5e48070f436d4ac6f9d4fe6558.png\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nКорпорация Microsoft приобрела VoIP-сервис Skype в 2011 году, можно сказать, на пике его популярности, за $8,5 млрд. И сейчас это огромная даже по меркам IT-отрасли сумма, а в 2011 году она была еще более внушительной. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКомпания, по словам ее экс-руководителя Стива Баллмера, собиралась развивать вместе со Skype коммуникации, создав простую среду для общения друзей, родственников и коллег. В целом, все выглядело неплохо, ведь тогда количество пользователей составляло 663 млн человек, при должном старании Skype (а значит, и Microsoft) мог стать едва ли не монополистом среди коммуникационных инструментов. Но что-то пошло не так. \u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"skype"},{"titleHtml":"мессенджер"},{"titleHtml":"развитие"},{"titleHtml":"Microsoft"}]},"579626":{"id":"579626","timePublished":"2021-09-29T10:52:57+00:00","isCorporative":true,"lang":"ru","titleHtml":"Если крысе не давать спать, она умрёт через 3 недели — как работают мозг и сон","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2221530","alias":"Asya_Dyu","fullname":"Анастасия","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffec\u002F943\u002F098\u002Ffec943098e84d65a162934040de8b9ed.gif","speciality":"Иллюстратор"},"statistics":{"commentsCount":1,"favoritesCount":59,"readingCount":4178,"score":21,"votesCount":21},"hubs":[{"relatedData":null,"id":"17357","alias":"timeweb","type":"corporative","title":"Блог компании Timeweb","titleHtml":"Блог компании Timeweb","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21990","alias":"brain","type":"collective","title":"Мозг","titleHtml":"Мозг","isProfiled":false},{"relatedData":null,"id":"21996","alias":"health","type":"collective","title":"Здоровье","titleHtml":"Здоровье","isProfiled":false},{"relatedData":null,"id":"22750","alias":"biology","type":"collective","title":"Биология","titleHtml":"Биология","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8y\u002Fnt\u002Feg\u002F8ynteg9tee4b_rbudidreaw4ksm.gif\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nПосмотрела 2х-часовую \u003Ca href=\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=Zdy9wy8N8Lo&amp;t=2s\" rel=\"nofollow noopener noreferrer\"\u003Eлекцию \u003C\u002Fa\u003Eпрофессора МГУ Вячеслава Дубынина про влияние сна на мозг и мозга на сон. Под катом конспект минут на 20 чтения. Если попытаться сжать до 1 минуты, то получится что-то вроде этого:\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСколько нужно спать. Индивидуально, от 6 до 10 часов — для взрослого человека в пределах нормы.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#Example\"\u003EГигиена сна\u003C\u002Fa\u003E — правила, чтобы нормально засыпать и высыпаться. (Просто якорь на слайд-список).\u003C\u002Fli\u003E\r\n\u003Cli\u003EБиологические часы — реальный физиологический процесс, который ориентируется на циркадные ритмы. Смена часовых поясов и работа по сменам «расшатывает» механизмы биологических часов. \u003C\u002Fli\u003E\r\n\u003Cli\u003EСпать надо ложиться не позже, чем… — фигня. Просто в одно и то же время.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли вы спите днем, купите себе хорошие шторы. Мелатонин коррелирует с освещением. Если в глаза (даже закрытые) светит солнце, вы не отдыхаете полноценно.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСколько можно не спать. Без необратимых серьезных последствий взрослый человек выдержит до 4-х суток. \u003C\u002Fli\u003E\r\n\u003Cli\u003EСон делится на медленную и парадоксальную фазы. \u003C\u002Fli\u003E\r\n\u003Cli\u003EМедленная фаза сна — про очищение организма. Если нет медленной фазы сна, иммунитет, эндокринка, обменные процессы и гомеостаз идут лесом. Экспериментальные крысы умирают на 15-20 день без сна от воспаления, когда кишечные бактерии попадают в кровь.\u003C\u002Fli\u003E\r\n\u003Cli\u003EПарадоксальная фаза сна участвует в обработке информации. По уровню электрической активности мозга она близка к состоянию активного решения сложных задач. \u003C\u002Fli\u003E\r\n\u003Cli\u003EКогда правильно просыпаться. На переходе от парадоксальной фазы к медленной. \u003C\u002Fli\u003E\r\n\u003Cli\u003EКак определить на глаз, когда можно будить. Когда человек лежал спокойно и начал ворочаться, можно будить.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКофеин не позволяет организму получить сигнал об усталости, но не дает дополнительную энергию.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКак затормозить перевозбужденную нервную систему нежно. Фенобарбитал в малых дозах — корвалол, валокордин, валосердин. Противогистаминные препараты. \u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"здоровье"},{"titleHtml":"сон"},{"titleHtml":"мозг"},{"titleHtml":"нейрофизиология"},{"titleHtml":"нейробиология"},{"titleHtml":"нейроны"}]},"579960":{"id":"579960","timePublished":"2021-09-28T17:50:38+00:00","isCorporative":false,"lang":"ru","titleHtml":"Архитектура Вселенной, часть 1: Сознание","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"248181","alias":"SergioShpadi","fullname":"Сергей Шпадырев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F4c0\u002Fe3f\u002F7f3\u002F4c0e3f7f3dd535053b9bd3bbcc7fbfde.png","speciality":"Software Engineer"},"statistics":{"commentsCount":111,"favoritesCount":73,"readingCount":7360,"score":14,"votesCount":26},"hubs":[{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cem\u003E'По одной капле воды человек, умеющий мыслить логически, может сделать вывод о возможности существования Атлантического океана или Ниагарского водопада, даже если он не видал ни того, ни другого и никогда о них не слыхал' -&nbsp;Артур Конан-Дойль, «Этюд в багровых тонах».\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EМеня всегда восхищали древние философы, которые не имея никаких инструментов познания мира кроме собственного разума, бесстрашно погружались в пучины тайн мироздания. С помощью одних лишь только рассуждений они обретали исключительно глубокое понимание принципов работы механизма Вселенной, тем самым расширяя наши представления о мире.\u003C\u002Fp\u003E\u003Cp\u003EТрудно переоценить влияние философии на науку, так как наука произошла именно от философии. Использующаяся для формализации процесса рассуждений математика стала первенцем философии. Даже сами слова \"философия\" и \"математика\" произошли из терминов религиозной школы одного из величайших философов античности - Пифагора. Физика, названию которой мы обязаны другому великому античному философу - Аристотелю, примерно до XVIII века именовалась натуральной философией. Ему же мы обязаны появлением логики - науки о мышлении. Кроме того, философы, изучавшие процесс познания и его ограничения, создали важнейший инструмент исследования природы - научный метод. \u003C\u002Fp\u003E\u003Cp\u003EДаже многие научные открытия последних веков были вдохновлены философией. Иоганн Кеплер, Николай Коперник и Исаак Ньютон вдохновлялись теорией о гармонии мира Пифагора, о чем сами и писали в своих научных трудах. Альберт Эйнштейн был ярым приверженцем философии средневекового философа Бенедикта Спинозы, но также считал себя в некотором смысле платоником и пифагорейцем. Один из основоположников квантовой механики Эрвин Шрёдингер написал целую книгу о том, как его открытия в квантовой механике согласуются с индийской философией веданты. \u003C\u002Fp\u003E\u003Cp\u003EДо сих пор в западных университетах всем специалистам в точных и естественных науках, успешно защитившим свою диссертацию, присваивают почетное звание доктора философии - \u003Cem\u003EPhilosophiæ Doctor\u003C\u002Fem\u003E, часто сокращаемое в речи и на письме до простого PhD. Тем самым университеты подчеркивают, что философия лежит в самом основании всего человеческого знания. Но чем именно занимается философия, в чем состоит её роль?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd13\u002Fd45\u002F8ea\u002Fd13d458ea0fe8e643a0444a0133f0472.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd13\u002Fd45\u002F8ea\u002Fd13d458ea0fe8e643a0444a0133f0472.jpg","fit":"cover","positionY":53.409090909091,"positionX":3.974358974359}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"сознание"},{"titleHtml":"квалиа"},{"titleHtml":"философский зомби"},{"titleHtml":"цвет"},{"titleHtml":"дэвид чалмерс"},{"titleHtml":"шредингер"},{"titleHtml":"макс планк"},{"titleHtml":"спиноза"}]},"579972":{"id":"579972","timePublished":"2021-09-29T13:00:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Апскейл, который смог","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"410650","alias":"man_of_letters","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb59\u002Fd10\u002Fcc4\u002Fb59d10cc4887ce1d5ac2382e5f034940.png","speciality":"Человек смыслов"},"statistics":{"commentsCount":10,"favoritesCount":34,"readingCount":2218,"score":41,"votesCount":41},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"19439","alias":"machine_learning","type":"collective","title":"Машинное обучение","titleHtml":"Машинное обучение","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"Термин «апскейл» используется для обозначения процесса увеличения разрешения цифровых изображений с фокусом на создание иллюзии «настоящего» высокого разрешения. Правда, 90% таких продуктов — это барахло, больше намёк на перспективы, чем волшебство. Недавно мои ручки добрались до двух алгоритмов повышения чёткости, которые оказались настолько хороши, что появилась эта статья. Будут субъективные и объективные тесты алгоритма Real-ESRGAN для увеличения разрешения и алгоритма GFPGAN для детализации лиц.\u003Cbr\u003E\r\n\u003Cblockquote\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ETraffic_Warning:\u003C\u002Ffont\u003E\u003C\u002Fb\u003E в статье демонстрируется множество примеров.\u003C\u002Fblockquote\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F579972\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Feg\u002F1j\u002Fkt\u002Feg1jktqrr0hcjrqsua4rsxqqio0.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"ruvds_статьи"},{"titleHtml":"машинное обучение"},{"titleHtml":"нейросети"},{"titleHtml":"искусственный интеллект"},{"titleHtml":"machine learning"},{"titleHtml":"upscale"},{"titleHtml":"Lancoz"},{"titleHtml":"Topaz Gigapixe"},{"titleHtml":"Real-ESRGAN"}]},"580034":{"id":"580034","timePublished":"2021-09-28T17:18:57+00:00","isCorporative":false,"lang":"ru","titleHtml":"Пыль, пылевые клещи и их аллергены. Профилактика и защита","editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"1841275","alias":"steanlab","fullname":"Cергей Бесараб (Siarhei Besarab) EU1AEY","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F2d8\u002Fb91\u002F145\u002F2d8b911451a45b7d469e3eead16f750d.jpg","speciality":"Хабра-химик, турист, авантюрист и радиолюбитель :)"},"statistics":{"commentsCount":53,"favoritesCount":62,"readingCount":11039,"score":54,"votesCount":62},"hubs":[{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21996","alias":"health","type":"collective","title":"Здоровье","titleHtml":"Здоровье","isProfiled":false},{"relatedData":null,"id":"22010","alias":"Chemistry","type":"collective","title":"Химия","titleHtml":"Химия","isProfiled":false},{"relatedData":null,"id":"22012","alias":"Ecology","type":"collective","title":"Экология","titleHtml":"Экология","isProfiled":false},{"relatedData":null,"id":"22750","alias":"biology","type":"collective","title":"Биология","titleHtml":"Биология","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Пыль и пылевые клещи в ней есть практически везде и всегда. Уничтожить их удается возможно только в условиях «чистых комнат» на производстве полупроводников. Приходится с этим мириться, и жить допуская, что все что нам под силу — уменьшить их количество. Считается, что если концентрация клещей &lt; 100 штук на грамм пыли — аллергия у большинства не возникает. После того как пришлось пару-тройку минут чихать без остановки — у меня накопилось достаточно злобы, чтобы \u003Ca href=\"https:\u002F\u002Ft.me\u002Fjoinchat\u002FAAAAAFFhzPKyiLO85pRxUA\" rel=\"nofollow noopener noreferrer\"\u003Eрассмотреть\u003C\u002Fa\u003E, что же представляет из себя пыль в квартире и что и кто в этой пыли живет. А теперь вот нашлось время, чтобы познакомить с «нашими маленькими друзьями» и читателей Хабра. В заметке рассуждения о некоторых особенностях биологии вездесущего домашнего паразита и методикам его контроля. То, что под катом можешь смело давать почитать жене, %username%!\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F580034\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fw0\u002F9u\u002Fzv\u002Fw09uzvckqowxlqadjnpx414mf6y.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Дружно скажем НЕТ пыли и ее обитателям","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"пыль"},{"titleHtml":"пыль это"},{"titleHtml":"пыль под микроскопом"},{"titleHtml":"пыль аллергия"},{"titleHtml":"пыль бытовая"},{"titleHtml":"мебельные клещи"},{"titleHtml":"пыль в воздухе"},{"titleHtml":"пыль текстура"},{"titleHtml":"из чего состоит пыль"},{"titleHtml":"пыль откуда берется"},{"titleHtml":"пыль от постельного белья"},{"titleHtml":"пыль обветшания"},{"titleHtml":"пыль размер частиц"},{"titleHtml":"пыль уборка"},{"titleHtml":"пыль химический состав"},{"titleHtml":"пыль что это"},{"titleHtml":"что такое пыль"},{"titleHtml":"откуда берется пыль"},{"titleHtml":"пыль это кожа"},{"titleHtml":"пылевые клещи как избавиться"},{"titleHtml":"пылевые клещи аллергия"},{"titleHtml":"пылевые клещи размер"},{"titleHtml":"где живут пылевые клещи"},{"titleHtml":"пылевые клещи борьба с ними"},{"titleHtml":"пылевые клещи борьба"},{"titleHtml":"пылевые клещи боятся холода"},{"titleHtml":"клещи пылевые"},{"titleHtml":"пылевые клещи в подушках"},{"titleHtml":"в постели"},{"titleHtml":"в матрасе"},{"titleHtml":"в постельном белье"},{"titleHtml":"в мягких игрушках"},{"titleHtml":"в одежде"},{"titleHtml":"в каждом доме"},{"titleHtml":"в диване"},{"titleHtml":"в ковре"},{"titleHtml":"пылевые клещи вред"},{"titleHtml":"пылевые клещи дезинфекция"},{"titleHtml":"пылевые клещи и ультрафиолет"},{"titleHtml":"пылевые клещи избавление"},{"titleHtml":"пыль и пылевые клещи"},{"titleHtml":"пылевые клещи мороз"},{"titleHtml":"пылевые клещи обработка"},{"titleHtml":"пылевые клещи профилактика"},{"titleHtml":"клещи при стирке"},{"titleHtml":"средства от клещей"},{"titleHtml":"пылевые клещи температура"},{"titleHtml":"клещи озон"},{"titleHtml":"аллергия на пыль"},{"titleHtml":"плесень"},{"titleHtml":"Валлемия"},{"titleHtml":"микотоксины"},{"titleHtml":"никто не читает тэги"}]},"580118":{"id":"580118","timePublished":"2021-09-29T09:34:41+00:00","isCorporative":true,"lang":"ru","titleHtml":"Вычисляем на видеокартах. Технология OpenCL. Часть 1a. Как работает OpenCL","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2690813","alias":"xjossy","fullname":"Georgy Osipov","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5c1\u002Ff73\u002F5f3\u002F5c1f735f3c77ebd66743a8e2f38a98b2.png","speciality":"Пользователь"},"statistics":{"commentsCount":3,"favoritesCount":41,"readingCount":1426,"score":18,"votesCount":18},"hubs":[{"relatedData":null,"id":"22588","alias":"yandex_praktikum","type":"corporative","title":"Блог компании Яндекс.Практикум","titleHtml":"Блог компании Яндекс.Практикум","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"9233","alias":"gpgpu","type":"collective","title":"GPGPU","titleHtml":"GPGPU","isProfiled":true},{"relatedData":null,"id":"21944","alias":"videocards","type":"collective","title":"Видеокарты","titleHtml":"Видеокарты","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"22 июня автор курса \u003Ca href=\"https:\u002F\u002Fpracticum.yandex.ru\u002Fcpp?utm_source=pr&amp;utm_medium=content&amp;utm_content=28_09_21&amp;utm_campaign=pr_content_cpp_habr\" rel=\"nofollow noopener noreferrer\"\u003E«Разработчик C++» \u003C\u002Fa\u003Eв Яндекс.Практикуме Георгий Осипов провёл вебинар \u003Ca href=\"https:\u002F\u002Fyoutu.be\u002FyPCeYXxSLjA\" rel=\"nofollow noopener noreferrer\"\u003E«Вычисляем на видеокартах. Технология OpenCL».\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fyoutu.be\u002FyPCeYXxSLjA\" rel=\"nofollow noopener noreferrer\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fwq\u002Frf\u002Fap\u002Fwqrfaphypdz0hchnq36fsinwes8.png\"\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nМы подготовили для вас его текстовую версию, для удобства разбив её на смысловые блоки.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fyandex_praktikum\u002Fblog\u002F575484\u002F\"\u003E0. Зачем мы здесь собрались. Краткая история GPGPU.\u003C\u002Fa\u003E\u003Cbr\u003E\r\n \u003Cb\u003E1a. Как работает OpenCL.\u003C\u002Fb\u003E\u003Cbr\u003E\r\n 1b. Пишем для OpenCL.\u003Cbr\u003E\r\n 2. Алгоритмы в условиях массового параллелизма.\u003Cbr\u003E\r\n 3. Сравнение технологий.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nМы обещали, что разберём написание полноценной программы уже в этой части, но материала оказалось слишком много, и мы разбили эту часть надвое. В первой половине расскажем про основные принципы, которые должен знать каждый OpenCL-разработчик, а во второй напишем программу.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ci\u003EЕсть мнение, что для написания эффективного кода для GPU программист обязан понимать архитектуру видеокарты. И это мнение не чьё-нибудь там, а NVIDIA (см. \u003Ca href=\"https:\u002F\u002Fwww.nvidia.ru\u002Fcontent\u002FEMEAI\u002FCUDA\u002Flecture_documents\u002FLecture_11.pdf\" rel=\"nofollow noopener noreferrer\"\u003EЛекции NVIDIA по GPGPU\u003C\u002Fa\u003E). Не будем спорить и разберём базовые принципы работы видеокарты.\u003C\u002Fi\u003E\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"OpenCL"},{"titleHtml":"CUDA"},{"titleHtml":"GPU"},{"titleHtml":"GPGPU"},{"titleHtml":"NVIDIA"},{"titleHtml":"OpenGL"},{"titleHtml":"видеокарты"},{"titleHtml":"высокая производительность"},{"titleHtml":"курс Разработчик C++"},{"titleHtml":"высокопроизводительные"},{"titleHtml":"многопоточные вычисления"},{"titleHtml":"Яндекс Практикум"}]},"580296":{"id":"580296","timePublished":"2021-09-28T17:06:29+00:00","isCorporative":true,"lang":"ru","titleHtml":"О чём .NET-разработчикам расскажут на DotNext 2021 Moscow","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2238368","alias":"k_tultseva","fullname":"Christina","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F44b\u002Fd20\u002F52c\u002F44bd2052c476b5ee251ae790021fcde4.jpg","speciality":"Редактор"},"statistics":{"commentsCount":2,"favoritesCount":8,"readingCount":1441,"score":12,"votesCount":12},"hubs":[{"relatedData":null,"id":"18226","alias":"jugru","type":"corporative","title":"Блог компании JUG Ru Group","titleHtml":"Блог компании JUG Ru Group","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"546","alias":"net","type":"collective","title":".NET","titleHtml":".NET","isProfiled":true},{"relatedData":null,"id":"20754","alias":"tech_events","type":"collective","title":"Конференции","titleHtml":"Конференции","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"4","alias":"marketing","title":"Маркетинг"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПорой жизнь разработчика превращается в кошмар. Называться это может по-разному: «миграция большого проекта», «отладка асинхронного кода», «запущенное легаси» или даже «зоопарк технологий для распределённых приложений». Уже скоро мы проведем .NET-конференцию \u003Cstrong\u003E\u003Ca href=\"https:\u002F\u002Fdotnext-moscow.ru\u002F?utm_source=habr&amp;utm_medium=580296\"\u003E\u003Cu\u003EDotNext\u003C\u002Fu\u003E\u003C\u002Fa\u003E\u003C\u002Fstrong\u003E, и поучаствовать в ней не только интересно, но и может помогать от кошмаров.\u003C\u002Fp\u003E\u003Cp\u003EСреди тем конференции — и низкоуровневый хардкор, и нестандартные подходы, и личные истории преодоления препятствий. А рассказывать обо всём этом будут яркие спикеры, уже знакомые многим .NET-разработчикам: например, Скотт Влашин, Дилан Битти, Стивен Тауб, Егор Богатов, Евгений Пешков.\u003C\u002Fp\u003E\u003Cp\u003EВ программу сейчас вносятся последние штрихи, так что возможны маленькие изменения, но в целом доклады будет такими, как описано под катом. А кроме докладов, будут ещё и активности от программного комитета (вроде игры в формате ЧГК), о них позже расскажем отдельно.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faee\u002F58c\u002F604\u002Faee58c604114791cf6e493e61c72f433.png","buttonTextHtml":"Смотреть программу","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faee\u002F58c\u002F604\u002Faee58c604114791cf6e493e61c72f433.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":".net"},{"titleHtml":".net development"},{"titleHtml":"конференция"},{"titleHtml":"dotnext"}]},"580392":{"id":"580392","timePublished":"2021-09-29T09:00:14+00:00","isCorporative":true,"lang":"ru","titleHtml":"Дообучаем готовую нейросеть для классификации данных","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2072505","alias":"MrNightSky","fullname":"Yaroslav Murzaev","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F9ce\u002F822\u002Fa59\u002F9ce822a590f5ae38e2ccd2507deaf9ef.jpg","speciality":"Data Scientist, ML engineer"},"statistics":{"commentsCount":0,"favoritesCount":33,"readingCount":791,"score":33,"votesCount":35},"hubs":[{"relatedData":null,"id":"18232","alias":"funcorp","type":"corporative","title":"Блог компании FUNCORP","titleHtml":"Блог компании FUNCORP","isProfiled":false},{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"19439","alias":"machine_learning","type":"collective","title":"Машинное обучение","titleHtml":"Машинное обучение","isProfiled":true},{"relatedData":null,"id":"22374","alias":"data_engineering","type":"collective","title":"Data Engineering","titleHtml":"Data Engineering","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Ffuncorp\u002Fblog\u002F576658\u002F\"\u003E\u003Cu\u003Eпрошлой статье\u003C\u002Fu\u003E\u003C\u002Fa\u003E мы научились классифицировать данные без разметки с помощью понижения размерности и методов кластеризации. По итогам получили первичную разметку данных и узнали, что это картинки. С такими начальными условиями можно придумать что-то более серьёзное, например, дообучить существующую нейросеть на наши классы, даже если до этого она их никогда не видела. В iFunny на первом уровне модерации мы выделяем три основных класса:&nbsp;\u003C\u002Fp\u003E\u003Cp\u003E• approved — картинки идут в раздел collective (развлекательный контент и мемы);\u003Cbr\u003E• not suitable — не попадают в общую ленту, но остаются в ленте пользователя (селфи, пейзажи и другие);\u003Cbr\u003E• risked — получают бан и удаляются из приложения (расизм, порнография, расчленёнка и всё, что попадает под определение «противоправный контент»).\u003C\u002Fp\u003E\u003Cp\u003EСегодня расскажу на наглядных примерах, как мы перестраивали модель под наши классы, обучали её и выделяли паттерны распознавания картинок. Технические подробности — под катом.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3d9\u002F2b4\u002F678\u002F3d92b46781695b6ccf2e69c5b4b4fe3c.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3d9\u002F2b4\u002F678\u002F3d92b46781695b6ccf2e69c5b4b4fe3c.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"обработка данных"},{"titleHtml":"машинное обучение"},{"titleHtml":"python"},{"titleHtml":"machine learning"},{"titleHtml":"data engineering"},{"titleHtml":"классификация изображений"},{"titleHtml":"нейросети"},{"titleHtml":"классификатор данных"},{"titleHtml":"data science"}]},"580516":{"id":"580516","timePublished":"2021-09-28T14:25:12+00:00","isCorporative":false,"lang":"ru","titleHtml":"Лучший язык программирования","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"8114","alias":"markshevchenko","fullname":"Марк Шевченко","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb16\u002F6c1\u002Fc82\u002Fb166c1c82387bf9406fcd39f40dc264e.jpg","speciality":"программист"},"statistics":{"commentsCount":87,"favoritesCount":182,"readingCount":39298,"score":154,"votesCount":168},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВопрос, который часто задают начинающие программисты&nbsp;— какой язык программирования изучать? Вопрос звучит разумно. Хочется выбрать самый лучший, чтобы потом не пришлось переучиваться.\u003C\u002Fp\u003E\u003Cp\u003EМожно ли на него ответить?\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"образование"},{"titleHtml":"языки программирования"}]},"580534":{"id":"580534","timePublished":"2021-09-28T16:33:56+00:00","isCorporative":false,"lang":"ru","titleHtml":"Виниловый проигрыватель своими руками","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"365505","alias":"Gromushka","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":61,"favoritesCount":21,"readingCount":6899,"score":15,"votesCount":25},"hubs":[{"relatedData":null,"id":"21976","alias":"DIY","type":"collective","title":"DIY или Сделай сам","titleHtml":"DIY или Сделай сам","isProfiled":false},{"relatedData":null,"id":"21988","alias":"sound","type":"collective","title":"Звук","titleHtml":"Звук","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EДля многих старый звук с пластинок - это ностальгия. Кому-то нравится просто вид вращающегося диска, другим нравится пощелкивание и поскрипывание в процессе проигрывания. \u003C\u002Fp\u003E\u003Cp\u003EСовременные пластмассовые балалайки - не выдерживают критики, редкие модели можно использовать действительно для извлечения звука, а не стонов. Более интересные модели - слишком дороги, а винтаж стар и требует внимания, кроме того, не каждый винтаж хорош, а действительно интересные предложения совсем не дешевые. \u003C\u002Fp\u003E\u003Cp\u003EА вот сделать самому, используя не сильно большой бюджет - вертушку с хорошими возможностями и всеми необходимыми функциями - это интересно. \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2a1\u002F9a0\u002F730\u002F2a19a073018436be3f5821b68c8cbe9f.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"винил"},{"titleHtml":"аудио"},{"titleHtml":"винтаж"},{"titleHtml":"звук"},{"titleHtml":"сделай сам"},{"titleHtml":"проигрыватель винила"},{"titleHtml":"проигрыватель пластинок"}]},"580560":{"id":"580560","timePublished":"2021-09-28T18:48:12+00:00","isCorporative":false,"lang":"ru","titleHtml":"Интересное применение WordCloud","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2784957","alias":"Arsem","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":0,"favoritesCount":16,"readingCount":1038,"score":12,"votesCount":12},"hubs":[{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИспользование WordCloud для создания облака слов из переписки.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2e2\u002Ff0f\u002F65b\u002F2e2f0f65b10692ce0e8e90d0b39459c6.jpeg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"wordcloud"}]},"580572":{"id":"580572","timePublished":"2021-09-29T03:42:38+00:00","isCorporative":false,"lang":"ru","titleHtml":"Байконур, часть 4: МИК «Протонов»","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"368687","alias":"lozga","fullname":"Филипп Терехов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F817\u002F6fa\u002Fd6b\u002F8176fad6ba9b8839f4372de9d0187146.png","speciality":"Тестировщик и популяризатор космонавтики"},"statistics":{"commentsCount":1,"favoritesCount":5,"readingCount":3810,"score":14,"votesCount":14},"hubs":[{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EУже после того, как модуль \"Наука\" отправился на старт, мы получили возможность зайти в монтажно-испытательный комплекс (МИК), где его устанавливали на ракету-носитель. Нам несколько раз говорили, что мы стали первыми посторонними посетителями этого МИКа. И по количеству просьб не снимать эта локация заняла первое место со значительным отрывом.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F707\u002Fc87\u002Fa1c\u002F707c87a1cd773efcc1e03242fdd40502.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F707\u002Fc87\u002Fa1c\u002F707c87a1cd773efcc1e03242fdd40502.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Космодром Байконур"},{"titleHtml":"ракеты-носители"},{"titleHtml":"ракета &quot;Протон&quot;"},{"titleHtml":"репортаж"},{"titleHtml":"экскурсия"}]},"580582":{"id":"580582","timePublished":"2021-09-29T06:19:53+00:00","isCorporative":false,"lang":"ru","titleHtml":"Конфиденциальность пользователей Telegram снова нарушена. Представители мессенджера требуют не раскрывать подробностей","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1800409","alias":"ne555","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":71,"favoritesCount":28,"readingCount":28879,"score":180,"votesCount":188},"hubs":[{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"92","alias":"instant_messaging","type":"collective","title":"Мессенджеры","titleHtml":"Мессенджеры","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ конце февраля 2021 года выходит обновленный релиз клиента Telegram с заголовком: ‘\u003Cem\u003EАвтоудаление, виджеты и временные ссылки для приглашений’.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EНа красивой, художественной \u003Ca href=\"https:\u002F\u002Ftelegram.org\u002Ffile\u002F464001519\u002F2\u002Fpw2YpXpzBFk.222382\u002F9ec672b0125c50ad34\" rel=\"noopener noreferrer nofollow\"\u003Eобложке\u003C\u002Fa\u003E к пресс-релизу новой верси Tg-мессенджера пользователи видят корзину с таймером и уничтоженными данными, а так же лицезреют главных героев из культового хакерского сериала \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9C%D0%B8%D1%81%D1%82%D0%B5%D1%80_%D0%A0%D0%BE%D0%B1%D0%BE%D1%82#%D0%9D%D0%B0%D0%B3%D1%80%D0%B0%D0%B4%D1%8B_%D0%B8_%D0%BD%D0%BE%D0%BC%D0%B8%D0%BD%D0%B0%D1%86%D0%B8%D0%B8\" rel=\"noopener noreferrer nofollow\"\u003EМистер Робот\u003C\u002Fa\u003E. Но действительно ли все так круто с зачисткой следов как и в сериале? Подробности об одной щекотливой bug bounty в этой статье.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1e9\u002F2a3\u002F6cc\u002F1e92a36cc8aeb8ec3f80bd8c3dd26b44.jpeg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1e9\u002F2a3\u002F6cc\u002F1e92a36cc8aeb8ec3f80bd8c3dd26b44.jpeg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"telegram"},{"titleHtml":"уязвимость"}]},"580588":{"id":"580588","timePublished":"2021-09-29T07:57:53+00:00","isCorporative":true,"lang":"ru","titleHtml":"Техподдержка без бюрократии: автоматизации под капотом ServiceDesk Яндекса","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2792513","alias":"arvidasgafiulin","fullname":"Арвидас Гафиулин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F463\u002Fe51\u002Ff5d\u002F463e51f5d7d8eaf0704e3db17fdee1e5.jpg","speciality":"Руководитель отдела эксплуатации и развития"},"statistics":{"commentsCount":6,"favoritesCount":10,"readingCount":1379,"score":17,"votesCount":17},"hubs":[{"relatedData":null,"id":"4991","alias":"yandex","type":"corporative","title":"Блог компании Яндекс","titleHtml":"Блог компании Яндекс","isProfiled":false},{"relatedData":null,"id":"17739","alias":"crm","type":"collective","title":"CRM-системы","titleHtml":"CRM-системы","isProfiled":true},{"relatedData":null,"id":"19369","alias":"service_desk","type":"collective","title":"Service Desk","titleHtml":"Service Desk","isProfiled":true},{"relatedData":null,"id":"21904","alias":"office","type":"collective","title":"Офисы IT-компаний","titleHtml":"Офисы IT-компаний","isProfiled":false},{"relatedData":null,"id":"22026","alias":"itcompanies","type":"collective","title":"IT-компании","titleHtml":"IT-компании","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Привет! Меня зовут Арвидас Гафиулин, я руководитель отдела эксплуатации и развития ИТ-инфраструктуры в Яндексе. Важнейшее направление работы отдела — наша внутренняя служба поддержки, ServiceDesk. Именно команда SD отвечает за то, чтобы у сотрудников компании была возможность работать из офиса или на удалёнке со всеми необходимыми доступами, оборудованием и комфортом. В среднем служба получает 10 тысяч запросов каждую неделю и постоянно работает над тем, чтобы решать их качественнее и быстрее, а также предотвращать новые инциденты, устраняя корни проблем. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nМы уже писали на Хабр о том, как работает \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fyandex\u002Fblog\u002F487078\u002F\"\u003Eвендомат ServiceDesk\u003C\u002Fa\u003E, выдающий расходники и компьютерные аксессуары без согласований и бумажек, а сегодня расскажем, как выглядит работа службы изнутри и какие технические решения живут у ServiceDesk «под капотом», помогая нам автоматизировать львиную долю задач. Добро пожаловать под кат, если вам интересно, откуда техподдержка знает, кому уже пора апгрейдить технику, а кому придётся ещё немного подождать, у кого устарела версия ОС или доживает последние дни жёсткий диск, какие автоматизации мы можем создавать на основе пользовательских данных, а главное — от скольких часов ожидания и кругов согласований это избавляет сотрудников Яндекса.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fao\u002Fg-\u002Fgv\u002Faog-gvbfx0gynbv_nderxmcmooi.jpeg\"\u003E\u003Cbr\u003E\r\n\u003Csup\u003EWelcome-зона службы ИТ-поддержки в одном из офисов\u003C\u002Fsup\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"служба поддержки"},{"titleHtml":"service desk"},{"titleHtml":"автоматизация"},{"titleHtml":"data lake"},{"titleHtml":"crm"},{"titleHtml":"api"}]},"580604":{"id":"580604","timePublished":"2021-09-29T08:11:26+00:00","isCorporative":false,"lang":"ru","titleHtml":"Поговорим о высшем образовании, требованиях и ожиданиях","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"56016","alias":"onlinehead","fullname":"Anton Kostenko","avatarUrl":"","speciality":"DevOps\u002FSRE"},"statistics":{"commentsCount":18,"favoritesCount":13,"readingCount":2686,"score":14,"votesCount":18},"hubs":[{"relatedData":null,"id":"20696","alias":"study","type":"collective","title":"Учебный процесс в IT","titleHtml":"Учебный процесс в IT","isProfiled":false},{"relatedData":null,"id":"20740","alias":"career","type":"collective","title":"Карьера в IT-индустрии","titleHtml":"Карьера в IT-индустрии","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EОчень много комментариев собрал \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\u002Fhttps:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eпост\u003C\u002Fa\u003E молодого человека, первокурсника, пришедшего учиться на \"программиста\", но получившего несколько не то, что он ожидал. Я сам 15 лет назад поступил в региональный университет на \"айтишную\" специальность и мне это близко. \u003C\u002Fp\u003E\u003Cp\u003EКак это обычно и бывает для постов, поднявших весьма больную тему, комментарии оказались как бы не интереснее самого поста. \u003C\u002Fp\u003E\u003Cp\u003EВ них эдаким лейтмотивом проходит несколько мыслей, которые я бы и хотел выделить, обсудить и в некотором роде постараться опровергнуть или, как минимум, поставить под сомнение.\u003C\u002Fp\u003E\u003Cp\u003EЯ заранее извиняюсь у авторов комментариев за то, что не буду упоминать их ники. Одна и та же мысль могла быть высказана десятки раз в разных формах и я не вижу никакой разумной возможности найти и упомянуть их всех, поэтому ограничусь или переформулированной идеей, или небольшой прямой цитатой там, где это совершенно необходимо.\u003C\u002Fp\u003E\u003Cp\u003EАналогично, я оговорюсь, что в некоторых ВУЗах все может быть по-другому. Частные случаи хорошо подсвечивают проблему, но никак не отменяют её наличия.\u003C\u002Fp\u003E\u003Cp\u003EКроме этого, я бы не хотел рассуждать о причинах проблем и\\или предлагать какие-либо способы решения. Но, конечно же, это всегда можно обсудить в комментариях.\u003C\u002Fp\u003E\u003Cp\u003EИтак, примем к рассмотрению следующие тезисы, которые достаточно массово высказывались в комментариях:\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3a1\u002Fe0c\u002F854\u002F3a1e0c854b5d502922bcbb9528301fc1.jpg","buttonTextHtml":"Три тезиса, о которых мы поговорим","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3a1\u002Fe0c\u002F854\u002F3a1e0c854b5d502922bcbb9528301fc1.jpg","fit":"cover","positionY":89.772727272727,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"высшее образование"},{"titleHtml":"проблемы образования"},{"titleHtml":"проблемы профессии it"},{"titleHtml":"образование в ит"},{"titleHtml":"образование в it"},{"titleHtml":"образование"},{"titleHtml":"государство"},{"titleHtml":"государственные учереждения"}]},"580618":{"id":"580618","timePublished":"2021-09-29T08:38:40+00:00","isCorporative":false,"lang":"ru","titleHtml":"Заметки о дельта-роботе. Часть 1. Историческая справка и обзор научных работ","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2647083","alias":"multiengineer","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":1,"favoritesCount":6,"readingCount":938,"score":11,"votesCount":11},"hubs":[{"relatedData":null,"id":"19309","alias":"lib","type":"collective","title":"Профессиональная литература","titleHtml":"Профессиональная литература","isProfiled":false},{"relatedData":null,"id":"19735","alias":"robo_dev","type":"collective","title":"Разработка робототехники","titleHtml":"Разработка робототехники","isProfiled":true},{"relatedData":null,"id":"21902","alias":"robot","type":"collective","title":"Робототехника","titleHtml":"Робототехника","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭтой публикацией я начинаю цикл статей о дельта-роботе. Здесь поговорим об истории этого механизма и я расскажу немного об интересных работах по этой тематике. В следующих статьях будут материалы, посвящённые его теоретическому анализу, построению рабочей зоны, выбору приводов, конструированию, изготовлению, сборке и созданию системы управления.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd7f\u002Fe6f\u002Fa2e\u002Fd7fe6fa2ea118b8426f3aa4c479345e2.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd7f\u002Fe6f\u002Fa2e\u002Fd7fe6fa2ea118b8426f3aa4c479345e2.png","fit":"cover","positionY":0,"positionX":60.128205128205}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дельта-робот"},{"titleHtml":"манипулятор"},{"titleHtml":"робототехника"},{"titleHtml":"роботостроение"}]},"580620":{"id":"580620","timePublished":"2021-09-29T09:30:34+00:00","isCorporative":false,"lang":"ru","titleHtml":"Членимая калейдоскопическая сложность. Об устройстве и потенциале фасеточного глаза","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2534007","alias":"OlegSivchenko","fullname":"Олег Сивченко","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F27b\u002Ff35\u002Ff6f\u002F27bf35f6f595fc136b70c384752ba387.jpg","speciality":"Переводчик, PM, автор, просветитель-любитель"},"statistics":{"commentsCount":3,"favoritesCount":11,"readingCount":1447,"score":11,"votesCount":13},"hubs":[{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21912","alias":"biotech","type":"collective","title":"Биотехнологии","titleHtml":"Биотехнологии","isProfiled":false},{"relatedData":null,"id":"21946","alias":"video_tech","type":"collective","title":"Видеотехника","titleHtml":"Видеотехника","isProfiled":false},{"relatedData":null,"id":"21968","alias":"physics","type":"collective","title":"Физика","titleHtml":"Физика","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНекоторое время назад я планировал разместить здесь откровенно антирелигиозную статью и пройтись по излюбленному примеру креационистов, связанному с \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9D%D0%B5%D1%87%D0%BB%D0%B5%D0%BD%D0%B8%D0%BC%D0%B0%D1%8F_%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D1%8C\" rel=\"noopener noreferrer nofollow\"\u003Eнечленимой сложностью\u003C\u002Fa\u003E. Я хотел разобрать казус с отказом признавать эволюцию глаз, но обнаружил на Хабре \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F387101\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eпревосходную статью\u003C\u002Fa\u003E Вячеслава Пуговкина @\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fusers\u002Fra3vdx\u002F\" rel=\"noopener noreferrer nofollow\"\u003Era3vdx\u003C\u002Fa\u003E, в которой разобрана именно эта проблема. Поэтому я решил изменить акценты и развернуть не менее интересную тему: рассказать об устройстве и бионическом потенциале фасеточного глаза. Давайте об этом поговорим – и начну я, пожалуй, с ваятельницы Лин, главной героини гротескного романа, написанного Чайной Мьевилем. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbd1\u002Fe25\u002F23a\u002Fbd1e2523aa1cbf2a4cf144122e6f1382.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbd1\u002Fe25\u002F23a\u002Fbd1e2523aa1cbf2a4cf144122e6f1382.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"бионика"},{"titleHtml":"фотоника"},{"titleHtml":"омматидии"},{"titleHtml":"оптика"},{"titleHtml":"обработка изображений"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["580582","580516","580034","579972","579530","580392","578690","578788","579626","580118","580588","580534","580604","580572","579960","579106","580560","580296","580620","580618"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":3},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["579924","333996"],"similarListRefs":{"333996":{"id":"333996","timePublished":"2017-07-24T12:21:19+00:00","isCorporative":false,"lang":"ru","titleHtml":"Вынос локального сервера в сеть с помощью другого внешнего сервера","editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"1518741","alias":"Trofen","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":10,"favoritesCount":68,"readingCount":12788,"score":1,"votesCount":9},"hubs":[{"id":"36","alias":"linux","type":"collective","title":"Настройка Linux","titleHtml":"Настройка Linux","isProfiled":true},{"id":"17123","alias":"network_technologies","type":"collective","title":"Сетевые технологии","titleHtml":"Сетевые технологии","isProfiled":true},{"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"Добрый день, хабровчане! История такова: сколько себя помню, всегда дома висел какой-нибудь сервер, который очень хотелось вывести во всеми нами любимый Интернет. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\n«Ну и что тут сложного? Практически любой провайдер предоставляет статический белый IP за небольшую плату!», – скажите Вы и будете абсолютно правы. Но это платно, да и вообще хотелось попробовать чего-нибудь более оригинального. Основная проблема доступа к моему серверу – NAT. Если вдруг кто не знает, что это, ниже оставил пояснение из Википедии.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"status":"published","plannedPublishTime":null,"checked":null},"579924":{"id":"579924","timePublished":"2021-09-25T10:02:04+00:00","isCorporative":false,"lang":"ru","titleHtml":"Как запустить свой сервер с белым ip из локальной домашней сети","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"2646835","alias":"the_lll_end","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F59e\u002Ffc0\u002Ffe2\u002F59efc0fe2524f178115a401aec2a415e.png","speciality":null},"statistics":{"commentsCount":61,"favoritesCount":142,"readingCount":23743,"score":15,"votesCount":41},"hubs":[{"id":"36","alias":"linux","type":"collective","title":"Настройка Linux","titleHtml":"Настройка Linux","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПоднимаем свой веб-сервер в домашней сети видимый из вне для pet проектов на старом ноутбуке с Ubuntu Server.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"kest":{"scoreStats":{"score":11,"votesCount":15},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"60539","alias":"kest","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8c5\u002F1eb\u002Fa96\u002F8c51eba96a2c4a5a45ab56241c15c729.png","speciality":null}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
