<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>По мотивам Cisco Live 2009: Advanced Concepts of DMVPN / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/84738\/"},"headline":"По мотивам Cisco Live 2009: Advanced Concepts of DMVPN","datePublished":"2010-02-22T14:41:53+03:00","dateModified":"2010-02-22T18:02:10+03:00","author":{"@type":"Person","name":"Подкопаев Илья"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)  Начну по сло...","url":"https:\/\/habr.com\/ru\/post\/84738\/#post-content-body","about":["h_cisconetworks","f_admin"],"image":["http:\/\/img24.imageshack.us\/img24\/6099\/zeroris.png","http:\/\/img16.imageshack.us\/img16\/5923\/firstris.png","http:\/\/img98.imageshack.us\/img98\/9138\/nhrpphase1.png","http:\/\/img63.imageshack.us\/img63\/1376\/nhrp2.png","http:\/\/img52.imageshack.us\/img52\/4383\/nhrp3.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="По мотивам Cisco Live 2009: Advanced Concepts of DMVPN" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="По мотивам Cisco Live 2009: Advanced Concepts of DMVPN" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="По мотивам Cisco Live 2009: Advanced Concepts of DMVPN" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)

Начну по сложившейся традиции с постановки..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)

Начну по сложившейся традиции с постановки..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)

Начну по сложившейся традиции с постановки..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)

Начну по сложившейся традиции с постановки..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)

Начну по сложившейся традиции с постановки..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/84738/2615464fba2649f19900f658f11d8508/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/84738/2615464fba2649f19900f658f11d8508/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/84738/2615464fba2649f19900f658f11d8508/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/84738/2615464fba2649f19900f658f11d8508/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/84738/2615464fba2649f19900f658f11d8508/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="84738" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2010-02-22T11:41:53.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/84738/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/84738/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/84738/2615464fba2649f19900f658f11d8508/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/IlyaPodkopaev/" title="IlyaPodkopaev" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.cee85629.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/IlyaPodkopaev/" class="tm-user-info__username">
      IlyaPodkopaev
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2010-02-22T11:41:53.000Z" title="2010-02-22, 14:41">22  февраля  2010 в 14:41</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>По мотивам Cisco Live 2009: Advanced Concepts of DMVPN</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/cisconetworks/" class="tm-article-snippet__hubs-item-link"><span>Cisco</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)<br/>
<a name="habracut"></a><br/>
Начну по сложившейся традиции с <u>постановки задачи</u>.<br/>
<br/>
Итак, у нас есть центральный офис и несколько филиалов, мы их хотим объединить в общую сеть с использованием публичных каналов связи (Internet).<br/>
<img src="/img/image-loader.svg" alt="image" data-src="http://img24.imageshack.us/img24/6099/zeroris.png"/><br/>
В отличие от описанной технологии GET VPN, использование интернет-каналов обязывает нас использовать туннелирование (замену заголовка).<br/>
<br/>
Что же такое Dynamic Multipoint VPNs (DMVPN)? Если коротко — это объединение multipoint GRE (<i>mGRE</i>) c IPSec.<br/>
mGRE — протокол туннелирования, отличающийся от традиционного GRE возможностью установления туннелей с несколькими соседями на одном интерфейсе. В основе лежит использование Next-Hop Resolution Protocol (<i>NHRP</i>), который позволяет динамически устанавливать такие соединения. IPSec, взаимодействуя с NHRP, по необходимости устанавливает SA и обеспечивает шифрование каждого отдельно соединения.<br/>
<br/>
Важно, что хотя топология соединений — классический hub-n-spoke, DMVPN позволяет динамически устанавливать туннели spoke-to-spoke.<br/>
<br/>
Если совсем коротко, идея NHRP состоит в задании хаба или <i>NHS </i>(Next-Hop Server), указанного для всех spoke статически. Каждый spoke регистрируется динамически (т.е. изначально NHS не знает адресов spoke), устанавливает постоянный туннель с NHS и NHS вносит соответствие его туннельного и реально адреса (mapping) в базу соседей, а также по необходимости сообщает об этом остальным spoke, чтобы они могли установить соединения друг с другом напрямую, а не через хаб. Соединения spoke-to-spoke, в отличие от hub-to-spoke, не постоянные, а временные. Как только трафик между филиалами отсутствует некоторое время, туннель между ними удаляется. Это позволяет использовать в качестве spoke-маршрутизаторов более слабые модели, поскольку на них нет необходимости держать столько соединений, сколько есть spoke. В качестве хаба же, наоборот, приходится выбирать маршрутизатор достаточно сильный, чтобы выдержать соединение со всеми spoke.<br/>
<img src="/img/image-loader.svg" alt="image" data-src="http://img16.imageshack.us/img16/5923/firstris.png"/><br/>
Поскольку каждый филиал сообщает хабу о своем существовании (посредством регистрации) динамически, то филиальные маршрутизаторы могут быть скрыты за dynamic NAT. А т.к. хаб конфигурится на каждом филиальном маршрутизаторе статически, то он может находиться только за статическим NAT.<br/>
<br/>
Теперь введем понятие <u>фаз DMVPN</u>. Под фазами в данном случае понимается тип (или характер) взаимодействия spoke-to-spoke или spoke-to-hub. Всего существует три фазы.<br/>
<b>Phase 1</b>. Реализованы только туннели hub-to-spoke, туннели spoke-to-spoke не устанавливаются и весь трафик течет через хаб. При этом логично заменять в протоколах маршрутизации next-hop с адреса NHC на адрес NHS.<br/>
Регистрация проходит следующим образом:<br/>
<img src="/img/image-loader.svg" alt="image" data-src="http://img98.imageshack.us/img98/9138/nhrpphase1.png"/><br/>
Т.е. сначала устанавливается IPSec-туннель, потом NHC шлет сообщение NHRP registration request. <br/>
Интервал между сообщениями — 1/3 'ip nhrp registration holdtime' или 'ip nhrp registration timeout'. Если NHS не отвечает — интервал увеличивается в геометрической прогрессии, начиная с 1 (1, 2, 4, 8..., 64,… ). При этом, уже после третьей попытки NHS будет помечен как Down и не будет использоваться. Иными словами, registration requests выполняют еще и функцию keepalive.<br/>
Каждое сообщение NHRP Registration содержит соответствие туннельного адреса NHC и его реального адреса (NBMA) и может содержать еще заголовки расширения, например аутентификацию, NAT и т.п.<br/>
<br/>
Ответ на это сообщение — естественно NHRP registration reply. Содержит соответствие реального и туннельного адресов NHC и NHS, а также все те же заголовки расширения. Фактически еще и подтверждает жизнеспособность хаба.<br/>
После регистрации NHC, вывод таблицы NHRP выглядит так:<br/>
<u>На Hub</u>:<br/>
<code>HUB#sh ip nhrp <br/>
10.1.1.2/32 via 10.1.1.2, Tunnel0 created 15:17:10, expire 01:22:43<br/>
 Type: dynamic, Flags: unique registered <br/>
 NBMA address: 172.16.2.1 <br/>
10.1.1.3/32 via 10.1.1.3, Tunnel0 created 15:17:10, expire 01:22:43<br/>
 Type: dynamic, Flags: unique registered <br/>
 NBMA address: 172.16.3.1 </code><br/>
<u>На Spoke 1</u>:<br/>
<code>SPOKE1#sh ip nhrp <br/>
10.1.1.1/32 via 10.1.1.1, Tunnel0 created 15:17:45, never expire <br/>
 Type: static, Flags: used <br/>
 NBMA address: 172.16.1.1 </code><br/>
<br/>
Раз уж мы коснулись вывода mapping, то давайте обсудим <s>типы и флаги</s>, соответствующие этим mapping.<br/>
<u><i>Типы</i></u><br/>
<ol>
<li><i>Static </i> — запись, для которой на интерфейсе явно прописано соответствие туннельного адреса и реального (ip nhrp map ...)</li>
<li><i>Dynamic </i> — запись, полученная по NHRP. Бывает двух видов:</li>
<li><i>Incomplete </i> — мы знаем туннельный адрес spoke, но еще не получили ответ на NHRP Resolution request.</li>
</ol><br/>
<u><i>Флаги</i></u><br/>
<ol>
<li><i>Unique</i>. Означает, что данный mapping — уникальный и в случае смены NBMA адреса обновление этой записи проводиться не будет.</li>
<li><i>Registered </i> — получена из NHRP Registration, обычно бывает на хабе.</li>
<li><i>Learned </i> — получена из NHRP Registration, наоборот, обычно на spoke.\</li>
<li><i>Authoritative</i>. Может использоваться для ответов на NHRP resolution request.</li>
<li><i>Used</i>. Запись использовалась в предшествующие 60 секунд.</li>
<li><i>Router</i>. Записи для удаленного роутера или для сетей за ним маркируются таким флагом.</li>
<li><i>Implicit</i>. Запись получена из информации о источнике в NHRP пакете.</li>
<li> <i>Local</i>. Информация о нашей локальной сети, которую мы отдали какому-то другому spoke в ответ на NHRP request. Хранит также NBMA адрес этого spoke.</li>
<li><i>NAT</i>. (появилась в 12.4(6)Т версии IOS, не показывается после 12.4(15)Т. Показывает, что удаленный пир поддерживает работу через NAT. После 12.4(15) Т просто показывается в записи еще и claimed NBMA адрес.</li>
<li> <i>no socket</i>. Запись, для которой роутер не имеет необходимости или не хочет устанавливать IPSec туннель, потому что нет трафика, которому этот туннель нужен. Если в дальнейшем такой трафик появится, то запись будет преобразована в “socket” и туннель IPsec будет поднят. Записи типа Local и implicit всегда сначала маркируются как “no socket”. Кроме того, NHRP по умолчанию кэширует информацию об источнике из NHRP resolution request или reply, когда они проходят через роутер. Чтобы разрешить такое кэширование, но не поднимать IPSec-туннель, они маркируются как (no socket). Если этого не сделать, будут образованы лишние IPSec сокеты от хаба к spoke, которые не будут использоваться. Данные, прибывающие на туннельный интерфейс и уходящие с него не могут использовать (no socket) запись, поскольку в этом случае роутер является промежуточной нодой на пути между двумя взаимодействующими, и мы вряд ли захотим поднимать еще один туннель с промежуточной точкой. Если же в какой-то момент времени роутер получит пакет данных, который пришел не с туннельного интерфейса и должен использовать (nmo socket) запись, роутер преобразует ее в (socket) запись, поскольку в этом случае роутер будет являться точкой выхода в туннель для этого потока данных. Так же, эти (no socket) записи маркируются как (non-authoritative), поскольку только полученные из NHRP registrations записи маркируются как (authoritative). </li>
<li><i>Negative</i>. Означает, что запрошенный mapping еще не получен. Когда NHRP шлет NHRP resolution request, он ставит этот (negative) флаг на запись типа incomplete, что избавляет роутер от многократных отправок этих запросов в ожидании ответа или установления IPSec соединения.</li>
</ol><br/>
<br/>
После регистрации происходит обмен маршрутной информацией, в которой хаб ставит себя в качестве next-hop для каждого маршрута. После этого NHC могут обмениваться данными, но через хаб.<br/>
<br/>
Из <u>преимуществ </u>такой технологии можно отметить наличие всего одного туннеля на каждом NHC, что позволяет экономить ресурсы.<br/>
<u>Недостаток</u> очевиден: маршрутизация через хаб не только нагружает его, но и приводит к существенным задержкам при передаче.<br/>
<br/>
<b>Phase 2</b>. Здесь мы уже можем строить туннели spoke-to-spoke, для чего используется «обман» CEF. Все филиалы получают полностью маршрутную информацию с неизменным next-hop (дальше поясню, как это сделать).<br/>
<br/>
NHC, получив такой маршрут от NHS, помещает для маршрута соответствующую CEF-запись, отмеченную как «invalid», а для next-hop адреса (т.е. адреса другого NHC) — запись типа glean (т.е. адрес L3 должен быть разрешен в адрес L2). Это разрешение осуществляется NHRP, когда первый пакет будет отправлен по этому маршруту. <br/>
<br/>
Пример таких записей:<br/>
<br/>
<code>SPOKE1#sh ip cef 192.168.2.0<br/>
192.168.2.0/24, version 27, epoch 0<br/>
0 packets, 0 bytes<br/>
 via 10.1.1.3, Tunnel0, 0 dependencies<br/>
 next hop 10.1.1.3, Tunnel0<br/>
 invalid adjacency<br/>
SPOKE1#sh ip cef 10.1.1.3 <br/>
10.1.1.0/24, version 20, epoch 0, attached, connected<br/>
0 packets, 0 bytes<br/>
 via Tunnel0, 0 dependencies<br/>
 valid glean adjacency</code><br/>
<br/>
На уровне NHRP тоже существует три вида записей, соответствующих второй фазе.<br/>
<ol>
<li> Запись отсутствует. Все прозрачно, трафик отправляется к NHS, в след за ним летит NHRP resolution request.</li>
<li> Запись типа (no socket). Вроде знаем кому отправлять, но не установлено IPSec соединение. Трафик по-прежнему летит к NHS, и устанавливается соединение с другим NHC</li>
<li> Запись типа (socket). Трафик летит к другому NHC по IPSec туннелю.</li>
</ol><br/>
<br/>
Первый пакет будет отправлен через NHS с использованием process switching. NHC пошлет NHS NHRP resolution request, на который NHS ответит адресом, позволяющим дозаполнить запись в CEF.<br/>
<br/>
<u>Особенность</u>. До IOS 12.4.5a запрос и ответ проходил всю цепочку NHS. После (не на 6500 и 7600) функцию ответа на NHRP resolution request переложили на сам NHC, адрес которого нас интересует. Схема взаимодействия новой реализации phase представлена на рисунке:<br/>
<img src="/img/image-loader.svg" alt="image" data-src="http://img63.imageshack.us/img63/1376/nhrp2.png"/><br/>
<br/>
Пример вывода команды debug nhrp packet для phase 2.<br/>
<code>SPOKE1#ping 192.168.2.1<br/>
<br/>
Type escape sequence to abort.<br/>
Sending 5, 100-byte ICMP Echos to 192.168.2.1, timeout is 2 seconds:<br/>
!!!!!<br/>
Success rate is 100 percent (5/5), round-trip min/avg/max = 8/41/72 ms<br/>
SPOKE1#<br/>
*Mar 1 00:30:01.367: NHRP: Send Resolution Request via Tunnel0 vrf 0, packet size: 81<br/>
*Mar 1 00:30:01.367: src: 10.1.1.2, dst: 10.1.1.3<br/>
*Mar 1 00:30:01.371: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1<br/>
*Mar 1 00:30:01.371: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:30:01.371: (M) flags: "router auth src-stable", reqid: 4 <br/>
*Mar 1 00:30:01.371: <b> <u> src NBMA: 172.16.2.1</u></b><br/>
*Mar 1 00:30:01.371: src protocol: 10.1.1.2, dst protocol: 10.1.1.3<br/>
*Mar 1 00:30:01.375: (C-1) code: no error(0)<br/>
*Mar 1 00:30:01.375: prefix: 0, mtu: 1514, hd_time: 7200<br/>
*Mar 1 00:30:01.375: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0<br/>
*Mar 1 00:30:01.375: NHRP: Send Resolution Request via Tunnel0 vrf 0, packet size: 81<br/>
*Mar 1 00:30:01.379: src: 10.1.1.2, dst: 10.1.1.1<br/>
*Mar 1 00:30:01.379: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1<br/>
*Mar 1 00:30:01.379: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:30:01.383: (M) flags: "router auth src-stable", reqid: 4 <br/>
*Mar 1 00:30:01.383: src NBMA: 172.16.2.1<br/>
*Mar 1 00:30:01.383: src protocol: 10.1.1.2, dst protocol: 10.1.1.3<br/>
*Mar 1 00:30:01.383: (C-1) code: no error(0)<br/>
*Mar 1 00:30:01.387: prefix: 0, mtu: 1514, hd_time: 7200<br/>
*Mar 1 00:30:01.387: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0<br/>
*Mar 1 00:30:01.415: NHRP: Receive Resolution Reply via Tunnel0 vrf 0, packet size: 109<br/>
*Mar 1 00:30:01.415: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1<br/>
*Mar 1 00:30:01.415: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:30:01.415: (M) flags: "router auth dst-stable unique src-stable", reqid: 4 <br/>
*Mar 1 00:30:01.419: <b><u>src NBMA: 172.16.2.1</u></b><br/>
*Mar 1 00:30:01.419: src protocol: 10.1.1.2, dst protocol: 10.1.1.3<br/>
*Mar 1 00:30:01.419: (C-1) code: no error(0)<br/>
*Mar 1 00:30:01.423: prefix: 32, mtu: 1514, hd_time: 6089<br/>
*Mar 1 00:30:01.423: addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0<br/>
*Mar 1 00:30:01.423: client NBMA: 172.16.3.1<br/>
*Mar 1 00:30:01.423: client protocol: 10.1.1.3</code><br/>
<br/>
Наличие поля src NBMA позволяет NHC назначения отвечать минуя хаб.<br/>
<u>Замечания</u>.<br/>
<ul>
<li>Сохранение адреса next-hop на первый взгляд выглядит логичным и правильным решением. Но есть у него один недостаток: каждый NHC должен получить полностью всю таблицу маршрутизации от NHS, без использования суммаризации. Это позволяет использовать только один уровень NHS, т.е. мы можем обслуживать половину NHC одним NHS, другую половину — другим, но мы обязаны соединить их как NHS друг для друга. Это необходимо для того, чтобы позволить NHRP resolution request пройти все потенциальные NHS. А статическое их указание уменьшает общую надежность. </li>
<li>Ну и кроме того, первый пакет будет отправлен не через CEF, а через process switching.</li>
</ul><br/>
<b>Phase 3</b>.<br/>
В этой фазе мы позволяем NHC участвовать в ответе на NHRP resolution requests, отбирая это «преимущество» у NHS. <br/>
<br/>
Рассмотрим по шагам.<br/>
<img src="/img/image-loader.svg" alt="image" data-src="http://img52.imageshack.us/img52/4383/nhrp3.png"/><br/>
<ol>
<li>NHC по традиции регистрируется на NHS, что позволяет последнему установить с NHC соседство по протоколу маршрутизации и обменяться маршрутной информацией. При этом, NHS не обязан сохранять маршрутную информацию в первозданном виде: он может поменять next-hop на себя и даже ее суммаризовать при этом. Более того, чем более общий маршрут мы пошлем обратно NHC, тем легче ему будет :) </li>
<li>NHC получает маршрутную информацию и заполняет CEF-таблицу. Поскольку у теперь next-hop у нас теперь сам NHS, у нас не будет «invalid» или «glean» записей. Другими словами, первый пакет по такому маршруту будет отправлен с помощью CEF… куда???… правильно, на хаб! Но это, кроме всего прочего, означает, что отсутствие «неправильных» записей в CEF не будет вызывать NHRP resolution requests! И здесь на арену выходит <i>NHRP redirect message</i>!</li>
<li>Шаг 3 — прямое продолжение второго. Итак, первый пакет, отправленный от spoke к другому spoke идет через NHS. Когда NHS получает по mGRE туннелю пакет, а потом вынужден отправить его обратно по этому же интерфейсу (но уже другому NHC), NHS шлет источнику такого пакета главную «фишку» третьей фазы — NHRP redirect message. Это сообщение говорит NHC, что он использует «не совсем правильный» :) путь в маршрутизации пакетов. И «намекает», что хорошо бы использовать NHRP resolution для уточнения пути у NHC. Сам же первый пакет тем не менее отправляется NHS по адресу. </li>
<li>Опять продолжаем. Теперь NHC, пославший первый пакет, получает сообщение redirect, содержащее адрес назначения того самого первого пакета. Этот NHC шлет NHRP resolution request об этом же IP, но (внимание!!!) не к NHS, а<b> опять по этому же адрес</b>у! Т.е. NHC спрашивает другого NHC о его реальном адресе. Еще раз: адрес назначения в NHRP resolution request не NHS, а именно тот NHC, которым мы интересуемся, хотя мы и (как и первый пакет) будем до него добираться через NHS. NHS отправит его тем же самым путем по назначению (т.е. опять пакет пойдет через хаб, неоптимально). </li>
<li>Развязка :) Теперь наш NHC назначения (а не NHS!!) отвечает на resolution request. Используя реальный адрес, приложенный к запросу, этот NHC ответит отправителю напрямую, минуя NHS. При этом, ответ будет содержать всю сеть (маршрут, префикс), найденный в RIB, а не только запрошенный адрес. Когда наш NHC-отправитель запроса получит такой ответ, он узнает реальный next-hop такого адреса, заполнит NHRP-таблицу и поправит запись в CEF (или новую создаст).</li>
</ol><br/>
<br/>
Пример дебажного вывода:<br/>
<code>SPOKE2#ping 192.168.1.1<br/>
<br/>
Type escape sequence to abort.<br/>
Sending 5, 100-byte ICMP Echos to 192.168.1.1, timeout is 2 seconds:<br/>
!!!!!<br/>
Success rate is 100 percent (5/5), round-trip min/avg/max = 32/51/84 ms<br/>
SPOKE2#<br/>
*Mar 1 00:07:57.151: NHRP: <u>Receive Traffic Indication </u>via Tunnel0 vrf 0, packet size: 97<br/>
*Mar 1 00:07:57.155: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1<br/>
*Mar 1 00:07:57.155: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:07:57.159: (M) traffic code: redirect(0)<br/>
*Mar 1 00:07:57.159: src NBMA: 172.16.1.1<br/>
*Mar 1 00:07:57.159: src protocol: 10.1.1.1, dst protocol: 10.1.1.3<br/>
*Mar 1 00:07:57.163: Contents of nhrp traffic indication packet:<br/>
*Mar 1 00:07:57.167: 45 00 00 64 00 00 00 00 FE 01 EF EB 0A 01 01 03 <br/>
*Mar 1 00:07:57.171: C0 A8 01 01 08 00 36 7F 00 00 00 <br/>
*Mar 1 00:07:57.211: NHRP: Send Resolution Request via Tunnel0 vrf 0, packet size: 85<br/>
*Mar 1 00:07:57.215: src: 10.1.1.3, dst: 192.168.1.1<br/>
*Mar 1 00:07:57.219: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1<br/>
*Mar 1 00:07:57.219: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:07:57.219: (M) flags: "router auth src-stable nat ", reqid: 5 <br/>
*Mar 1 00:07:57.219: src NBMA: 172.16.3.1<br/>
*Mar 1 00:07:57.219: src protocol: 10.1.1.3, dst protocol: 192.168.1.1<br/>
*Mar 1 00:07:57.219: (C-1) code: no error(0)<br/>
*Mar 1 00:07:57.219: prefix: 0, mtu: 1514, hd_time: 7200<br/>
*Mar 1 00:07:57.219: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0<br/>
*Mar 1 00:07:57.247: NHRP: Receive Resolution Request via Tunnel0 vrf 0, packet size: 105<br/>
*Mar 1 00:07:57.251: (F) afn: IPv4(1), type: IP(800), hop: 254, ver: 1<br/>
*Mar 1 00:07:57.251: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:07:57.255: (M) flags: "router auth src-stable nat ", reqid: 6 <br/>
*Mar 1 00:07:57.255: src NBMA: 172.16.2.1<br/>
*Mar 1 00:07:57.259: src protocol: 10.1.1.2, dst protocol: 10.1.1.3<br/>
*Mar 1 00:07:57.263: (C-1) code: no error(0)<br/>
*Mar 1 00:07:57.263: prefix: 0, mtu: 1514, hd_time: 7200<br/>
*Mar 1 00:07:57.263: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0<br/>
*Mar 1 00:07:57.271: NHRP: Send Resolution Reply via Tunnel0 vrf 0, packet size: 133<br/>
*Mar 1 00:07:57.275: src: 10.1.1.3, dst: 10.1.1.2<br/>
*Mar 1 00:07:57.279: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1<br/>
*Mar 1 00:07:57.279: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:07:57.283: (M) flags: "router auth dst-stable unique src-stable nat ", reqid: 6 <br/>
*Mar 1 00:07:57.283: src NBMA: 172.16.2.1<br/>
*Mar 1 00:07:57.287: src protocol: 10.1.1.2, dst protocol: 10.1.1.3<br/>
*Mar 1 00:07:57.291: (C-1) code: no error(0)<br/>
*Mar 1 00:07:57.291: prefix: 32, mtu: 1514, hd_time: 7200<br/>
*Mar 1 00:07:57.295: addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0<br/>
*Mar 1 00:07:57.299: client NBMA: 172.16.3.1<br/>
*Mar 1 00:07:57.299: client protocol: 10.1.1.3<br/>
*Mar 1 00:07:57.323: NHRP: Receive Resolution Reply via Tunnel0 vrf 0, packet size: 153<br/>
*Mar 1 00:07:57.331: (F) afn: IPv4(1), type: IP(800), hop: 254, ver: 1<br/>
*Mar 1 00:07:57.331: shtl: 4(NSAP), sstl: 0(NSAP)<br/>
*Mar 1 00:07:57.331: (M) flags: "router auth dst-stable unique src-stable nat ", reqid: 5 <br/>
*Mar 1 00:07:57.335: src NBMA: 172.16.3.1<br/>
*Mar 1 00:07:57.339: src protocol: 10.1.1.3, dst protocol: 192.168.1.1<br/>
*Mar 1 00:07:57.343: (C-1) code: no error(0)<br/>
*Mar 1 00:07:57.343: prefix: 24, mtu: 1514, hd_time: 7200<br/>
*Mar 1 00:07:57.343: addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0<br/>
*Mar 1 00:07:57.347: client NBMA: 172.16.2.1<br/>
*Mar 1 00:07:57.347: client protocol: 10.1.1.2</code><br/>
<br/>
Подчеркнутым выделено получение NHRP редиректа.<br/>
<br/>
Подведем <u>итоги третьей фазы</u>:<br/>
<ol>
<li> Нет неправильных записей в CEF. Все пакеты используют CEF, а NHRP request теперь вызываются не неправильной записью в CEF, а явным указанием от NHS.</li>
<li> NHS теперь не единственный источник информации NHRP. В это вовлекли еще и остальные NHC. Больше похоже на peer2peer.</li>
<li> NHRP replies от NHC содержит целый префикс, а не только next-hop. Именно это, кстати, позволяет нам посылать общий маршрут от NHS к NHC, т.к. NHC назначения вернет именно ему принадлежащий префикс, который может быть более частным, чем тот, что изначально получен от NHS.</li>
<li> Первоначальные пакеты бегут через хаб.</li>
<li> Поскольку ответ дает не NHS, а NHC, в топологии может быть несколько уровней хабов.</li>
</ol><br/>
Теперь несколько подведем <b>итоги по маршрутизации</b>, вооружившись знаниями о фазах.<br/>
<br/>
<u>Постулат 1</u>. NHC устанавливает соседство по протоколу маршрутизации только с NHS, и никогда с NHC. NHC сообщает о своих локальных сетях NHS.<br/>
<u>Постулат 2</u>. NHS устанавливает соседство со всеми NHC. При этом он сообщает NHC о всех сетях, узнанных от других NHC и своих локальных сетях.<br/>
кроме того, вне зависимости от фазы, требуется выключать split horizon для RIP и EIGRP.<br/>
Но есть и различие в функционировании, в зависимости от фазы:<br/>
<ol>
<li>В phase 1 и phase 3 хаб не может сохранять next-hop в маршрутной информации (например, BGP next-hop-self, OSPF network point-to-multipoint), за счет этого возможно применение суммаризации. Кроме того, число хабов не ограничено и они не обязаны быть одного уровня.</li>
<li>В phase 2 напротив, хаб <b>обязан</b> сохранять next-hop в маршрутной информации (EIGRP <b>no ip next-hop-self</b>, BGP default, OSPF network broadcast), возможно использование не более двух хабов.</li>
</ol><br/>
<u>Постулат 3</u>. NHS устанавливает соседство по протоколу маршрутизации с другими NHS. При этом<br/>
<ol>
<li>В phase 1 и phase 3 протокол маршрутизации между хабами может отличаться от протокола маршрутизации между хабами и NHC.</li>
<li>В phase 2 хабы <b>обязаны</b> использовать тот же протокол.</li>
</ol><br/>
<br/>
 — Теперь, когда мы рассмотрели теоретические основы функционирования DMVPN, посмотрим, как его настроить на маршрутизаторах Cisco.<br/>
<b>Настройка </b>будет отличаться в зависимости от желамой фазы и роли роутера (Hub или spoke). <br/>
<br/>
По порядку:<br/>
<br/>
<u>Hub</u> с точки зрения NHRP настраивается одинаково для Phase 1 и Phase 2. Разница будет в настройке протоколов маршрутизации.<br/>
<br/>
Создаем туннельный интерфейс и присваиваем ему адрес:<br/>
<code>Hub(config)# interface Tunnel0<br/>
Hub(config-if)# ip address 10.1.1.1 255.255.255.0</code><br/>
<br/>
Задаем интерфейс-источник и режим — GRE multipoint<br/>
<code>Hub(config-if)# tunnel source FastEthernet0/0<br/>
Hub(config-if)# tunnel mode gre multipoint</code><br/>
<br/>
Далее собственно задаем настройки протокола NHRP.<br/>
Идентификатор сети:<br/>
<code>Hub(config-if)# ip nhrp network-id 123</code><br/>
<br/>
Опционально аутентификацию:<br/>
<code>Hub(config-if)# ip nhrp authentication cisco</code><br/>
<br/>
И настраиваем маппинг мультикастовых рассылок в динамически узнаваемые адреса<br/>
<code>Hub(config-if)# ip nhrp map multicast dynamic</code><br/>
<br/>
<u><i>Phase 3.</i></u> Отличается от Phase 2 только наличием <br/>
<code>Hub(config-if)# ip nhrp redirect</code><br/>
<br/>
<u>Spoke</u>.<br/>
<br/>
<u><i>Phase 1.</i></u><br/>
Создаем туннельный интерфейс и присваиваем ему адрес:<br/>
<code>Spoke1(config)# interface Tunnel0<br/>
Spoke1(config-if)# ip address 10.1.1.2 255.255.255.0</code><br/>
<br/>
Задаем интерфейс-источник<br/>
<code>Spoke1(config-if)# tunnel source FastEthernet0/0</code><br/>
<br/>
Поскольку мы планируем связываться только с хабом — можем явно задать адрес назначения и тип туннеля — обычный GRE IP (по умолчанию)<br/>
<code>Spoke1(config-if)# tunnel destination 172.16.1.1</code><br/>
<br/>
Т.к. регистрироваться по протоколу NHRP все равно нужно, то задаем идентификатор сети:<br/>
<code>Spoke1(config-if)# ip nhrp network-id 123</code><br/>
<br/>
Опционально аутентификацию:<br/>
<code>Spoke1(config-if)# ip nhrp authentication cisco</code><br/>
<br/>
И настраиваем маппинг мультикастовых рассылок в адрес хаба (внимание, не туннельный, а реальный)<br/>
<code>Spoke1(config-if)# ip nhrp map multicast 172.16.1.1</code><br/>
<br/>
Указываем туннельный адрес NHS:<br/>
<code>Spoke1(config-if)# ip nhrp nhs 10.1.1.1</code> <br/>
<br/>
И создаем маппинг для этого туннельного адреса в реальный:<br/>
<code>Spoke1(config-if)# ip nhrp map 10.1.1.1 172.16.1.1</code><br/>
<br/>
<u><i>Phase 2.</i></u><br/>
Почти тоже самое, только задаем tunnel mode и не указываем tunnel destination:<br/>
<code>Spoke1(config)# interface Tunnel0<br/>
Spoke1(config-if)# ip address 10.1.1.2 255.255.255.0<br/>
Spoke1(config-if)# tunnel source FastEthernet0/0<br/>
Spoke1(config-if)# tunnel mode gre multipoint<br/>
Spoke1(config-if)# ip nhrp network-id 123<br/>
Spoke1(config-if)# ip nhrp authentication cisco<br/>
Spoke1(config-if)# ip nhrp map multicast 172.16.1.1<br/>
Spoke1(config-if)# ip nhrp nhs 10.1.1.1<br/>
Spoke1(config-if)# ip nhrp map 10.1.1.1 172.16.1.1</code><br/>
<br/>
<u><i>Phase 3.</i></u> Отличается от Phase 2 только наличием <br/>
<code>Spoke1(config-if)# ip nhrp shortcut<br/>
Spoke1(config-if)# ip nhrp redirect</code><br/>
<br/>
Таким образом, мы настроили mGRE. Осталось прицепить к нему <b>IPSec</b>. Настройка одинакова на всех роутерах.<br/>
<br/>
Создаем<u> политику ISAKMP</u><br/>
<code>Router(config)#crypto isakmp policy 10<br/>
Router(config-isakmp)# encr aes<br/>
Router(config-isakmp)# authentication pre-share<br/>
Router(config-isakmp)# group 2</code><br/>
<br/>
Для простоты описания я использую аутентификацию по общему ключу<br/>
<code>Router(config-isakmp)#crypto isakmp key cisco address 0.0.0.0 0.0.0.0</code><br/>
<br/>
Включаем <u>keepalive</u><br/>
<code>Router(config)#crypto isakmp keepalive 10 3 periodic</code><br/>
<br/>
Создаем трансформ-сет и привязываем его к <u>профайлу IPSec</u>.<br/>
<code>Router(config)#crypto ipsec transform-set IPSEC_SET esp-aes esp-sha-hmac <br/>
Router(cfg-crypto-trans)#crypto ipsec profile IPSEC_PROFILE<br/>
Router(ipsec-profile)# set transform-set IPSEC_SET </code><br/>
<br/>
<u>Цепляем профайл</u> на туннельный интерфейс<br/>
<code>Router(config)#interface tunnel 0<br/>
Router(config-if)#tunnel protection ipsec profile IPSEC_PROFILE</code><br/>
<br/>
Теперь поговорим о <b>настройках протоколов маршрутизации</b>. Для простоты я ограничусь двумя наиболее распространенными IGP: OSPF и EIGRP, к тому же, один из них link-state, другой distance-vector.<br/>
<br/>
Итак, как мы уже выяснили, <u>phase 1 &amp; 3</u> обязуют <i><u>хаб </u></i>менять next-hop в маршрутной информации на свой адрес, поэтому <br/>
OSPF: <code>Hub(config-if)# ip ospf network point-to-multipoint</code><br/>
В случае EIGRP next-hop меняется по умолчанию и дополнительных усилий не требует.<br/>
Кроме того, в случае EIGRP и RIP требуется отключать split-horizon :<code> Hub(config-if)#no ip split-horizon eigrp <i>AS_NUMBER</i></code><br/>
<br/>
На <i><u>spoke </u></i>все просто: настраиваем тип сети OSPF и принудительно запрещаем spoke быть DR или BDR.<br/>
OSPF: <code>Spoke(config-if)# ip ospf network point-to-multipoint<br/>
Spoke(config-if)# ip ospf priority 0</code><br/>
<br/>
Для <u>phase 2</u> немного по-другому.<br/>
<br/>
На <u>хабе</u> нам уже не требуется менять next-hop, но split horizon нам по-прежнему мешает. Поэтому<br/>
OSPF: <code>Hub(config-if)# ip ospf network broadcast</code> (таймеры по вкусу)<br/>
EIGRP: <code>Hub(config-if)#no ip next-hop-self eigrp <i>AS_NUMBER</i><br/>
Hub(config-if)#no ip split-horizon eigrp <i>AS_NUMBER</i></code><br/>
<br/>
На <i><u>spoke </u></i> тоже настраиваем тип сети OSPF как broadcast и поскольку нам нужно соседство только с хабом, то по-прежнему принудительно запрещаем spoke быть DR или BDR.<br/>
OSPF: <code>Spoke(config-if)# ip ospf network broadcast<br/>
Spoke(config-if)# ip ospf priority 0</code><br/>
<br/>
Подведем <b>итоги </b>технологии.<br/>
<ul>
<li>DMVPN — технология, позволяющая строить VPN со множеством участников. Основная топология — hub-n-spoke, но возможно динамическое установление туннелей spoke-to-spoke и даже иерархия хабов.</li>
<li>В основе лежит mGRE (а в его основе — NHRP), а защита возложена на IPSec, тесно с ним взаимодействующий.</li>
<li>Нагрузка на хаб в общем случае больше, чем на spoke. Это позволяет использовать оборудование, различающееся по производительности, в зависимости от нужд конкретного филиала.</li>
<li>Характер работы напрямую зависит от настроенной фазы.</li>
<li>Конфигурация протоколов маршрутизации тоже требует внимательности.</li>
<li>Из недостатков хотел бы отметить ограниченность поддержки мультикастов и отсутствие поддержки на Cisco ASA (хнык...)</li>
</ul><br/>
<br/>
За сим разрешите откланяться :) Конечно, опять не надеюсь на то, что раскрыл все аспекты технологии. За кадром как минимум остались конфигурация с множеством хабов и т.п. Но надеюсь, что общее представление о технологии мне изложить удалось.<br/>
<br/>
Всячески надеюсь на конструктивную критику, т.к. статья большая и наверняка в ней полно неточностей, ошибок и опечаток.<br/>
<br/>
Подкопаев Илья, инструктор<br/>
<br/>
UPD. Спасибо <a href="https://habrahabr.ru/users/quickshooter/" class="user_link">Quickshooter</a> за найденную ошибку :)</div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BVPN%5D" class="tm-article-body__tags-item-link">VPN</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bcisco%5D" class="tm-article-body__tags-item-link">cisco</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BDMVPN%5D" class="tm-article-body__tags-item-link">DMVPN</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/cisconetworks/" class="tm-article-body__tags-item-link">
                  Cisco
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 3: ↑3 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 3: ↑3 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+3</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    57
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/84738/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      17
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/IlyaPodkopaev/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_blue"><!----> <use xlink:href="/img/megazord-v24.cee85629.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 94 голоса " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    68
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><span class="tm-user-card__name">Подкопаев Илья</span> <a href="/ru/users/IlyaPodkopaev/" class="tm-user-card__nickname">
          @IlyaPodkopaev
        </a> <!----></div> <p class="tm-user-card__short-info">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/84738/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 17 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-04-23T15:00:02.000Z" title="2021-04-23, 18:00">23  апреля   в 18:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/553156/" class="tm-article-title__link"><span>MPLS L3VPN поверх DMVPN</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 5: ↑5 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 5: ↑5 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+5</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.8K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    13
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/553156/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      3
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-03-26T09:00:01.000Z" title="2021-03-26, 12:00">26  марта   в 12:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/547006/" class="tm-article-title__link"><span>Spoke to spoke мультикаст в сетях DMVPN</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 3: ↑3 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 3: ↑3 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+3</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">858</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    4
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/547006/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      0
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2014-12-19T08:46:56.000Z" title="2014-12-19, 11:46">19  декабря  2014 в 11:46</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/246281/" class="tm-article-title__link"><span>Поговорим о VPN-ах? Типы VPN соединений. Масштабирование VPN</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 54: ↑53 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 54: ↑53 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+52</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">165K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    1073
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/246281/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      39
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T09:00:04.000Z" title="2021-09-27, 12:00">вчера в 12:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580060/" class="tm-article-title__link"><span>Арракис, который мы заслужили</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 147: ↑141 и ↓6</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 147: ↑141 и ↓6" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+135</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">23K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    40
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580060/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      114
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T16:41:21.000Z" title="2021-09-27, 19:41">вчера в 19:41</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/lamptest/blog/580228/" class="tm-article-title__link"><span>Идеальная светодиодная лампа за 21 рубль</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 83: ↑81 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 83: ↑81 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+79</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">11K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    46
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/lamptest/blog/580228/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      29
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T13:03:14.000Z" title="2021-09-27, 16:03">вчера в 16:03</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580124/" class="tm-article-title__link"><span>Электролюминесцентные индикаторы из прошлого</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 75: ↑75 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 75: ↑75 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+75</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">5.3K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    37
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580124/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      13
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T12:53:02.000Z" title="2021-09-27, 15:53">вчера в 15:53</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580210/" class="tm-article-title__link"><span>PHP Дайджест № 212 (13 – 27 сентября 2021)</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 41: ↑41 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 41: ↑41 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+41</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.7K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    14
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580210/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      1
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T10:50:03.000Z" title="2021-09-27, 13:50">вчера в 13:50</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/oleg-bunin/blog/580150/" class="tm-article-title__link"><span>Топ-5 когнитивных искажений при планировании в IT</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 40: ↑39 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 40: ↑39 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+38</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    54
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/oleg-bunin/blog/580150/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      7
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="84738" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/84738/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/84738/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"84738":{"id":"84738","timePublished":"2010-02-22T11:41:53+00:00","isCorporative":false,"lang":"ru","titleHtml":"По мотивам Cisco Live 2009: Advanced Concepts of DMVPN","leadData":{"textHtml":"Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":68,"votesCount":94},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"54347","alias":"IlyaPodkopaev","fullname":"Подкопаев Илья","avatarUrl":null,"speciality":null},"statistics":{"commentsCount":17,"favoritesCount":57,"readingCount":27838,"score":3,"votesCount":3},"hubs":[{"relatedData":null,"id":"6900","alias":"cisconetworks","type":"collective","title":"Cisco","titleHtml":"Cisco","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EПродолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nНачну по сложившейся традиции с \u003Cu\u003Eпостановки задачи\u003C\u002Fu\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, у нас есть центральный офис и несколько филиалов, мы их хотим объединить в общую сеть с использованием публичных каналов связи (Internet).\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"http:\u002F\u002Fimg24.imageshack.us\u002Fimg24\u002F6099\u002Fzeroris.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\nВ отличие от описанной технологии GET VPN, использование интернет-каналов обязывает нас использовать туннелирование (замену заголовка).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто же такое Dynamic Multipoint VPNs (DMVPN)? Если коротко — это объединение multipoint GRE (\u003Ci\u003EmGRE\u003C\u002Fi\u003E) c IPSec.\u003Cbr\u002F\u003E\r\nmGRE — протокол туннелирования, отличающийся от традиционного GRE возможностью установления туннелей с несколькими соседями на одном интерфейсе. В основе лежит использование Next-Hop Resolution Protocol (\u003Ci\u003ENHRP\u003C\u002Fi\u003E), который позволяет динамически устанавливать такие соединения. IPSec, взаимодействуя с NHRP, по необходимости устанавливает SA и обеспечивает шифрование каждого отдельно соединения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВажно, что хотя топология соединений — классический hub-n-spoke, DMVPN позволяет динамически устанавливать туннели spoke-to-spoke.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли совсем коротко, идея NHRP состоит в задании хаба или \u003Ci\u003ENHS \u003C\u002Fi\u003E(Next-Hop Server), указанного для всех spoke статически. Каждый spoke регистрируется динамически (т.е. изначально NHS не знает адресов spoke), устанавливает постоянный туннель с NHS и NHS вносит соответствие его туннельного и реально адреса (mapping) в базу соседей, а также по необходимости сообщает об этом остальным spoke, чтобы они могли установить соединения друг с другом напрямую, а не через хаб. Соединения spoke-to-spoke, в отличие от hub-to-spoke, не постоянные, а временные. Как только трафик между филиалами отсутствует некоторое время, туннель между ними удаляется. Это позволяет использовать в качестве spoke-маршрутизаторов более слабые модели, поскольку на них нет необходимости держать столько соединений, сколько есть spoke. В качестве хаба же, наоборот, приходится выбирать маршрутизатор достаточно сильный, чтобы выдержать соединение со всеми spoke.\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"http:\u002F\u002Fimg16.imageshack.us\u002Fimg16\u002F5923\u002Ffirstris.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\nПоскольку каждый филиал сообщает хабу о своем существовании (посредством регистрации) динамически, то филиальные маршрутизаторы могут быть скрыты за dynamic NAT. А т.к. хаб конфигурится на каждом филиальном маршрутизаторе статически, то он может находиться только за статическим NAT.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь введем понятие \u003Cu\u003Eфаз DMVPN\u003C\u002Fu\u003E. Под фазами в данном случае понимается тип (или характер) взаимодействия spoke-to-spoke или spoke-to-hub. Всего существует три фазы.\u003Cbr\u002F\u003E\r\n\u003Cb\u003EPhase 1\u003C\u002Fb\u003E. Реализованы только туннели hub-to-spoke, туннели spoke-to-spoke не устанавливаются и весь трафик течет через хаб. При этом логично заменять в протоколах маршрутизации next-hop с адреса NHC на адрес NHS.\u003Cbr\u002F\u003E\r\nРегистрация проходит следующим образом:\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"http:\u002F\u002Fimg98.imageshack.us\u002Fimg98\u002F9138\u002Fnhrpphase1.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\nТ.е. сначала устанавливается IPSec-туннель, потом NHC шлет сообщение NHRP registration request. \u003Cbr\u002F\u003E\r\nИнтервал между сообщениями — 1\u002F3 'ip nhrp registration holdtime' или 'ip nhrp registration timeout'. Если NHS не отвечает — интервал увеличивается в геометрической прогрессии, начиная с 1 (1, 2, 4, 8..., 64,… ). При этом, уже после третьей попытки NHS будет помечен как Down и не будет использоваться. Иными словами, registration requests выполняют еще и функцию keepalive.\u003Cbr\u002F\u003E\r\nКаждое сообщение NHRP Registration содержит соответствие туннельного адреса NHC и его реального адреса (NBMA) и может содержать еще заголовки расширения, например аутентификацию, NAT и т.п.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОтвет на это сообщение — естественно NHRP registration reply. Содержит соответствие реального и туннельного адресов NHC и NHS, а также все те же заголовки расширения. Фактически еще и подтверждает жизнеспособность хаба.\u003Cbr\u002F\u003E\r\nПосле регистрации NHC, вывод таблицы NHRP выглядит так:\u003Cbr\u002F\u003E\r\n\u003Cu\u003EНа Hub\u003C\u002Fu\u003E:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHUB#sh ip nhrp \u003Cbr\u002F\u003E\r\n10.1.1.2\u002F32 via 10.1.1.2, Tunnel0 created 15:17:10, expire 01:22:43\u003Cbr\u002F\u003E\r\n Type: dynamic, Flags: unique registered \u003Cbr\u002F\u003E\r\n NBMA address: 172.16.2.1 \u003Cbr\u002F\u003E\r\n10.1.1.3\u002F32 via 10.1.1.3, Tunnel0 created 15:17:10, expire 01:22:43\u003Cbr\u002F\u003E\r\n Type: dynamic, Flags: unique registered \u003Cbr\u002F\u003E\r\n NBMA address: 172.16.3.1 \u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cu\u003EНа Spoke 1\u003C\u002Fu\u003E:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESPOKE1#sh ip nhrp \u003Cbr\u002F\u003E\r\n10.1.1.1\u002F32 via 10.1.1.1, Tunnel0 created 15:17:45, never expire \u003Cbr\u002F\u003E\r\n Type: static, Flags: used \u003Cbr\u002F\u003E\r\n NBMA address: 172.16.1.1 \u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРаз уж мы коснулись вывода mapping, то давайте обсудим \u003Cs\u003Eтипы и флаги\u003C\u002Fs\u003E, соответствующие этим mapping.\u003Cbr\u002F\u003E\r\n\u003Cu\u003E\u003Ci\u003EТипы\u003C\u002Fi\u003E\u003C\u002Fu\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E\u003Ci\u003EStatic \u003C\u002Fi\u003E — запись, для которой на интерфейсе явно прописано соответствие туннельного адреса и реального (ip nhrp map ...)\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003EDynamic \u003C\u002Fi\u003E — запись, полученная по NHRP. Бывает двух видов:\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003EIncomplete \u003C\u002Fi\u003E — мы знаем туннельный адрес spoke, но еще не получили ответ на NHRP Resolution request.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cu\u003E\u003Ci\u003EФлаги\u003C\u002Fi\u003E\u003C\u002Fu\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E\u003Ci\u003EUnique\u003C\u002Fi\u003E. Означает, что данный mapping — уникальный и в случае смены NBMA адреса обновление этой записи проводиться не будет.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003ERegistered \u003C\u002Fi\u003E — получена из NHRP Registration, обычно бывает на хабе.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003ELearned \u003C\u002Fi\u003E — получена из NHRP Registration, наоборот, обычно на spoke.\\\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003EAuthoritative\u003C\u002Fi\u003E. Может использоваться для ответов на NHRP resolution request.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003EUsed\u003C\u002Fi\u003E. Запись использовалась в предшествующие 60 секунд.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003ERouter\u003C\u002Fi\u003E. Записи для удаленного роутера или для сетей за ним маркируются таким флагом.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003EImplicit\u003C\u002Fi\u003E. Запись получена из информации о источнике в NHRP пакете.\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003Ci\u003ELocal\u003C\u002Fi\u003E. Информация о нашей локальной сети, которую мы отдали какому-то другому spoke в ответ на NHRP request. Хранит также NBMA адрес этого spoke.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003ENAT\u003C\u002Fi\u003E. (появилась в 12.4(6)Т версии IOS, не показывается после 12.4(15)Т. Показывает, что удаленный пир поддерживает работу через NAT. После 12.4(15) Т просто показывается в записи еще и claimed NBMA адрес.\u003C\u002Fli\u003E\r\n\u003Cli\u003E \u003Ci\u003Eno socket\u003C\u002Fi\u003E. Запись, для которой роутер не имеет необходимости или не хочет устанавливать IPSec туннель, потому что нет трафика, которому этот туннель нужен. Если в дальнейшем такой трафик появится, то запись будет преобразована в “socket” и туннель IPsec будет поднят. Записи типа Local и implicit всегда сначала маркируются как “no socket”. Кроме того, NHRP по умолчанию кэширует информацию об источнике из NHRP resolution request или reply, когда они проходят через роутер. Чтобы разрешить такое кэширование, но не поднимать IPSec-туннель, они маркируются как (no socket). Если этого не сделать, будут образованы лишние IPSec сокеты от хаба к spoke, которые не будут использоваться. Данные, прибывающие на туннельный интерфейс и уходящие с него не могут использовать (no socket) запись, поскольку в этом случае роутер является промежуточной нодой на пути между двумя взаимодействующими, и мы вряд ли захотим поднимать еще один туннель с промежуточной точкой. Если же в какой-то момент времени роутер получит пакет данных, который пришел не с туннельного интерфейса и должен использовать (nmo socket) запись, роутер преобразует ее в (socket) запись, поскольку в этом случае роутер будет являться точкой выхода в туннель для этого потока данных. Так же, эти (no socket) записи маркируются как (non-authoritative), поскольку только полученные из NHRP registrations записи маркируются как (authoritative). \u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ci\u003ENegative\u003C\u002Fi\u003E. Означает, что запрошенный mapping еще не получен. Когда NHRP шлет NHRP resolution request, он ставит этот (negative) флаг на запись типа incomplete, что избавляет роутер от многократных отправок этих запросов в ожидании ответа или установления IPSec соединения.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосле регистрации происходит обмен маршрутной информацией, в которой хаб ставит себя в качестве next-hop для каждого маршрута. После этого NHC могут обмениваться данными, но через хаб.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИз \u003Cu\u003Eпреимуществ \u003C\u002Fu\u003Eтакой технологии можно отметить наличие всего одного туннеля на каждом NHC, что позволяет экономить ресурсы.\u003Cbr\u002F\u003E\r\n\u003Cu\u003EНедостаток\u003C\u002Fu\u003E очевиден: маршрутизация через хаб не только нагружает его, но и приводит к существенным задержкам при передаче.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EPhase 2\u003C\u002Fb\u003E. Здесь мы уже можем строить туннели spoke-to-spoke, для чего используется «обман» CEF. Все филиалы получают полностью маршрутную информацию с неизменным next-hop (дальше поясню, как это сделать).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nNHC, получив такой маршрут от NHS, помещает для маршрута соответствующую CEF-запись, отмеченную как «invalid», а для next-hop адреса (т.е. адреса другого NHC) — запись типа glean (т.е. адрес L3 должен быть разрешен в адрес L2). Это разрешение осуществляется NHRP, когда первый пакет будет отправлен по этому маршруту. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПример таких записей:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESPOKE1#sh ip cef 192.168.2.0\u003Cbr\u002F\u003E\r\n192.168.2.0\u002F24, version 27, epoch 0\u003Cbr\u002F\u003E\r\n0 packets, 0 bytes\u003Cbr\u002F\u003E\r\n via 10.1.1.3, Tunnel0, 0 dependencies\u003Cbr\u002F\u003E\r\n next hop 10.1.1.3, Tunnel0\u003Cbr\u002F\u003E\r\n invalid adjacency\u003Cbr\u002F\u003E\r\nSPOKE1#sh ip cef 10.1.1.3 \u003Cbr\u002F\u003E\r\n10.1.1.0\u002F24, version 20, epoch 0, attached, connected\u003Cbr\u002F\u003E\r\n0 packets, 0 bytes\u003Cbr\u002F\u003E\r\n via Tunnel0, 0 dependencies\u003Cbr\u002F\u003E\r\n valid glean adjacency\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа уровне NHRP тоже существует три вида записей, соответствующих второй фазе.\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E Запись отсутствует. Все прозрачно, трафик отправляется к NHS, в след за ним летит NHRP resolution request.\u003C\u002Fli\u003E\r\n\u003Cli\u003E Запись типа (no socket). Вроде знаем кому отправлять, но не установлено IPSec соединение. Трафик по-прежнему летит к NHS, и устанавливается соединение с другим NHC\u003C\u002Fli\u003E\r\n\u003Cli\u003E Запись типа (socket). Трафик летит к другому NHC по IPSec туннелю.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПервый пакет будет отправлен через NHS с использованием process switching. NHC пошлет NHS NHRP resolution request, на который NHS ответит адресом, позволяющим дозаполнить запись в CEF.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003EОсобенность\u003C\u002Fu\u003E. До IOS 12.4.5a запрос и ответ проходил всю цепочку NHS. После (не на 6500 и 7600) функцию ответа на NHRP resolution request переложили на сам NHC, адрес которого нас интересует. Схема взаимодействия новой реализации phase представлена на рисунке:\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"http:\u002F\u002Fimg63.imageshack.us\u002Fimg63\u002F1376\u002Fnhrp2.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПример вывода команды debug nhrp packet для phase 2.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESPOKE1#ping 192.168.2.1\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nType escape sequence to abort.\u003Cbr\u002F\u003E\r\nSending 5, 100-byte ICMP Echos to 192.168.2.1, timeout is 2 seconds:\u003Cbr\u002F\u003E\r\n!!!!!\u003Cbr\u002F\u003E\r\nSuccess rate is 100 percent (5\u002F5), round-trip min\u002Favg\u002Fmax = 8\u002F41\u002F72 ms\u003Cbr\u002F\u003E\r\nSPOKE1#\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.367: NHRP: Send Resolution Request via Tunnel0 vrf 0, packet size: 81\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.367: src: 10.1.1.2, dst: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.371: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.371: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.371: (M) flags: \"router auth src-stable\", reqid: 4 \u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.371: \u003Cb\u003E \u003Cu\u003E src NBMA: 172.16.2.1\u003C\u002Fu\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.371: src protocol: 10.1.1.2, dst protocol: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.375: (C-1) code: no error(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.375: prefix: 0, mtu: 1514, hd_time: 7200\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.375: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.375: NHRP: Send Resolution Request via Tunnel0 vrf 0, packet size: 81\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.379: src: 10.1.1.2, dst: 10.1.1.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.379: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.379: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.383: (M) flags: \"router auth src-stable\", reqid: 4 \u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.383: src NBMA: 172.16.2.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.383: src protocol: 10.1.1.2, dst protocol: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.383: (C-1) code: no error(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.387: prefix: 0, mtu: 1514, hd_time: 7200\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.387: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.415: NHRP: Receive Resolution Reply via Tunnel0 vrf 0, packet size: 109\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.415: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.415: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.415: (M) flags: \"router auth dst-stable unique src-stable\", reqid: 4 \u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.419: \u003Cb\u003E\u003Cu\u003Esrc NBMA: 172.16.2.1\u003C\u002Fu\u003E\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.419: src protocol: 10.1.1.2, dst protocol: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.419: (C-1) code: no error(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.423: prefix: 32, mtu: 1514, hd_time: 6089\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.423: addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.423: client NBMA: 172.16.3.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:30:01.423: client protocol: 10.1.1.3\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНаличие поля src NBMA позволяет NHC назначения отвечать минуя хаб.\u003Cbr\u002F\u003E\r\n\u003Cu\u003EЗамечания\u003C\u002Fu\u003E.\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EСохранение адреса next-hop на первый взгляд выглядит логичным и правильным решением. Но есть у него один недостаток: каждый NHC должен получить полностью всю таблицу маршрутизации от NHS, без использования суммаризации. Это позволяет использовать только один уровень NHS, т.е. мы можем обслуживать половину NHC одним NHS, другую половину — другим, но мы обязаны соединить их как NHS друг для друга. Это необходимо для того, чтобы позволить NHRP resolution request пройти все потенциальные NHS. А статическое их указание уменьшает общую надежность. \u003C\u002Fli\u003E\r\n\u003Cli\u003EНу и кроме того, первый пакет будет отправлен не через CEF, а через process switching.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cb\u003EPhase 3\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\nВ этой фазе мы позволяем NHC участвовать в ответе на NHRP resolution requests, отбирая это «преимущество» у NHS. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРассмотрим по шагам.\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"image\" data-src=\"http:\u002F\u002Fimg52.imageshack.us\u002Fimg52\u002F4383\u002Fnhrp3.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003ENHC по традиции регистрируется на NHS, что позволяет последнему установить с NHC соседство по протоколу маршрутизации и обменяться маршрутной информацией. При этом, NHS не обязан сохранять маршрутную информацию в первозданном виде: он может поменять next-hop на себя и даже ее суммаризовать при этом. Более того, чем более общий маршрут мы пошлем обратно NHC, тем легче ему будет :) \u003C\u002Fli\u003E\r\n\u003Cli\u003ENHC получает маршрутную информацию и заполняет CEF-таблицу. Поскольку у теперь next-hop у нас теперь сам NHS, у нас не будет «invalid» или «glean» записей. Другими словами, первый пакет по такому маршруту будет отправлен с помощью CEF… куда???… правильно, на хаб! Но это, кроме всего прочего, означает, что отсутствие «неправильных» записей в CEF не будет вызывать NHRP resolution requests! И здесь на арену выходит \u003Ci\u003ENHRP redirect message\u003C\u002Fi\u003E!\u003C\u002Fli\u003E\r\n\u003Cli\u003EШаг 3 — прямое продолжение второго. Итак, первый пакет, отправленный от spoke к другому spoke идет через NHS. Когда NHS получает по mGRE туннелю пакет, а потом вынужден отправить его обратно по этому же интерфейсу (но уже другому NHC), NHS шлет источнику такого пакета главную «фишку» третьей фазы — NHRP redirect message. Это сообщение говорит NHC, что он использует «не совсем правильный» :) путь в маршрутизации пакетов. И «намекает», что хорошо бы использовать NHRP resolution для уточнения пути у NHC. Сам же первый пакет тем не менее отправляется NHS по адресу. \u003C\u002Fli\u003E\r\n\u003Cli\u003EОпять продолжаем. Теперь NHC, пославший первый пакет, получает сообщение redirect, содержащее адрес назначения того самого первого пакета. Этот NHC шлет NHRP resolution request об этом же IP, но (внимание!!!) не к NHS, а\u003Cb\u003E опять по этому же адрес\u003C\u002Fb\u003Eу! Т.е. NHC спрашивает другого NHC о его реальном адресе. Еще раз: адрес назначения в NHRP resolution request не NHS, а именно тот NHC, которым мы интересуемся, хотя мы и (как и первый пакет) будем до него добираться через NHS. NHS отправит его тем же самым путем по назначению (т.е. опять пакет пойдет через хаб, неоптимально). \u003C\u002Fli\u003E\r\n\u003Cli\u003EРазвязка :) Теперь наш NHC назначения (а не NHS!!) отвечает на resolution request. Используя реальный адрес, приложенный к запросу, этот NHC ответит отправителю напрямую, минуя NHS. При этом, ответ будет содержать всю сеть (маршрут, префикс), найденный в RIB, а не только запрошенный адрес. Когда наш NHC-отправитель запроса получит такой ответ, он узнает реальный next-hop такого адреса, заполнит NHRP-таблицу и поправит запись в CEF (или новую создаст).\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПример дебажного вывода:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESPOKE2#ping 192.168.1.1\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nType escape sequence to abort.\u003Cbr\u002F\u003E\r\nSending 5, 100-byte ICMP Echos to 192.168.1.1, timeout is 2 seconds:\u003Cbr\u002F\u003E\r\n!!!!!\u003Cbr\u002F\u003E\r\nSuccess rate is 100 percent (5\u002F5), round-trip min\u002Favg\u002Fmax = 32\u002F51\u002F84 ms\u003Cbr\u002F\u003E\r\nSPOKE2#\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.151: NHRP: \u003Cu\u003EReceive Traffic Indication \u003C\u002Fu\u003Evia Tunnel0 vrf 0, packet size: 97\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.155: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.155: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.159: (M) traffic code: redirect(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.159: src NBMA: 172.16.1.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.159: src protocol: 10.1.1.1, dst protocol: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.163: Contents of nhrp traffic indication packet:\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.167: 45 00 00 64 00 00 00 00 FE 01 EF EB 0A 01 01 03 \u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.171: C0 A8 01 01 08 00 36 7F 00 00 00 \u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.211: NHRP: Send Resolution Request via Tunnel0 vrf 0, packet size: 85\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.215: src: 10.1.1.3, dst: 192.168.1.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: (M) flags: \"router auth src-stable nat \", reqid: 5 \u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: src NBMA: 172.16.3.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: src protocol: 10.1.1.3, dst protocol: 192.168.1.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: (C-1) code: no error(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: prefix: 0, mtu: 1514, hd_time: 7200\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.219: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.247: NHRP: Receive Resolution Request via Tunnel0 vrf 0, packet size: 105\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.251: (F) afn: IPv4(1), type: IP(800), hop: 254, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.251: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.255: (M) flags: \"router auth src-stable nat \", reqid: 6 \u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.255: src NBMA: 172.16.2.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.259: src protocol: 10.1.1.2, dst protocol: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.263: (C-1) code: no error(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.263: prefix: 0, mtu: 1514, hd_time: 7200\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.263: addr_len: 0(NSAP), subaddr_len: 0(NSAP), proto_len: 0, pref: 0\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.271: NHRP: Send Resolution Reply via Tunnel0 vrf 0, packet size: 133\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.275: src: 10.1.1.3, dst: 10.1.1.2\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.279: (F) afn: IPv4(1), type: IP(800), hop: 255, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.279: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.283: (M) flags: \"router auth dst-stable unique src-stable nat \", reqid: 6 \u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.283: src NBMA: 172.16.2.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.287: src protocol: 10.1.1.2, dst protocol: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.291: (C-1) code: no error(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.291: prefix: 32, mtu: 1514, hd_time: 7200\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.295: addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.299: client NBMA: 172.16.3.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.299: client protocol: 10.1.1.3\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.323: NHRP: Receive Resolution Reply via Tunnel0 vrf 0, packet size: 153\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.331: (F) afn: IPv4(1), type: IP(800), hop: 254, ver: 1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.331: shtl: 4(NSAP), sstl: 0(NSAP)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.331: (M) flags: \"router auth dst-stable unique src-stable nat \", reqid: 5 \u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.335: src NBMA: 172.16.3.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.339: src protocol: 10.1.1.3, dst protocol: 192.168.1.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.343: (C-1) code: no error(0)\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.343: prefix: 24, mtu: 1514, hd_time: 7200\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.343: addr_len: 4(NSAP), subaddr_len: 0(NSAP), proto_len: 4, pref: 0\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.347: client NBMA: 172.16.2.1\u003Cbr\u002F\u003E\r\n*Mar 1 00:07:57.347: client protocol: 10.1.1.2\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПодчеркнутым выделено получение NHRP редиректа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПодведем \u003Cu\u003Eитоги третьей фазы\u003C\u002Fu\u003E:\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E Нет неправильных записей в CEF. Все пакеты используют CEF, а NHRP request теперь вызываются не неправильной записью в CEF, а явным указанием от NHS.\u003C\u002Fli\u003E\r\n\u003Cli\u003E NHS теперь не единственный источник информации NHRP. В это вовлекли еще и остальные NHC. Больше похоже на peer2peer.\u003C\u002Fli\u003E\r\n\u003Cli\u003E NHRP replies от NHC содержит целый префикс, а не только next-hop. Именно это, кстати, позволяет нам посылать общий маршрут от NHS к NHC, т.к. NHC назначения вернет именно ему принадлежащий префикс, который может быть более частным, чем тот, что изначально получен от NHS.\u003C\u002Fli\u003E\r\n\u003Cli\u003E Первоначальные пакеты бегут через хаб.\u003C\u002Fli\u003E\r\n\u003Cli\u003E Поскольку ответ дает не NHS, а NHC, в топологии может быть несколько уровней хабов.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nТеперь несколько подведем \u003Cb\u003Eитоги по маршрутизации\u003C\u002Fb\u003E, вооружившись знаниями о фазах.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003EПостулат 1\u003C\u002Fu\u003E. NHC устанавливает соседство по протоколу маршрутизации только с NHS, и никогда с NHC. NHC сообщает о своих локальных сетях NHS.\u003Cbr\u002F\u003E\r\n\u003Cu\u003EПостулат 2\u003C\u002Fu\u003E. NHS устанавливает соседство со всеми NHC. При этом он сообщает NHC о всех сетях, узнанных от других NHC и своих локальных сетях.\u003Cbr\u002F\u003E\r\nкроме того, вне зависимости от фазы, требуется выключать split horizon для RIP и EIGRP.\u003Cbr\u002F\u003E\r\nНо есть и различие в функционировании, в зависимости от фазы:\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EВ phase 1 и phase 3 хаб не может сохранять next-hop в маршрутной информации (например, BGP next-hop-self, OSPF network point-to-multipoint), за счет этого возможно применение суммаризации. Кроме того, число хабов не ограничено и они не обязаны быть одного уровня.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ phase 2 напротив, хаб \u003Cb\u003Eобязан\u003C\u002Fb\u003E сохранять next-hop в маршрутной информации (EIGRP \u003Cb\u003Eno ip next-hop-self\u003C\u002Fb\u003E, BGP default, OSPF network broadcast), возможно использование не более двух хабов.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cu\u003EПостулат 3\u003C\u002Fu\u003E. NHS устанавливает соседство по протоколу маршрутизации с другими NHS. При этом\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EВ phase 1 и phase 3 протокол маршрутизации между хабами может отличаться от протокола маршрутизации между хабами и NHC.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ phase 2 хабы \u003Cb\u003Eобязаны\u003C\u002Fb\u003E использовать тот же протокол.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n — Теперь, когда мы рассмотрели теоретические основы функционирования DMVPN, посмотрим, как его настроить на маршрутизаторах Cisco.\u003Cbr\u002F\u003E\r\n\u003Cb\u003EНастройка \u003C\u002Fb\u003Eбудет отличаться в зависимости от желамой фазы и роли роутера (Hub или spoke). \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПо порядку:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003EHub\u003C\u002Fu\u003E с точки зрения NHRP настраивается одинаково для Phase 1 и Phase 2. Разница будет в настройке протоколов маршрутизации.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСоздаем туннельный интерфейс и присваиваем ему адрес:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHub(config)# interface Tunnel0\u003Cbr\u002F\u003E\r\nHub(config-if)# ip address 10.1.1.1 255.255.255.0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗадаем интерфейс-источник и режим — GRE multipoint\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHub(config-if)# tunnel source FastEthernet0\u002F0\u003Cbr\u002F\u003E\r\nHub(config-if)# tunnel mode gre multipoint\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДалее собственно задаем настройки протокола NHRP.\u003Cbr\u002F\u003E\r\nИдентификатор сети:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHub(config-if)# ip nhrp network-id 123\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОпционально аутентификацию:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHub(config-if)# ip nhrp authentication cisco\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ настраиваем маппинг мультикастовых рассылок в динамически узнаваемые адреса\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHub(config-if)# ip nhrp map multicast dynamic\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003E\u003Ci\u003EPhase 3.\u003C\u002Fi\u003E\u003C\u002Fu\u003E Отличается от Phase 2 только наличием \u003Cbr\u002F\u003E\r\n\u003Ccode\u003EHub(config-if)# ip nhrp redirect\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003ESpoke\u003C\u002Fu\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003E\u003Ci\u003EPhase 1.\u003C\u002Fi\u003E\u003C\u002Fu\u003E\u003Cbr\u002F\u003E\r\nСоздаем туннельный интерфейс и присваиваем ему адрес:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config)# interface Tunnel0\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip address 10.1.1.2 255.255.255.0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗадаем интерфейс-источник\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# tunnel source FastEthernet0\u002F0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПоскольку мы планируем связываться только с хабом — можем явно задать адрес назначения и тип туннеля — обычный GRE IP (по умолчанию)\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# tunnel destination 172.16.1.1\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТ.к. регистрироваться по протоколу NHRP все равно нужно, то задаем идентификатор сети:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# ip nhrp network-id 123\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОпционально аутентификацию:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# ip nhrp authentication cisco\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ настраиваем маппинг мультикастовых рассылок в адрес хаба (внимание, не туннельный, а реальный)\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# ip nhrp map multicast 172.16.1.1\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУказываем туннельный адрес NHS:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# ip nhrp nhs 10.1.1.1\u003C\u002Fcode\u003E \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ создаем маппинг для этого туннельного адреса в реальный:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# ip nhrp map 10.1.1.1 172.16.1.1\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003E\u003Ci\u003EPhase 2.\u003C\u002Fi\u003E\u003C\u002Fu\u003E\u003Cbr\u002F\u003E\r\nПочти тоже самое, только задаем tunnel mode и не указываем tunnel destination:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config)# interface Tunnel0\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip address 10.1.1.2 255.255.255.0\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# tunnel source FastEthernet0\u002F0\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# tunnel mode gre multipoint\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip nhrp network-id 123\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip nhrp authentication cisco\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip nhrp map multicast 172.16.1.1\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip nhrp nhs 10.1.1.1\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip nhrp map 10.1.1.1 172.16.1.1\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003E\u003Ci\u003EPhase 3.\u003C\u002Fi\u003E\u003C\u002Fu\u003E Отличается от Phase 2 только наличием \u003Cbr\u002F\u003E\r\n\u003Ccode\u003ESpoke1(config-if)# ip nhrp shortcut\u003Cbr\u002F\u003E\r\nSpoke1(config-if)# ip nhrp redirect\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТаким образом, мы настроили mGRE. Осталось прицепить к нему \u003Cb\u003EIPSec\u003C\u002Fb\u003E. Настройка одинакова на всех роутерах.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСоздаем\u003Cu\u003E политику ISAKMP\u003C\u002Fu\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ERouter(config)#crypto isakmp policy 10\u003Cbr\u002F\u003E\r\nRouter(config-isakmp)# encr aes\u003Cbr\u002F\u003E\r\nRouter(config-isakmp)# authentication pre-share\u003Cbr\u002F\u003E\r\nRouter(config-isakmp)# group 2\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля простоты описания я использую аутентификацию по общему ключу\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ERouter(config-isakmp)#crypto isakmp key cisco address 0.0.0.0 0.0.0.0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВключаем \u003Cu\u003Ekeepalive\u003C\u002Fu\u003E\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ERouter(config)#crypto isakmp keepalive 10 3 periodic\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСоздаем трансформ-сет и привязываем его к \u003Cu\u003Eпрофайлу IPSec\u003C\u002Fu\u003E.\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ERouter(config)#crypto ipsec transform-set IPSEC_SET esp-aes esp-sha-hmac \u003Cbr\u002F\u003E\r\nRouter(cfg-crypto-trans)#crypto ipsec profile IPSEC_PROFILE\u003Cbr\u002F\u003E\r\nRouter(ipsec-profile)# set transform-set IPSEC_SET \u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cu\u003EЦепляем профайл\u003C\u002Fu\u003E на туннельный интерфейс\u003Cbr\u002F\u003E\r\n\u003Ccode\u003ERouter(config)#interface tunnel 0\u003Cbr\u002F\u003E\r\nRouter(config-if)#tunnel protection ipsec profile IPSEC_PROFILE\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь поговорим о \u003Cb\u003Eнастройках протоколов маршрутизации\u003C\u002Fb\u003E. Для простоты я ограничусь двумя наиболее распространенными IGP: OSPF и EIGRP, к тому же, один из них link-state, другой distance-vector.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, как мы уже выяснили, \u003Cu\u003Ephase 1 &amp; 3\u003C\u002Fu\u003E обязуют \u003Ci\u003E\u003Cu\u003Eхаб \u003C\u002Fu\u003E\u003C\u002Fi\u003Eменять next-hop в маршрутной информации на свой адрес, поэтому \u003Cbr\u002F\u003E\r\nOSPF: \u003Ccode\u003EHub(config-if)# ip ospf network point-to-multipoint\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nВ случае EIGRP next-hop меняется по умолчанию и дополнительных усилий не требует.\u003Cbr\u002F\u003E\r\nКроме того, в случае EIGRP и RIP требуется отключать split-horizon :\u003Ccode\u003E Hub(config-if)#no ip split-horizon eigrp \u003Ci\u003EAS_NUMBER\u003C\u002Fi\u003E\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа \u003Ci\u003E\u003Cu\u003Espoke \u003C\u002Fu\u003E\u003C\u002Fi\u003Eвсе просто: настраиваем тип сети OSPF и принудительно запрещаем spoke быть DR или BDR.\u003Cbr\u002F\u003E\r\nOSPF: \u003Ccode\u003ESpoke(config-if)# ip ospf network point-to-multipoint\u003Cbr\u002F\u003E\r\nSpoke(config-if)# ip ospf priority 0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля \u003Cu\u003Ephase 2\u003C\u002Fu\u003E немного по-другому.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа \u003Cu\u003Eхабе\u003C\u002Fu\u003E нам уже не требуется менять next-hop, но split horizon нам по-прежнему мешает. Поэтому\u003Cbr\u002F\u003E\r\nOSPF: \u003Ccode\u003EHub(config-if)# ip ospf network broadcast\u003C\u002Fcode\u003E (таймеры по вкусу)\u003Cbr\u002F\u003E\r\nEIGRP: \u003Ccode\u003EHub(config-if)#no ip next-hop-self eigrp \u003Ci\u003EAS_NUMBER\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\nHub(config-if)#no ip split-horizon eigrp \u003Ci\u003EAS_NUMBER\u003C\u002Fi\u003E\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа \u003Ci\u003E\u003Cu\u003Espoke \u003C\u002Fu\u003E\u003C\u002Fi\u003E тоже настраиваем тип сети OSPF как broadcast и поскольку нам нужно соседство только с хабом, то по-прежнему принудительно запрещаем spoke быть DR или BDR.\u003Cbr\u002F\u003E\r\nOSPF: \u003Ccode\u003ESpoke(config-if)# ip ospf network broadcast\u003Cbr\u002F\u003E\r\nSpoke(config-if)# ip ospf priority 0\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПодведем \u003Cb\u003Eитоги \u003C\u002Fb\u003Eтехнологии.\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EDMVPN — технология, позволяющая строить VPN со множеством участников. Основная топология — hub-n-spoke, но возможно динамическое установление туннелей spoke-to-spoke и даже иерархия хабов.\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ основе лежит mGRE (а в его основе — NHRP), а защита возложена на IPSec, тесно с ним взаимодействующий.\u003C\u002Fli\u003E\r\n\u003Cli\u003EНагрузка на хаб в общем случае больше, чем на spoke. Это позволяет использовать оборудование, различающееся по производительности, в зависимости от нужд конкретного филиала.\u003C\u002Fli\u003E\r\n\u003Cli\u003EХарактер работы напрямую зависит от настроенной фазы.\u003C\u002Fli\u003E\r\n\u003Cli\u003EКонфигурация протоколов маршрутизации тоже требует внимательности.\u003C\u002Fli\u003E\r\n\u003Cli\u003EИз недостатков хотел бы отметить ограниченность поддержки мультикастов и отсутствие поддержки на Cisco ASA (хнык...)\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗа сим разрешите откланяться :) Конечно, опять не надеюсь на то, что раскрыл все аспекты технологии. За кадром как минимум остались конфигурация с множеством хабов и т.п. Но надеюсь, что общее представление о технологии мне изложить удалось.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсячески надеюсь на конструктивную критику, т.к. статья большая и наверняка в ней полно неточностей, ошибок и опечаток.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПодкопаев Илья, инструктор\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nUPD. Спасибо \u003Ca href=\"https:\u002F\u002Fhabrahabr.ru\u002Fusers\u002Fquickshooter\u002F\" class=\"user_link\"\u003EQuickshooter\u003C\u002Fa\u003E за найденную ошибку :)\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"VPN"},{"titleHtml":"cisco"},{"titleHtml":"DMVPN"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F84738\u002F2615464fba2649f19900f658f11d8508\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F84738\u002F2615464fba2649f19900f658f11d8508\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F84738\\\u002F\"},\"headline\":\"По мотивам Cisco Live 2009: Advanced Concepts of DMVPN\",\"datePublished\":\"2010-02-22T14:41:53+03:00\",\"dateModified\":\"2010-02-22T18:02:10+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Подкопаев Илья\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)  Начну по сло...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F84738\\\u002F#post-content-body\",\"about\":[\"h_cisconetworks\",\"f_admin\"],\"image\":[\"http:\\\u002F\\\u002Fimg24.imageshack.us\\\u002Fimg24\\\u002F6099\\\u002Fzeroris.png\",\"http:\\\u002F\\\u002Fimg16.imageshack.us\\\u002Fimg16\\\u002F5923\\\u002Ffirstris.png\",\"http:\\\u002F\\\u002Fimg98.imageshack.us\\\u002Fimg98\\\u002F9138\\\u002Fnhrpphase1.png\",\"http:\\\u002F\\\u002Fimg63.imageshack.us\\\u002Fimg63\\\u002F1376\\\u002Fnhrp2.png\",\"http:\\\u002F\\\u002Fimg52.imageshack.us\\\u002Fimg52\\\u002F4383\\\u002Fnhrp3.png\"]}","metaDescription":"Продолжая серию статей о VPN, хочу поделиться подробностями о реализации технологии DMVPN, изложенными на Cisco Live 2009. Осторожно, много букв :)\r\n\r\nНачну по сложившейся традиции с постановки...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"572164":{"id":"572164","timePublished":"2021-09-27T11:37:23+00:00","isCorporative":false,"lang":"ru","titleHtml":"Первые шаги в ОТО: прецессия орбиты Меркурия","editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"1832999","alias":"Yermack","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F690\u002F140\u002F823\u002F690140823f555d03574a59d46f648d24.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":2,"favoritesCount":26,"readingCount":3273,"score":18,"votesCount":18},"hubs":[{"relatedData":null,"id":"18840","alias":"julia","type":"collective","title":"Julia","titleHtml":"Julia","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21968","alias":"physics","type":"collective","title":"Физика","titleHtml":"Физика","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКогда речь заходит о теории относительности, частенько на ровном месте разрастаются споры, которые были занесены в почву непонимания и обильно удобрены мифами, недосказанностью и недостаточной математической подготовкой. Даже на лекциях от некоторых профессоров можно услышать, что детище гения Эйнштейна не имеет практической пользы, а на робкие попытки пролепетать что-то про спутниковые системы навигации они пренебрежительно отмахиваются, дескать, там все сложно и двояко. \u003C\u002Fp\u003E\u003Cp\u003EТак что совершенно естественно желание попробовать провести некоторые расчеты самолично, потрогать формулы, покрутить параметры, чтобы постепенно заложить интуицию в столь горячей теме.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"прецессия"},{"titleHtml":"меркурий"},{"titleHtml":"теория относительности"},{"titleHtml":"уравнения эйнштейна"},{"titleHtml":"метрики"},{"titleHtml":"спасибо scihub"},{"titleHtml":"спасибо mathpix"},{"titleHtml":"астрология_точная_наука"}]},"579772":{"id":"579772","timePublished":"2021-09-27T05:32:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сливы процветают. Эксперт-«параноик» Майкл Баззель о защите личных данных","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Michael Bazzell","originalUrl":"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F"}}],"author":{"id":"2297567","alias":"SearchInform_team","fullname":null,"avatarUrl":"","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":8,"readingCount":2448,"score":9,"votesCount":9},"hubs":[{"relatedData":null,"id":"22418","alias":"searchinform","type":"corporative","title":"Блог компании SearchInform","titleHtml":"Блог компании SearchInform","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНаш очередной пост из серии «интересное на иностранном языке» – рассказ Майкла Баззеля о том, как сберечь свои персональные данные от утечек. Майкл – знаковая фигура в сфере OSINT, работал в правительстве США и ФБР, его приглашали в качестве технического эксперта в сериал «Мистер Робот», который считают достойным с точки зрения достоверности. В личной жизни эксперт придерживается настолько жестких правил в отношении информационной гигиены, что некоторые считают его «неадекватом». Так ли это – может быть несколько мнений. \u003C\u002Fp\u003E\u003Cp\u003EОдин из факторов, который убеждает в правильном подходе Майкла, – что риски обнаружить свои данные в интернете стали существенно выше, потому что шифровальщики без разбору сливают в сеть все, до чего дотягиваются при атаках на бизнес. Приводим перевод \u003Ca href=\"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F\"\u003Eпоста Майкла Баззеля\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EАтакуют корпорации, а страдают люди\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EБольшинство людей не задумываются о том, как их касается проблема распространения вирусов-шифровальщиков. Логика такова: речь идет о проблемах компаний, это они вынуждены платить выкуп. При чем тут, казалось бы, обычные люди?! \u003C\u002Fp\u003E\u003Cp\u003EА при том, что преступники сменили тактику: сейчас они не просто шифруют данные, но и скачивают их, выкладывают в открытый доступ, если компании не платят им выкуп. Теперь давайте подумаем, что в этих слитых базах? Множество данных о сотрудниках, клиентах, контрагентах, с которыми компания-жертва работает.\u003C\u002Fp\u003E\u003Cp\u003EХочу сразу уточнить: я это пишу не потому что выступаю за уплату выкупа. Я за то, чтобы сопротивляться избыточному сбору данных там, где это не обязательно. Мы халатно относимся к своим ПДн, раздавая их по первому требованию.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"персональные данные"},{"titleHtml":"пдн"},{"titleHtml":"сёрчинформ"},{"titleHtml":"Майкл Баззел"},{"titleHtml":"утечки информации"}]},"579854":{"id":"579854","timePublished":"2021-09-27T06:03:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Видишь уязвимости? А они есть! Наше исследование популярных CMS-систем","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2684283","alias":"Solar_Pentest","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":8,"favoritesCount":25,"readingCount":4120,"score":27,"votesCount":29},"hubs":[{"relatedData":null,"id":"20826","alias":"solarsecurity","type":"corporative","title":"Блог компании Ростелеком-Солар","titleHtml":"Блог компании Ростелеком-Солар","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛьвиная доля всех работ по анализу защищенности внешнего периметра – это тестирование веб-приложений. Здесь могут быть как корпоративные решения, так и «домашние» разработки на базе различных публичных систем управления контентом (CMS). Мы всегда проводим глубокий анализ подобных решений на тестовых стендах и зачастую находим уязвимости нулевого дня. Собственно, из опыта таких проектов и родилась идея собрать исследовательскую команду и провести глубокий анализ популярных CMS-систем и различных плагинов для них. В этом посте мы поделимся результатами нашего исследования, а также продемонстрируем примеры уязвимого кода наиболее интересных, на наш взгляд, уязвимостей и примеры их эксплуатации. Конечно все эти уязвимости уже исправлены и описываются здесь с разрешения владельцев систем.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","buttonTextHtml":"Не всё то в безопасности, что с Bug Bounty","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"cms"},{"titleHtml":"уязвимости"},{"titleHtml":"уязвимости и их эксплуатация"},{"titleHtml":"уязвимость нулевого дня"}]},"580008":{"id":"580008","timePublished":"2021-09-27T06:30:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"Летний Магнитогорск","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2614609","alias":"city_scraper","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8f8\u002Fd6c\u002F328\u002F8f8d6c328ec3a513103b6757c2c21610.png","speciality":"Пользователь"},"statistics":{"commentsCount":6,"favoritesCount":3,"readingCount":3890,"score":14,"votesCount":20},"hubs":[{"relatedData":null,"id":"22012","alias":"Ecology","type":"collective","title":"Экология","titleHtml":"Экология","isProfiled":false},{"relatedData":null,"id":"22024","alias":"urban","type":"collective","title":"Урбанизм","titleHtml":"Урбанизм","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EМагнитогорск Челябинской области – один из крупнейших мировых центров чёрной металлургии. В России это шестой из крупнейших городов, которые не являются центрами субъектов страны. \u003C\u002Fp\u003E\u003Cp\u003EСовсем недавно город был одним из наиболее неблагополучных с точки зрения загрязнения атмосферного воздуха, но в 2021 году был зафиксирован «повышенный» уровень – то есть не «высокий» или «очень высокий», как раньше. \u003C\u002Fp\u003E\u003Cp\u003EКак этот город выглядит летом? Где и как его жители могут проводить время?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Магнитогорск"},{"titleHtml":"промышленность"},{"titleHtml":"промышленные города"},{"titleHtml":"урбанизм\u002Fурбания"},{"titleHtml":"урбанистика"},{"titleHtml":"города России"},{"titleHtml":"города"}]},"580050":{"id":"580050","timePublished":"2021-09-27T10:23:25+00:00","isCorporative":false,"lang":"ru","titleHtml":"Один человек ответил на 85+ тысяч вопросов на Stack Overflow (24,1 ответа в день)","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1585037","alias":"sahsAGU","fullname":"Александр Гуреев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F43c\u002F6c7\u002F0ab\u002F43c6c70ab024d45474e6abe8db797573.jpg","speciality":"Автор"},"statistics":{"commentsCount":36,"favoritesCount":10,"readingCount":11251,"score":11,"votesCount":21},"hubs":[{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"306","alias":"mysql","type":"collective","title":"MySQL","titleHtml":"MySQL","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"594","alias":"sql","type":"collective","title":"SQL","titleHtml":"SQL","isProfiled":true},{"relatedData":null,"id":"7152","alias":"data_mining","type":"collective","title":"Data Mining","titleHtml":"Data Mining","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cstrong\u003EВ среднем 24,1 ответа в день (если все 365 дней в году считать рабочими) на протяжении почти 10 лет.\u003C\u002Fstrong\u003E \u003C\u002Fp\u003E\u003Cp\u003EНесколько дней назад на некоторых англоязычных ресурсах началось обсуждение одного очень необычного пользователя Stack Overflow. Его зовут Гордон Линофф (Gordon Linoff), он из Нью-Йорка, и за 9 лет и 8 месяцев своего присутствия на платформе он дал 85,201 ответов на различные вопросы, в основном связанные с SQL и дата-майнингом (цифра актуальна на 27.09.2021). \u003C\u002Fp\u003E\u003Cp\u003EЧто это за маг?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F396\u002F5ac\u002Fef4\u002F3965acef48ae14917c514fa091f60d1a.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F396\u002F5ac\u002Fef4\u002F3965acef48ae14917c514fa091f60d1a.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"sql"},{"titleHtml":"mysql"},{"titleHtml":"stackoverflow"},{"titleHtml":"базы данных"},{"titleHtml":"дата майнинг"},{"titleHtml":"data mining"}]},"580060":{"id":"580060","timePublished":"2021-09-27T09:00:04+00:00","isCorporative":true,"lang":"ru","titleHtml":"Арракис, который мы заслужили","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"238277","alias":"Zelenyikot","fullname":"Виталий Егоров","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F22b\u002F2d7\u002F7a5\u002F22b2d77a57b687aae24784a3e53089c9.jpg","speciality":"Популяризатор космонавтики"},"statistics":{"commentsCount":114,"favoritesCount":40,"readingCount":22709,"score":135,"votesCount":147},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false},{"relatedData":null,"id":"21984","alias":"sci-fi","type":"collective","title":"Научная фантастика","titleHtml":"Научная фантастика","isProfiled":false},{"relatedData":null,"id":"22014","alias":"futurenow","type":"collective","title":"Будущее здесь","titleHtml":"Будущее здесь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F580060\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fk0\u002Fds\u002Fy5\u002Fk0dsy5npxclyjdytiroqga7-leu.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nВо вселенной писателя-фантаста Фрэнка Герберта, Дюна, она же Арракис &mdash; это пустынная и маловодная планета с двумя лунами. По сюжету, она находится за пределами Солнечной системы, но если мы захотим поискать ближайшую схожую параллель,&nbsp;то больше всего подходит планета Марс. Предлагаю воспользоваться возможностями, которые даёт современная космонавтика, и совершить воображаемую прогулку на нашу Дюну.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Марс"},{"titleHtml":"Дюна"},{"titleHtml":"MRO"},{"titleHtml":"Curiosity"},{"titleHtml":"марсоход"},{"titleHtml":"ruvds_статьи"}]},"580124":{"id":"580124","timePublished":"2021-09-27T13:03:14+00:00","isCorporative":true,"lang":"ru","titleHtml":"Электролюминесцентные индикаторы из прошлого","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"146371","alias":"radiolok","fullname":"Артем Кашканов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa46\u002Fc6a\u002F151\u002Fa46c6a15193f7c0cac79d2736b107358.jpg","speciality":"Релейно-декатронный маньяк"},"statistics":{"commentsCount":13,"favoritesCount":37,"readingCount":5297,"score":75,"votesCount":75},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false},{"relatedData":null,"id":"21930","alias":"antikvariat","type":"collective","title":"Старое железо","titleHtml":"Старое железо","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Сегодня речь пойдёт об электролюминесцентных индикаторах. Но, не о тех, которые окружают вас повсюду и к которым вы привыкли, а о других — получивших огромную популярность в 60-е годы прошлого века, и так же стремительно канувших в небытие. Заодно запущу свою коллекцию индикаторов, как серийно выпускавшихся, так и уникальных опытных и даже — лабораторных образцов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F523004\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F94e\u002F51f\u002F459\u002F94e51f459ae59c9d2fe6c448cb07bcca.gif\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Индикатор"},{"titleHtml":"электролюминесцентность"},{"titleHtml":"ruvds_статьи"}]},"580150":{"id":"580150","timePublished":"2021-09-27T10:50:03+00:00","isCorporative":true,"lang":"ru","titleHtml":"Топ-5 когнитивных искажений при планировании в IT","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2794469","alias":"KM_QA","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":7,"favoritesCount":54,"readingCount":6179,"score":38,"votesCount":40},"hubs":[{"relatedData":null,"id":"14332","alias":"oleg-bunin","type":"corporative","title":"Блог компании Конференции Олега Бунина (Онтико)","titleHtml":"Блог компании Конференции Олега Бунина (Онтико)","isProfiled":false},{"relatedData":null,"id":"19583","alias":"dev_management","type":"collective","title":"Управление разработкой","titleHtml":"Управление разработкой","isProfiled":true},{"relatedData":null,"id":"20736","alias":"hr_management","type":"collective","title":"Управление персоналом","titleHtml":"Управление персоналом","isProfiled":true},{"relatedData":null,"id":"20754","alias":"tech_events","type":"collective","title":"Конференции","titleHtml":"Конференции","isProfiled":false},{"relatedData":null,"id":"21990","alias":"brain","type":"collective","title":"Мозг","titleHtml":"Мозг","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"4","alias":"marketing","title":"Маркетинг"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭта статья подходит для тимлидов и их подопечных, а также для всех, кто оценивает проекты и задачи. Я расскажу, как и почему мы делаем ошибки из-за когнитивных искажений. Попадаем в них мы почти все, просто потому что мы живые люди. И на примере одного дня из жизни тимлида я хочу показать, в какие искажения чаще всего влетают в IT, и&nbsp; — самое полезное&nbsp; —&nbsp; как из них можно выходить.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EЗамечу, что искать когнитивные искажения стоит, в первую очередь, у себя, а не у коллег. \u003C\u002Fstrong\u003EИ что рассказывать про искажения намного проще, чем не влетать в их на практике, однако, если этому научиться, то в перспективе это изрядно окупается, потому что экономит и время, и деньги, помогая и нам, и команде.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb78\u002F76f\u002F001\u002Fb7876f0010e85c328462a735df0b76e8.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb78\u002F76f\u002F001\u002Fb7876f0010e85c328462a735df0b76e8.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"когнитивные искажения"},{"titleHtml":"нейрофизиология"},{"titleHtml":"мозг"},{"titleHtml":"психология"},{"titleHtml":"тимлидство"},{"titleHtml":"тимлид"},{"titleHtml":"управление людьми"},{"titleHtml":"управление проектами и командой"},{"titleHtml":"управление командой"},{"titleHtml":"управление персоналом"}]},"580164":{"id":"580164","timePublished":"2021-09-27T11:17:58+00:00","isCorporative":true,"lang":"ru","titleHtml":"Измеряем производительность String.format() в Java","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"@cowtowncoder","originalUrl":"https:\u002F\u002Fcowtowncoder.medium.com\u002Fmeasuring-performance-of-java-string-format-or-lack-thereof-2e1c6a13362c"}}],"author":{"id":"2571061","alias":"GolovinDS","fullname":"Дмитрий Головин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd27\u002Fccd\u002F743\u002Fd27ccd743d8bccbf1a885e5dadaa7ffe.jpg","speciality":"Контент-маркетолог"},"statistics":{"commentsCount":0,"favoritesCount":16,"readingCount":1760,"score":9,"votesCount":11},"hubs":[{"relatedData":null,"id":"21052","alias":"otus","type":"corporative","title":"Блог компании OTUS","titleHtml":"Блог компании OTUS","isProfiled":false},{"relatedData":null,"id":"4","alias":"hi","type":"collective","title":"Высокая производительность","titleHtml":"Высокая производительность","isProfiled":true},{"relatedData":null,"id":"375","alias":"java","type":"collective","title":"Java","titleHtml":"Java","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЯ раньше считал, что JDK в целом хорошо оптимизирована, и если в JDK есть простой способ решения какой-то задачи, то он вполне подойдет для большинства ситуаций и будет работать хорошо.\u003C\u002Fp\u003E\u003Cp\u003EНо я обнаружил, что иногда некоторые классы или методы работают на удивление плохо. Знание таких аномалий полезно при работе с требовательным к производительности кодом.\u003C\u002Fp\u003E\u003Cp\u003EВ этом посте рассмотрим один из подобных кейсов: поразительно низкая производительность \u003Ccode\u003EString.format()\u003C\u002Fcode\u003E при простой конкатенации строк.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fed4\u002F612\u002F7ef\u002Fed46127ef6d1b8f8d650482dfd335220.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fed4\u002F612\u002F7ef\u002Fed46127ef6d1b8f8d650482dfd335220.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"java"},{"titleHtml":"performance"},{"titleHtml":"jdk"}]},"580166":{"id":"580166","timePublished":"2021-09-27T11:22:03+00:00","isCorporative":false,"lang":"ru","titleHtml":"Новости из жизни Haiku за август-сентябрь 2021","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"375413","alias":"petr97","fullname":"Ахламов Петр","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fadf\u002F830\u002F79c\u002Fadf83079c33fd56935b929935559572a.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":2,"favoritesCount":3,"readingCount":1773,"score":8,"votesCount":8},"hubs":[{"relatedData":null,"id":"144","alias":"open_source","type":"collective","title":"Open source","titleHtml":"Open source","isProfiled":true},{"relatedData":null,"id":"559","alias":"cpp","type":"collective","title":"C++","titleHtml":"C++","isProfiled":true},{"relatedData":null,"id":"7330","alias":"qt_software","type":"collective","title":"Qt","titleHtml":"Qt","isProfiled":true},{"relatedData":null,"id":"21918","alias":"soft","type":"collective","title":"Софт","titleHtml":"Софт","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЗдравствуйте, дорогие друзья. Продолжаю Вас знакомить на Хабре с новостями проекта Haiku.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F877\u002Fa0f\u002Fc9c\u002F877a0fc9c92663d8cd2acc965493dacc.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F877\u002Fa0f\u002Fc9c\u002F877a0fc9c92663d8cd2acc965493dacc.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Haiku"},{"titleHtml":"Intel"},{"titleHtml":"VESA"},{"titleHtml":"RISC-V"},{"titleHtml":"Веб-камера"},{"titleHtml":"Превью"},{"titleHtml":"Куба"},{"titleHtml":"Wine"},{"titleHtml":"Менеджер окон"}]},"580172":{"id":"580172","timePublished":"2021-09-27T11:45:49+00:00","isCorporative":true,"lang":"ru","titleHtml":"Небинарный ngIf*","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1050218","alias":"Waterplea","fullname":"Александр Инкин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa70\u002F569\u002Ff31\u002Fa70569f31346559ce2b8b875e7f97480.jpg","speciality":"Google Developer Expert | Angular"},"statistics":{"commentsCount":1,"favoritesCount":13,"readingCount":950,"score":15,"votesCount":15},"hubs":[{"relatedData":null,"id":"17420","alias":"tinkoff","type":"corporative","title":"Блог компании TINKOFF","titleHtml":"Блог компании TINKOFF","isProfiled":false},{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"18109","alias":"angular","type":"collective","title":"Angular","titleHtml":"Angular","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВам когда-нибудь хотелось отобразить состояние загрузки, пока \u003Ccode\u003EngIf\u003C\u002Fcode\u003E ждет ответа от \u003Ccode\u003Easync\u003C\u002Fcode\u003E-пайпа? Или, может, вы мечтали передать в \u003Ccode\u003EngFor\u003C\u002Fcode\u003E шаблон для пустого массива? Возможно, вы бросили это, потому что вам не хотелось реализовывать базовую логику этих директив самому. На самом деле в этом нет нужды! Один и тот же селектор может подцепить несколько директив, что позволяет расширить функциональность встроенных директив дополнительной логикой.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"template"},{"titleHtml":"directive"},{"titleHtml":"angular"},{"titleHtml":"structural"}]},"580194":{"id":"580194","timePublished":"2021-09-27T12:36:12+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сотрудники на карте: отвечаем на 10 важных вопросов о трекинге","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1254716","alias":"Axelus","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F118\u002Fc4f\u002F08f\u002F118c4f08ffa66438ad6be22e205d563d.png","speciality":"Разработчик"},"statistics":{"commentsCount":0,"favoritesCount":7,"readingCount":1115,"score":13,"votesCount":15},"hubs":[{"relatedData":null,"id":"20758","alias":"regionsoft","type":"corporative","title":"Блог компании RegionSoft","titleHtml":"Блог компании RegionSoft","isProfiled":false},{"relatedData":null,"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"relatedData":null,"id":"12365","alias":"saas","type":"collective","title":"SaaS \u002F S+S","titleHtml":"SaaS \u002F S+S","isProfiled":true},{"relatedData":null,"id":"17783","alias":"geo","type":"collective","title":"Геоинформационные сервисы","titleHtml":"Геоинформационные сервисы","isProfiled":true},{"relatedData":null,"id":"20736","alias":"hr_management","type":"collective","title":"Управление персоналом","titleHtml":"Управление персоналом","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛюбой контроль сотрудников — опасный и болезненный вопрос, особенно в небольших компаниях. Часто в дружеские и открытые отношения компании не вписывается ни одна из форм контроля, рассчитывать можно только на доверие. Но пресловутый ковид и здесь внёс свои коррективы: расширение удалённой работы, увеличение штата мобильных сотрудников, частичная занятость пополнили ряды полевых сисадминов, аутсорсеров поддержки и остальных «разъездных» работников. Увы, люди разные и вслед за приятными плодами и бонусами удалёнки пришли негативные истории про поведение курьеров, опоздания и откровенные нарушения сотрудников на территории клиентов, неявки на работу или к заказчику и т.д. С этим столкнулись и ритейл, и ИТ, и любая сфера с мобильными сотрудниками. Очень хочется верить в лучшее, но без минимального контроля можно просто потерять бизнес — и тогда пострадают коллеги нерадивых сотрудников.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"geomonitor"},{"titleHtml":"геолокация"},{"titleHtml":"геозона"},{"titleHtml":"трекинг"}]},"580196":{"id":"580196","timePublished":"2021-09-27T12:28:15+00:00","isCorporative":true,"lang":"ru","titleHtml":"Зачем нужен динамический анализ кода, на примере проекта PVS-Studio","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2302295","alias":"MrROBUST","fullname":"Алексей Говоров","avatarUrl":"","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":4,"readingCount":715,"score":9,"votesCount":9},"hubs":[{"relatedData":null,"id":"18095","alias":"pvs-studio","type":"corporative","title":"Блог компании PVS-Studio","titleHtml":"Блог компании PVS-Studio","isProfiled":false},{"relatedData":null,"id":"559","alias":"cpp","type":"collective","title":"C++","titleHtml":"C++","isProfiled":true},{"relatedData":null,"id":"11606","alias":"vs","type":"collective","title":"Visual Studio","titleHtml":"Visual Studio","isProfiled":true},{"relatedData":null,"id":"21456","alias":"win_dev","type":"collective","title":"Разработка под Windows","titleHtml":"Разработка под Windows","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ разговоре с Маршаллом Клоу на подкасте CppCast #300 ABI Stability была затронута достаточно давняя новость о поддержке компиляторами Visual Studio инструмента AddressSanitizer (ASan). Мы уже достаточно давно внедрили ASan в свою систему тестирования и хотим рассказать о паре интересных ошибок, которые он помог найти.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F7ef\u002F2db\u002F210\u002F7ef2db210d677f9a8c07026d4361d3ba.png\" alt=\"0868_PVS-Studio_ASan_ru\u002Fimage2.png\"\u003E\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"pvs-studio"},{"titleHtml":"clang"},{"titleHtml":"asan"},{"titleHtml":"sanitizer"},{"titleHtml":"динамический анализ кода"}]},"580204":{"id":"580204","timePublished":"2021-09-27T12:31:54+00:00","isCorporative":false,"lang":"ru","titleHtml":"Почему using namespace std; это плохо","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"sbi, Greg Hewgill","originalUrl":"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F1452721\u002Fwhy-is-using-namespace-std-considered-bad-practice"}}],"author":{"id":"936030","alias":"F0iL","fullname":"K. just K.","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fbcd\u002F9c7\u002F270\u002Fbcd9c7270c0727e164ac404a7f929971.jpg","speciality":"Разработчик"},"statistics":{"commentsCount":12,"favoritesCount":13,"readingCount":4992,"score":16,"votesCount":24},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"524","alias":"complete_code","type":"collective","title":"Совершенный код","titleHtml":"Совершенный код","isProfiled":true},{"relatedData":null,"id":"559","alias":"cpp","type":"collective","title":"C++","titleHtml":"C++","isProfiled":true},{"relatedData":null,"id":"17188","alias":"compilers","type":"collective","title":"Компиляторы","titleHtml":"Компиляторы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EТо, что написано ниже, для многих квалифицированных C++ разработчиков будет прекрасно известной и очевидной вещью, но тем не менее, я периодически встречаю using namespace std; в коде различных проектов, а недавно в \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\" rel=\"noopener noreferrer nofollow\"\u003Eнашумевшей статье про впечатления от высшего образования\u003C\u002Fa\u003E было упомянуто, что студентов так учат писать код в вузах, поэтому давайте повторим очевидное еще раз.\u003C\u002Fp\u003E\u003Cp\u003EИтак... многие слышали, что \u003Cstrong\u003Eusing namespace std;\u003C\u002Fstrong\u003E в C++ считается плохой практикой. Касательно недопустимости использования using namespace в header-файлах вопросов обычно не возникает, если мы хоть немного понимаем, как работает препроцессор компилятора: .hpp-файлы при использовании директивы #include вставляются в код \"как есть\", и соответственно using автоматически распространится на все затронутые  .hpp- и .cpp-файлы, если файл с ним был заинклюден хоть в одном звене цепочки (на одном из сайтов это метко обозвали как \"заболевание, передающеемя половым путем\"). Но вот про .cpp-файлы все не так очевидно, так что давайте еще раз разберем, что же именно здесь не так.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F662\u002F8a9\u002Fe33\u002F6628a9e3322ab1dbca4e4976098da83d.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F662\u002F8a9\u002Fe33\u002F6628a9e3322ab1dbca4e4976098da83d.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"с++"},{"titleHtml":"namespace"},{"titleHtml":"namespaces"},{"titleHtml":"best practices"},{"titleHtml":"антипаттерны"}]},"580206":{"id":"580206","timePublished":"2021-09-27T12:51:03+00:00","isCorporative":false,"lang":"ru","titleHtml":"МТС отказался от скрытых мобильных подписок?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2467147","alias":"Plusodin","fullname":"Владимир","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F343\u002Fb77\u002Fd12\u002F343b77d12f047368849a9880276f936e.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":12,"favoritesCount":4,"readingCount":5284,"score":14,"votesCount":14},"hubs":[{"relatedData":null,"id":"22008","alias":"cellular","type":"collective","title":"Сотовая связь","titleHtml":"Сотовая связь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПривет, Хабр!\u003C\u002Fp\u003E\u003Cp\u003EНу что, подходит к концу первый сезон сериала «О скрытых мобильных подписках и операторах связи». Предыдущие три серии: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F550448\u002F\" rel=\"noopener noreferrer nofollow\"\u003EМегафон\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F563260\u002F\" rel=\"noopener noreferrer nofollow\"\u003EБилайн\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F571256\u002F\" rel=\"noopener noreferrer nofollow\"\u003ETele2\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EНу и вишенка на этом торте – МТС.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"мтс"},{"titleHtml":"мобильные подписки"},{"titleHtml":"подписки"},{"titleHtml":"оператор связи"},{"titleHtml":"теле2"},{"titleHtml":"мегафон"},{"titleHtml":"билайн"}]},"580208":{"id":"580208","timePublished":"2021-09-27T12:52:27+00:00","isCorporative":false,"lang":"ru","titleHtml":"Основная проблема образования","editorVersion":"2.0","postType":"article","postLabels":[{"type":"recovery","data":null}],"author":{"id":"2270142","alias":"Chronicler","fullname":"Пушиз де Хрониклер","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Faa3\u002F149\u002Fdb0\u002Faa3149db0de5f6c071dfade7285fcb99.jpg","speciality":"Исследователь ближнего заполярья, почетный манул"},"statistics":{"commentsCount":17,"favoritesCount":15,"readingCount":2595,"score":8,"votesCount":20},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"17189","alias":"itstandarts","type":"collective","title":"IT-стандарты","titleHtml":"IT-стандарты","isProfiled":true},{"relatedData":null,"id":"20682","alias":"pm","type":"collective","title":"Управление проектами","titleHtml":"Управление проектами","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНа днях на Хабре появилась \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eкритическая статья\u003C\u002Fa\u003E о бакалавриате, что называется \"из первых уст\", от очередного первохода. Статья далеко не лишена смысла, однако главная проблема не была в ней затронута. А заключается она вовсе не в обилии посторонних дисциплин и даже не в том, что в учебных заведениях так мало разъясняют суровую конкретику жизни \"научиться штамповать JavaScript сайты за месяц\".  Да, эти проблемы присутствуют, наряду с плохой подготовкой педагогов и отношением к студентам, но не они на корню обесценивают нынешнее образование.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Что же на самом деле не так?","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"программирование"},{"titleHtml":"образование"},{"titleHtml":"курсы не нужны"},{"titleHtml":"вуз"}]},"580210":{"id":"580210","timePublished":"2021-09-27T12:53:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"PHP Дайджест № 212 (13 – 27 сентября 2021)","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"100489","alias":"pronskiy","fullname":"Роман Пронский","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F27f\u002Fb99\u002Feb3\u002F27fb99eb3e30e3221c5839e88be02395.jpg","speciality":"PHP"},"statistics":{"commentsCount":1,"favoritesCount":14,"readingCount":3707,"score":41,"votesCount":41},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"477","alias":"symfony","type":"collective","title":"Symfony","titleHtml":"Symfony","isProfiled":true},{"relatedData":null,"id":"9554","alias":"yii","type":"collective","title":"Yii","titleHtml":"Yii","isProfiled":true},{"relatedData":null,"id":"18812","alias":"laravel","type":"collective","title":"Laravel","titleHtml":"Laravel","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fek\u002F6r\u002Fr1\u002Fek6rr1odvyzb89tfv0lq4cmfxi4.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nПодборка свежих новостей и материалов из мира PHP.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВышел PHP 8.1 RC2 и уже доступен первый пакет с использованием перечислений, будет сделан форк Magento, новый тип стандартов PER в дополнение к PSR, стартовала PhpStorm 2021.3 EAP, Symfony 6 будет полностью типизирован — как обновляться?\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nДля PHP 8.2 предложены новые оптимизированные структуры данных.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nТакже в выпуске порция инструментов, полезные статьи, видео и анонсы двух митапов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПриятного чтения!\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дайджест"},{"titleHtml":"php-дайджест"},{"titleHtml":"PHP"},{"titleHtml":"Symfony"},{"titleHtml":"Laravel"},{"titleHtml":"Magento"},{"titleHtml":"PHPUnit"},{"titleHtml":"PHP 8.1"},{"titleHtml":"PHP 8.2"}]},"580228":{"id":"580228","timePublished":"2021-09-27T16:41:21+00:00","isCorporative":true,"lang":"ru","titleHtml":"Идеальная светодиодная лампа за 21 рубль","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"108988","alias":"AlexeyNadezhin","fullname":"Алексей Надежин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffdc\u002F3ac\u002F9a2\u002Ffdc3ac9a2dc0107cc956f1bd0cf5fc2b.jpg","speciality":"Блогер"},"statistics":{"commentsCount":29,"favoritesCount":46,"readingCount":11335,"score":79,"votesCount":83},"hubs":[{"relatedData":null,"id":"21646","alias":"lamptest","type":"corporative","title":"Блог компании LampTest","titleHtml":"Блог компании LampTest","isProfiled":false},{"relatedData":null,"id":"21894","alias":"gadgets","type":"collective","title":"Гаджеты","titleHtml":"Гаджеты","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Удивительно осознавать, что достаточно сложное электронное устройство, которым является светодиодная лампочка, может стоить 21 рубль. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЕщё сложнее поверить, что эта лампочка безукоризненна по всем параметрам.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F849\u002Ffcd\u002F20f849fcd6a3891f506676fc87223bdf.jpg\"\u003E\u003C\u002Fdiv\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"led"},{"titleHtml":"светодиодные лампы"},{"titleHtml":"тест"}]},"580304":{"id":"580304","timePublished":"2021-09-27T18:31:25+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как сделать 248MP фотографию Солнца","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Simon Tang","originalUrl":"https:\u002F\u002Fpetapixel.com\u002F2021\u002F09\u002F15\u002Fa-closer-look-how-i-created-a-248mp-photo-of-the-sun\u002F"}}],"author":{"id":"2192534","alias":"Itelma","fullname":"T-800","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc3a\u002Fd1e\u002F43d\u002Fc3ad1e43d500046c3228c9494b510912.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":4,"favoritesCount":4,"readingCount":1502,"score":13,"votesCount":13},"hubs":[{"relatedData":null,"id":"22356","alias":"itelma","type":"corporative","title":"Блог компании НПП ИТЭЛМА","titleHtml":"Блог компании НПП ИТЭЛМА","isProfiled":false},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21932","alias":"photo","type":"collective","title":"Фототехника","titleHtml":"Фототехника","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fe02\u002F643\u002Fa55\u002Fe02643a550e20aa10c366e20956e4b40.jpg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ci\u003EЭто изображение диска нашего Солнца создано с помощью большого рефракторного (линзового) телескопа и высокоскоростной монохромной CMOS-камеры.\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКаждый день над нашими головами висит большой шар света. Он там всегда, и никто не обращает на него внимания. Разумеется, мы не советуем вам долго смотреть на него и при этом ослепнуть, тем не менее, наука дала нам возможность смотреть прямо на солнце совершенно безопасно.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПоскольку техника стала более доступной, обычный человек может заглянуть в многочисленные слои Солнца с помощью специального оборудования, которое может купить в любом хорошем магазине телескопов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ этой статье мы подробно рассмотрим слой, известный как хромосфера: область Солнца, видимая в оранжево-красном спектре. При помощи специального фильтра это устройство блокирует весь нежелательный свет, пропуская при этом определенный диапазон частот, который нас интересует.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"обработка изображений"},{"titleHtml":"фототехника"}]},"580326":{"id":"580326","timePublished":"2021-09-27T22:44:08+00:00","isCorporative":false,"lang":"ru","titleHtml":"Почему инженеры презирают Agile","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Stefan Wolpers","originalUrl":"https:\u002F\u002Fage-of-product.com\u002Fengineers-despise-agile\u002F"}}],"author":{"id":"2015227","alias":"kantocoder","fullname":null,"avatarUrl":"","speciality":"C++"},"statistics":{"commentsCount":21,"favoritesCount":4,"readingCount":1741,"score":8,"votesCount":16},"hubs":[{"relatedData":null,"id":"19583","alias":"dev_management","type":"collective","title":"Управление разработкой","titleHtml":"Управление разработкой","isProfiled":true},{"relatedData":null,"id":"20692","alias":"agile","type":"collective","title":"Agile","titleHtml":"Agile","isProfiled":true}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EМы продолжаем цикл публикаций о недостатках Аgile методологии.  Сегодня перевод статьи о том, почему инженеры презирают Agile (много новых удивительных наблюдений!)\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F34a\u002Ffbe\u002F0e8\u002F34afbe0e8166313ff883d59e59da0785.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F34a\u002Ffbe\u002F0e8\u002F34afbe0e8166313ff883d59e59da0785.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"agile development"},{"titleHtml":"микроменеджмент"},{"titleHtml":"agile"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["580060","580228","580124","580210","580150","579854","572164","580204","580172","580008","580206","580304","580194","580050","580196","580164","579772","580326","580208","580166"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":3},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["553156","547006","246281"],"similarListRefs":{"246281":{"id":"246281","timePublished":"2014-12-19T08:46:56+00:00","isCorporative":false,"lang":"ru","titleHtml":"Поговорим о VPN-ах? Типы VPN соединений. Масштабирование VPN","editorVersion":"1.0","postType":"article","postLabels":[{"type":"sandbox","data":null}],"author":{"id":"874459","alias":"vadims06","fullname":null,"avatarUrl":null,"speciality":null},"statistics":{"commentsCount":39,"favoritesCount":1073,"readingCount":164907,"score":52,"votesCount":54},"hubs":[{"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"id":"17123","alias":"network_technologies","type":"collective","title":"Сетевые технологии","titleHtml":"Сетевые технологии","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"Коллеги, здравствуйте. Меня зовут Семенов Вадим и я хочу представить статью, посвященную вопросу масштабируемости VPN-ов, причем тех VPN-ов, которые доступны для настройки в обычной корпоративной сети предприятия, а не со стороны провайдера. Надеюсь, данная статья станет справочным материалом, который может потребоваться при дизайне сети, либо при её апгрейде, либо для того, чтобы освежить в памяти принцип работы того или иного VPN-на.&nbsp;\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null},"547006":{"id":"547006","timePublished":"2021-03-26T09:00:01+00:00","isCorporative":false,"lang":"ru","titleHtml":"Spoke to spoke мультикаст в сетях DMVPN","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2638797","alias":"braonle","fullname":"Ярослав Бондаренко","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fdd3\u002F012\u002Fc1f\u002Fdd3012c1f1f30f8ceffd158800dfd2e9.jpg","speciality":"Системный инженер"},"statistics":{"commentsCount":0,"favoritesCount":4,"readingCount":858,"score":3,"votesCount":3},"hubs":[{"id":"6900","alias":"cisconetworks","type":"collective","title":"Cisco","titleHtml":"Cisco","isProfiled":true},{"id":"17123","alias":"network_technologies","type":"collective","title":"Сетевые технологии","titleHtml":"Сетевые технологии","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПро настройку и диагностику технологии DMVPN в интернете написано немало статей. Однако про использование мультикаста поверх DMVPN лучшее, что мне удалось найти – это \u003Ca href=\"https:\u002F\u002Fwww.cisco.com\u002Fc\u002Fen\u002Fus\u002Ftd\u002Fdocs\u002Fios-xml\u002Fios\u002Fsec_conn_dmvpn\u002Fconfiguration\u002Fxe-16\u002Fsec-conn-dmvpn-xe-16-book\u002Fsec-conn-dmvpn-summ-maps.html\" rel=\"noopener noreferrer nofollow\"\u003Eмаленькая заметка в Configuration Guide\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cem\u003E“In DMVPN, it is recommended to  configure a Rendezvous Point (RP) at or behind the hub. If there is an  IP multicast source behind a spoke, the ip pim spt-threshold infinity  command must be configured on spokes to avoid multicast traffic going  through spoke-to-spoke tunnels.”\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cp\u003EДавайте выясним, в чем на самом деле заключается необходимость этой команды. \u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd51\u002Fc2f\u002F6a8\u002Fd51c2f6a845b3dba6d073acff3014f68.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd51\u002Fc2f\u002F6a8\u002Fd51c2f6a845b3dba6d073acff3014f68.png","fit":"cover","positionY":24.545454545455,"positionX":58.846153846154}},"status":"published","plannedPublishTime":null,"checked":null},"553156":{"id":"553156","timePublished":"2021-04-23T15:00:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"MPLS L3VPN поверх DMVPN","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Iaroslav Bondarenko","originalUrl":"https:\u002F\u002Fbraonle.wordpress.com\u002F2021\u002F04\u002F11\u002Fmpls-l3vpn-over-dmvpn-ibgp\u002F"}}],"author":{"id":"2638797","alias":"braonle","fullname":"Ярослав Бондаренко","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fdd3\u002F012\u002Fc1f\u002Fdd3012c1f1f30f8ceffd158800dfd2e9.jpg","speciality":"Системный инженер"},"statistics":{"commentsCount":3,"favoritesCount":13,"readingCount":1785,"score":5,"votesCount":5},"hubs":[{"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"id":"6900","alias":"cisconetworks","type":"collective","title":"Cisco","titleHtml":"Cisco","isProfiled":true},{"id":"17123","alias":"network_technologies","type":"collective","title":"Сетевые технологии","titleHtml":"Сетевые технологии","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EDMVPN является известным решением для построения топологий hub&amp;spoke. В ряде случаев может понадобиться поддержка изолированной передачи трафика различных клиентов. Конечно, можно построить DMVPN туннель в каждом VRF; однако в реальной жизни такой подход не является достаточно масштабируемым. В такой ситуации на ум приходит MPLS, который зарекомендовал себя в корпоративных и провайдерских сетях. \u003C\u002Fp\u003E\u003Cp\u003EGRE поддерживает инкапсуляцию различных PDU, в том числе и MPLS, поэтому, на первый взгляд, не должно возникнуть проблем на уровне передачи трафика. С управляющими протоколами, однако, ситуация обстоит несколько сложнее. LDP и RSVP должны установить соседство перед тем, как обменяться какими-либо данными. Масштабируемость этих протоколов обусловлена использованием мультикаста для обнаружения соседей и обмена с ними необходимыми параметрами протокола. Ручная настройка LDP\u002FRSVP соседства в DMVPN сведёт на нет масштабируемость, поэтому такой сценарий статья не рассматривает. Использование же мультикаста ограничивает функциональность решения, поскольку spoke могут обмениваться такими сообщениями только с hub, что исключает наличие spoke-to-spoke связности с использованием MPLS.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F470\u002F112\u002F329\u002F4701123294b38069d14cc515565541a4.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F470\u002F112\u002F329\u002F4701123294b38069d14cc515565541a4.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"ilyapodkopaev":{"scoreStats":{"score":68,"votesCount":94},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"54347","alias":"IlyaPodkopaev","fullname":"Подкопаев Илья","avatarUrl":null,"speciality":null}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
