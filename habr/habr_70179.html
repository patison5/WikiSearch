<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Часть 2/3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/70179\/"},"headline":"Часть 2\/3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями","datePublished":"2009-09-21T01:38:01+04:00","dateModified":"2009-09-21T11:58:56+04:00","author":{"@type":"Person","name":"Я робот"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Начало здесь.  Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию.   readMyFile&nbsp;=&nbsp;withBinaryFile&nbsp;&quot;bin4.obf&quot;&nbsp;ReadMode&nbsp;$&nbsp;\\h&nbsp;-&gt;&nbsp;do...","url":"https:\/\/habr.com\/ru\/post\/70179\/#post-content-body","about":["h_closet","f_popsci"],"image":["https:\/\/habr.com\/share\/publication\/70179\/8ff827e30ce398ef16ddb94d20a83e2f\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Часть 2/3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Часть 2/3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Часть 2/3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Начало здесь.

Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию...." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Начало здесь.

Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию...." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Начало здесь.

Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию...." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Начало здесь.

Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию...." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Начало здесь.

Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию...." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/70179/8ff827e30ce398ef16ddb94d20a83e2f/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/70179/8ff827e30ce398ef16ddb94d20a83e2f/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/70179/8ff827e30ce398ef16ddb94d20a83e2f/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/70179/8ff827e30ce398ef16ddb94d20a83e2f/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/70179/8ff827e30ce398ef16ddb94d20a83e2f/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="70179" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2009-09-20T21:38:01.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/70179/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/70179/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/70179/8ff827e30ce398ef16ddb94d20a83e2f/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/San13/" title="San13" class="tm-user-info__userpic"><div class="tm-entity-image"><svg height="24" width="24" class="tm-svg-img tm-image-placeholder tm-image-placeholder_lilac"><!----> <use xlink:href="/img/megazord-v24.cee85629.svg#placeholder-user"></use></svg></div></a> <span class="tm-user-info__user"><a href="/ru/users/San13/" class="tm-user-info__username">
      San13
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2009-09-20T21:38:01.000Z" title="2009-09-21, 01:38">21  сентября  2009 в 01:38</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Часть 2/3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/closet/" class="tm-article-snippet__hubs-item-link"><span>Чулан</span> <!----></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><a href="http://san13.habrahabr.ru/blog/68995/">Начало здесь.</a><br/>
<br/>
Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию. <br/>
<br/>
<blockquote><code>readMyFile <font color="#a52a2a"><b>=</b></font> withBinaryFile <font color="#ff00ff">"bin4.obf"</font> ReadMode <font color="#a52a2a"><b>$</b></font> <font color="#a52a2a"><b>\</b></font>h <font color="#a52a2a"><b>-></b></font> <font color="#a52a2a"><b>do</b></font>&lt;br><br/>
        len <font color="#a52a2a"><b>&lt;-</b></font> hFileSize h&lt;br><br/>
        buf <font color="#a52a2a"><b>&lt;-</b></font> mallocBytes <font color="#a52a2a"><b>$</b></font> fromInteger len&lt;br><br/>
        hGetBuf h buf <font color="#a52a2a"><b>$</b></font> fromInteger len&lt;br><br/>
        return (len, buf)&lt;br><br/>
</code></blockquote>Это императивный кусок, потому что с файлами так в основном и работают. withBinaryFile открывает файл, выполняет указанную ей «пользовательскую» функцию, передав ей handle, и закрывает файл, и возвращает то, что вернула ей пользовательская функция. Вот, после знака $ мы описали «пользовательскую» функцию с одним параметром h (от handle). Эта функция получает размер файла, аллоцирует буфер, читает в буфер и возвращает сам буфер и его длину (в байтах). Заметим, что «пользовательская функция» здесь не имеет имени и начинается так:<br/>
<br/>
<a name="habracut"></a><br/>
<br/>
<code>\h -> function_body -- это такой синтаксис безымянных функций с одним параметром<br/>
</code><br/>
Далее функция получения инструкции и слова данных из буфера. Сюда передается текущий указатель на буфер (уже сдвинутый на нужное число байтов), и передается индекс инструкции. Из спецификации помним про четный-нечетный индекс, и что опкод и слово данных лежат то так то эдак. То есть инструкция начинается то с нулевого байта, то с восьмого, а слово данных (плавающее), соответственно, то с четвертого, то с нулевого.<br/>
<br/>
<blockquote><code>instruction <font color="#a52a2a"><b>::</b></font> Ptr a <font color="#a52a2a"><b>-></b></font> Int <font color="#a52a2a"><b>-></b></font> IO (Word32,Double)&lt;br><br/>
instruction ptr i <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>do</b></font>&lt;br><br/>
        <font color="#a52a2a"><b>let</b></font> (iaddr,daddr) <font color="#a52a2a"><b>=</b></font> <font color="#a52a2a"><b>if</b></font> i <font color="#a52a2a"><b>`mod`</b></font> <font color="#ff00ff">2</font> <font color="#a52a2a"><b>/=</b></font> <font color="#ff00ff">O</font> <font color="#a52a2a"><b>then</b></font> (<font color="#ff00ff">O</font>,<font color="#ff00ff">4</font>) <font color="#a52a2a"><b>else</b></font> (<font color="#ff00ff">8</font>,<font color="#ff00ff">O</font>)  <font color="#0000ff">-- смещения instruction/data</font>&lt;br><br/>
        instr <font color="#a52a2a"><b>&lt;-</b></font> peek (plusPtr ptr iaddr) <font color="#a52a2a"><b>::</b></font> IO Word32  <font color="#0000ff">-- выборка инструкции</font>&lt;br><br/>
        dta <font color="#a52a2a"><b>&lt;-</b></font> peek (plusPtr ptr daddr) <font color="#a52a2a"><b>::</b></font> IO Double                  <font color="#0000ff">-- выборка данных</font>&lt;br><br/>
        return (instr, dta)&lt;br><br/>
</code></blockquote>Заметим, что операция «неравно» звучит по-математически: "/=".<br/>
Теперь пройдемся «циклом» по всему буферу, и вернем список пар (инструкция, данное):<br/>
<blockquote><code>ast <font color="#a52a2a"><b>=</b></font> mapM (<font color="#a52a2a"><b>\</b></font>i <font color="#a52a2a"><b>-></b></font> instruction (plusPtr buf <font color="#a52a2a"><b>$</b></font> i<font color="#a52a2a"><b>*</b></font><font color="#ff00ff">12</font>) i) [<font color="#ff00ff">O</font><font color="#a52a2a"><b>..</b></font>nframes<font color="#a52a2a"><b>-</b></font><font color="#ff00ff">1</font>]&lt;br><br/>
</code></blockquote>Тут происходит множество вещей. Во-первых, функция map и ей подобные (в частности, mapM) работают следующим образом: им на вход подается «пользовательская функция», преобразующая один элемент списка, а также ей передается сам список, а затем уж map применяет эту пользовательскую функцию к каждому элементу списка, и формирует новый список, из значений этой функции. Цикл у map где-то там внутри (не будем вдаваться в подробности).<br/>
<br/>
<code>let q = map (\h -> h * 2) [1,2,3,4,5] <br/>
</code><br/>
вернет [2,4,6,8,10], это классический пример. А у нас в рассматриваемой задаче на входе индексы (от нуля до конца), а на выходе список результатов вызова функции «instruction» с каждым индексом. Это иногда сложно понять сразу, но уже пора — python и ruby движутся в этом направлении, а с ними еще когорта языков (из тех, которые еще не там, понятное дело).<br/>
<br/>
<code>ast <font color="#a52a2a"><b>=</b></font> mapM (<font color="#a52a2a"><b>\</b></font>i <font color="#a52a2a"><b>-></b></font> instruction (plusPtr buf <font color="#a52a2a"><b>$</b></font> i<font color="#a52a2a"><b>*</b></font><font color="#ff00ff">12</font>) i) [<font color="#ff00ff">O</font><font color="#a52a2a"><b>..</b></font>nframes<font color="#a52a2a"><b>-</b></font><font color="#ff00ff">1</font>]&lt;br><br/>
</code><br/>
Возвращаясь к нашей mapM, в переданной ей функции стоит вызов instruction, которому по-очереди скармливается 0, 1, итд, как второй аргумент, а как первый — передается буфер со смещениями по 12 байт дальше и дальше на каждую итерацию (1 опкод + 1 слово данных = 12 байт). plusPtr формирует новый указатель, отстоящий от указанного на указанное число байт.<br/>
<br/>
Вот и весь цикл. В результате имеем список из «плоских» опкодов (плоских, потому что переведены один к одному по спецификации):<br/>
<br/>
<code>[(Add 0 77 66, 0.0), (Sub 1 0 102, 0.0), ...]<br/>
</code><br/>
Что означает: сложить ячейки 77 и 66, результат поместить в 0. Затем вычесть содержимое ячейки 102 из содержимого ячейки 0, результат поместить в 1… итд. Таков наш код. А вот данные: в нулевой ячейке 0.0, в первой 0.0, итд…<br/>
<br/>
На этом месте можно остановиться и сгенерировать неидеальный код на любом языке, хоть на ассемблере (ведь операции из спецификации задачи близки к нему). Для этого необходимо дописать перевод в строку (на желаемом языке) каждой из плоских операций, и нагенерить в цикле код. Но это будет дословным исполнением, а оттого медленно и нудно.<br/>
<br/>
Почему медленно? Потому что будет присутствовать операция записи в память некоторых результатов, которые используются только 1 раз, и которые, по правде, лучше хранить где-то в регистрах или даже на стеке (этими деталями займется компилятор C/Haskell/Java или чего угодно, во что мы представим наш AST, а «чем угодно» у нас нынче служит хаскель). И если мы нагенерим запись в поле структуры по каждому чиху, то никакой компилятор нам регистров оттуда не наизобретает, а только одни записи в память.<br/>
<br/>
Поэтому мы разберем, на какие же категории делятся наши ячейки «памяти».<br/>
<br/>
1) константы: только чтение, никогда запись<br/>
2) реальная память: чтение раньше записи, запись позже чтения<br/>
3) временные переменные: запись, затем несколько чтений<br/>
4) одноразовые переменные: запись, затем одно чтение. Пойдут в выражения со скобками.<br/>
<br/>
Чтобы понять, кто и что читает или пишет в ячейку памяти, нам необходимо описать поведение каждой инструкции в следующем разрезе: одни инструкции только читают память (вывод из памяти в порт), другие только пишут (из порта в пямать), большинство читают и пишут (арифметические, условные). <br/>
<br/>
Описываем поведение каждой инструкции — что она читает (потребляет).<br/>
<br/>
<blockquote><code>consumesData (Add _ r1 r2) <font color="#a52a2a"><b>=</b></font> [r1,r2]&lt;br><br/>
consumesData (Sub _ r1 r2) <font color="#a52a2a"><b>=</b></font> [r1,r2]&lt;br><br/>
consumesData (Mul _ r1 r2) <font color="#a52a2a"><b>=</b></font> [r1,r2]&lt;br><br/>
consumesData (Div _ r1 r2) <font color="#a52a2a"><b>=</b></font> [r1,r2]&lt;br><br/>
consumesData (Output r1 r2) <font color="#a52a2a"><b>=</b></font> [r2]&lt;br><br/>
consumesData (If _ condr1 _ r1 r2) <font color="#a52a2a"><b>=</b></font> [condr1,r1,r2]&lt;br><br/>
consumesData (Sqrt _ r2) <font color="#a52a2a"><b>=</b></font> [r2]&lt;br><br/>
consumesData (Copy _ r2) <font color="#a52a2a"><b>=</b></font> [r2]&lt;br><br/>
consumesData _ <font color="#a52a2a"><b>=</b></font> []&lt;br><br/>
</code></blockquote>Подчеркивание в последнем случае означает «все остальные», а в первых случаях оно означает, что нам не интересно, что там в этом месте конструктора за аргумент. Как видно, здесь снова используется pattern matching.<br/>
<br/>
Аналогично описываем поведение каждой операции касаемо того, что она пишет (производит):<br/>
<blockquote><code>producesData (Add addr _ _) <font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData (Sub addr _ _) <font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData (Mul addr _ _) <font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData (Div addr _ _ )<font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData (If _ _ addr _ _) <font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData (Input addr _) <font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData (Copy addr _) <font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData (Sqrt addr _ )<font color="#a52a2a"><b>=</b></font> [addr]&lt;br><br/>
producesData _ <font color="#a52a2a"><b>=</b></font> []&lt;br><br/>
</code></blockquote>Описываем, что каждая инструкция делает по отношению к портам — какие порты она читает.<br/>
<blockquote><code>readsPort (Input _ port) <font color="#a52a2a"><b>=</b></font> [port]&lt;br><br/>
readsPort _ <font color="#a52a2a"><b>=</b></font> []&lt;br><br/>
</code></blockquote>И запись — какие порты она пишет:<br/>
<blockquote><code>writesPort (Output r1 _) <font color="#a52a2a"><b>=</b></font> [r1]&lt;br><br/>
writesPort _ <font color="#a52a2a"><b>=</b></font> []&lt;br><br/>
</code></blockquote>Далее, для более короткой записи (причуда автора)<br/>
<blockquote><code>cmap <font color="#a52a2a"><b>=</b></font> concatMap&lt;br><br/>
</code></blockquote>Что делает concatMap? Она делает то же что и map, только еще после этого делает concat. Concat «склеивает список на один уровень». Маленький пример:<br/>
<br/>
<code>concat [<font color="#ff00ff">"hello"</font>,<font color="#ff00ff">"africa"</font>] <font color="#a52a2a"><b>=</b></font> <font color="#ff00ff">"helloafrica"</font>&lt;br><br/>
concat [[<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>,<font color="#ff00ff">4</font>],[<font color="#ff00ff">5</font>,<font color="#ff00ff">6</font>,<font color="#ff00ff">7</font>,<font color="#ff00ff">8</font>]] <font color="#a52a2a"><b>=</b></font> [<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>,<font color="#ff00ff">4</font>,<font color="#ff00ff">5</font>,<font color="#ff00ff">6</font>,<font color="#ff00ff">7</font>,<font color="#ff00ff">8</font>]&lt;br><br/>
concat [[]] <font color="#a52a2a"><b>=</b></font> []&lt;br><br/>
&lt;br><br/>
map (<font color="#a52a2a"><b>\</b></font>i <font color="#a52a2a"><b>-></b></font> [<font color="#ff00ff">1</font><font color="#a52a2a"><b>..</b></font>i]) [<font color="#ff00ff">1</font><font color="#a52a2a"><b>..</b></font><font color="#ff00ff">5</font>] <font color="#a52a2a"><b>=</b></font> [[<font color="#ff00ff">1</font>],[<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>],[<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>],[<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>,<font color="#ff00ff">4</font>],[<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>,<font color="#ff00ff">4</font>,<font color="#ff00ff">5</font>]]&lt;br><br/>
concatMap (<font color="#a52a2a"><b>\</b></font>i <font color="#a52a2a"><b>-></b></font> [<font color="#ff00ff">1</font><font color="#a52a2a"><b>..</b></font>i]) [<font color="#ff00ff">1</font><font color="#a52a2a"><b>..</b></font><font color="#ff00ff">5</font>] <font color="#a52a2a"><b>=</b></font> [<font color="#ff00ff">1</font>,<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>,<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>,<font color="#ff00ff">4</font>,<font color="#ff00ff">1</font>,<font color="#ff00ff">2</font>,<font color="#ff00ff">3</font>,<font color="#ff00ff">4</font>,<font color="#ff00ff">5</font>]&lt;br><br/>
</code><br/>
<br/>
Теперь самый страшный и большой кусок:<br/>
<blockquote><code>produceCode ast dta <font color="#a52a2a"><b>=</b></font>&lt;br><br/>
<font color="#a52a2a"><b>let</b></font> &lt;br><br/>
   inports <font color="#a52a2a"><b>=</b></font> cmap readsPort ast  <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
   outports <font color="#a52a2a"><b>=</b></font> cmap writesPort ast <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
</code></blockquote>применить readsPort/writesPort к каждому опкоду, и сложить (concat) все списки в один список. Таким образом, мы получили списки входных и выходных портов вообще. <br/>
<blockquote><code>   <font color="#0000ff">-- consumes,produces,outputs to port [(memory/port ref,op address)] lookup tables</font>&lt;br><br/>
   consumes <font color="#a52a2a"><b>=</b></font> cmap (<font color="#a52a2a"><b>\</b></font>(d,a)<font color="#a52a2a"><b>-></b></font> consumesData d <font color="#a52a2a"><b>`zip`</b></font> [a,a<font color="#a52a2a"><b>..</b></font>] ) (ast <font color="#a52a2a"><b>`zip`</b></font> [<font color="#a52a2a"><b>O..</b></font>]) <font color="#a52a2a"><b>::</b></font> [(Int,Int)]&lt;br><br/>
   produces <font color="#a52a2a"><b>=</b></font> cmap (<font color="#a52a2a"><b>\</b></font>(d,a)<font color="#a52a2a"><b>-></b></font> producesData d <font color="#a52a2a"><b>`zip`</b></font> [a,a<font color="#a52a2a"><b>..</b></font>] ) (ast <font color="#a52a2a"><b>`zip`</b></font> [<font color="#a52a2a"><b>O..</b></font>])&lt;br><br/>
   outputsPort  <font color="#a52a2a"><b>=</b></font> cmap (<font color="#a52a2a"><b>\</b></font>(d,a)<font color="#a52a2a"><b>-></b></font> writesPort d <font color="#a52a2a"><b>`zip`</b></font> [a,a<font color="#a52a2a"><b>..</b></font>] ) (ast <font color="#a52a2a"><b>`zip`</b></font> [<font color="#a52a2a"><b>O..</b></font>])&lt;br><br/>
</code></blockquote>здесь мы построили несколько lookup tables (справочников?), к которым можно задавать следующие вопросы: <br/>
<br/>
По какому адресу расположена инструкция, которая пишет в указанный адрес? (вообще, вопрос глупый, потому по определению задачи эта инструкция расположена по адресу N, но это я только сейчас сообразил)<br/>
По каким адресам расположены инструкции, которые читают указанную ячейку?<br/>
По какому адресу расположена инструкция, которая пишет в указанный порт?<br/>
<br/>
В хаскеле примитивный справочник (lookup table) — это список пар (ключ, значение). У нас вот есть функции, которые ищут все значения по данному ключу и возвращают список. Вот они:<br/>
<br/>
<blockquote><code>   <font color="#0000ff">-- op address that reads/writes given mem/port</font>&lt;br><br/>
   reads m <font color="#a52a2a"><b>=</b></font> map snd <font color="#a52a2a"><b>$</b></font> filter ((m<font color="#a52a2a"><b>==</b></font>)<font color="#a52a2a"><b>.</b></font>fst) consumes <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
   writes m <font color="#a52a2a"><b>=</b></font> map snd <font color="#a52a2a"><b>$</b></font> filter ((m<font color="#a52a2a"><b>==</b></font>)<font color="#a52a2a"><b>.</b></font>fst) (produces) <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
   outputs m <font color="#a52a2a"><b>=</b></font> map snd <font color="#a52a2a"><b>$</b></font> filter ((m<font color="#a52a2a"><b>==</b></font>)<font color="#a52a2a"><b>.</b></font>fst) outputsPort <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
</code></blockquote>Они возвращают просто список адресов, кто читает указанную ячейку памяти, или пишет, или пишет указанный порт. Как это работает:<br/>
<blockquote><code>     reads m <font color="#a52a2a"><b>=</b></font> map snd <font color="#a52a2a"><b>$</b></font> filter ((m<font color="#a52a2a"><b>==</b></font>)<font color="#a52a2a"><b>.</b></font>fst) consumes^M&lt;br><br/>
</code></blockquote>означает буквально: взять вторые элементы, отфильтровав сначала всех у кого первый элемент равен указанному m из справочника consumes (вычислен раньше). Как это работает?<br/>
<br/>
функция filter на вход берет «пользовательскую функцию» ((m==).fst) и список. Пользовательской функции скармливается на вход каждый элемент из списка, и она возвращает True или False. Из этого списка, в зависимости от результата, в результирующий список попадают или не попадают элементы. Остается меньший список, стало быть. Этот список является вторым аргументом функции map (как было рассказано раньше про оператор '$'). Дальше map применяет функцию snd к каждому элементу списка и формирует список результатов.<br/>
<br/>
Нерассмотренными осталось несколько вещей. Функции snd/fst возвращают второй или первый элемент пары соответственно, то есть они занимаются декомпозицией пары, а если говорить простым языком, выкусывают второй или первый элемент:<br/>
<br/>
<code>fst (1,2) = 1<br/>
snd (1,2) = 2<br/>
fst ("Hello", 2+2) = "Hello"<br/>
snd ("Hello", 2+2) = 4<br/>
</code><br/>
И теперь один из интересных моментов в хаскеле — композиция функций. Рассмотрим примерчик:<br/>
<br/>
<code>f x = sin (cos (sqrt (x))), его можно записать по-хаскельски короче:<br/>
f x = sin $ cos $ sqrt x<br/>
</code><br/>
Теперь пошевелить мозгом и увидеть, что «x» всегда проходит через мясорубку функций: сначала sqrt, потом cos, потом через sin. Наверняка можно бы было построить график функции f x, а раз можно построить график, то наверняка последовательности применений этих трех функций соответствует какая-то одна единственная функция, которая дает тот же результат, только математики не дали ей еще названия!!! Да простят меня люди с формальным мышлением.<br/>
<br/>
Теперь, предположим, у нас есть функция на хаскеле, которая строит график любой переданной функции, например<br/>
<br/>
<code>plot :: (Double -> Double) -> Double -> Double -> IO() (читаем IO () как void, а всё определение типа звучит как: функция plot берет на вход функцию от Double возвращающую Double, а также еще берет два аргумента Double (интервал на котором строить), и возвращает void)<br/>
plot sin 0 6.28 -- построить график функции sin на интервали от 0 до 6.28<br/>
plot cos 0 3.14 -- то же, на другом интервале, другой функцией.<br/>
</code><br/>
Тут мы видим, что функцию sin или cos мы передаем как таковую, аргумент в нее передавать будут в процессе постройки графика, те кто его строят. Как же нам передать целую мясорубку функций, которой не придумали имя, но мы знаем как оно складывается? <br/>
<br/>
Возникает насущная необходимость описать такую мясорубку. Следовательно:<br/>
<br/>
<code>fun1 = sin -- это мясорубка из 1 функции<br/>
fun2 = sin . cos . sqrt -- это мясорубка из трех функций, а точка - это операция композиции функций<br/>
</code><br/>
Теперь про неполное применение. Вот у нас есть функция, которая берет два аргумента, например возведение в степень:<br/>
<code>pow 2 3 = 8 -- два в третьей степени<br/>
теперь опишем функцию pow2:<br/>
pow2 = pow 2<br/>
</code><br/>
Оказывается, мы передали всего один аргумент из двух требуемых, но нас никто не остановил и не поругал! Какой же тип у функции pow2? Очень просто, она хочет еще один аргумент Double, и добавит его, и вызовет функцию pow с этим аргументом, а двойка там уже стоит!<br/>
<br/>
<code>pow2 4 = 16<br/>
</code>Оказывается, нотация для описания хаскельских типов тоже не с потолка взята: следите за руками:<br/>
<br/>
<code>pow :: Double -> Double -> Double -- берет double, и еще double, возвращает double<br/>
pow2 :: Double -> Double -- берет один double, возвращает double<br/>
</code><br/>
а так как pow2 получилось указанием одного аргумента к функции pow, то мы можем заключить, что добавление одного аргумента к pow порождает новую функцию!<br/>
<br/>
<code>pow :: Double -> (Double -> Double) -- вот я тут добавил скобок.<br/>
</code><br/>
Стало быть, можно как угодно справа добавлять скобок, а смысл будет тот же. Из этого также следует, что:<br/>
<br/>
pow 2 3 = (pow 2) 3, то есть вначале сгенерим функцию, а потом добавим в нее недостающий аргумент (применим функцию к тройке).<br/>
<br/>
Вернемся к нашим баранам.<br/>
<blockquote><code>     reads m <font color="#a52a2a"><b>=</b></font> map snd <font color="#a52a2a"><b>$</b></font> filter ((m<font color="#a52a2a"><b>==</b></font>)<font color="#a52a2a"><b>.</b></font>fst) consumes&lt;br><br/>
</code></blockquote>в filter стоит функция: (m==). fst. Здесь мы наблюдаем точку (композиция) и частичное применение: m==. Вот это вот m== — это функция, которая получает на вход 1 аргумент, подставляет его справа от знака равно, и вуаля! Функция m== возвращает результат сравнения своего аргумента с m. Если m равно 5, то ((m==) 5) вернет True.<br/>
<br/>
Теперь читаем всё справа налево: у нас есть мясорубка, то что в нее входит, сначала скармливается функции fst (которая, как известно, из пары извлекает первый элемент), потом это значение скармливается m==, которая берет число, сравнивает его с m и возвращает Boolean. Таким образом, в мясорубку входит пара (a,b), а выходит Boolean, равно ли а вот этому m.<br/>
<br/>
Теперь нам надлежит выбрать все упоминания ячеек, которые пишутся или читаются, для того чтобы было от чего отталкиваться:<br/>
<br/>
<blockquote><code>   <font color="#0000ff">-- all memory references (including temporaries etc - from plain program)</font>&lt;br><br/>
   alldata <font color="#a52a2a"><b>=</b></font>  nub <font color="#a52a2a"><b>$</b></font> sort <font color="#a52a2a"><b>$</b></font> cmap consumesData ast <font color="#a52a2a"><b>++</b></font> (map recast <font color="#a52a2a"><b>$</b></font> cmap producesData ast) <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
</code></blockquote>Здесь (читаем справа налево) «cmap producesDataAst ast» возвращает список всех записываемых ячеек в виде плоского списка их адресов, аналогично происходит с consumesData, потом оба списка просто склеиваются (++), потом сортируются, и потом из них удаляются дупликаты (nub). В принципе, nub не требуется отсортированный список, но я этого раньше не знал:<br/>
<br/>
<code>nub [1,2,1] = [1,2]<br/>
nub [2,1,2] = [2,1]<br/>
</code><br/>
<blockquote><code>   <font color="#0000ff">-- constants</font>&lt;br><br/>
            constants <font color="#a52a2a"><b>=</b></font> filter (<font color="#a52a2a"><b>\</b></font>m <font color="#a52a2a"><b>-></b></font> <font color="#ff00ff">O</font> <font color="#a52a2a"><b>==</b></font> (length <font color="#a52a2a"><b>$</b></font> writes m))  alldata <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
</code></blockquote>A тут произошло следующее: мы выбрали из alldata все адреса, в которые никто никогда не пишет. А раз из них только читают, то это наверняка константы. Вот мы списочек и составили.<br/>
<br/>
<blockquote><code>   <font color="#0000ff">-- all persistent (optimized memory)</font>&lt;br><br/>
            persistents <font color="#a52a2a"><b>=</b></font> filter (<font color="#a52a2a"><b>\</b></font>m <font color="#a52a2a"><b>-></b></font> (head <font color="#a52a2a"><b>$</b></font> reads m) <font color="#a52a2a"><b>&lt;=</b></font> (head <font color="#a52a2a"><b>$</b></font> writes m)) (alldata <font color="#a52a2a"><b>\\</b></font> constants) <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
</code></blockquote>А тут мы выбрали все переменные, которые должны сохраняться от раза к разу между итерациями. Для этого мы взяли alldata, вычли из него константы (операция \\ — разность списков), и нашли кто первый читает и кто первый пишет. Если читают раньше того места где пишут, значит полагают, что там что-то есть! Осталось с прошлого раза! Вот, таким образом и составили список тех мест, которые реально являются памятью нашего черного ящика, доступной для чтения-записи.<br/>
<br/>
<blockquote><code>   <font color="#0000ff">-- temporaries which are reused parts of expressions</font>&lt;br><br/>
            lets <font color="#a52a2a"><b>=</b></font> filter (<font color="#a52a2a"><b>\</b></font>m <font color="#a52a2a"><b>-></b></font> <font color="#ff00ff">1</font> <font color="#a52a2a"><b>&lt;</b></font> (length <font color="#a52a2a"><b>$</b></font> reads m))  (alldata <font color="#a52a2a"><b>\\</b></font> constants) <font color="#a52a2a"><b>\\</b></font> persistents <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
</code></blockquote>Теперь мы из оставшихся (потому что вычли из alldata всё, что знаем до сих пор), нашли те ячейки, которые читаются больше одного раза. Так как это не перманентные данные (мы их исключили), то это наверняка временные переменные, которые сначала вычисляются, а потом несколько раз пользуются. Временные переменные используются в пределах одной итерации, а вне нее они не нужны.<br/>
<br/>
<blockquote><code>   <font color="#0000ff">-- expressions to inline (variables that are used 1 time)</font>&lt;br><br/>
            onerefs <font color="#a52a2a"><b>=</b></font> filter (<font color="#a52a2a"><b>\</b></font>m <font color="#a52a2a"><b>-></b></font> (length <font color="#a52a2a"><b>$</b></font> reads m) <font color="#a52a2a"><b>==</b></font><font color="#ff00ff">1</font> <font color="#a52a2a"><b>&amp;&amp;</b></font> (length <font color="#a52a2a"><b>$</b></font> writes m) <font color="#a52a2a"><b>==</b></font> <font color="#ff00ff">1</font>) &lt;br><br/>
((alldata <font color="#a52a2a"><b>\\</b></font> constants) <font color="#a52a2a"><b>\\</b></font> persistents) <font color="#a52a2a"><b>::</b></font> [Int]&lt;br><br/>
</code></blockquote>А тут мы вычислили переменные, которые один раз пишутся и потом 1 раз читаются. Для них мы не будем вообще ничего заводить, и из них сформируются выражения со скобками. Этот класс переменных понадобился авторам черного ящика, потому что у них такой низкоуровневый язык, а в нашем высокоуровневом результате они будут жить в регистрах процессора, но об этом позаботится компилятор без нашего ведома.<br/>
<br/>
Сейчас мы должны будем из плоских операций (в которых упоминаются только адреса которые читаются пишутся в процессе работы операции), перейти к древовидным опкодам, то есть к тем, которые у нас с суффиксом Exp — они содержат в себе ссылки на себе подобных, образуя дерево. Для этого мы опишем функцию, которая нам будет генерировать по адресу целый древовидный Op. Она будет рекурсивной. Потому что если мы даем ей адрес, по которому лежит константа, то делать особо много не надо. А если мы даем ей адрес, в который записывается результат сложений двух каких-то других ячеек, то нужно сгенерировать Op, который складывает два других Op-а, а уж они там могут быть константами, или вдруг там результатами умножений…<br/>
<br/>
<blockquote><code>   <font color="#0000ff">-- geherates reference to the expression identified by given address,</font>&lt;br><br/>
   <font color="#0000ff">-- this excludes address where to store it, only value is obtained</font>&lt;br><br/>
   ref <font color="#a52a2a"><b>::</b></font> DestAddr <font color="#a52a2a"><b>-></b></font> Op&lt;br><br/>
   ref a &lt;br><br/>
        <font color="#a52a2a"><b>|</b></font> elem a constants <font color="#a52a2a"><b>=</b></font> Const (dta<font color="#a52a2a"><b>!!</b></font>a)&lt;br><br/>
        <font color="#a52a2a"><b>|</b></font> elem a onerefs <font color="#a52a2a"><b>=</b></font> geneval a&lt;br><br/>
        <font color="#a52a2a"><b>|</b></font> elem a lets <font color="#a52a2a"><b>=</b></font> ReadVarExp a&lt;br><br/>
        <font color="#a52a2a"><b>|</b></font> elem a persistents <font color="#a52a2a"><b>=</b></font> ReadExp a&lt;br><br/>
        <font color="#a52a2a"><b>|</b></font> otherwise <font color="#a52a2a"><b>=</b></font> trace <font color="#ff00ff">"oops1"</font> <font color="#a52a2a"><b>$</b></font> undefined&lt;br><br/>
</code></blockquote>Тут мы имеем функцию ref, в которой есть некоторые пред-условия, накладывающиеся на входной параметр, синтаксис таких условий — это вертикальная черта, потом условие, а потом знак равенства, а за ним — тело функции, выполяющееся в случае истинности условия. Это как бы большой if… elseif… elseif… else… endif. Последний else у нас описан через trace «oops» $ undefined — выведет ошибку (trace) и остановит программу (undefined).<br/>
<br/>
Смотрим, если входной адрес принадлежит к константам, то генерируем доступ к константе (просто Op, обозначающий константу). Какую именно константу — определяет параметр конструктора Const — это просто значение памяти по указанному адресу. dta — это список, содержащий все ячейки памяти последовательно, а dfa!!a — это доступ к a-тому элементу списка.<br/>
<br/>
Если входной адрес принадлежит к onerefs (память 1 раз пишется, затем 1 раз читается), то нужно образовать просто узел дерева с двумя другими опами (операция со скобками). Вызывается geneval (описан ниже), который сгенерирует из простого Op-а (сложение двух ячеек памяти и помещение результата в третью) сложный (сложить два других Op-а, вернуть результат _вообще_)<br/>
<br/>
Аналогично для чтения временных переменных (которые один раз пишутся, много читаются), и для чтения входных портов.<br/>
<br/>
Сама функция geneval описана далее, в ней используется pattern matching. Из полученного адреса мы выбираем плоский Op (из списка ast), и преобразуем его в древовидный. Любопытно, что эта функция вызывает ref, описанную выше, таким образом функции взаимно-рекурсивны.<br/>
<br/>
<blockquote><code>   <font color="#0000ff">-- turns plain code in tree code, converting memory refs to ops via "ref"</font>&lt;br><br/>
            geneval a <font color="#a52a2a"><b>=</b></font> e <font color="#a52a2a"><b>$</b></font> ast <font color="#a52a2a"><b>!!</b></font> a&lt;br><br/>
   e (Add addr r1 r2) <font color="#a52a2a"><b>=</b></font> AddExp (ref r1) (ref r2)&lt;br><br/>
   e (Sub addr r1 r2) <font color="#a52a2a"><b>=</b></font> SubExp (ref r1) (ref r2)&lt;br><br/>
   e (Mul addr r1 r2) <font color="#a52a2a"><b>=</b></font> MulExp (ref r1) (ref r2)&lt;br><br/>
   e (Div addr r1 r2) <font color="#a52a2a"><b>=</b></font> DivExp (ref r1) (ref r2)&lt;br><br/>
   e (If cmdop cmdr addr r1 r2) <font color="#a52a2a"><b>=</b></font> IfExp cmdop (ref cmdr) (ref r1) (ref r2)&lt;br><br/>
   e (Input addr r1) <font color="#a52a2a"><b>=</b></font> ReadPortExp r1&lt;br><br/>
   e (Sqrt addr r1) <font color="#a52a2a"><b>=</b></font> SqrtExp (ref r1)&lt;br><br/>
   e (Copy addr r1) <font color="#a52a2a"><b>=</b></font> ref r1&lt;br><br/>
   e x <font color="#a52a2a"><b>=</b></font> trace (show x) <font color="#a52a2a"><b>$</b></font> undefined&lt;br><br/>
</code></blockquote>Op копирования (Copy) просто означает взять результат по оригинальному адресу. Команды Add/Sub/Mul/Div — дословные преобразования из плоских в древовидные. Input преобразовывается в чтение из порта. Чтение из временных переменных или из постоянных переменных конвертируется выше, в ref.<br/>
<br/>
Следом пишем генерацию<br/>
<blockquote><code>   retval <font color="#a52a2a"><b>=</b></font> <font color="#ff00ff">"module Vm where</font><font color="#6a5acd">\n</font><font color="#ff00ff">data VMState = VMState { "</font> <font color="#a52a2a"><b>++</b></font>&lt;br><br/>
(intercalate <font color="#ff00ff">","</font> <font color="#a52a2a"><b>$</b></font> &lt;br><br/>
map ((<font color="#ff00ff">"m"</font><font color="#a52a2a"><b>++</b></font>)<font color="#a52a2a"><b>.</b></font>show) persistents <font color="#a52a2a"><b>++</b></font>&lt;br><br/>
map ((<font color="#ff00ff">"o"</font><font color="#a52a2a"><b>++</b></font>)<font color="#a52a2a"><b>.</b></font>show) outports&lt;br><br/>
    ) <font color="#a52a2a"><b>++</b></font> <font color="#ff00ff">"::Double } </font><font color="#6a5acd">\n</font><font color="#ff00ff">"</font><font color="#a52a2a"><b>++</b></font>&lt;br><br/>
</code></blockquote><br/>
Это сгенерировалась часть с описанием самой структуры. Тут, очевидно, (++) — оператор склеивания списков (строк), intercalate — это склеивание нескольких списков, перемежая их указанным (читаем: вставляем разделяющую запятую), а в структуру мы включим все персистентные поля с префиксом m (memory) и все выходные порты с префиксом o — output ports. В конце дадим им тип Double и перевод строки не забудем.<br/>
<br/>
Можно дать им не тип Double, а тип !Double, тогда это будет структура не с ленивыми полями, а с неленивыми. Исследование показывает (см предыдущий пост), что при вычислении всех выходных портов разница по скорости составляет больше 20 раз, с ленивыми, понятно, медленнее. Ну, дело читателя подставить или не подставить strictness annotation (воскл знак). Почему я сказал «всех выходных портов»? Потому что с ленивыми вычислениями можно получить значение этой структуры после N-й итерации, и спросить только один требуемый порт, например. Начнет разворачиваться большой фронт работ, и после некоторой паузы придет вычисленное значение (например, когда мы напишем <br/>
<br/>
<code>putStrLn $ "o10=" ++ (show $ o10 vmlast)<br/>
</code><br/>
<br/>
то произойдет следующее: на консоли напишется «o10=», а потом будет пауза, а потом выведется значение. Если следом написать снова тот же putStrLn, то задержки уже не будет, т.к. значение вычислено. Если спросить потом написать o11, то задержка будет снова, но, вероятно, не такая большая, так как скорее всего o10 и o11 имеют какую-то общую часть вычислений, которая целиком уже посчиталась для o10, и для o11 считаться уже не будет. <br/>
<br/>
<blockquote><code>       <font color="#ff00ff">"initState = VMState {"</font><font color="#a52a2a"><b>++</b></font>&lt;br><br/>
(intercalate <font color="#ff00ff">","</font> <font color="#a52a2a"><b>$</b></font> &lt;br><br/>
map (<font color="#a52a2a"><b>\</b></font>a <font color="#a52a2a"><b>-></b></font> <font color="#ff00ff">"m"</font><font color="#a52a2a"><b>++</b></font>(show a) <font color="#a52a2a"><b>++</b></font><font color="#ff00ff">"="</font><font color="#a52a2a"><b>++</b></font>(show <font color="#a52a2a"><b>$</b></font> dta <font color="#a52a2a"><b>!!</b></font> (recast a))) persistents <font color="#a52a2a"><b>++</b></font>&lt;br><br/>
map ((<font color="#a52a2a"><b>++</b></font><font color="#ff00ff">"=O"</font>)<font color="#a52a2a"><b>.</b></font>(<font color="#ff00ff">"o"</font><font color="#a52a2a"><b>++</b></font>)<font color="#a52a2a"><b>.</b></font>show) outports&lt;br><br/>
    )  <font color="#a52a2a"><b>++</b></font><font color="#ff00ff">"} </font><font color="#6a5acd">\n</font><font color="#ff00ff">"</font><font color="#a52a2a"><b>++</b></font>&lt;br><br/>
</code></blockquote>Здесь сгенерировалась функция создания первоначального значения состояния черного ящика. Вся память инициализируется значениями из бинарника, которые лежали в нужном месте (dta). Все выходные порты инициализируются нулями. Хаскель требует обязательной инициализации структур.<br/>
<br/>
<blockquote><code><font color="#ff00ff">"nextState x ("</font><font color="#a52a2a"><b>++</b></font>(intercalate <font color="#ff00ff">","</font> <font color="#a52a2a"><b>$</b></font> map ((<font color="#ff00ff">"i"</font><font color="#a52a2a"><b>++</b></font>)<font color="#a52a2a"><b>.</b></font>show) inports)<font color="#a52a2a"><b>++</b></font><font color="#ff00ff">")=</font><font color="#6a5acd">\n</font><font color="#ff00ff"> let</font><font color="#6a5acd">\n</font><font color="#ff00ff">"</font><font color="#a52a2a"><b>++</b></font>&lt;br><br/>
cmap (<font color="#a52a2a"><b>\</b></font>a<font color="#a52a2a"><b>-></b></font><font color="#ff00ff">"    t"</font><font color="#a52a2a"><b>++</b></font>show a<font color="#a52a2a"><b>++</b></font><font color="#ff00ff">"=("</font><font color="#a52a2a"><b>++</b></font>(ast2haskell <font color="#ff00ff">"x"</font> <font color="#a52a2a"><b>$</b></font> geneval a)<font color="#a52a2a"><b>++</b></font><font color="#ff00ff">") :: Double</font><font color="#6a5acd">\n</font><font color="#ff00ff">"</font>) lets  <font color="#a52a2a"><b>++</b></font>&lt;br><br/>
<font color="#ff00ff">" in x {</font><font color="#6a5acd">\n</font><font color="#ff00ff">"</font><font color="#a52a2a"><b>++</b></font> &lt;br><br/>
  intercalate <font color="#ff00ff">",</font><font color="#6a5acd">\n</font><font color="#ff00ff">"</font> (&lt;br><br/>
map (<font color="#a52a2a"><b>\</b></font>a<font color="#a52a2a"><b>-></b></font><font color="#ff00ff">"    m"</font><font color="#a52a2a"><b>++</b></font>show a<font color="#a52a2a"><b>++</b></font><font color="#ff00ff">"="</font><font color="#a52a2a"><b>++</b></font>(ast2haskell <font color="#ff00ff">"x"</font> <font color="#a52a2a"><b>$</b></font> geneval a)) persistents <font color="#a52a2a"><b>++</b></font>&lt;br><br/>
map (<font color="#a52a2a"><b>\</b></font>a<font color="#a52a2a"><b>-></b></font><font color="#ff00ff">"    o"</font><font color="#a52a2a"><b>++</b></font>show a<font color="#a52a2a"><b>++</b></font><font color="#ff00ff">"="</font><font color="#a52a2a"><b>++</b></font>(ast2haskell <font color="#ff00ff">"x"</font> <font color="#a52a2a"><b>$</b></font> geneval <font color="#a52a2a"><b>$</b></font> head <font color="#a52a2a"><b>$</b></font> outputs a)) outports )&lt;br><br/>
<font color="#a52a2a"><b>++</b></font><font color="#ff00ff">"}</font><font color="#6a5acd">\n</font><font color="#ff00ff">"</font>;&lt;br><br/>
</code></blockquote>Тут генерируется самая объемная часть. Для начала, формируется кортеж входных параметров в виде, подобном этому: (i10,i11,i60000), затем идет «let», в которую вписываются все временные (неперманентные) переменные, с префиксом «t». Затем идет формирование новой структуры, в которой прописываются выражения для каждого ее члена: x {m20=expr1,m25=expr2...,o10=exprN}. Выражения в инциализациях t и m ссылаются на «tNN», «iNN» и «mNN x» — последнее означает значение памяти из предыдущей итерации.<br/>
<br/>
<blockquote><code> in retval -- вернули строку с целой хаскельской программой.<br/>
</code></blockquote><br/>
<br/>
<a href="http://san13.habrahabr.ru/blog/70185/">Окончание следует</a></div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bicfpc%5D" class="tm-article-body__tags-item-link">icfpc</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bhaskell%5D" class="tm-article-body__tags-item-link">haskell</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/closet/" class="tm-article-body__tags-item-link">
                  Чулан
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 15: ↑14 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 15: ↑14 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+13</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    3
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/70179/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      0
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/San13/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><svg class="tm-svg-img tm-image-placeholder tm-image-placeholder_lilac"><!----> <use xlink:href="/img/megazord-v24.cee85629.svg#placeholder-user"></use></svg></div></a> <div class="tm-user-card__meta"><div title=" 100 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    72
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><span class="tm-user-card__name">Я робот</span> <a href="/ru/users/San13/" class="tm-user-card__nickname">
          @San13
        </a> <!----></div> <p class="tm-user-card__short-info">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/70179/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментировать 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-08-25T16:26:36.000Z" title="2021-08-25, 19:26">25  августа   в 19:26</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/skbkontur/blog/574620/" class="tm-article-title__link"><span>Как мы поучаствовали в ICFPC 2021 и что из этого вышло</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 13: ↑13 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 13: ↑13 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+13</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">931</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    5
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/skbkontur/blog/574620/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      1
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-06-18T15:01:42.000Z" title="2021-06-18, 18:01">18  июня   в 18:01</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/typeable/blog/563550/" class="tm-article-title__link"><span>Создаем веб-приложение на Haskell с использованием Reflex. Часть 4</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 8: ↑8 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 8: ↑8 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+8</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    25
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/typeable/blog/563550/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      0
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2009-09-20T21:37:24.000Z" title="2009-09-21, 01:37">21  сентября  2009 в 01:37</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/68995/" class="tm-article-title__link"><span>Часть 1/3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 40: ↑34 и ↓6</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 40: ↑34 и ↓6" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+28</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.1K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    15
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/68995/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      4
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T09:00:04.000Z" title="2021-09-27, 12:00">вчера в 12:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580060/" class="tm-article-title__link"><span>Арракис, который мы заслужили</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 141: ↑136 и ↓5</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 141: ↑136 и ↓5" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+131</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">20K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    37
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580060/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      107
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T13:03:14.000Z" title="2021-09-27, 16:03">вчера в 16:03</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580124/" class="tm-article-title__link"><span>Электролюминесцентные индикаторы из прошлого</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 68: ↑68 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 68: ↑68 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+68</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.5K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    37
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580124/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      11
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T16:41:21.000Z" title="2021-09-27, 19:41">вчера в 19:41</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/lamptest/blog/580228/" class="tm-article-title__link"><span>Идеальная светодиодная лампа за 21 рубль</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 66: ↑64 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 66: ↑64 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+62</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">7.8K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    33
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/lamptest/blog/580228/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      24
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T21:49:14.000Z" title="2021-09-27, 00:49">вчера в 00:49</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580092/" class="tm-article-title__link"><span>30 сентября: Let's Encrypt и конец срока действия IdenTrust DST Root CA X3</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 48: ↑48 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 48: ↑48 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+48</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">19K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    59
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580092/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      93
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T12:53:02.000Z" title="2021-09-27, 15:53">вчера в 15:53</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580210/" class="tm-article-title__link"><span>PHP Дайджест № 212 (13 – 27 сентября 2021)</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 37: ↑37 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 37: ↑37 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+37</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.3K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    10
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580210/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      1
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="70179" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/70179/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/70179/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"70179":{"id":"70179","timePublished":"2009-09-20T21:38:01+00:00","isCorporative":false,"lang":"ru","titleHtml":"Часть 2\u002F3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями","leadData":{"textHtml":"\u003Ca href=\"http:\u002F\u002Fsan13.habrahabr.ru\u002Fblog\u002F68995\u002F\"\u003EНачало здесь.\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003EreadMyFile&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&nbsp;withBinaryFile&nbsp;\u003Cfont color=\"#ff00ff\"\u003E&quot;bin4.obf&quot;\u003C\u002Ffont\u003E&nbsp;ReadMode&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eh&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-&gt;\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Edo\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br&gt;\u003Cbr\u002F\u003E\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;len&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&nbsp;hFileSize&nbsp;h&lt;br&gt;\u003Cbr\u002F\u003E\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&nbsp;mallocBytes&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&nbsp;fromInteger&nbsp;len&lt;br&gt;\u003Cbr\u002F\u003E\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hGetBuf&nbsp;h&nbsp;buf&nbsp;\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&nbsp;fromInteger&nbsp;len&lt;br&gt;\u003Cbr\u002F\u003E\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(len,&nbsp;buf)&lt;br&gt;\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EЭто императивный кусок, потому что с файлами так в основном и работают. withBinaryFile открывает файл, выполняет указанную ей «пользовательскую» функцию, передав ей handle, и закрывает файл, и возвращает то, что вернула ей пользовательская функция. Вот, после знака $ мы описали «пользовательскую» функцию с одним параметром h (от handle). Эта функция получает размер файла, аллоцирует буфер, читает в буфер и возвращает сам буфер и его длину (в байтах). Заметим, что «пользовательская функция» здесь не имеет имени и начинается так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":72,"votesCount":100},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"50634","alias":"San13","fullname":"Я робот","avatarUrl":null,"speciality":null},"statistics":{"commentsCount":0,"favoritesCount":3,"readingCount":257,"score":13,"votesCount":15},"hubs":[{"relatedData":null,"id":"19259","alias":"closet","type":"collective","title":"Чулан","titleHtml":"Чулан","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Ca href=\"http:\u002F\u002Fsan13.habrahabr.ru\u002Fblog\u002F68995\u002F\"\u003EНачало здесь.\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003EreadMyFile \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E withBinaryFile \u003Cfont color=\"#ff00ff\"\u003E\"bin4.obf\"\u003C\u002Ffont\u003E ReadMode \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eh \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Edo\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n        len \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E hFileSize h&lt;br\u003E\u003Cbr\u002F\u003E\r\n        buf \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E mallocBytes \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E fromInteger len&lt;br\u003E\u003Cbr\u002F\u003E\r\n        hGetBuf h buf \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E fromInteger len&lt;br\u003E\u003Cbr\u002F\u003E\r\n        return (len, buf)&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EЭто императивный кусок, потому что с файлами так в основном и работают. withBinaryFile открывает файл, выполняет указанную ей «пользовательскую» функцию, передав ей handle, и закрывает файл, и возвращает то, что вернула ей пользовательская функция. Вот, после знака $ мы описали «пользовательскую» функцию с одним параметром h (от handle). Эта функция получает размер файла, аллоцирует буфер, читает в буфер и возвращает сам буфер и его длину (в байтах). Заметим, что «пользовательская функция» здесь не имеет имени и начинается так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E\\h -\u003E function_body -- это такой синтаксис безымянных функций с одним параметром\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nДалее функция получения инструкции и слова данных из буфера. Сюда передается текущий указатель на буфер (уже сдвинутый на нужное число байтов), и передается индекс инструкции. Из спецификации помним про четный-нечетный индекс, и что опкод и слово данных лежат то так то эдак. То есть инструкция начинается то с нулевого байта, то с восьмого, а слово данных (плавающее), соответственно, то с четвертого, то с нулевого.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003Einstruction \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E Ptr a \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E Int \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E IO (Word32,Double)&lt;br\u003E\u003Cbr\u002F\u003E\r\ninstruction ptr i \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Edo\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Elet\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (iaddr,daddr) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Eif\u003C\u002Fb\u003E\u003C\u002Ffont\u003E i \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E`mod`\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\u002F=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003EO\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Ethen\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (\u003Cfont color=\"#ff00ff\"\u003EO\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E4\u003C\u002Ffont\u003E) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Eelse\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (\u003Cfont color=\"#ff00ff\"\u003E8\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003EO\u003C\u002Ffont\u003E)  \u003Cfont color=\"#0000ff\"\u003E-- смещения instruction\u002Fdata\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n        instr \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E peek (plusPtr ptr iaddr) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E IO Word32  \u003Cfont color=\"#0000ff\"\u003E-- выборка инструкции\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n        dta \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E peek (plusPtr ptr daddr) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E IO Double                  \u003Cfont color=\"#0000ff\"\u003E-- выборка данных\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n        return (instr, dta)&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EЗаметим, что операция «неравно» звучит по-математически: \"\u002F=\".\u003Cbr\u002F\u003E\r\nТеперь пройдемся «циклом» по всему буферу, и вернем список пар (инструкция, данное):\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003East \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E mapM (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ei \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E instruction (plusPtr buf \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E i\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E*\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E12\u003C\u002Ffont\u003E) i) [\u003Cfont color=\"#ff00ff\"\u003EO\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003Enframes\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EТут происходит множество вещей. Во-первых, функция map и ей подобные (в частности, mapM) работают следующим образом: им на вход подается «пользовательская функция», преобразующая один элемент списка, а также ей передается сам список, а затем уж map применяет эту пользовательскую функцию к каждому элементу списка, и формирует новый список, из значений этой функции. Цикл у map где-то там внутри (не будем вдаваться в подробности).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Elet q = map (\\h -\u003E h * 2) [1,2,3,4,5] \u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nвернет [2,4,6,8,10], это классический пример. А у нас в рассматриваемой задаче на входе индексы (от нуля до конца), а на выходе список результатов вызова функции «instruction» с каждым индексом. Это иногда сложно понять сразу, но уже пора — python и ruby движутся в этом направлении, а с ними еще когорта языков (из тех, которые еще не там, понятное дело).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003East \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E mapM (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ei \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E instruction (plusPtr buf \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E i\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E*\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E12\u003C\u002Ffont\u003E) i) [\u003Cfont color=\"#ff00ff\"\u003EO\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003Enframes\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nВозвращаясь к нашей mapM, в переданной ей функции стоит вызов instruction, которому по-очереди скармливается 0, 1, итд, как второй аргумент, а как первый — передается буфер со смещениями по 12 байт дальше и дальше на каждую итерацию (1 опкод + 1 слово данных = 12 байт). plusPtr формирует новый указатель, отстоящий от указанного на указанное число байт.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот и весь цикл. В результате имеем список из «плоских» опкодов (плоских, потому что переведены один к одному по спецификации):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003E[(Add 0 77 66, 0.0), (Sub 1 0 102, 0.0), ...]\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nЧто означает: сложить ячейки 77 и 66, результат поместить в 0. Затем вычесть содержимое ячейки 102 из содержимого ячейки 0, результат поместить в 1… итд. Таков наш код. А вот данные: в нулевой ячейке 0.0, в первой 0.0, итд…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа этом месте можно остановиться и сгенерировать неидеальный код на любом языке, хоть на ассемблере (ведь операции из спецификации задачи близки к нему). Для этого необходимо дописать перевод в строку (на желаемом языке) каждой из плоских операций, и нагенерить в цикле код. Но это будет дословным исполнением, а оттого медленно и нудно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПочему медленно? Потому что будет присутствовать операция записи в память некоторых результатов, которые используются только 1 раз, и которые, по правде, лучше хранить где-то в регистрах или даже на стеке (этими деталями займется компилятор C\u002FHaskell\u002FJava или чего угодно, во что мы представим наш AST, а «чем угодно» у нас нынче служит хаскель). И если мы нагенерим запись в поле структуры по каждому чиху, то никакой компилятор нам регистров оттуда не наизобретает, а только одни записи в память.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПоэтому мы разберем, на какие же категории делятся наши ячейки «памяти».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n1) константы: только чтение, никогда запись\u003Cbr\u002F\u003E\r\n2) реальная память: чтение раньше записи, запись позже чтения\u003Cbr\u002F\u003E\r\n3) временные переменные: запись, затем несколько чтений\u003Cbr\u002F\u003E\r\n4) одноразовые переменные: запись, затем одно чтение. Пойдут в выражения со скобками.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧтобы понять, кто и что читает или пишет в ячейку памяти, нам необходимо описать поведение каждой инструкции в следующем разрезе: одни инструкции только читают память (вывод из памяти в порт), другие только пишут (из порта в пямать), большинство читают и пишут (арифметические, условные). \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОписываем поведение каждой инструкции — что она читает (потребляет).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003EconsumesData (Add _ r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r1,r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData (Sub _ r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r1,r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData (Mul _ r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r1,r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData (Div _ r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r1,r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData (Output r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData (If _ condr1 _ r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [condr1,r1,r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData (Sqrt _ r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData (Copy _ r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r2]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconsumesData _ \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E []&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EПодчеркивание в последнем случае означает «все остальные», а в первых случаях оно означает, что нам не интересно, что там в этом месте конструктора за аргумент. Как видно, здесь снова используется pattern matching.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nАналогично описываем поведение каждой операции касаемо того, что она пишет (производит):\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003EproducesData (Add addr _ _) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData (Sub addr _ _) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData (Mul addr _ _) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData (Div addr _ _ )\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData (If _ _ addr _ _) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData (Input addr _) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData (Copy addr _) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData (Sqrt addr _ )\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [addr]&lt;br\u003E\u003Cbr\u002F\u003E\r\nproducesData _ \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E []&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EОписываем, что каждая инструкция делает по отношению к портам — какие порты она читает.\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003EreadsPort (Input _ port) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [port]&lt;br\u003E\u003Cbr\u002F\u003E\r\nreadsPort _ \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E []&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EИ запись — какие порты она пишет:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003EwritesPort (Output r1 _) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [r1]&lt;br\u003E\u003Cbr\u002F\u003E\r\nwritesPort _ \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E []&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EДалее, для более короткой записи (причуда автора)\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003Ecmap \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E concatMap&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EЧто делает concatMap? Она делает то же что и map, только еще после этого делает concat. Concat «склеивает список на один уровень». Маленький пример:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Econcat [\u003Cfont color=\"#ff00ff\"\u003E\"hello\"\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E\"africa\"\u003C\u002Ffont\u003E] \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003E\"helloafrica\"\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\nconcat [[\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E4\u003C\u002Ffont\u003E],[\u003Cfont color=\"#ff00ff\"\u003E5\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E6\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E7\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E8\u003C\u002Ffont\u003E]] \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E4\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E5\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E6\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E7\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E8\u003C\u002Ffont\u003E]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconcat [[]] \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E []&lt;br\u003E\u003Cbr\u002F\u003E\r\n&lt;br\u003E\u003Cbr\u002F\u003E\r\nmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ei \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ei]) [\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E5\u003C\u002Ffont\u003E] \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [[\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E],[\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E],[\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E],[\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E4\u003C\u002Ffont\u003E],[\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E4\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E5\u003C\u002Ffont\u003E]]&lt;br\u003E\u003Cbr\u002F\u003E\r\nconcatMap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ei \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ei]) [\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E5\u003C\u002Ffont\u003E] \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E4\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E2\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E3\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E4\u003C\u002Ffont\u003E,\u003Cfont color=\"#ff00ff\"\u003E5\u003C\u002Ffont\u003E]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь самый страшный и большой кусок:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003EproduceCode ast dta \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003Elet\u003C\u002Fb\u003E\u003C\u002Ffont\u003E &lt;br\u003E\u003Cbr\u002F\u003E\r\n   inports \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E cmap readsPort ast  \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n   outports \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E cmap writesPort ast \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003Eприменить readsPort\u002FwritesPort к каждому опкоду, и сложить (concat) все списки в один список. Таким образом, мы получили списки входных и выходных портов вообще. \u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- consumes,produces,outputs to port [(memory\u002Fport ref,op address)] lookup tables\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n   consumes \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E cmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(d,a)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E consumesData d \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E`zip`\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [a,a\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E] ) (ast \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E`zip`\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003EO..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E]) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [(Int,Int)]&lt;br\u003E\u003Cbr\u002F\u003E\r\n   produces \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E cmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(d,a)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E producesData d \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E`zip`\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [a,a\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E] ) (ast \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E`zip`\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003EO..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E])&lt;br\u003E\u003Cbr\u002F\u003E\r\n   outputsPort  \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E cmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(d,a)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E writesPort d \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E`zip`\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [a,a\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E] ) (ast \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E`zip`\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003EO..\u003C\u002Fb\u003E\u003C\u002Ffont\u003E])&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003Eздесь мы построили несколько lookup tables (справочников?), к которым можно задавать следующие вопросы: \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПо какому адресу расположена инструкция, которая пишет в указанный адрес? (вообще, вопрос глупый, потому по определению задачи эта инструкция расположена по адресу N, но это я только сейчас сообразил)\u003Cbr\u002F\u003E\r\nПо каким адресам расположены инструкции, которые читают указанную ячейку?\u003Cbr\u002F\u003E\r\nПо какому адресу расположена инструкция, которая пишет в указанный порт?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ хаскеле примитивный справочник (lookup table) — это список пар (ключ, значение). У нас вот есть функции, которые ищут все значения по данному ключу и возвращают список. Вот они:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- op address that reads\u002Fwrites given mem\u002Fport\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n   reads m \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E map snd \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter ((m\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Efst) consumes \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n   writes m \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E map snd \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter ((m\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Efst) (produces) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n   outputs m \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E map snd \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter ((m\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Efst) outputsPort \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EОни возвращают просто список адресов, кто читает указанную ячейку памяти, или пишет, или пишет указанный порт. Как это работает:\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E     reads m \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E map snd \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter ((m\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Efst) consumes^M&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003Eозначает буквально: взять вторые элементы, отфильтровав сначала всех у кого первый элемент равен указанному m из справочника consumes (вычислен раньше). Как это работает?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nфункция filter на вход берет «пользовательскую функцию» ((m==).fst) и список. Пользовательской функции скармливается на вход каждый элемент из списка, и она возвращает True или False. Из этого списка, в зависимости от результата, в результирующий список попадают или не попадают элементы. Остается меньший список, стало быть. Этот список является вторым аргументом функции map (как было рассказано раньше про оператор '$'). Дальше map применяет функцию snd к каждому элементу списка и формирует список результатов.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНерассмотренными осталось несколько вещей. Функции snd\u002Ffst возвращают второй или первый элемент пары соответственно, то есть они занимаются декомпозицией пары, а если говорить простым языком, выкусывают второй или первый элемент:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Efst (1,2) = 1\u003Cbr\u002F\u003E\r\nsnd (1,2) = 2\u003Cbr\u002F\u003E\r\nfst (\"Hello\", 2+2) = \"Hello\"\u003Cbr\u002F\u003E\r\nsnd (\"Hello\", 2+2) = 4\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nИ теперь один из интересных моментов в хаскеле — композиция функций. Рассмотрим примерчик:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Ef x = sin (cos (sqrt (x))), его можно записать по-хаскельски короче:\u003Cbr\u002F\u003E\r\nf x = sin $ cos $ sqrt x\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nТеперь пошевелить мозгом и увидеть, что «x» всегда проходит через мясорубку функций: сначала sqrt, потом cos, потом через sin. Наверняка можно бы было построить график функции f x, а раз можно построить график, то наверняка последовательности применений этих трех функций соответствует какая-то одна единственная функция, которая дает тот же результат, только математики не дали ей еще названия!!! Да простят меня люди с формальным мышлением.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь, предположим, у нас есть функция на хаскеле, которая строит график любой переданной функции, например\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Eplot :: (Double -\u003E Double) -\u003E Double -\u003E Double -\u003E IO() (читаем IO () как void, а всё определение типа звучит как: функция plot берет на вход функцию от Double возвращающую Double, а также еще берет два аргумента Double (интервал на котором строить), и возвращает void)\u003Cbr\u002F\u003E\r\nplot sin 0 6.28 -- построить график функции sin на интервали от 0 до 6.28\u003Cbr\u002F\u003E\r\nplot cos 0 3.14 -- то же, на другом интервале, другой функцией.\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nТут мы видим, что функцию sin или cos мы передаем как таковую, аргумент в нее передавать будут в процессе постройки графика, те кто его строят. Как же нам передать целую мясорубку функций, которой не придумали имя, но мы знаем как оно складывается? \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВозникает насущная необходимость описать такую мясорубку. Следовательно:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Efun1 = sin -- это мясорубка из 1 функции\u003Cbr\u002F\u003E\r\nfun2 = sin . cos . sqrt -- это мясорубка из трех функций, а точка - это операция композиции функций\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nТеперь про неполное применение. Вот у нас есть функция, которая берет два аргумента, например возведение в степень:\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Epow 2 3 = 8 -- два в третьей степени\u003Cbr\u002F\u003E\r\nтеперь опишем функцию pow2:\u003Cbr\u002F\u003E\r\npow2 = pow 2\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nОказывается, мы передали всего один аргумент из двух требуемых, но нас никто не остановил и не поругал! Какой же тип у функции pow2? Очень просто, она хочет еще один аргумент Double, и добавит его, и вызовет функцию pow с этим аргументом, а двойка там уже стоит!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Epow2 4 = 16\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003EОказывается, нотация для описания хаскельских типов тоже не с потолка взята: следите за руками:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Epow :: Double -\u003E Double -\u003E Double -- берет double, и еще double, возвращает double\u003Cbr\u002F\u003E\r\npow2 :: Double -\u003E Double -- берет один double, возвращает double\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nа так как pow2 получилось указанием одного аргумента к функции pow, то мы можем заключить, что добавление одного аргумента к pow порождает новую функцию!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Epow :: Double -\u003E (Double -\u003E Double) -- вот я тут добавил скобок.\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\nСтало быть, можно как угодно справа добавлять скобок, а смысл будет тот же. Из этого также следует, что:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\npow 2 3 = (pow 2) 3, то есть вначале сгенерим функцию, а потом добавим в нее недостающий аргумент (применим функцию к тройке).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВернемся к нашим баранам.\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E     reads m \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E map snd \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter ((m\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Efst) consumes&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003Eв filter стоит функция: (m==). fst. Здесь мы наблюдаем точку (композиция) и частичное применение: m==. Вот это вот m== — это функция, которая получает на вход 1 аргумент, подставляет его справа от знака равно, и вуаля! Функция m== возвращает результат сравнения своего аргумента с m. Если m равно 5, то ((m==) 5) вернет True.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь читаем всё справа налево: у нас есть мясорубка, то что в нее входит, сначала скармливается функции fst (которая, как известно, из пары извлекает первый элемент), потом это значение скармливается m==, которая берет число, сравнивает его с m и возвращает Boolean. Таким образом, в мясорубку входит пара (a,b), а выходит Boolean, равно ли а вот этому m.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь нам надлежит выбрать все упоминания ячеек, которые пишутся или читаются, для того чтобы было от чего отталкиваться:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- all memory references (including temporaries etc - from plain program)\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n   alldata \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E  nub \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E sort \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E cmap consumesData ast \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (map recast \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E cmap producesData ast) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EЗдесь (читаем справа налево) «cmap producesDataAst ast» возвращает список всех записываемых ячеек в виде плоского списка их адресов, аналогично происходит с consumesData, потом оба списка просто склеиваются (++), потом сортируются, и потом из них удаляются дупликаты (nub). В принципе, nub не требуется отсортированный список, но я этого раньше не знал:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003Enub [1,2,1] = [1,2]\u003Cbr\u002F\u003E\r\nnub [2,1,2] = [2,1]\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- constants\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n            constants \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Em \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003EO\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (length \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E writes m))  alldata \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EA тут произошло следующее: мы выбрали из alldata все адреса, в которые никто никогда не пишет. А раз из них только читают, то это наверняка константы. Вот мы списочек и составили.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- all persistent (optimized memory)\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n            persistents \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Em \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (head \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E reads m) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (head \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E writes m)) (alldata \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E constants) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EА тут мы выбрали все переменные, которые должны сохраняться от раза к разу между итерациями. Для этого мы взяли alldata, вычли из него константы (операция \\\\ — разность списков), и нашли кто первый читает и кто первый пишет. Если читают раньше того места где пишут, значит полагают, что там что-то есть! Осталось с прошлого раза! Вот, таким образом и составили список тех мест, которые реально являются памятью нашего черного ящика, доступной для чтения-записи.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- temporaries which are reused parts of expressions\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n            lets \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Em \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&lt;\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (length \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E reads m))  (alldata \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E constants) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E persistents \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EТеперь мы из оставшихся (потому что вычли из alldata всё, что знаем до сих пор), нашли те ячейки, которые читаются больше одного раза. Так как это не перманентные данные (мы их исключили), то это наверняка временные переменные, которые сначала вычисляются, а потом несколько раз пользуются. Временные переменные используются в пределах одной итерации, а вне нее они не нужны.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- expressions to inline (variables that are used 1 time)\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n            onerefs \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E filter (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Em \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (length \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E reads m) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E&amp;&amp;\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (length \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E writes m) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E==\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003E1\u003C\u002Ffont\u003E) &lt;br\u003E\u003Cbr\u002F\u003E\r\n((alldata \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E constants) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003E persistents) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E [Int]&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EА тут мы вычислили переменные, которые один раз пишутся и потом 1 раз читаются. Для них мы не будем вообще ничего заводить, и из них сформируются выражения со скобками. Этот класс переменных понадобился авторам черного ящика, потому что у них такой низкоуровневый язык, а в нашем высокоуровневом результате они будут жить в регистрах процессора, но об этом позаботится компилятор без нашего ведома.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСейчас мы должны будем из плоских операций (в которых упоминаются только адреса которые читаются пишутся в процессе работы операции), перейти к древовидным опкодам, то есть к тем, которые у нас с суффиксом Exp — они содержат в себе ссылки на себе подобных, образуя дерево. Для этого мы опишем функцию, которая нам будет генерировать по адресу целый древовидный Op. Она будет рекурсивной. Потому что если мы даем ей адрес, по которому лежит константа, то делать особо много не надо. А если мы даем ей адрес, в который записывается результат сложений двух каких-то других ячеек, то нужно сгенерировать Op, который складывает два других Op-а, а уж они там могут быть константами, или вдруг там результатами умножений…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- geherates reference to the expression identified by given address,\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n   \u003Cfont color=\"#0000ff\"\u003E-- this excludes address where to store it, only value is obtained\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n   ref \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E::\u003C\u002Fb\u003E\u003C\u002Ffont\u003E DestAddr \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E Op&lt;br\u003E\u003Cbr\u002F\u003E\r\n   ref a &lt;br\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E|\u003C\u002Fb\u003E\u003C\u002Ffont\u003E elem a constants \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E Const (dta\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E!!\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ea)&lt;br\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E|\u003C\u002Fb\u003E\u003C\u002Ffont\u003E elem a onerefs \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E geneval a&lt;br\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E|\u003C\u002Fb\u003E\u003C\u002Ffont\u003E elem a lets \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E ReadVarExp a&lt;br\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E|\u003C\u002Fb\u003E\u003C\u002Ffont\u003E elem a persistents \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E ReadExp a&lt;br\u003E\u003Cbr\u002F\u003E\r\n        \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E|\u003C\u002Fb\u003E\u003C\u002Ffont\u003E otherwise \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E trace \u003Cfont color=\"#ff00ff\"\u003E\"oops1\"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E undefined&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EТут мы имеем функцию ref, в которой есть некоторые пред-условия, накладывающиеся на входной параметр, синтаксис таких условий — это вертикальная черта, потом условие, а потом знак равенства, а за ним — тело функции, выполяющееся в случае истинности условия. Это как бы большой if… elseif… elseif… else… endif. Последний else у нас описан через trace «oops» $ undefined — выведет ошибку (trace) и остановит программу (undefined).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСмотрим, если входной адрес принадлежит к константам, то генерируем доступ к константе (просто Op, обозначающий константу). Какую именно константу — определяет параметр конструктора Const — это просто значение памяти по указанному адресу. dta — это список, содержащий все ячейки памяти последовательно, а dfa!!a — это доступ к a-тому элементу списка.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли входной адрес принадлежит к onerefs (память 1 раз пишется, затем 1 раз читается), то нужно образовать просто узел дерева с двумя другими опами (операция со скобками). Вызывается geneval (описан ниже), который сгенерирует из простого Op-а (сложение двух ячеек памяти и помещение результата в третью) сложный (сложить два других Op-а, вернуть результат _вообще_)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nАналогично для чтения временных переменных (которые один раз пишутся, много читаются), и для чтения входных портов.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСама функция geneval описана далее, в ней используется pattern matching. Из полученного адреса мы выбираем плоский Op (из списка ast), и преобразуем его в древовидный. Любопытно, что эта функция вызывает ref, описанную выше, таким образом функции взаимно-рекурсивны.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   \u003Cfont color=\"#0000ff\"\u003E-- turns plain code in tree code, converting memory refs to ops via \"ref\"\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n            geneval a \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E e \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E ast \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E!!\u003C\u002Fb\u003E\u003C\u002Ffont\u003E a&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (Add addr r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E AddExp (ref r1) (ref r2)&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (Sub addr r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E SubExp (ref r1) (ref r2)&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (Mul addr r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E MulExp (ref r1) (ref r2)&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (Div addr r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E DivExp (ref r1) (ref r2)&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (If cmdop cmdr addr r1 r2) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E IfExp cmdop (ref cmdr) (ref r1) (ref r2)&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (Input addr r1) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E ReadPortExp r1&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (Sqrt addr r1) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E SqrtExp (ref r1)&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e (Copy addr r1) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E ref r1&lt;br\u003E\u003Cbr\u002F\u003E\r\n   e x \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E trace (show x) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E undefined&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EOp копирования (Copy) просто означает взять результат по оригинальному адресу. Команды Add\u002FSub\u002FMul\u002FDiv — дословные преобразования из плоских в древовидные. Input преобразовывается в чтение из порта. Чтение из временных переменных или из постоянных переменных конвертируется выше, в ref.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСледом пишем генерацию\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E   retval \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E=\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003E\"module Vm where\u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003Edata VMState = VMState { \"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n(intercalate \u003Cfont color=\"#ff00ff\"\u003E\",\"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E &lt;br\u003E\u003Cbr\u002F\u003E\r\nmap ((\u003Cfont color=\"#ff00ff\"\u003E\"m\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eshow) persistents \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\nmap ((\u003Cfont color=\"#ff00ff\"\u003E\"o\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eshow) outports&lt;br\u003E\u003Cbr\u002F\u003E\r\n    ) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003E\"::Double } \u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nЭто сгенерировалась часть с описанием самой структуры. Тут, очевидно, (++) — оператор склеивания списков (строк), intercalate — это склеивание нескольких списков, перемежая их указанным (читаем: вставляем разделяющую запятую), а в структуру мы включим все персистентные поля с префиксом m (memory) и все выходные порты с префиксом o — output ports. В конце дадим им тип Double и перевод строки не забудем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМожно дать им не тип Double, а тип !Double, тогда это будет структура не с ленивыми полями, а с неленивыми. Исследование показывает (см предыдущий пост), что при вычислении всех выходных портов разница по скорости составляет больше 20 раз, с ленивыми, понятно, медленнее. Ну, дело читателя подставить или не подставить strictness annotation (воскл знак). Почему я сказал «всех выходных портов»? Потому что с ленивыми вычислениями можно получить значение этой структуры после N-й итерации, и спросить только один требуемый порт, например. Начнет разворачиваться большой фронт работ, и после некоторой паузы придет вычисленное значение (например, когда мы напишем \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ccode\u003EputStrLn $ \"o10=\" ++ (show $ o10 vmlast)\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nто произойдет следующее: на консоли напишется «o10=», а потом будет пауза, а потом выведется значение. Если следом написать снова тот же putStrLn, то задержки уже не будет, т.к. значение вычислено. Если спросить потом написать o11, то задержка будет снова, но, вероятно, не такая большая, так как скорее всего o10 и o11 имеют какую-то общую часть вычислений, которая целиком уже посчиталась для o10, и для o11 считаться уже не будет. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E       \u003Cfont color=\"#ff00ff\"\u003E\"initState = VMState {\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n(intercalate \u003Cfont color=\"#ff00ff\"\u003E\",\"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E &lt;br\u003E\u003Cbr\u002F\u003E\r\nmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ea \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E \u003Cfont color=\"#ff00ff\"\u003E\"m\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(show a) \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"=\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(show \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E dta \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E!!\u003C\u002Fb\u003E\u003C\u002Ffont\u003E (recast a))) persistents \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\nmap ((\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"=O\"\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(\u003Cfont color=\"#ff00ff\"\u003E\"o\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eshow) outports&lt;br\u003E\u003Cbr\u002F\u003E\r\n    )  \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"} \u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EЗдесь сгенерировалась функция создания первоначального значения состояния черного ящика. Вся память инициализируется значениями из бинарника, которые лежали в нужном месте (dta). Все выходные порты инициализируются нулями. Хаскель требует обязательной инициализации структур.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E\u003Cfont color=\"#ff00ff\"\u003E\"nextState x (\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(intercalate \u003Cfont color=\"#ff00ff\"\u003E\",\"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E map ((\u003Cfont color=\"#ff00ff\"\u003E\"i\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E.\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eshow) inports)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\")=\u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E let\u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\ncmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ea\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"    t\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eshow a\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"=(\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(ast2haskell \u003Cfont color=\"#ff00ff\"\u003E\"x\"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E geneval a)\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\") :: Double\u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"\u003C\u002Ffont\u003E) lets  \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#ff00ff\"\u003E\" in x {\u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E &lt;br\u003E\u003Cbr\u002F\u003E\r\n  intercalate \u003Cfont color=\"#ff00ff\"\u003E\",\u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"\u003C\u002Ffont\u003E (&lt;br\u003E\u003Cbr\u002F\u003E\r\nmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ea\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"    m\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eshow a\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"=\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(ast2haskell \u003Cfont color=\"#ff00ff\"\u003E\"x\"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E geneval a)) persistents \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E&lt;br\u003E\u003Cbr\u002F\u003E\r\nmap (\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E\\\u003C\u002Fb\u003E\u003C\u002Ffont\u003Ea\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E-\u003E\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"    o\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003Eshow a\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"=\"\u003C\u002Ffont\u003E\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E(ast2haskell \u003Cfont color=\"#ff00ff\"\u003E\"x\"\u003C\u002Ffont\u003E \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E geneval \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E head \u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E$\u003C\u002Fb\u003E\u003C\u002Ffont\u003E outputs a)) outports )&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003Cfont color=\"#a52a2a\"\u003E\u003Cb\u003E++\u003C\u002Fb\u003E\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"}\u003C\u002Ffont\u003E\u003Cfont color=\"#6a5acd\"\u003E\\n\u003C\u002Ffont\u003E\u003Cfont color=\"#ff00ff\"\u003E\"\u003C\u002Ffont\u003E;&lt;br\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003EТут генерируется самая объемная часть. Для начала, формируется кортеж входных параметров в виде, подобном этому: (i10,i11,i60000), затем идет «let», в которую вписываются все временные (неперманентные) переменные, с префиксом «t». Затем идет формирование новой структуры, в которой прописываются выражения для каждого ее члена: x {m20=expr1,m25=expr2...,o10=exprN}. Выражения в инциализациях t и m ссылаются на «tNN», «iNN» и «mNN x» — последнее означает значение памяти из предыдущей итерации.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Ccode\u003E in retval -- вернули строку с целой хаскельской программой.\u003Cbr\u002F\u003E\r\n\u003C\u002Fcode\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca href=\"http:\u002F\u002Fsan13.habrahabr.ru\u002Fblog\u002F70185\u002F\"\u003EОкончание следует\u003C\u002Fa\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"icfpc"},{"titleHtml":"haskell"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F70179\u002F8ff827e30ce398ef16ddb94d20a83e2f\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F70179\u002F8ff827e30ce398ef16ddb94d20a83e2f\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F70179\\\u002F\"},\"headline\":\"Часть 2\\\u002F3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями\",\"datePublished\":\"2009-09-21T01:38:01+04:00\",\"dateModified\":\"2009-09-21T11:58:56+04:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Я робот\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Начало здесь.  Теперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию.   readMyFile&nbsp;=&nbsp;withBinaryFile&nbsp;&quot;bin4.obf&quot;&nbsp;ReadMode&nbsp;$&nbsp;\\\\h&nbsp;-&gt;&nbsp;do...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F70179\\\u002F#post-content-body\",\"about\":[\"h_closet\",\"f_popsci\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F70179\\\u002F8ff827e30ce398ef16ddb94d20a83e2f\\\u002F\"]}","metaDescription":"Начало здесь.\r\n\r\nТеперь разбираемся как мы будем декодировать весь файл, а не только одну инструкцию....","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"572164":{"id":"572164","timePublished":"2021-09-27T11:37:23+00:00","isCorporative":false,"lang":"ru","titleHtml":"Первые шаги в ОТО: прецессия орбиты Меркурия","editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"1832999","alias":"Yermack","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F690\u002F140\u002F823\u002F690140823f555d03574a59d46f648d24.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":2,"favoritesCount":23,"readingCount":2806,"score":17,"votesCount":17},"hubs":[{"relatedData":null,"id":"18840","alias":"julia","type":"collective","title":"Julia","titleHtml":"Julia","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21968","alias":"physics","type":"collective","title":"Физика","titleHtml":"Физика","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКогда речь заходит о теории относительности, частенько на ровном месте разрастаются споры, которые были занесены в почву непонимания и обильно удобрены мифами, недосказанностью и недостаточной математической подготовкой. Даже на лекциях от некоторых профессоров можно услышать, что детище гения Эйнштейна не имеет практической пользы, а на робкие попытки пролепетать что-то про спутниковые системы навигации они пренебрежительно отмахиваются, дескать, там все сложно и двояко. \u003C\u002Fp\u003E\u003Cp\u003EТак что совершенно естественно желание попробовать провести некоторые расчеты самолично, потрогать формулы, покрутить параметры, чтобы постепенно заложить интуицию в столь горячей теме.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"прецессия"},{"titleHtml":"меркурий"},{"titleHtml":"теория относительности"},{"titleHtml":"уравнения эйнштейна"},{"titleHtml":"метрики"},{"titleHtml":"спасибо scihub"},{"titleHtml":"спасибо mathpix"},{"titleHtml":"астрология_точная_наука"}]},"579772":{"id":"579772","timePublished":"2021-09-27T05:32:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сливы процветают. Эксперт-«параноик» Майкл Баззель о защите личных данных","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Michael Bazzell","originalUrl":"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F"}}],"author":{"id":"2297567","alias":"SearchInform_team","fullname":null,"avatarUrl":"","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":7,"readingCount":2343,"score":9,"votesCount":9},"hubs":[{"relatedData":null,"id":"22418","alias":"searchinform","type":"corporative","title":"Блог компании SearchInform","titleHtml":"Блог компании SearchInform","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНаш очередной пост из серии «интересное на иностранном языке» – рассказ Майкла Баззеля о том, как сберечь свои персональные данные от утечек. Майкл – знаковая фигура в сфере OSINT, работал в правительстве США и ФБР, его приглашали в качестве технического эксперта в сериал «Мистер Робот», который считают достойным с точки зрения достоверности. В личной жизни эксперт придерживается настолько жестких правил в отношении информационной гигиены, что некоторые считают его «неадекватом». Так ли это – может быть несколько мнений. \u003C\u002Fp\u003E\u003Cp\u003EОдин из факторов, который убеждает в правильном подходе Майкла, – что риски обнаружить свои данные в интернете стали существенно выше, потому что шифровальщики без разбору сливают в сеть все, до чего дотягиваются при атаках на бизнес. Приводим перевод \u003Ca href=\"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F\"\u003Eпоста Майкла Баззеля\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EАтакуют корпорации, а страдают люди\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EБольшинство людей не задумываются о том, как их касается проблема распространения вирусов-шифровальщиков. Логика такова: речь идет о проблемах компаний, это они вынуждены платить выкуп. При чем тут, казалось бы, обычные люди?! \u003C\u002Fp\u003E\u003Cp\u003EА при том, что преступники сменили тактику: сейчас они не просто шифруют данные, но и скачивают их, выкладывают в открытый доступ, если компании не платят им выкуп. Теперь давайте подумаем, что в этих слитых базах? Множество данных о сотрудниках, клиентах, контрагентах, с которыми компания-жертва работает.\u003C\u002Fp\u003E\u003Cp\u003EХочу сразу уточнить: я это пишу не потому что выступаю за уплату выкупа. Я за то, чтобы сопротивляться избыточному сбору данных там, где это не обязательно. Мы халатно относимся к своим ПДн, раздавая их по первому требованию.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"персональные данные"},{"titleHtml":"пдн"},{"titleHtml":"сёрчинформ"},{"titleHtml":"Майкл Баззел"},{"titleHtml":"утечки информации"}]},"579854":{"id":"579854","timePublished":"2021-09-27T06:03:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Видишь уязвимости? А они есть! Наше исследование популярных CMS-систем","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2684283","alias":"Solar_Pentest","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":8,"favoritesCount":22,"readingCount":3830,"score":27,"votesCount":29},"hubs":[{"relatedData":null,"id":"20826","alias":"solarsecurity","type":"corporative","title":"Блог компании Ростелеком-Солар","titleHtml":"Блог компании Ростелеком-Солар","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛьвиная доля всех работ по анализу защищенности внешнего периметра – это тестирование веб-приложений. Здесь могут быть как корпоративные решения, так и «домашние» разработки на базе различных публичных систем управления контентом (CMS). Мы всегда проводим глубокий анализ подобных решений на тестовых стендах и зачастую находим уязвимости нулевого дня. Собственно, из опыта таких проектов и родилась идея собрать исследовательскую команду и провести глубокий анализ популярных CMS-систем и различных плагинов для них. В этом посте мы поделимся результатами нашего исследования, а также продемонстрируем примеры уязвимого кода наиболее интересных, на наш взгляд, уязвимостей и примеры их эксплуатации. Конечно все эти уязвимости уже исправлены и описываются здесь с разрешения владельцев систем.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","buttonTextHtml":"Не всё то в безопасности, что с Bug Bounty","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"cms"},{"titleHtml":"уязвимости"},{"titleHtml":"уязвимости и их эксплуатация"},{"titleHtml":"уязвимость нулевого дня"}]},"580008":{"id":"580008","timePublished":"2021-09-27T06:30:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"Летний Магнитогорск","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2614609","alias":"city_scraper","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8f8\u002Fd6c\u002F328\u002F8f8d6c328ec3a513103b6757c2c21610.png","speciality":"Пользователь"},"statistics":{"commentsCount":6,"favoritesCount":3,"readingCount":3681,"score":14,"votesCount":20},"hubs":[{"relatedData":null,"id":"22012","alias":"Ecology","type":"collective","title":"Экология","titleHtml":"Экология","isProfiled":false},{"relatedData":null,"id":"22024","alias":"urban","type":"collective","title":"Урбанизм","titleHtml":"Урбанизм","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EМагнитогорск Челябинской области – один из крупнейших мировых центров чёрной металлургии. В России это шестой из крупнейших городов, которые не являются центрами субъектов страны. \u003C\u002Fp\u003E\u003Cp\u003EСовсем недавно город был одним из наиболее неблагополучных с точки зрения загрязнения атмосферного воздуха, но в 2021 году был зафиксирован «повышенный» уровень – то есть не «высокий» или «очень высокий», как раньше. \u003C\u002Fp\u003E\u003Cp\u003EКак этот город выглядит летом? Где и как его жители могут проводить время?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Магнитогорск"},{"titleHtml":"промышленность"},{"titleHtml":"промышленные города"},{"titleHtml":"урбанизм\u002Fурбания"},{"titleHtml":"урбанистика"},{"titleHtml":"города России"},{"titleHtml":"города"}]},"580050":{"id":"580050","timePublished":"2021-09-27T10:23:25+00:00","isCorporative":false,"lang":"ru","titleHtml":"Один человек ответил на 85+ тысяч вопросов на Stack Overflow (24,1 ответа в день)","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1585037","alias":"sahsAGU","fullname":"Александр Гуреев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F43c\u002F6c7\u002F0ab\u002F43c6c70ab024d45474e6abe8db797573.jpg","speciality":"Автор"},"statistics":{"commentsCount":34,"favoritesCount":9,"readingCount":10560,"score":11,"votesCount":17},"hubs":[{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"306","alias":"mysql","type":"collective","title":"MySQL","titleHtml":"MySQL","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"594","alias":"sql","type":"collective","title":"SQL","titleHtml":"SQL","isProfiled":true},{"relatedData":null,"id":"7152","alias":"data_mining","type":"collective","title":"Data Mining","titleHtml":"Data Mining","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cstrong\u003EВ среднем 24,1 ответа в день (если все 365 дней в году считать рабочими) на протяжении почти 10 лет.\u003C\u002Fstrong\u003E \u003C\u002Fp\u003E\u003Cp\u003EНесколько дней назад на некоторых англоязычных ресурсах началось обсуждение одного очень необычного пользователя Stack Overflow. Его зовут Гордон Линофф (Gordon Linoff), он из Нью-Йорка, и за 9 лет и 8 месяцев своего присутствия на платформе он дал 85,201 ответов на различные вопросы, в основном связанные с SQL и дата-майнингом (цифра актуальна на 27.09.2021). \u003C\u002Fp\u003E\u003Cp\u003EЧто это за маг?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F396\u002F5ac\u002Fef4\u002F3965acef48ae14917c514fa091f60d1a.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F396\u002F5ac\u002Fef4\u002F3965acef48ae14917c514fa091f60d1a.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"sql"},{"titleHtml":"mysql"},{"titleHtml":"stackoverflow"},{"titleHtml":"базы данных"},{"titleHtml":"дата майнинг"},{"titleHtml":"data mining"}]},"580060":{"id":"580060","timePublished":"2021-09-27T09:00:04+00:00","isCorporative":true,"lang":"ru","titleHtml":"Арракис, который мы заслужили","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"238277","alias":"Zelenyikot","fullname":"Виталий Егоров","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F22b\u002F2d7\u002F7a5\u002F22b2d77a57b687aae24784a3e53089c9.jpg","speciality":"Популяризатор космонавтики"},"statistics":{"commentsCount":107,"favoritesCount":37,"readingCount":19895,"score":131,"votesCount":141},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false},{"relatedData":null,"id":"21984","alias":"sci-fi","type":"collective","title":"Научная фантастика","titleHtml":"Научная фантастика","isProfiled":false},{"relatedData":null,"id":"22014","alias":"futurenow","type":"collective","title":"Будущее здесь","titleHtml":"Будущее здесь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F580060\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fk0\u002Fds\u002Fy5\u002Fk0dsy5npxclyjdytiroqga7-leu.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nВо вселенной писателя-фантаста Фрэнка Герберта, Дюна, она же Арракис &mdash; это пустынная и маловодная планета с двумя лунами. По сюжету, она находится за пределами Солнечной системы, но если мы захотим поискать ближайшую схожую параллель,&nbsp;то больше всего подходит планета Марс. Предлагаю воспользоваться возможностями, которые даёт современная космонавтика, и совершить воображаемую прогулку на нашу Дюну.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Марс"},{"titleHtml":"Дюна"},{"titleHtml":"MRO"},{"titleHtml":"Curiosity"},{"titleHtml":"марсоход"},{"titleHtml":"ruvds_статьи"}]},"580088":{"id":"580088","timePublished":"2021-09-26T21:17:27+00:00","isCorporative":false,"lang":"ru","titleHtml":"Запуск X-приложения в chroot на примере POSE (или «QEMU не нужен»)","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1481597","alias":"edo1h","fullname":null,"avatarUrl":"","speciality":"немного программист, немного админ"},"statistics":{"commentsCount":5,"favoritesCount":15,"readingCount":1270,"score":17,"votesCount":17},"hubs":[{"relatedData":null,"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true},{"relatedData":null,"id":"7289","alias":"nix","type":"collective","title":"*nix","titleHtml":"*nix","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭта мини-статья родилась как ответ на статью \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F579296\" rel=\"noopener noreferrer nofollow\"\u003EУпрощаем эмуляцию X86 с помощью Live CD\u003C\u002Fa\u003E, в которой для запуска старых 32-битных приложений на 64-битных дистрибутивах Linux предлагалось использовать QEMU + Live CD — по моему мнению «из пушки по воробьям». Опишу своё решение на \u003Ccode\u003Echroot\u003C\u002Fcode\u003E + \u003Ccode\u003Edebootstrap\u003C\u002Fcode\u003E. \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"chroot"},{"titleHtml":"debootstrap"},{"titleHtml":"xwindow"}]},"580090":{"id":"580090","timePublished":"2021-09-26T21:19:11+00:00","isCorporative":false,"lang":"ru","titleHtml":"Сравнение подходов к реализации распределенных транзакций для микросервисов","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null},{"type":"translation","data":{"originalAuthorName":"Bilgin Ibryam","originalUrl":"https:\u002F\u002Fdevelopers.redhat.com\u002Farticles\u002F2021\u002F09\u002F21\u002Fdistributed-transaction-patterns-microservices-compared"}}],"author":{"id":"194270","alias":"sprosin","fullname":"Sergey Prosin","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd67\u002F5d8\u002F1d6\u002Fd675d81d6fe5bf69493735cef4910eb5.jpg","speciality":"Веду команды к релизам, пишу статьи, выступаю."},"statistics":{"commentsCount":6,"favoritesCount":102,"readingCount":5904,"score":20,"votesCount":20},"hubs":[{"relatedData":null,"id":"7504","alias":"refactoring","type":"collective","title":"Проектирование и рефакторинг","titleHtml":"Проектирование и рефакторинг","isProfiled":true},{"relatedData":null,"id":"21482","alias":"distributed_systems","type":"collective","title":"Распределённые системы","titleHtml":"Распределённые системы","isProfiled":true},{"relatedData":null,"id":"22115","alias":"microservices","type":"collective","title":"Микросервисы","titleHtml":"Микросервисы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКак архитектор-консультант в Red Hat, я имел возможность поработать над множеством проектов для наших клиентов. У каждого из них есть свои особенности, которые, однако, имеют некоторые общие черты. Большинство клиентов хотят знать, как скоординировать запись в несколько систем одновременно. Ответ на этот вопрос обычно включает подробное объяснение двойной записи, распределенных транзакций, современных альтернатив, а также возможных сценариев сбоев и недостатков каждого подхода. Как правило, именно в этот момент заказчик понимает, что разделение монолитного приложения на микросервисы - долгий и сложный путь, обычно требующий компромиссов.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc4\u002F35d\u002Fff3\u002Fbc435dff35d09143dacf29bbc1e470a7.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc4\u002F35d\u002Fff3\u002Fbc435dff35d09143dacf29bbc1e470a7.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"распределенные системы"},{"titleHtml":"микросервисы"},{"titleHtml":"транзакции"},{"titleHtml":"распределенные транзакции"},{"titleHtml":"оркестрация"},{"titleHtml":"оркестрация микросервисов"},{"titleHtml":"хореография"},{"titleHtml":"конвейеры"}]},"580092":{"id":"580092","timePublished":"2021-09-26T21:49:14+00:00","isCorporative":false,"lang":"ru","titleHtml":"30 сентября: Let's Encrypt и конец срока действия IdenTrust DST Root CA X3","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"805873","alias":"rantal","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":93,"favoritesCount":59,"readingCount":19413,"score":48,"votesCount":48},"hubs":[{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E30 сентября 2021 14:01:15  GMT оканчивается срок действия корневого сертификата IdenTrust DST Root CA X3.\u003C\u002Fp\u003E\u003Cp\u003EЭто событие достойно вашего внимания по той причине, что после наступления этого момента ряд устаревших систем перестанут доверять сертификатам,&nbsp;выпущенным центром сертификации Let’s Encrypt. С учётом того, что на текущий момент Let's Encrypt предоставляет бесплатные криптографические сертификаты примерно для \u003Ca href=\"https:\u002F\u002Fletsencrypt.org\u002Fstats\u002F\" rel=\"noopener noreferrer nofollow\"\u003E250 миллионов доменных имен\u003C\u002Fa\u003E, а \"устаревшие системы\" - это порой системы возрастом всего 5-6 лет, вряд ли окончание срока действия сертификата&nbsp;DST Root CA X3 пройдёт для всех гладко и незаметно. В чём причина, кого конкретно это затронет, и что можно сделать?\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"let's encrypt"},{"titleHtml":"DST Root CA X3"},{"titleHtml":"корневой сертификат"},{"titleHtml":"https"},{"titleHtml":"tls"},{"titleHtml":"openssl"}]},"580094":{"id":"580094","timePublished":"2021-09-26T22:35:26+00:00","isCorporative":false,"lang":"ru","titleHtml":"Блокчейн нас подвёл? Почему ДЭГ — это плохо и можем ли мы адекватно контролировать процесс подсчёта голосов?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"206414","alias":"PoltoS","fullname":"Сергей Полторак","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5cf\u002F03a\u002Fc7f\u002F5cf03ac7fe60ea8a6686bd4c57627ddc.png","speciality":""},"statistics":{"commentsCount":100,"favoritesCount":28,"readingCount":15240,"score":32,"votesCount":54},"hubs":[{"relatedData":null,"id":"118","alias":"crypto","type":"collective","title":"Криптография","titleHtml":"Криптография","isProfiled":true},{"relatedData":null,"id":"210","alias":"it_testing","type":"collective","title":"Тестирование IT-систем","titleHtml":"Тестирование IT-систем","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИнтересно наблюдать, как дискредитируется термин блокчейна на выборах в госдуму. Вроде голосование было на блокчейне, но его якобы подделали. Т.е. блокчейн можно подделать или ЦИК и ДИТ нам подсунули какой-то лохчейн вместо блокчейна?!? И мало кто обсуждает происходящее по существу без эмоций, связанных с результатами партий и кандидатов.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e5\u002F82b\u002F9d0\u002F6e582b9d062dd29fa41c7842a8b76495.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e5\u002F82b\u002F9d0\u002F6e582b9d062dd29fa41c7842a8b76495.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Криптография"},{"titleHtml":"блокчейн"},{"titleHtml":"открытые данные"},{"titleHtml":"электронное голосование"},{"titleHtml":"выборы"},{"titleHtml":"выборы в госдуму"},{"titleHtml":"дэг"},{"titleHtml":"дэг 2021"}]},"580124":{"id":"580124","timePublished":"2021-09-27T13:03:14+00:00","isCorporative":true,"lang":"ru","titleHtml":"Электролюминесцентные индикаторы из прошлого","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"146371","alias":"radiolok","fullname":"Артем Кашканов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa46\u002Fc6a\u002F151\u002Fa46c6a15193f7c0cac79d2736b107358.jpg","speciality":"Релейно-декатронный маньяк"},"statistics":{"commentsCount":11,"favoritesCount":37,"readingCount":4467,"score":68,"votesCount":68},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false},{"relatedData":null,"id":"21930","alias":"antikvariat","type":"collective","title":"Старое железо","titleHtml":"Старое железо","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Сегодня речь пойдёт об электролюминесцентных индикаторах. Но, не о тех, которые окружают вас повсюду и к которым вы привыкли, а о других — получивших огромную популярность в 60-е годы прошлого века, и так же стремительно канувших в небытие. Заодно запущу свою коллекцию индикаторов, как серийно выпускавшихся, так и уникальных опытных и даже — лабораторных образцов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F523004\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F94e\u002F51f\u002F459\u002F94e51f459ae59c9d2fe6c448cb07bcca.gif\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Индикатор"},{"titleHtml":"электролюминесцентность"},{"titleHtml":"ruvds_статьи"}]},"580150":{"id":"580150","timePublished":"2021-09-27T10:50:03+00:00","isCorporative":true,"lang":"ru","titleHtml":"Топ-5 когнитивных искажений при планировании в IT","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2794469","alias":"KM_QA","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":7,"favoritesCount":48,"readingCount":5064,"score":35,"votesCount":37},"hubs":[{"relatedData":null,"id":"14332","alias":"oleg-bunin","type":"corporative","title":"Блог компании Конференции Олега Бунина (Онтико)","titleHtml":"Блог компании Конференции Олега Бунина (Онтико)","isProfiled":false},{"relatedData":null,"id":"19583","alias":"dev_management","type":"collective","title":"Управление разработкой","titleHtml":"Управление разработкой","isProfiled":true},{"relatedData":null,"id":"20736","alias":"hr_management","type":"collective","title":"Управление персоналом","titleHtml":"Управление персоналом","isProfiled":true},{"relatedData":null,"id":"20754","alias":"tech_events","type":"collective","title":"Конференции","titleHtml":"Конференции","isProfiled":false},{"relatedData":null,"id":"21990","alias":"brain","type":"collective","title":"Мозг","titleHtml":"Мозг","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"4","alias":"marketing","title":"Маркетинг"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭта статья подходит для тимлидов и их подопечных, а также для всех, кто оценивает проекты и задачи. Я расскажу, как и почему мы делаем ошибки из-за когнитивных искажений. Попадаем в них мы почти все, просто потому что мы живые люди. И на примере одного дня из жизни тимлида я хочу показать, в какие искажения чаще всего влетают в IT, и&nbsp; — самое полезное&nbsp; —&nbsp; как из них можно выходить.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EЗамечу, что искать когнитивные искажения стоит, в первую очередь, у себя, а не у коллег. \u003C\u002Fstrong\u003EИ что рассказывать про искажения намного проще, чем не влетать в их на практике, однако, если этому научиться, то в перспективе это изрядно окупается, потому что экономит и время, и деньги, помогая и нам, и команде.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb78\u002F76f\u002F001\u002Fb7876f0010e85c328462a735df0b76e8.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb78\u002F76f\u002F001\u002Fb7876f0010e85c328462a735df0b76e8.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"когнитивные искажения"},{"titleHtml":"нейрофизиология"},{"titleHtml":"мозг"},{"titleHtml":"психология"},{"titleHtml":"тимлидство"},{"titleHtml":"тимлид"},{"titleHtml":"управление людьми"},{"titleHtml":"управление проектами и командой"},{"titleHtml":"управление командой"},{"titleHtml":"управление персоналом"}]},"580172":{"id":"580172","timePublished":"2021-09-27T11:45:49+00:00","isCorporative":true,"lang":"ru","titleHtml":"Небинарный ngIf*","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1050218","alias":"Waterplea","fullname":"Александр Инкин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa70\u002F569\u002Ff31\u002Fa70569f31346559ce2b8b875e7f97480.jpg","speciality":"Google Developer Expert | Angular"},"statistics":{"commentsCount":1,"favoritesCount":11,"readingCount":854,"score":14,"votesCount":14},"hubs":[{"relatedData":null,"id":"17420","alias":"tinkoff","type":"corporative","title":"Блог компании TINKOFF","titleHtml":"Блог компании TINKOFF","isProfiled":false},{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"18109","alias":"angular","type":"collective","title":"Angular","titleHtml":"Angular","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВам когда-нибудь хотелось отобразить состояние загрузки, пока \u003Ccode\u003EngIf\u003C\u002Fcode\u003E ждет ответа от \u003Ccode\u003Easync\u003C\u002Fcode\u003E-пайпа? Или, может, вы мечтали передать в \u003Ccode\u003EngFor\u003C\u002Fcode\u003E шаблон для пустого массива? Возможно, вы бросили это, потому что вам не хотелось реализовывать базовую логику этих директив самому. На самом деле в этом нет нужды! Один и тот же селектор может подцепить несколько директив, что позволяет расширить функциональность встроенных директив дополнительной логикой.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"template"},{"titleHtml":"directive"},{"titleHtml":"angular"},{"titleHtml":"structural"}]},"580194":{"id":"580194","timePublished":"2021-09-27T12:36:12+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сотрудники на карте: отвечаем на 10 важных вопросов о трекинге","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1254716","alias":"Axelus","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F118\u002Fc4f\u002F08f\u002F118c4f08ffa66438ad6be22e205d563d.png","speciality":"Разработчик"},"statistics":{"commentsCount":0,"favoritesCount":6,"readingCount":1000,"score":13,"votesCount":15},"hubs":[{"relatedData":null,"id":"20758","alias":"regionsoft","type":"corporative","title":"Блог компании RegionSoft","titleHtml":"Блог компании RegionSoft","isProfiled":false},{"relatedData":null,"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"relatedData":null,"id":"12365","alias":"saas","type":"collective","title":"SaaS \u002F S+S","titleHtml":"SaaS \u002F S+S","isProfiled":true},{"relatedData":null,"id":"17783","alias":"geo","type":"collective","title":"Геоинформационные сервисы","titleHtml":"Геоинформационные сервисы","isProfiled":true},{"relatedData":null,"id":"20736","alias":"hr_management","type":"collective","title":"Управление персоналом","titleHtml":"Управление персоналом","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛюбой контроль сотрудников — опасный и болезненный вопрос, особенно в небольших компаниях. Часто в дружеские и открытые отношения компании не вписывается ни одна из форм контроля, рассчитывать можно только на доверие. Но пресловутый ковид и здесь внёс свои коррективы: расширение удалённой работы, увеличение штата мобильных сотрудников, частичная занятость пополнили ряды полевых сисадминов, аутсорсеров поддержки и остальных «разъездных» работников. Увы, люди разные и вслед за приятными плодами и бонусами удалёнки пришли негативные истории про поведение курьеров, опоздания и откровенные нарушения сотрудников на территории клиентов, неявки на работу или к заказчику и т.д. С этим столкнулись и ритейл, и ИТ, и любая сфера с мобильными сотрудниками. Очень хочется верить в лучшее, но без минимального контроля можно просто потерять бизнес — и тогда пострадают коллеги нерадивых сотрудников.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"geomonitor"},{"titleHtml":"геолокация"},{"titleHtml":"геозона"},{"titleHtml":"трекинг"}]},"580196":{"id":"580196","timePublished":"2021-09-27T12:28:15+00:00","isCorporative":true,"lang":"ru","titleHtml":"Зачем нужен динамический анализ кода, на примере проекта PVS-Studio","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"2302295","alias":"MrROBUST","fullname":"Алексей Говоров","avatarUrl":"","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":3,"readingCount":626,"score":9,"votesCount":9},"hubs":[{"relatedData":null,"id":"18095","alias":"pvs-studio","type":"corporative","title":"Блог компании PVS-Studio","titleHtml":"Блог компании PVS-Studio","isProfiled":false},{"relatedData":null,"id":"559","alias":"cpp","type":"collective","title":"C++","titleHtml":"C++","isProfiled":true},{"relatedData":null,"id":"11606","alias":"vs","type":"collective","title":"Visual Studio","titleHtml":"Visual Studio","isProfiled":true},{"relatedData":null,"id":"21456","alias":"win_dev","type":"collective","title":"Разработка под Windows","titleHtml":"Разработка под Windows","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ разговоре с Маршаллом Клоу на подкасте CppCast #300 ABI Stability была затронута достаточно давняя новость о поддержке компиляторами Visual Studio инструмента AddressSanitizer (ASan). Мы уже достаточно давно внедрили ASan в свою систему тестирования и хотим рассказать о паре интересных ошибок, которые он помог найти.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F7ef\u002F2db\u002F210\u002F7ef2db210d677f9a8c07026d4361d3ba.png\" alt=\"0868_PVS-Studio_ASan_ru\u002Fimage2.png\"\u003E\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"pvs-studio"},{"titleHtml":"clang"},{"titleHtml":"asan"},{"titleHtml":"sanitizer"},{"titleHtml":"динамический анализ кода"}]},"580206":{"id":"580206","timePublished":"2021-09-27T12:51:03+00:00","isCorporative":false,"lang":"ru","titleHtml":"МТС отказался от скрытых мобильных подписок?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2467147","alias":"Plusodin","fullname":"Владимир","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F343\u002Fb77\u002Fd12\u002F343b77d12f047368849a9880276f936e.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":8,"favoritesCount":4,"readingCount":4420,"score":13,"votesCount":13},"hubs":[{"relatedData":null,"id":"22008","alias":"cellular","type":"collective","title":"Сотовая связь","titleHtml":"Сотовая связь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПривет, Хабр!\u003C\u002Fp\u003E\u003Cp\u003EНу что, подходит к концу первый сезон сериала «О скрытых мобильных подписках и операторах связи». Предыдущие три серии: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F550448\u002F\" rel=\"noopener noreferrer nofollow\"\u003EМегафон\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F563260\u002F\" rel=\"noopener noreferrer nofollow\"\u003EБилайн\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F571256\u002F\" rel=\"noopener noreferrer nofollow\"\u003ETele2\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EНу и вишенка на этом торте – МТС.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"мтс"},{"titleHtml":"мобильные подписки"},{"titleHtml":"подписки"},{"titleHtml":"оператор связи"},{"titleHtml":"теле2"},{"titleHtml":"мегафон"},{"titleHtml":"билайн"}]},"580208":{"id":"580208","timePublished":"2021-09-27T12:52:27+00:00","isCorporative":false,"lang":"ru","titleHtml":"Основная проблема образования","editorVersion":"2.0","postType":"article","postLabels":[{"type":"recovery","data":null}],"author":{"id":"2270142","alias":"Chronicler","fullname":"Пушиз де Хрониклер","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Faa3\u002F149\u002Fdb0\u002Faa3149db0de5f6c071dfade7285fcb99.jpg","speciality":"Исследователь ближнего заполярья, почетный манул"},"statistics":{"commentsCount":12,"favoritesCount":12,"readingCount":2190,"score":8,"votesCount":20},"hubs":[{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"17189","alias":"itstandarts","type":"collective","title":"IT-стандарты","titleHtml":"IT-стандарты","isProfiled":true},{"relatedData":null,"id":"20682","alias":"pm","type":"collective","title":"Управление проектами","titleHtml":"Управление проектами","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНа днях на Хабре появилась \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F579998\u002F\" rel=\"noopener noreferrer nofollow\"\u003Eкритическая статья\u003C\u002Fa\u003E о бакалавриате, что называется \"из первых уст\", от очередного первохода. Статья далеко не лишена смысла, однако главная проблема не была в ней затронута. А заключается она вовсе не в обилии посторонних дисциплин и даже не в том, что в учебных заведениях так мало разъясняют суровую конкретику жизни \"научиться штамповать JavaScript сайты за месяц\".  Да, эти проблемы присутствуют, наряду с плохой подготовкой педагогов и отношением к студентам, но не они на корню обесценивают нынешнее образование.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Что же на самом деле не так?","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"программирование"},{"titleHtml":"образование"},{"titleHtml":"курсы не нужны"},{"titleHtml":"вуз"}]},"580210":{"id":"580210","timePublished":"2021-09-27T12:53:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"PHP Дайджест № 212 (13 – 27 сентября 2021)","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"100489","alias":"pronskiy","fullname":"Роман Пронский","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F27f\u002Fb99\u002Feb3\u002F27fb99eb3e30e3221c5839e88be02395.jpg","speciality":"PHP"},"statistics":{"commentsCount":1,"favoritesCount":10,"readingCount":3279,"score":37,"votesCount":37},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"477","alias":"symfony","type":"collective","title":"Symfony","titleHtml":"Symfony","isProfiled":true},{"relatedData":null,"id":"9554","alias":"yii","type":"collective","title":"Yii","titleHtml":"Yii","isProfiled":true},{"relatedData":null,"id":"18812","alias":"laravel","type":"collective","title":"Laravel","titleHtml":"Laravel","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fek\u002F6r\u002Fr1\u002Fek6rr1odvyzb89tfv0lq4cmfxi4.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nПодборка свежих новостей и материалов из мира PHP.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВышел PHP 8.1 RC2 и уже доступен первый пакет с использованием перечислений, будет сделан форк Magento, новый тип стандартов PER в дополнение к PSR, стартовала PhpStorm 2021.3 EAP, Symfony 6 будет полностью типизирован — как обновляться?\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nДля PHP 8.2 предложены новые оптимизированные структуры данных.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nТакже в выпуске порция инструментов, полезные статьи, видео и анонсы двух митапов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПриятного чтения!\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дайджест"},{"titleHtml":"php-дайджест"},{"titleHtml":"PHP"},{"titleHtml":"Symfony"},{"titleHtml":"Laravel"},{"titleHtml":"Magento"},{"titleHtml":"PHPUnit"},{"titleHtml":"PHP 8.1"},{"titleHtml":"PHP 8.2"}]},"580228":{"id":"580228","timePublished":"2021-09-27T16:41:21+00:00","isCorporative":true,"lang":"ru","titleHtml":"Идеальная светодиодная лампа за 21 рубль","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"108988","alias":"AlexeyNadezhin","fullname":"Алексей Надежин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffdc\u002F3ac\u002F9a2\u002Ffdc3ac9a2dc0107cc956f1bd0cf5fc2b.jpg","speciality":"Блогер"},"statistics":{"commentsCount":24,"favoritesCount":33,"readingCount":7819,"score":62,"votesCount":66},"hubs":[{"relatedData":null,"id":"21646","alias":"lamptest","type":"corporative","title":"Блог компании LampTest","titleHtml":"Блог компании LampTest","isProfiled":false},{"relatedData":null,"id":"21894","alias":"gadgets","type":"collective","title":"Гаджеты","titleHtml":"Гаджеты","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Удивительно осознавать, что достаточно сложное электронное устройство, которым является светодиодная лампочка, может стоить 21 рубль. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЕщё сложнее поверить, что эта лампочка безукоризненна по всем параметрам.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F849\u002Ffcd\u002F20f849fcd6a3891f506676fc87223bdf.jpg\"\u003E\u003C\u002Fdiv\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"led"},{"titleHtml":"светодиодные лампы"},{"titleHtml":"тест"}]},"580304":{"id":"580304","timePublished":"2021-09-27T18:31:25+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как сделать 248MP фотографию Солнца","editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Simon Tang","originalUrl":"https:\u002F\u002Fpetapixel.com\u002F2021\u002F09\u002F15\u002Fa-closer-look-how-i-created-a-248mp-photo-of-the-sun\u002F"}}],"author":{"id":"2192534","alias":"Itelma","fullname":"T-800","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc3a\u002Fd1e\u002F43d\u002Fc3ad1e43d500046c3228c9494b510912.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":4,"favoritesCount":3,"readingCount":882,"score":7,"votesCount":7},"hubs":[{"relatedData":null,"id":"22356","alias":"itelma","type":"corporative","title":"Блог компании НПП ИТЭЛМА","titleHtml":"Блог компании НПП ИТЭЛМА","isProfiled":false},{"relatedData":null,"id":"17175","alias":"image_processing","type":"collective","title":"Обработка изображений","titleHtml":"Обработка изображений","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21932","alias":"photo","type":"collective","title":"Фототехника","titleHtml":"Фототехника","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fe02\u002F643\u002Fa55\u002Fe02643a550e20aa10c366e20956e4b40.jpg\" alt=\"image\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ci\u003EЭто изображение диска нашего Солнца создано с помощью большого рефракторного (линзового) телескопа и высокоскоростной монохромной CMOS-камеры.\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКаждый день над нашими головами висит большой шар света. Он там всегда, и никто не обращает на него внимания. Разумеется, мы не советуем вам долго смотреть на него и при этом ослепнуть, тем не менее, наука дала нам возможность смотреть прямо на солнце совершенно безопасно.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПоскольку техника стала более доступной, обычный человек может заглянуть в многочисленные слои Солнца с помощью специального оборудования, которое может купить в любом хорошем магазине телескопов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ этой статье мы подробно рассмотрим слой, известный как хромосфера: область Солнца, видимая в оранжево-красном спектре. При помощи специального фильтра это устройство блокирует весь нежелательный свет, пропуская при этом определенный диапазон частот, который нас интересует.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"обработка изображений"},{"titleHtml":"фототехника"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["580060","580124","580228","580092","580210","580150","580094","579854","580090","580088","572164","580172","580008","580206","580194","580050","580196","579772","580208","580304"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":3},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["574620","563550","68995"],"similarListRefs":{"68995":{"id":"68995","timePublished":"2009-09-20T21:37:24+00:00","isCorporative":false,"lang":"ru","titleHtml":"Часть 1\u002F3. Компилятор идеальной VM для ICFPC 2009, на Haskell, с популяризаторскими комментариями","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"50634","alias":"San13","fullname":"Я робот","avatarUrl":null,"speciality":null},"statistics":{"commentsCount":4,"favoritesCount":15,"readingCount":1074,"score":28,"votesCount":40},"hubs":[{"id":"8424","alias":"haskell","type":"collective","title":"Haskell","titleHtml":"Haskell","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"Здесь мы будем разбирать по буквам некую программу (компилятор VM) на Хаскеле. На вход этому компилятору дается бинарный файл с инструкциями некоего процессора, где в этих инструкциях описываются некие вычисления. На выходе нашего компилятора получается текст программы, тоже на Хаскеле, которая производит те же самые вычисления, с большой скоростью. Возможно, это не компилятор, а декомпилятор, не знаю. Сравнение работы результирующих программ на Haskell\u002FJava приводится в \u003Ca href=\"http:\u002F\u002Fsan13.habrahabr.ru\u002Fblog\u002F67225\u002F\"\u003Eпредыдущем посте\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null},"563550":{"id":"563550","timePublished":"2021-06-18T15:01:42+00:00","isCorporative":true,"lang":"ru","titleHtml":"Создаем веб-приложение на Haskell с использованием Reflex. Часть 4","editorVersion":"1.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"196914","alias":"anisimoffnikita","fullname":"Анисимов Никита","avatarUrl":null,"speciality":"Haskell программист"},"statistics":{"commentsCount":0,"favoritesCount":25,"readingCount":1975,"score":8,"votesCount":8},"hubs":[{"id":"22642","alias":"typeable","type":"corporative","title":"Блог компании Typeable","titleHtml":"Блог компании Typeable","isProfiled":false},{"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"id":"8424","alias":"haskell","type":"collective","title":"Haskell","titleHtml":"Haskell","isProfiled":true},{"id":"17853","alias":"funcprog","type":"collective","title":"Функциональное программирование","titleHtml":"Функциональное программирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Ftypeable\u002Fblog\u002F543998\u002F\"\u003EЧасть 1\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Ftypeable\u002Fblog\u002F549542\u002F\"\u003EЧасть 2\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Ftypeable\u002Fblog\u002F557852\u002F\"\u003EЧасть 3\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВсем привет! В новой части мы рассмотрим использование \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fghcjs\u002Fghcjs\u002Fblob\u002Fmaster\u002Fdoc\u002Fforeign-function-interface.md\" rel=\"nofollow noopener noreferrer\"\u003EJSFFI\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F9w\u002Fm3\u002Fnt\u002F9wm3ntdpgxeukkjephuvba7tevc.gif\" alt=\"intro\"\u003E\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null},"574620":{"id":"574620","timePublished":"2021-08-25T16:26:36+00:00","isCorporative":true,"lang":"ru","titleHtml":"Как мы поучаствовали в ICFPC 2021 и что из этого вышло","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1181772","alias":"nevoroman","fullname":"Роман Неволин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F21d\u002F1d5\u002F7d9\u002F21d1d57d92a296101a1da62761632a78.jpg","speciality":"DevRel"},"statistics":{"commentsCount":1,"favoritesCount":5,"readingCount":931,"score":13,"votesCount":13},"hubs":[{"id":"15878","alias":"skbkontur","type":"corporative","title":"Блог компании Контур","titleHtml":"Блог компании Контур","isProfiled":false},{"id":"84","alias":"crazydev","type":"collective","title":"Ненормальное программирование","titleHtml":"Ненормальное программирование","isProfiled":true},{"id":"89","alias":"sport_programming","type":"collective","title":"Спортивное программирование","titleHtml":"Спортивное программирование","isProfiled":true},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"id":"8000","alias":"algorithms","type":"collective","title":"Алгоритмы","titleHtml":"Алгоритмы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EОдна старая академическая конференция,&nbsp;\u003Ca href=\"https:\u002F\u002Fwww.icfpconference.org\u002F\"\u003E\u003Cu\u003EInternational Conference on Functional Programming\u003C\u002Fu\u003E\u003C\u002Fa\u003E, уже больше двадцати лет организует соревнование по программированию своего имени. 1 задание, 72 часа, участвуют команды произвольного размера. На этом ограничения все. Задача может быть любой, решения — тем более.\u003C\u002Fp\u003E\u003Cp\u003EВас могут заставить писать ботов для игр или управлять марсоходом. Реализовывать виртуальные машины или разворачивать оригами. Искать кратчайшие маршруты в лабиринтах или разгадывать послания инопланетян. А в этом году мы пропихивали человечков в лямбды и клали песиков в гробы.\u003C\u002Fp\u003E\u003Cp\u003EПод катом обзор контеста 2021 года и нашего участия в нем. А еще алгоритмы, теории, байки и разбор решений других команд.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fda4\u002Fa9f\u002Fc9c\u002Fda4a9fc9c4397338e2f28c9642879316.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fda4\u002Fa9f\u002Fc9c\u002Fda4a9fc9c4397338e2f28c9642879316.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"san13":{"scoreStats":{"score":72,"votesCount":100},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"50634","alias":"San13","fullname":"Я робот","avatarUrl":null,"speciality":null}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
