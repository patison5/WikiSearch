<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Полиглоты в продакшн Питона / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.01bb2993.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.76acc47b.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0f7bdd8f.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.01bb2993.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-f458c7c4.e48e8f79.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.4f7c12b4e1b1b4c0e44ef6f9f33b1f9f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/63109\/"},"headline":"Полиглоты в продакшн Питона","datePublished":"2009-06-29T00:19:40+04:00","dateModified":"2009-06-29T10:16:41+04:00","author":{"@type":"Person","name":"Honeyman"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (...","url":"https:\/\/habr.com\/ru\/post\/63109\/#post-content-body","about":["h_python","f_develop"],"image":["https:\/\/habr.com\/share\/publication\/63109\/cbb3a2d19ed1f98e6e505bd583df10aa\/"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.47.1">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Полиглоты в продакшн Питона" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Полиглоты в продакшн Питона" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Полиглоты в продакшн Питона" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/63109/cbb3a2d19ed1f98e6e505bd583df10aa/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/63109/cbb3a2d19ed1f98e6e505bd583df10aa/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/63109/cbb3a2d19ed1f98e6e505bd583df10aa/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/63109/cbb3a2d19ed1f98e6e505bd583df10aa/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/63109/cbb3a2d19ed1f98e6e505bd583df10aa/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="63109" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2009-06-28T20:19:40.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/63109/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/63109/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/63109/cbb3a2d19ed1f98e6e505bd583df10aa/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.cee85629.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
              Как стать автором
            </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.cee85629.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.cee85629.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.cee85629.svg#pull-arrow"></use></svg></div></div> <!----> <div class="tm-page-article__body"><article class="tm-page-article__content tm-page-article__content_inner"><div class="tm-page-article__head-wrapper"><!----> <div class="tm-article-snippet tm-page-article__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Honeyman/" title="Honeyman" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/052/337/df7/052337df79576c450527ce51a573d49e.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/Honeyman/" class="tm-user-info__username">
      Honeyman
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2009-06-28T20:19:40.000Z" title="2009-06-29, 00:19">29  июня  2009 в 00:19</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Полиглоты в продакшн Питона</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/python/" class="tm-article-snippet__hubs-item-link"><span>Python</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-<a href="http://habrahabr.ru/blogs/crazydev/62058/">полиглоты</a>, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является Python). При этом, в случае интерпретации на одном из них, программа будет генерировать другую программу, функционально схожую (или даже эквивалентную) той, которая выполняется в случае интерпретации на другом языке.<br/>
<br/>
И самое интересное: подходы, используемые при написании этой программы, будут интересны не столько академически, сколько практически — при разработке программы с использованием этих подходов разработка будет проще и удобнее (хоть поначалу и чуточку непривычно), а программа будет эффективнее, чем без них.<br/>
<br/>
Впрочем, это звучит страшнее, чем является.<br/>
<br/>
<a name="habracut"></a>Поехали?<br/>
<br/>
<h1>__debug__</h1><br/>
Начнём с достаточно простого — с кодогенерации. Программисты на Python знают, что в Python нет никакого препроцессора (как, например, в C), который бы позволял создавать макросы, в зависимости от каких-то параметров генерирующие различный код на этапе compile-time. «Динамичность» Python-а, конечно, позволяет генерировать что угодно и когда угодно на runtime, но… иногда возможность влиять на compile time тоже полезна, и даже необходима.<br/>
<br/>
Препроцессора в Python, конечно, нет. Но все программисты на Python наверняка знают директиву assert, позволяющую добавить в код программы проверку, что в каком-то месте значение какого-то выражения инвариантно.<br/>
<br/>
При этом они наверняка помнят, что эта директива при запуске интерпретатора Python «с оптимизацией» (т.е., ключом <code>-O</code>) игнорируется и интерпретатором не выполняется.<br/>
<br/>
Сравним, например,<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python

def func(x):
    assert x > 5
    return x

import dis; dis.dis(func)
</pre></td>
<td>→</td>
<td><pre>

  4           0 LOAD_FAST                0 (x)
              3 LOAD_CONST               1 (5)
              6 COMPARE_OP               4 (>)
              9 JUMP_IF_TRUE             7 (to 19)
             12 POP_TOP
             13 LOAD_GLOBAL              0 (AssertionError)
             16 RAISE_VARARGS            1
        >>   19 POP_TOP

  5          20 LOAD_FAST                0 (x)
             23 RETURN_VALUE
</pre></td>
</tr>
</table><br/>
и<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python -O

def func(x):
    assert x > 5
    return x

import dis; dis.dis(func)
</pre></td>
<td>→</td>
<td><pre>
  5           0 LOAD_FAST                0 (x)
              3 RETURN_VALUE
</pre></td>
</tr>
</table>.<br/>
<br/>
Что из этого следует? Что, варьируя значение оптимизации при старте генерации байт-кода, можно получить совершенно разный байт-код. Код, который по-разному ведёт себя в зависимости от того, был он запущен в режиме оптимизации или без. Что это, как не зачаток препроцессора?<br/>
Зачем нам это может быть полезно? Для того, чтобы существенно разделять в поведении debug- и release-build-ы. Всё как «в больших языках» — куча проверок, логов и информативности в debug-build-е, быстрый и эффективный код в release-build-е. Но не мало ли для этого одной директивы assert?<br/>
<br/>
Итак, assert ведёт себя по-разному в зависимости от настройки оптимизации, которая была в момент генерации байт-кода (при этом я надеюсь, что все помнят/знают, что байт-код вовсе не обязательно перегенерировать каждый раз? Более того, его, т.е. файлы <code>.pyc</code>/<code>.pyo</code>, можно распространять без исходников, из которых они были сгенерированы).<br/>
Из этого вполне логично следует, что генератору байт-кода доступна информация, была ли включена оптимизация на момент его запуска. А как, кстати, он умеет оптимизировать код?<br/>
<br/>
Так вот, эта самая информация доступна ему в виде константы <code>__debug__</code>. Обратите внимание — действительно константы. Не так что часто в абсолютно динамическом языке Python-а можно найти константы :) Но раз уж это константа, то оптимизатор таки умеет генерировать код по-разному, в зависимости от её значения:<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python

def func():
    if __debug__:
        print

import dis; dis.dis(func)</pre></td>
<td>→</td>
<td><pre>

  5           0 PRINT_NEWLINE
              1 LOAD_CONST               0 (None)
              4 RETURN_VALUE
</pre></td>
</tr>
</table><br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python -O

def func():
    if __debug__:
        print

import dis; dis.dis(func)
</pre></td>
<td>→</td>
<td><pre>
  4           0 LOAD_CONST               0 (None)
              3 RETURN_VALUE
</pre></td>
</tr>
</table><br/>
<br/>
И это, и, как частный случай, оптимизация директивы assert (ну, плюс ещё удаление docstring-ов при <code>-OO</code>) и составляет фактически весь спектр умений оптимизатора.<br/>
<br/>
Этот оптимизатор настолько прост, что, хоть он и умеет оптимизировать генерацию кода для операторов <code>or</code> и <code>and</code> над <i>переменными</i> (так, что вторая часть проверки не будет <i>выполняться</i> в случае ненадобности), но оптимизировать генерацию кода, когда первой проверкой является <i>константа</i> (так, что вторая часть проверки не будет <i>генерироваться</i> в случае ненадобности), он уже не умеет:<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python -O

def func(x):
    if __debug__ and x > 5:
        print

import dis
dis.dis(func)
</pre></td>
<td>→</td>
<td><pre>
  4           0 LOAD_GLOBAL              0 (__debug__)
              3 JUMP_IF_FALSE           18 (to 24)
              6 POP_TOP
              7 LOAD_FAST                0 (x)
             10 LOAD_CONST               1 (5)
             13 COMPARE_OP               4 (>)
             16 JUMP_IF_FALSE            5 (to 24)
             19 POP_TOP

  5          20 PRINT_NEWLINE
             21 JUMP_FORWARD             1 (to 25)
        >>   24 POP_TOP
        >>   25 LOAD_CONST               0 (None)
             28 RETURN_VALUE
</pre></td>
</tr>
</table><br/>
<br/>
Обратите внимание: хоть оптимизация и была включена, хоть сгенерированный код и способен пропустить проверку на <code>x > 5</code>, если после проверки он выяснит, что константа <code>__debug__</code> установлена в <code>True</code>, но саму проверку он будет делать. Поэтому, если необходимо избавиться даже от генерации какого-то кода в release-build-е, придётся оптимизировать код «по старинке» — делать вложенные проверки, сначала на значение <code>__debug__</code>, и только внутри неё на <code>x > 5</code>:<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python -O

def func(x):
    if __debug__:
        if x > 5:
            print

import dis
dis.dis(func)
</pre></td>
<td>→</td>
<td><pre>
  4           0 LOAD_CONST               0 (None)
              3 RETURN_VALUE
</pre></td>
</tr>
</table><br/>
<br/>
Кстати, тернарный оператор тоже не оптимизируется на проверку константы:<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python -O

def func(x):
    return 5 if __debug__ else 7

import dis
dis.dis(func)
</pre></td>
<td>→</td>
<td><pre>
  4           0 LOAD_GLOBAL              0 (__debug__)
              3 JUMP_IF_FALSE            7 (to 13)
              6 POP_TOP
              7 LOAD_CONST               1 (5)
             10 JUMP_FORWARD             4 (to 17)
        >>   13 POP_TOP
             14 LOAD_CONST               2 (7)
        >>   17 RETURN_VALUE

</pre></td>
</tr>
</table><br/>
<br/>
Вспомним, для чего мы это делаем: для того, чтобы иметь возможность в debug-build-ах иметь сколь угодно детальную отладочную информацию (например, выводящуюся в сервисные логи), которая бы при этом опускалась и не влияла на производительность release-build-ов.<br/>
<br/>
Зато теперь, когда мы точно знаем, что и как можно делать с переменной <code>__debug__</code> (никаких составных логических операций, никаких тернарных операций — только чистая проверка одной переменной <code>__debug__</code> на валидность), мы можем сделать, например, следующее:<br/>
<br/>
<table>
<tr>
<td><pre>
if __debug__:
    def log(msg):
        __do_some_heavy_logging(msg)
else:
    def log(msg):
        pass
</pre></td>
</tr>
</table><br/>
<br/>
Это уже что-то. Теперь мы можем понавставлять <code>log(что-нибудь)</code> хоть в каждую вторую строку кода — на производительность release-build-а это нисколько не повлияет.<br/>
<br/>
Ну, честно говоря, <i>почти</i> нисколько. Пусть теперь на release-build-е мы и не пишем каждую строчку лога посредством жутко медленного вызова процедуры <code>__do_some_heavy_logging()</code> печати строчки на древнем рулонном АЦПУ — но вызов каждой функции <code>log()</code>, пусть и пустой, в release-build-е сохранится. И генерация сообщения для него (если она тоже вычислительно нетривиальна). Но тут уже ничего не поделаешь. В Python препроцессора нет, и совсем опускать вызов <code>log()</code> на debug-build-ах у нас не получится. Впрочем…<br/>
<br/>
<h1>GPP: GNU Python Preprocessor</h1><br/>
… Впрочем, если препроцессора нет в самом Python-е, почему бы не взять его извне? Чего только не сделаешь в стремлении оптимизировать release-build.<br/>
<br/>
Слава богам, на свете существует GPP — Generic Preprocessor, General-Purpose Processor, а теперь ещё и новый backronym — GNU Python Preprocessor. Почему бы и нет?<br/>
<br/>
Особо описывать его и перечитывать man вслух неохота. Скажу только, что синтаксис его фактически повторяет синтаксис препроцессора в C: <code>#define</code>, <code>#if</code> и т.п.<br/>
<br/>
Что очень даже удобно — в Python со знака диеза начинаются комментарии. Осознаёте, что это значит?..<br/>
<br/>
Правильно. Сейчас мы будем писать программу-<a href="http://habrahabr.ru/blogs/crazydev/62058/">полиглот</a>.<br/>
<br/>
Да. Это вполне себе полноценный полиглот. Программа на двух языках — языке Python (не обладающем препроцессором), и на языке GPP.<br/>
<br/>
При этом это программы не уровня <code>print "Hello world"</code>, одинаково ведущей себя на 4242 различных языках и диалектах программирования. Отнюдь, наши программы будут иметь вовсе даже различные задачи. Программа на Python (1) должна будет решить ту задачу, ради которой мы её пишем. Программа на GPP (2) должна сгенерировать программы на Python (3)/(4), решающие задачу, ради которой мы её пишем.<br/>
<br/>
Причём, обратите внимания на два забавных факта. Во-первых, программа на GPP будет генерировать не одну, а как минимум (в нашем случае) две различных программы на Python. Одну (3) — соответствующую debug-build-у, другую (4) — соответствующую release-build-у. А во-вторых, (1) определённо вовсе не равно (4) (ради того, чтобы релиз-билд отличался от промежуточного разработческого в сторону повышения производительности за счёт выкидывания отладочного кода, мы всё и затеяли), и даже не обязан быть равным (3)! Но лучше, конечно, чтобы хотя бы (1) был равен (3). Иначе запутаемся. Слишком много уровней, на которых одновременно надо мыслить. Типичная проблема при написании программы-полиглота.<br/>
<br/>
Ну что, попробуем?<br/>
<br/>
Пишем исходник на GPP:<br/>
<br/>
<table>
<tr>
<td><pre>
#ifdef debug
#define log(msg) __do_some_heavy_logging(msg)
#else
#define log(msg)
#endif
</pre></td>
</tr>
</table><br/>
<br/>
В общем, неплохо. Если мы вызывали GPP с параметром <code>-Ddebug</code>, то он в каждое место исходника, где встречался вызов функции <code>log()</code>, подставит вместо него вызов функции <code>__do_some_heavy_logging(msg)</code>. По сравнению с кодом, основанным на <code>__debug__</code>, уже прямая выгода — меньше на один промежуточный вызов функции. Если же мы вызывали GPP без такого параметра, то каждый вызов функции <code>log()</code> он заменит на пустую строку…<br/>
<br/>
Ура! То, что нам надо… или нет?<br/>
<br/>
А если мы выполним этот код сразу в интерпретаторе Python-а без препроцессинга? Тогда при любом вызове функции <code>log()</code> интерпретатор просто не найдёт её — у нас же она определена в препроцессоре.<br/>
<br/>
А значит, надо её определить и на уровне Python-а. Причём так, чтобы не помешать препроцессору. Второй блин:<br/>
<br/>
<table>
<tr>
<td><pre>
def log(msg):
    __do_some_heavy_logging(msg)
#ifdef debug
#define log(msg) __do_some_heavy_logging(msg)
#else
#define log(msg)
#endif
</pre></td>
</tr>
</table><br/>
<br/>
Уже лучше. Без препроцессинга — создаём функцию <code>log()</code> и используем её каждый раз при вызове <code>log()</code> в коде. С препроцессингом, без переменной препроцессора <code>debug</code> — вызовы <code>log()</code> заменяем на пустую строку. С препроцессингом, с переменной препроцессора <code>debug</code>: вызовы <code>log()</code> заменяем на вызовы <code>__do_some_heavy_logging()</code>.<br/>
<br/>
Хорошо? Уже лучше. Но есть один нюанс: у нас (1) получился не равным (3). Что, конечно, хоть и красиво, но потенциально опасно в процессе разработки. Лучше всё-таки сделать так, чтобы препроцессированный в режиме <code>debug</code> код был абсолютно эквивалентен коду без препроцессинга. И поэтому весь его поместить внутри проверки <code>#ifdef debug</code>.<br/>
<br/>
<table>
<tr>
<td><pre>
#ifdef debug
def log(msg):
    _do_some_heavy_logging(msg)
#else
#define log(msg)
#endif
</pre></td>
</tr>
</table><br/>
<br/>
Вот так намного лучше. В секции <code>#ifdef debug</code> — только непрепроцессорный код, и поэтому программа будет себя одинаково вести и с препроцессором и переменной <code>-Ddebug</code>, и без препроцессора. В секции <code>else</code> только препроцессорный код (и поэтому он сработает только в release-build-е). Так-то. И даже Python-овой переменной <code>__debug__</code> больше не надо.<br/>
<br/>
<h1>Cython</h1><br/>
Теперь, когда мы научились генерировать Python-овый код препроцессором и при этом сохранять запускаемость без прохода препроцессором, почему бы не взять задачу посложнее?<br/>
<br/>
Почему бы нам не попробовать написать программу, которая после прохода GPP в режиме release (без переменной <code>-Ddebug</code>) генерирует код на <i>вообще другом</i> языке программирования? Ну, или на <i>почти другом</i>?<br/>
<br/>
А зачем?<br/>
<br/>
А, например, затем, что этим языком может быть язык Cython. Основанный на Python-е и близкий к нему по синтаксису, но при этом явно типизированный. И имеющий милую и полезную в хозяйстве возможность: программа/модуль на Cython может транслироваться в исходник на C, а из этого исходника после компиляции может создаться модуль, пригодную для использования из Python-ового кода.<br/>
<br/>
Единственное что — программы на Cython обратно не совместимы с Python-ом. А вот программы на Python обычно являются корректными программами на Cython. С одной стороны, это упрощает задачу до почти что тривиальности. С другой — мы не пионеры, чтобы создавать себе трудности и героически решать их, мы просто хотим писать на Python эффективно.<br/>
<br/>
Итак, цель: написать модуль на Python (1'), имеющий функцию, производящую какие-то вычисления. Этот модуль должен спокойно импортироваться и использоваться самим Python-ом без какого бы то ни было препроцессинга — чтобы удобнее разрабатывать было. Кроме того, этот модуль должен являться программой на GPP (2'). Которая, в случае соответственного указания переменных GPP, должна сгенерировать программу на Cython (3'). Содержащую алгоритм, полностью аналогичный программе (1'), но при этом типизированный. Такой, что после трансляции исходника (3') в C (4') и компиляции создастся бинарная библиотека Python-а, выполняющая всё то же самое, что и в (1'), только, за счёт компилированного кода, намного быстрее.<br/>
<br/>
В качестве решаемой задачи возьмём, например, <a href="http://projecteuler.net/index.php?section=problems&amp;id=2">вторую задачу Project Euler</a>: <i>найти сумму всех чётных чисел Фибоначчи, не превышающих четырёх миллионов</i>. Представим, что нам её надо решать как часть гораздо большей проблемы, и задачу мы по-прежнему хотим решать на Python-е. Просто именно эту функцию мы хотим оптимизировать по производительности, переписав её на Cython-е. При этом хотим сохранить возможность запускать этот же код и без обработки Cython-ом (и GPP), как обычный Python-овый код, из соображений удобства разработки.<br/>
<br/>
Желаемый процесс выглядит разработки следующим образом: мы делаем модуль Python-а, из которого мы в процессе разработки и отладки и будем импортировать вычисляющую решение нашей задачи функцию. Этот же код при сборке release-build-а будет интерпретирован посредством GPP, который сгенерирует при этом эквивалентную программу на Cython (с необходимой для данной задачи типизацией данных); далее в процессе сборки release-build-а программа на Cython будет транслирована Cython-ом в программу на C, которая будет скомпилирована в библиотеку, доступную для использования Python-овому коду. И в release-build-е вызывающий Python-овый код будет импортировать функцию уже не из Python-ового модуля, а из бинарной библиотеки, скомпилированную и очень быструю.<br/>
<br/>
Как же должна выглядеть функция, решающая вторую задачу? Спойлер, конечно… но это вторая задача, и любой разумный программист, дочитавший до этой строчки и не ускользнувший в царство Морфея, наверняка спокойно решит её сам. Поэтому не будет большой потерей для учебного процесса, если я напишу эту функцию:<br/>
<br/>
<table>
<tr>
<td><pre>
def sum_even_fibo_le(upb):
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Соответственно, мы пишем модуль <code>fibo.py</code>, который содержит эту функцию, в основной программе импортируем функцию из этого модуля и вызываем, передав верхнюю границу для задачи.<br/>
<br/>
Хоть эта функция даже для верхней границы в четыре миллиона и выполняется достаточно быстро даже в интерпретируемом Python, но в данном случае она просто демонстрирует возможности, которых мы можем добиться. Поэтому попытаемся оптимизировать её, несмотря ни на что. Перепишем её на Cython.<br/>
<br/>
В принципе, уже имеющаяся у нас функция на Python является вполне валидной функцией на Cython. Более того, будучи скомпилирована Cython-ом, она даже будет работать быстрее. Раза этак в два-три. Потому что полностью исчезнет этап обработки байт-кода, и вместо него машинный код будет сразу выполнять необходимые операции над Python-овыми объектами.<br/>
<br/>
Но это не предел. Если мы решим типизировать наши данные (при этом, к сожалению, потеряв приятную неограниченность Python-ового типа данных long), то наш код будет работать ещё быстрее.<br/>
<br/>
Что мы будем (можем) типизировать в Cython? Входные аргументы функций. Выходные результаты функций. Промежуточные переменные.<br/>
<br/>
Вот и типизируем всё. Посчитаем, что 64 bit should be enough for everybody, и все переменные приведём к unsigned long long. Заодно и познакомимся с Cython-ом, кто его не знает:<br/>
<br/>
<table>
<tr>
<td><pre>
cdef unsigned long long sum_even_fibo_le(unsigned long long upb):
    cdef unsigned long long f1, f2, res
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
    </pre></td>
</tr>
</table><br/>
<br/>
Код хороший, достаточно читабельный для питонистов, и вполне понятный. Он имеет только два недостатка:<br/>
<ol>
<li>Он уже не является валидным кодом на Python. Впрочем, мы это решим. Препроцессором. Но…</li>
<li>Он не работает.</li>
</ol><br/>
<br/>
Ну не то что бы совсем не работает. Просто не решает нашу задачу. Этим кодом прекрасно создаётся, в терминологии Cython, «C function». Которую можно вызывать из другого кода на Cython или даже на C, но которую нельзя вызывать из кода на Python. Что нам не подходит.<br/>
Придётся модифицировать эту функцию так, чтобы она осталась «Python function». С чуточку медленным вызовом (впрочем, вызов из кода на Cython можно сохранить быстрым), возвращающую PyObject (если кого-то волнуют внутренности Python-ового интерпретатора).<br/>
<br/>
<table>
<tr>
<td><pre>
cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):
    cdef unsigned long long f1, f2, res
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Итак, мы имеем функцию на Python, которая решает нашу задачу пусть и медленно, зато модуль с ней удобнее отлаживать — запускать на интерпретацию без промежуточной обработки. И функцию на Cython, которую обычный интерпретатор Python уже не поймёт, но которая зато наиболее производительна:<br/>
<br/>
<table>
<tr>
<td><pre>
def sum_even_fibo_le(upb):
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
<td>∪</td>
<td><pre>
cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):
    cdef unsigned long long f1, f2, res
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Воспользуемся нашим любимым GPP (или что, вы его ещё не полюбили?), вспомним те знания, которые мы приобрели в процессе создания первой программы-полиглота Python/GPP, и напишем для начала программу на GPP:<br/>
<br/>
<table>
<tr>
<td><pre>
#ifdef debug
def sum_even_fibo_le(upb):
#else
cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):
    cdef unsigned long long f1, f2, res
#endif
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Неплохо. Но если мы попытаемся прочитать её как программу на Python, считая строки с диезами за комментарии, мы увидим, что это вовсе не полиглот. А невалидная программа на Python — сразу после строчки с <code>def</code> идёт строчка с <code>cpdef</code>. Будем думать, как же замаскировать от интерпретатора Python код на Cython.<br/>
<br/>
Предыдущий опыт подсказывает нам, что блок <code>#ifdef debug</code> должен содержать только код на Python, а блок <code>#else</code> — только препроцессорный код. Или комментарии. Но как спрятать от интерпретации Python-ом блок <code>#else</code>? Если мы закомментируем его — посредством GPP мы не сможем его раскомментировать. Если мы создадим какой-нибудь макрос GPP, который комментирует этот блок в debug-build и декомментирует в release-build — это будет невалидным кодом на Python, без прохода GPP.<br/>
<br/>
Посмотрим повнимательнее на стыки языков и попробуем сделать что-нибудь там. Подсказку нам может дать то, как выглядят и где находятся нежелательные Cython-строчки при интерпретации получившегося кода как Python-функции:<br/>
<br/>
<table>
<tr>
<td><pre>
def sum_even_fibo_le(upb):
cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):
    cdef unsigned long long f1, f2, res
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
… Они находятся прямо под сигнатурой функции, в том месте, где должны находиться… docstring-и!<br/>
<br/>
Ага. Идея ясна. Попробуем поправить этот код так, чтобы Cython-овые строчки выглядели docstring-ами (или просто свободными строками) при интерпретации Python-ом. А с интерпретацией GPP — нет.<br/>
<br/>
<table>
<tr>
<td><pre>
#ifdef debug
def sum_even_fibo_le(upb):
    """
#else
cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):
    cdef unsigned long long f1, f2, res
#endif
    """
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Это ещё далеко не рабочий код, это только начало. Но идея ясна: с точки зрения Python (и, что обязательно — одновременно после препроцессинга GPP без <code>-Ddebug</code>), код на Cython станет docstring-ом.<br/>
<br/>
Но теперь у нас возникла проблема: проход препроцессором в режиме <code>-Ddebug</code> генерирует пустой docstring, а проход препроцессором в release-режиме генерирует только конечный триплет двойных кавычек от docstring-а. Тупик.<br/>
<br/>
Что-то надо сделать, чтобы избавиться от триплета кавычек в препроцессинге, но сохранить его без препроцессинга?<br/>
Или вообще — чтобы в режиме препроцессинга триплеты кавычек исчезали, а без препроцессинга оставались? Нет, конечно, можно каждый триплет обрамлять своим собственным <code>#if debug</code>, или что-нибудь в этом духе, но это громоздко. Вот если бы можно было в режиме препроцессинга их прятать… комментировать!<br/>
<br/>
И точно. В GPP же есть возможность создавать свои комментации для препроцессора. Вот и создадим их, многострочные, как в C: <code>/* ... */</code>. Триплетами кавычек мы с точки зрения Python-а будем «комментировать» (точнее, всё-таки прятать) Cython-овый код, а C-style кавычками мы с точки зрения Cython будем комментировать триплеты кавычек. А C-style кавычки, чтобы они не проявились в Python-е, спрячем внутрь Python-овых комментариев.<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python

#mode comment "/*" "*/"

#ifdef debug
def sum_even_fibo_le(upb):
#else /*
    """ */
cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):
    cdef unsigned long long f1, f2, res
#endif /*
    """ # */
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Всё прекрасно. Этот код генерирует всё, что надо, во всех режимах. Он позволяет одну и ту же функциональность отлаживать в Python-режиме, и одновременно он готов к компиляции Cython-ом. Он великолепен.<br/>
<br/>
<h1>Down to Earth</h1><br/>
… Ладно, согласен, он не великолепен. Положа руку на сердце, вынужден признать — он отстой. Его совершенно нереально поддерживать. Его можно только копипастить. Эта путаница знаков препинания совершенно неинтуитивна. Если нам понадобится указывать эту конструкцию для каждой функции, то код станет выглядеть как Дрезден после бомбёжки. В реальном продукте такого быть не должно.<br/>
<br/>
Хорошо. В лучших традициях доктора Хауса, первый диагноз и первое лечение оказались неверными и опасными для пациента. Делаем дифференциальный диагноз ещё раз, на основании того, что мы уже знаем.<br/>
<br/>
Нам надо сделать две препроцессорные ветки. Ветка <code>#ifdef debug</code> должна без препроцессинга генерировать не выполняющийся при интерпретации Python-ом код. Ветка <code>#else</code> должна содержать как раз работающий код. Это всё должно выглядеть достаточно понятно и читабельно, и использовать это должно быть просто.<br/>
<br/>
Следовательно, вариант с комментированием всего и вся и перекрываниями области комментирования в разных языках отметается. Он в любом случае был негоден — а что если бы где-нибудь в Python-е встретилась бы последовательность <code>/*</code>?<br/>
<br/>
Хорошо. Какие у нас ещё варианты?<br/>
<br/>
Препроцессорные макросы. Да, именно они. Это всё упрощает. В точности как мы делали в самом первом эксперименте с GPP и логгированием.<br/>
<br/>
Заведём макрос <code>cython()</code>, которым мы будем обрамлять весь код, который не предназначен для обработки Python-интерпретатором. И поместим в него всё Cython-оотносящееся. При интерпретации GPP этот макрос будет восприниматься именно как макрос; без интерпретации он будет ничего не делающей Python-овой функцией. Что-то типа такого:<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python

def cython(text):
    pass
#ifndef debug
#define cython(x) x
#endif

cython("cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):")
def sum_even_fibo_le(upb):
    cython("cdef unsigned long long f1, f2, res")
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Вот, это выглядит намного проще и понятнее. Хотя ещё не закончено. Если мы пропустим этот код через препроцессор, то, на удивление, мы увидим целых две проблемы:<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python

def cython(text):
    pass

"cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):"
def sum_even_fibo_le(upb):
    "cdef unsigned long long f1
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Во-первых, хоть Cython-овый код теперь прячется препроцессором достаточно неплохо, но Python-овый заголовок функции всё ещё светится. Делать нечего — придётся в каждой функции, для которой мы собираемся создавать Cython-овый аналог, писать ещё и кусок с явной проверкой на <code>#ifdef debug</code>.<br/>
<br/>
Во-вторых, GPP просто так не обладает концепцией «строк». Поэтому если мы хотим макросу <code>cython</code> передавать аргумент именно как единственный строковый компонент, который при раскрытии должен не печатать сами кавычки, мы должны указать соответствующую настройку в GPP. Последние правки…<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python

def cython(text):
    pass
#ifndef debug
#mode string QQQ "\"" "\""
#define cython(x) x
#endif

cython("cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):")
#ifdef debug
def sum_even_fibo_le(upb):
#endif
    cython("cdef unsigned long long f1, f2, res")
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Вот теперь всё в порядке. Такой код не страшно и в продакшн. Главное — не забывать не использовать двойные кавычки внутри аргумента <code>cython()</code>.<br/>
<br/>
<h1>Итог</h1><br/>
Что же, научились мы многому. Писать программы на Python и Cython одновременно. Убирать debug-код в релиз-билде. Немножко познакомились с особенностями оптимизатора Python-а. Теперь представим, как может выглядеть наша функция в режиме all included, в окончательном коде:<br/>
<br/>
<table>
<tr>
<td><pre>
#!/usr/bin/python

#include debug.py
from debug import cython, log

cython("cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):")
#ifdef debug
def sum_even_fibo_le(upb):
#endif
    cython("cdef unsigned long long f1, f2, res")
    log("Calculating sum_even_fibo_le")
    assert upb > 2
    f1, f2 = 1, 2
    res = 2
    while f2 &lt; upb:
        f2, f1 = f1 + f2, f2
        if f2 % 2 == 0:
            res += f2
    log(res)    
    return res
</pre></td>
</tr>
</table><br/>
<br/>
Вот с этим уже можно жить.</div></div> <!----> <!----></div> <div class="tm-article-body__tags"><div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Теги:</span> <span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BPython%5D" class="tm-article-body__tags-item-link">Python</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BCython%5D" class="tm-article-body__tags-item-link">Cython</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5BGPP%5D" class="tm-article-body__tags-item-link">GPP</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D1%80%D0%B5%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BE%D1%80%5D" class="tm-article-body__tags-item-link">препроцессор</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BE%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F%5D" class="tm-article-body__tags-item-link">оптимизация</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BD%D0%B5%D0%BD%D0%BE%D1%80%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5%20%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%5D" class="tm-article-body__tags-item-link">ненормальное программирование</a></span><span class="tm-article-body__tags-item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BF%D0%BE%D0%BB%D0%B8%D0%B3%D0%BB%D0%BE%D1%82%D1%8B%5D" class="tm-article-body__tags-item-link">полиглоты</a></span></div> <div class="tm-article-body__tags-links"><span class="tm-article-body__tags-title">Хабы:</span> <span class="tm-article-body__tags-item"><a href="/ru/hub/python/" class="tm-article-body__tags-item-link">
                  Python
                </a></span></div></div></article> <div class="tm-article__icons-wrapper"><div class="tm-data-icons tm-page-article__counters-panel"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 68: ↑60 и ↓8</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 68: ↑60 и ↓8" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+52</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    68
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/63109/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      20
    </span></a> <!----></div> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <!----></div> <!----> <div class="tm-page-article__additional-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body"><div class="tm-article-author tm-page-article__author"><!----> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-two-column"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/Honeyman/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/052/337/df7/052337df79576c450527ce51a573d49e.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 418 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    274
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info"><div class="tm-user-card__title"><span class="tm-user-card__name">Honeyman</span> <a href="/ru/users/Honeyman/" class="tm-user-card__nickname">
          @Honeyman
        </a> <!----></div> <p class="tm-user-card__short-info">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-two-column"><!----> <!----> <!----> <!----> <!----></div></div> <!----></div></div> <!----></section> <div class="tm-page-article__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/63109/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 20 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Похожие публикации</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2020-12-04T18:03:25.000Z" title="2020-12-04, 21:03">4  декабря  2020 в 21:03</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/news/t/531402/" class="tm-article-title__link"><span>Python как компилируемый статически типизированный язык программирования</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 28: ↑22 и ↓6</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 28: ↑22 и ↓6" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+16</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">11K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    31
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/news/t/531402/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      38
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2018-03-22T06:54:22.000Z" title="2018-03-22, 09:54">22  марта  2018 в 09:54</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/351772/" class="tm-article-title__link"><span>Язык программирования, рассчитанный на минификацию</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 56: ↑54 и ↓2</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 56: ↑54 и ↓2" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+52</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">21K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    49
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/351772/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      38
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2015-12-17T21:33:21.000Z" title="2015-12-18, 00:33">18  декабря  2015 в 00:33</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/273401/" class="tm-article-title__link"><span>Python-&gt;Cython-&gt;C++, да и COM в придачу: написание фреймворка для автотестов</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 15: ↑15 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 15: ↑15 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+15</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">14K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    87
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/273401/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      4
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----> <section class="tm-block tm-block_spacing-around"><header class="tm-block__header"><h2 class="tm-block__title">Лучшие публикации за сутки</h2> <!----></header> <div class="tm-block__body"><ul class="tm-article-list-block__list"><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T09:00:04.000Z" title="2021-09-27, 12:00">сегодня в 12:00</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580060/" class="tm-article-title__link"><span>Арракис, который мы заслужили</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 127: ↑124 и ↓3</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 127: ↑124 и ↓3" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+121</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">16K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    34
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580060/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      66
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-27T13:03:14.000Z" title="2021-09-27, 16:03">сегодня в 16:03</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/company/ruvds/blog/580124/" class="tm-article-title__link"><span>Электролюминесцентные индикаторы из прошлого</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 56: ↑56 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 56: ↑56 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+56</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">3.2K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    32
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/company/ruvds/blog/580124/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      9
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T19:37:10.000Z" title="2021-09-26, 22:37">вчера в 22:37</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580086/" class="tm-article-title__link"><span>Термо принтер и JavaScript</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 51: ↑50 и ↓1</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 51: ↑50 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+49</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">10K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    36
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580086/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      53
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T21:49:14.000Z" title="2021-09-27, 00:49">сегодня в 00:49</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580092/" class="tm-article-title__link"><span>30 сентября: Let's Encrypt и конец срока действия IdenTrust DST Root CA X3</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 46: ↑46 и ↓0</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 46: ↑46 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+46</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">18K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    54
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580092/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      92
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li><li class="tm-article-list-block__item"><article class="tm-article-snippet-block-block tm-article-snippet-block-block_preview"><div class="tm-article-snippet-block__user-meta"><div class="tm-article-snippet-block__date"><time datetime="2021-09-26T22:35:26.000Z" title="2021-09-27, 01:35">сегодня в 01:35</time></div></div> <h2 class="tm-article-title tm-article-title_block"><a href="/ru/post/580094/" class="tm-article-title__link"><span>Блокчейн нас подвёл? Почему ДЭГ — это плохо и можем ли мы адекватно контролировать процесс подсчёта голосов?</span></a></h2> <div class="tm-data-icons"><!----> <div class="tm-votes-meter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_small"><title>Всего голосов 54: ↑43 и ↓11</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-rating"></use></svg> <span title="Всего голосов 54: ↑43 и ↓11" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_small">+32</span></div> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">14K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    27
  </span></button> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/post/580094/comments/" class="tm-article-comments-counter-link__link"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.cee85629.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      97
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></article></li> <!----></ul></div> <!----></section> <!----> <!----></div></div></div> <div class="tm-page__sidebar"><div hl="ru" id="63109" class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/63109/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/63109/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"63109":{"id":"63109","timePublished":"2009-06-28T20:19:40+00:00","isCorporative":false,"lang":"ru","titleHtml":"Полиглоты в продакшн Питона","leadData":{"textHtml":"Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-\u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Fcrazydev\u002F62058\u002F\"\u003Eполиглоты\u003C\u002Fa\u003E, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является Python). При этом, в случае интерпретации на одном из них, программа будет генерировать другую программу, функционально схожую (или даже эквивалентную) той, которая выполняется в случае интерпретации на другом языке.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ самое интересное: подходы, используемые при написании этой программы, будут интересны не столько академически, сколько практически &mdash; при разработке программы с использованием этих подходов разработка будет проще и удобнее (хоть поначалу и чуточку непривычно), а программа будет эффективнее, чем без них.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВпрочем, это звучит страшнее, чем является.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Поехали?","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":274,"votesCount":418},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"10407","alias":"Honeyman","fullname":"Honeyman","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F052\u002F337\u002Fdf7\u002F052337df79576c450527ce51a573d49e.png","speciality":null},"statistics":{"commentsCount":20,"favoritesCount":68,"readingCount":5815,"score":52,"votesCount":68},"hubs":[{"relatedData":null,"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EСразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-\u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Fcrazydev\u002F62058\u002F\"\u003Eполиглоты\u003C\u002Fa\u003E, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является Python). При этом, в случае интерпретации на одном из них, программа будет генерировать другую программу, функционально схожую (или даже эквивалентную) той, которая выполняется в случае интерпретации на другом языке.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ самое интересное: подходы, используемые при написании этой программы, будут интересны не столько академически, сколько практически — при разработке программы с использованием этих подходов разработка будет проще и удобнее (хоть поначалу и чуточку непривычно), а программа будет эффективнее, чем без них.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВпрочем, это звучит страшнее, чем является.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003EПоехали?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch1\u003E__debug__\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\nНачнём с достаточно простого — с кодогенерации. Программисты на Python знают, что в Python нет никакого препроцессора (как, например, в C), который бы позволял создавать макросы, в зависимости от каких-то параметров генерирующие различный код на этапе compile-time. «Динамичность» Python-а, конечно, позволяет генерировать что угодно и когда угодно на runtime, но… иногда возможность влиять на compile time тоже полезна, и даже необходима.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПрепроцессора в Python, конечно, нет. Но все программисты на Python наверняка знают директиву assert, позволяющую добавить в код программы проверку, что в каком-то месте значение какого-то выражения инвариантно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПри этом они наверняка помнят, что эта директива при запуске интерпретатора Python «с оптимизацией» (т.е., ключом \u003Ccode\u003E-O\u003C\u002Fcode\u003E) игнорируется и интерпретатором не выполняется.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСравним, например,\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython\r\n\r\ndef func(x):\r\n    assert x \u003E 5\r\n    return x\r\n\r\nimport dis; dis.dis(func)\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E→\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n\r\n  4           0 LOAD_FAST                0 (x)\r\n              3 LOAD_CONST               1 (5)\r\n              6 COMPARE_OP               4 (\u003E)\r\n              9 JUMP_IF_TRUE             7 (to 19)\r\n             12 POP_TOP\r\n             13 LOAD_GLOBAL              0 (AssertionError)\r\n             16 RAISE_VARARGS            1\r\n        \u003E\u003E   19 POP_TOP\r\n\r\n  5          20 LOAD_FAST                0 (x)\r\n             23 RETURN_VALUE\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\nи\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython -O\r\n\r\ndef func(x):\r\n    assert x \u003E 5\r\n    return x\r\n\r\nimport dis; dis.dis(func)\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E→\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n  5           0 LOAD_FAST                0 (x)\r\n              3 RETURN_VALUE\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто из этого следует? Что, варьируя значение оптимизации при старте генерации байт-кода, можно получить совершенно разный байт-код. Код, который по-разному ведёт себя в зависимости от того, был он запущен в режиме оптимизации или без. Что это, как не зачаток препроцессора?\u003Cbr\u002F\u003E\r\nЗачем нам это может быть полезно? Для того, чтобы существенно разделять в поведении debug- и release-build-ы. Всё как «в больших языках» — куча проверок, логов и информативности в debug-build-е, быстрый и эффективный код в release-build-е. Но не мало ли для этого одной директивы assert?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, assert ведёт себя по-разному в зависимости от настройки оптимизации, которая была в момент генерации байт-кода (при этом я надеюсь, что все помнят\u002Fзнают, что байт-код вовсе не обязательно перегенерировать каждый раз? Более того, его, т.е. файлы \u003Ccode\u003E.pyc\u003C\u002Fcode\u003E\u002F\u003Ccode\u003E.pyo\u003C\u002Fcode\u003E, можно распространять без исходников, из которых они были сгенерированы).\u003Cbr\u002F\u003E\r\nИз этого вполне логично следует, что генератору байт-кода доступна информация, была ли включена оптимизация на момент его запуска. А как, кстати, он умеет оптимизировать код?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТак вот, эта самая информация доступна ему в виде константы \u003Ccode\u003E__debug__\u003C\u002Fcode\u003E. Обратите внимание — действительно константы. Не так что часто в абсолютно динамическом языке Python-а можно найти константы :) Но раз уж это константа, то оптимизатор таки умеет генерировать код по-разному, в зависимости от её значения:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython\r\n\r\ndef func():\r\n    if __debug__:\r\n        print\r\n\r\nimport dis; dis.dis(func)\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E→\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n\r\n  5           0 PRINT_NEWLINE\r\n              1 LOAD_CONST               0 (None)\r\n              4 RETURN_VALUE\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython -O\r\n\r\ndef func():\r\n    if __debug__:\r\n        print\r\n\r\nimport dis; dis.dis(func)\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E→\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n  4           0 LOAD_CONST               0 (None)\r\n              3 RETURN_VALUE\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ это, и, как частный случай, оптимизация директивы assert (ну, плюс ещё удаление docstring-ов при \u003Ccode\u003E-OO\u003C\u002Fcode\u003E) и составляет фактически весь спектр умений оптимизатора.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭтот оптимизатор настолько прост, что, хоть он и умеет оптимизировать генерацию кода для операторов \u003Ccode\u003Eor\u003C\u002Fcode\u003E и \u003Ccode\u003Eand\u003C\u002Fcode\u003E над \u003Ci\u003Eпеременными\u003C\u002Fi\u003E (так, что вторая часть проверки не будет \u003Ci\u003Eвыполняться\u003C\u002Fi\u003E в случае ненадобности), но оптимизировать генерацию кода, когда первой проверкой является \u003Ci\u003Eконстанта\u003C\u002Fi\u003E (так, что вторая часть проверки не будет \u003Ci\u003Eгенерироваться\u003C\u002Fi\u003E в случае ненадобности), он уже не умеет:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython -O\r\n\r\ndef func(x):\r\n    if __debug__ and x \u003E 5:\r\n        print\r\n\r\nimport dis\r\ndis.dis(func)\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E→\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n  4           0 LOAD_GLOBAL              0 (__debug__)\r\n              3 JUMP_IF_FALSE           18 (to 24)\r\n              6 POP_TOP\r\n              7 LOAD_FAST                0 (x)\r\n             10 LOAD_CONST               1 (5)\r\n             13 COMPARE_OP               4 (\u003E)\r\n             16 JUMP_IF_FALSE            5 (to 24)\r\n             19 POP_TOP\r\n\r\n  5          20 PRINT_NEWLINE\r\n             21 JUMP_FORWARD             1 (to 25)\r\n        \u003E\u003E   24 POP_TOP\r\n        \u003E\u003E   25 LOAD_CONST               0 (None)\r\n             28 RETURN_VALUE\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОбратите внимание: хоть оптимизация и была включена, хоть сгенерированный код и способен пропустить проверку на \u003Ccode\u003Ex \u003E 5\u003C\u002Fcode\u003E, если после проверки он выяснит, что константа \u003Ccode\u003E__debug__\u003C\u002Fcode\u003E установлена в \u003Ccode\u003ETrue\u003C\u002Fcode\u003E, но саму проверку он будет делать. Поэтому, если необходимо избавиться даже от генерации какого-то кода в release-build-е, придётся оптимизировать код «по старинке» — делать вложенные проверки, сначала на значение \u003Ccode\u003E__debug__\u003C\u002Fcode\u003E, и только внутри неё на \u003Ccode\u003Ex \u003E 5\u003C\u002Fcode\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython -O\r\n\r\ndef func(x):\r\n    if __debug__:\r\n        if x \u003E 5:\r\n            print\r\n\r\nimport dis\r\ndis.dis(func)\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E→\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n  4           0 LOAD_CONST               0 (None)\r\n              3 RETURN_VALUE\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКстати, тернарный оператор тоже не оптимизируется на проверку константы:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython -O\r\n\r\ndef func(x):\r\n    return 5 if __debug__ else 7\r\n\r\nimport dis\r\ndis.dis(func)\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E→\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n  4           0 LOAD_GLOBAL              0 (__debug__)\r\n              3 JUMP_IF_FALSE            7 (to 13)\r\n              6 POP_TOP\r\n              7 LOAD_CONST               1 (5)\r\n             10 JUMP_FORWARD             4 (to 17)\r\n        \u003E\u003E   13 POP_TOP\r\n             14 LOAD_CONST               2 (7)\r\n        \u003E\u003E   17 RETURN_VALUE\r\n\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВспомним, для чего мы это делаем: для того, чтобы иметь возможность в debug-build-ах иметь сколь угодно детальную отладочную информацию (например, выводящуюся в сервисные логи), которая бы при этом опускалась и не влияла на производительность release-build-ов.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗато теперь, когда мы точно знаем, что и как можно делать с переменной \u003Ccode\u003E__debug__\u003C\u002Fcode\u003E (никаких составных логических операций, никаких тернарных операций — только чистая проверка одной переменной \u003Ccode\u003E__debug__\u003C\u002Fcode\u003E на валидность), мы можем сделать, например, следующее:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\nif __debug__:\r\n    def log(msg):\r\n        __do_some_heavy_logging(msg)\r\nelse:\r\n    def log(msg):\r\n        pass\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто уже что-то. Теперь мы можем понавставлять \u003Ccode\u003Elog(что-нибудь)\u003C\u002Fcode\u003E хоть в каждую вторую строку кода — на производительность release-build-а это нисколько не повлияет.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНу, честно говоря, \u003Ci\u003Eпочти\u003C\u002Fi\u003E нисколько. Пусть теперь на release-build-е мы и не пишем каждую строчку лога посредством жутко медленного вызова процедуры \u003Ccode\u003E__do_some_heavy_logging()\u003C\u002Fcode\u003E печати строчки на древнем рулонном АЦПУ — но вызов каждой функции \u003Ccode\u003Elog()\u003C\u002Fcode\u003E, пусть и пустой, в release-build-е сохранится. И генерация сообщения для него (если она тоже вычислительно нетривиальна). Но тут уже ничего не поделаешь. В Python препроцессора нет, и совсем опускать вызов \u003Ccode\u003Elog()\u003C\u002Fcode\u003E на debug-build-ах у нас не получится. Впрочем…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch1\u003EGPP: GNU Python Preprocessor\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\n… Впрочем, если препроцессора нет в самом Python-е, почему бы не взять его извне? Чего только не сделаешь в стремлении оптимизировать release-build.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСлава богам, на свете существует GPP — Generic Preprocessor, General-Purpose Processor, а теперь ещё и новый backronym — GNU Python Preprocessor. Почему бы и нет?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОсобо описывать его и перечитывать man вслух неохота. Скажу только, что синтаксис его фактически повторяет синтаксис препроцессора в C: \u003Ccode\u003E#define\u003C\u002Fcode\u003E, \u003Ccode\u003E#if\u003C\u002Fcode\u003E и т.п.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто очень даже удобно — в Python со знака диеза начинаются комментарии. Осознаёте, что это значит?..\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПравильно. Сейчас мы будем писать программу-\u003Ca href=\"http:\u002F\u002Fhabrahabr.ru\u002Fblogs\u002Fcrazydev\u002F62058\u002F\"\u003Eполиглот\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДа. Это вполне себе полноценный полиглот. Программа на двух языках — языке Python (не обладающем препроцессором), и на языке GPP.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПри этом это программы не уровня \u003Ccode\u003Eprint \"Hello world\"\u003C\u002Fcode\u003E, одинаково ведущей себя на 4242 различных языках и диалектах программирования. Отнюдь, наши программы будут иметь вовсе даже различные задачи. Программа на Python (1) должна будет решить ту задачу, ради которой мы её пишем. Программа на GPP (2) должна сгенерировать программы на Python (3)\u002F(4), решающие задачу, ради которой мы её пишем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПричём, обратите внимания на два забавных факта. Во-первых, программа на GPP будет генерировать не одну, а как минимум (в нашем случае) две различных программы на Python. Одну (3) — соответствующую debug-build-у, другую (4) — соответствующую release-build-у. А во-вторых, (1) определённо вовсе не равно (4) (ради того, чтобы релиз-билд отличался от промежуточного разработческого в сторону повышения производительности за счёт выкидывания отладочного кода, мы всё и затеяли), и даже не обязан быть равным (3)! Но лучше, конечно, чтобы хотя бы (1) был равен (3). Иначе запутаемся. Слишком много уровней, на которых одновременно надо мыслить. Типичная проблема при написании программы-полиглота.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНу что, попробуем?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПишем исходник на GPP:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#ifdef debug\r\n#define log(msg) __do_some_heavy_logging(msg)\r\n#else\r\n#define log(msg)\r\n#endif\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ общем, неплохо. Если мы вызывали GPP с параметром \u003Ccode\u003E-Ddebug\u003C\u002Fcode\u003E, то он в каждое место исходника, где встречался вызов функции \u003Ccode\u003Elog()\u003C\u002Fcode\u003E, подставит вместо него вызов функции \u003Ccode\u003E__do_some_heavy_logging(msg)\u003C\u002Fcode\u003E. По сравнению с кодом, основанным на \u003Ccode\u003E__debug__\u003C\u002Fcode\u003E, уже прямая выгода — меньше на один промежуточный вызов функции. Если же мы вызывали GPP без такого параметра, то каждый вызов функции \u003Ccode\u003Elog()\u003C\u002Fcode\u003E он заменит на пустую строку…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУра! То, что нам надо… или нет?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА если мы выполним этот код сразу в интерпретаторе Python-а без препроцессинга? Тогда при любом вызове функции \u003Ccode\u003Elog()\u003C\u002Fcode\u003E интерпретатор просто не найдёт её — у нас же она определена в препроцессоре.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА значит, надо её определить и на уровне Python-а. Причём так, чтобы не помешать препроцессору. Второй блин:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\ndef log(msg):\r\n    __do_some_heavy_logging(msg)\r\n#ifdef debug\r\n#define log(msg) __do_some_heavy_logging(msg)\r\n#else\r\n#define log(msg)\r\n#endif\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУже лучше. Без препроцессинга — создаём функцию \u003Ccode\u003Elog()\u003C\u002Fcode\u003E и используем её каждый раз при вызове \u003Ccode\u003Elog()\u003C\u002Fcode\u003E в коде. С препроцессингом, без переменной препроцессора \u003Ccode\u003Edebug\u003C\u002Fcode\u003E — вызовы \u003Ccode\u003Elog()\u003C\u002Fcode\u003E заменяем на пустую строку. С препроцессингом, с переменной препроцессора \u003Ccode\u003Edebug\u003C\u002Fcode\u003E: вызовы \u003Ccode\u003Elog()\u003C\u002Fcode\u003E заменяем на вызовы \u003Ccode\u003E__do_some_heavy_logging()\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХорошо? Уже лучше. Но есть один нюанс: у нас (1) получился не равным (3). Что, конечно, хоть и красиво, но потенциально опасно в процессе разработки. Лучше всё-таки сделать так, чтобы препроцессированный в режиме \u003Ccode\u003Edebug\u003C\u002Fcode\u003E код был абсолютно эквивалентен коду без препроцессинга. И поэтому весь его поместить внутри проверки \u003Ccode\u003E#ifdef debug\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#ifdef debug\r\ndef log(msg):\r\n    _do_some_heavy_logging(msg)\r\n#else\r\n#define log(msg)\r\n#endif\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот так намного лучше. В секции \u003Ccode\u003E#ifdef debug\u003C\u002Fcode\u003E — только непрепроцессорный код, и поэтому программа будет себя одинаково вести и с препроцессором и переменной \u003Ccode\u003E-Ddebug\u003C\u002Fcode\u003E, и без препроцессора. В секции \u003Ccode\u003Eelse\u003C\u002Fcode\u003E только препроцессорный код (и поэтому он сработает только в release-build-е). Так-то. И даже Python-овой переменной \u003Ccode\u003E__debug__\u003C\u002Fcode\u003E больше не надо.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch1\u003ECython\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\nТеперь, когда мы научились генерировать Python-овый код препроцессором и при этом сохранять запускаемость без прохода препроцессором, почему бы не взять задачу посложнее?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПочему бы нам не попробовать написать программу, которая после прохода GPP в режиме release (без переменной \u003Ccode\u003E-Ddebug\u003C\u002Fcode\u003E) генерирует код на \u003Ci\u003Eвообще другом\u003C\u002Fi\u003E языке программирования? Ну, или на \u003Ci\u003Eпочти другом\u003C\u002Fi\u003E?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА зачем?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nА, например, затем, что этим языком может быть язык Cython. Основанный на Python-е и близкий к нему по синтаксису, но при этом явно типизированный. И имеющий милую и полезную в хозяйстве возможность: программа\u002Fмодуль на Cython может транслироваться в исходник на C, а из этого исходника после компиляции может создаться модуль, пригодную для использования из Python-ового кода.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕдинственное что — программы на Cython обратно не совместимы с Python-ом. А вот программы на Python обычно являются корректными программами на Cython. С одной стороны, это упрощает задачу до почти что тривиальности. С другой — мы не пионеры, чтобы создавать себе трудности и героически решать их, мы просто хотим писать на Python эффективно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, цель: написать модуль на Python (1'), имеющий функцию, производящую какие-то вычисления. Этот модуль должен спокойно импортироваться и использоваться самим Python-ом без какого бы то ни было препроцессинга — чтобы удобнее разрабатывать было. Кроме того, этот модуль должен являться программой на GPP (2'). Которая, в случае соответственного указания переменных GPP, должна сгенерировать программу на Cython (3'). Содержащую алгоритм, полностью аналогичный программе (1'), но при этом типизированный. Такой, что после трансляции исходника (3') в C (4') и компиляции создастся бинарная библиотека Python-а, выполняющая всё то же самое, что и в (1'), только, за счёт компилированного кода, намного быстрее.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ качестве решаемой задачи возьмём, например, \u003Ca href=\"http:\u002F\u002Fprojecteuler.net\u002Findex.php?section=problems&amp;id=2\"\u003Eвторую задачу Project Euler\u003C\u002Fa\u003E: \u003Ci\u003Eнайти сумму всех чётных чисел Фибоначчи, не превышающих четырёх миллионов\u003C\u002Fi\u003E. Представим, что нам её надо решать как часть гораздо большей проблемы, и задачу мы по-прежнему хотим решать на Python-е. Просто именно эту функцию мы хотим оптимизировать по производительности, переписав её на Cython-е. При этом хотим сохранить возможность запускать этот же код и без обработки Cython-ом (и GPP), как обычный Python-овый код, из соображений удобства разработки.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЖелаемый процесс выглядит разработки следующим образом: мы делаем модуль Python-а, из которого мы в процессе разработки и отладки и будем импортировать вычисляющую решение нашей задачи функцию. Этот же код при сборке release-build-а будет интерпретирован посредством GPP, который сгенерирует при этом эквивалентную программу на Cython (с необходимой для данной задачи типизацией данных); далее в процессе сборки release-build-а программа на Cython будет транслирована Cython-ом в программу на C, которая будет скомпилирована в библиотеку, доступную для использования Python-овому коду. И в release-build-е вызывающий Python-овый код будет импортировать функцию уже не из Python-ового модуля, а из бинарной библиотеки, скомпилированную и очень быструю.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак же должна выглядеть функция, решающая вторую задачу? Спойлер, конечно… но это вторая задача, и любой разумный программист, дочитавший до этой строчки и не ускользнувший в царство Морфея, наверняка спокойно решит её сам. Поэтому не будет большой потерей для учебного процесса, если я напишу эту функцию:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\ndef sum_even_fibo_le(upb):\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСоответственно, мы пишем модуль \u003Ccode\u003Efibo.py\u003C\u002Fcode\u003E, который содержит эту функцию, в основной программе импортируем функцию из этого модуля и вызываем, передав верхнюю границу для задачи.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХоть эта функция даже для верхней границы в четыре миллиона и выполняется достаточно быстро даже в интерпретируемом Python, но в данном случае она просто демонстрирует возможности, которых мы можем добиться. Поэтому попытаемся оптимизировать её, несмотря ни на что. Перепишем её на Cython.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ принципе, уже имеющаяся у нас функция на Python является вполне валидной функцией на Cython. Более того, будучи скомпилирована Cython-ом, она даже будет работать быстрее. Раза этак в два-три. Потому что полностью исчезнет этап обработки байт-кода, и вместо него машинный код будет сразу выполнять необходимые операции над Python-овыми объектами.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНо это не предел. Если мы решим типизировать наши данные (при этом, к сожалению, потеряв приятную неограниченность Python-ового типа данных long), то наш код будет работать ещё быстрее.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто мы будем (можем) типизировать в Cython? Входные аргументы функций. Выходные результаты функций. Промежуточные переменные.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот и типизируем всё. Посчитаем, что 64 bit should be enough for everybody, и все переменные приведём к unsigned long long. Заодно и познакомимся с Cython-ом, кто его не знает:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\ncdef unsigned long long sum_even_fibo_le(unsigned long long upb):\r\n    cdef unsigned long long f1, f2, res\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n    \u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКод хороший, достаточно читабельный для питонистов, и вполне понятный. Он имеет только два недостатка:\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EОн уже не является валидным кодом на Python. Впрочем, мы это решим. Препроцессором. Но…\u003C\u002Fli\u003E\r\n\u003Cli\u003EОн не работает.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНу не то что бы совсем не работает. Просто не решает нашу задачу. Этим кодом прекрасно создаётся, в терминологии Cython, «C function». Которую можно вызывать из другого кода на Cython или даже на C, но которую нельзя вызывать из кода на Python. Что нам не подходит.\u003Cbr\u002F\u003E\r\nПридётся модифицировать эту функцию так, чтобы она осталась «Python function». С чуточку медленным вызовом (впрочем, вызов из кода на Cython можно сохранить быстрым), возвращающую PyObject (если кого-то волнуют внутренности Python-ового интерпретатора).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\ncpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\r\n    cdef unsigned long long f1, f2, res\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИтак, мы имеем функцию на Python, которая решает нашу задачу пусть и медленно, зато модуль с ней удобнее отлаживать — запускать на интерпретацию без промежуточной обработки. И функцию на Cython, которую обычный интерпретатор Python уже не поймёт, но которая зато наиболее производительна:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\ndef sum_even_fibo_le(upb):\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E∪\u003C\u002Ftd\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\ncpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\r\n    cdef unsigned long long f1, f2, res\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВоспользуемся нашим любимым GPP (или что, вы его ещё не полюбили?), вспомним те знания, которые мы приобрели в процессе создания первой программы-полиглота Python\u002FGPP, и напишем для начала программу на GPP:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#ifdef debug\r\ndef sum_even_fibo_le(upb):\r\n#else\r\ncpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\r\n    cdef unsigned long long f1, f2, res\r\n#endif\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНеплохо. Но если мы попытаемся прочитать её как программу на Python, считая строки с диезами за комментарии, мы увидим, что это вовсе не полиглот. А невалидная программа на Python — сразу после строчки с \u003Ccode\u003Edef\u003C\u002Fcode\u003E идёт строчка с \u003Ccode\u003Ecpdef\u003C\u002Fcode\u003E. Будем думать, как же замаскировать от интерпретатора Python код на Cython.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПредыдущий опыт подсказывает нам, что блок \u003Ccode\u003E#ifdef debug\u003C\u002Fcode\u003E должен содержать только код на Python, а блок \u003Ccode\u003E#else\u003C\u002Fcode\u003E — только препроцессорный код. Или комментарии. Но как спрятать от интерпретации Python-ом блок \u003Ccode\u003E#else\u003C\u002Fcode\u003E? Если мы закомментируем его — посредством GPP мы не сможем его раскомментировать. Если мы создадим какой-нибудь макрос GPP, который комментирует этот блок в debug-build и декомментирует в release-build — это будет невалидным кодом на Python, без прохода GPP.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПосмотрим повнимательнее на стыки языков и попробуем сделать что-нибудь там. Подсказку нам может дать то, как выглядят и где находятся нежелательные Cython-строчки при интерпретации получившегося кода как Python-функции:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\ndef sum_even_fibo_le(upb):\r\ncpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\r\n    cdef unsigned long long f1, f2, res\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n… Они находятся прямо под сигнатурой функции, в том месте, где должны находиться… docstring-и!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nАга. Идея ясна. Попробуем поправить этот код так, чтобы Cython-овые строчки выглядели docstring-ами (или просто свободными строками) при интерпретации Python-ом. А с интерпретацией GPP — нет.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#ifdef debug\r\ndef sum_even_fibo_le(upb):\r\n    \"\"\"\r\n#else\r\ncpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\r\n    cdef unsigned long long f1, f2, res\r\n#endif\r\n    \"\"\"\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто ещё далеко не рабочий код, это только начало. Но идея ясна: с точки зрения Python (и, что обязательно — одновременно после препроцессинга GPP без \u003Ccode\u003E-Ddebug\u003C\u002Fcode\u003E), код на Cython станет docstring-ом.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНо теперь у нас возникла проблема: проход препроцессором в режиме \u003Ccode\u003E-Ddebug\u003C\u002Fcode\u003E генерирует пустой docstring, а проход препроцессором в release-режиме генерирует только конечный триплет двойных кавычек от docstring-а. Тупик.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧто-то надо сделать, чтобы избавиться от триплета кавычек в препроцессинге, но сохранить его без препроцессинга?\u003Cbr\u002F\u003E\r\nИли вообще — чтобы в режиме препроцессинга триплеты кавычек исчезали, а без препроцессинга оставались? Нет, конечно, можно каждый триплет обрамлять своим собственным \u003Ccode\u003E#if debug\u003C\u002Fcode\u003E, или что-нибудь в этом духе, но это громоздко. Вот если бы можно было в режиме препроцессинга их прятать… комментировать!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИ точно. В GPP же есть возможность создавать свои комментации для препроцессора. Вот и создадим их, многострочные, как в C: \u003Ccode\u003E\u002F* ... *\u002F\u003C\u002Fcode\u003E. Триплетами кавычек мы с точки зрения Python-а будем «комментировать» (точнее, всё-таки прятать) Cython-овый код, а C-style кавычками мы с точки зрения Cython будем комментировать триплеты кавычек. А C-style кавычки, чтобы они не проявились в Python-е, спрячем внутрь Python-овых комментариев.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython\r\n\r\n#mode comment \"\u002F*\" \"*\u002F\"\r\n\r\n#ifdef debug\r\ndef sum_even_fibo_le(upb):\r\n#else \u002F*\r\n    \"\"\" *\u002F\r\ncpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\r\n    cdef unsigned long long f1, f2, res\r\n#endif \u002F*\r\n    \"\"\" # *\u002F\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВсё прекрасно. Этот код генерирует всё, что надо, во всех режимах. Он позволяет одну и ту же функциональность отлаживать в Python-режиме, и одновременно он готов к компиляции Cython-ом. Он великолепен.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch1\u003EDown to Earth\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\n… Ладно, согласен, он не великолепен. Положа руку на сердце, вынужден признать — он отстой. Его совершенно нереально поддерживать. Его можно только копипастить. Эта путаница знаков препинания совершенно неинтуитивна. Если нам понадобится указывать эту конструкцию для каждой функции, то код станет выглядеть как Дрезден после бомбёжки. В реальном продукте такого быть не должно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХорошо. В лучших традициях доктора Хауса, первый диагноз и первое лечение оказались неверными и опасными для пациента. Делаем дифференциальный диагноз ещё раз, на основании того, что мы уже знаем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНам надо сделать две препроцессорные ветки. Ветка \u003Ccode\u003E#ifdef debug\u003C\u002Fcode\u003E должна без препроцессинга генерировать не выполняющийся при интерпретации Python-ом код. Ветка \u003Ccode\u003E#else\u003C\u002Fcode\u003E должна содержать как раз работающий код. Это всё должно выглядеть достаточно понятно и читабельно, и использовать это должно быть просто.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСледовательно, вариант с комментированием всего и вся и перекрываниями области комментирования в разных языках отметается. Он в любом случае был негоден — а что если бы где-нибудь в Python-е встретилась бы последовательность \u003Ccode\u003E\u002F*\u003C\u002Fcode\u003E?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nХорошо. Какие у нас ещё варианты?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПрепроцессорные макросы. Да, именно они. Это всё упрощает. В точности как мы делали в самом первом эксперименте с GPP и логгированием.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗаведём макрос \u003Ccode\u003Ecython()\u003C\u002Fcode\u003E, которым мы будем обрамлять весь код, который не предназначен для обработки Python-интерпретатором. И поместим в него всё Cython-оотносящееся. При интерпретации GPP этот макрос будет восприниматься именно как макрос; без интерпретации он будет ничего не делающей Python-овой функцией. Что-то типа такого:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython\r\n\r\ndef cython(text):\r\n    pass\r\n#ifndef debug\r\n#define cython(x) x\r\n#endif\r\n\r\ncython(\"cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\")\r\ndef sum_even_fibo_le(upb):\r\n    cython(\"cdef unsigned long long f1, f2, res\")\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот, это выглядит намного проще и понятнее. Хотя ещё не закончено. Если мы пропустим этот код через препроцессор, то, на удивление, мы увидим целых две проблемы:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython\r\n\r\ndef cython(text):\r\n    pass\r\n\r\n\"cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\"\r\ndef sum_even_fibo_le(upb):\r\n    \"cdef unsigned long long f1\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВо-первых, хоть Cython-овый код теперь прячется препроцессором достаточно неплохо, но Python-овый заголовок функции всё ещё светится. Делать нечего — придётся в каждой функции, для которой мы собираемся создавать Cython-овый аналог, писать ещё и кусок с явной проверкой на \u003Ccode\u003E#ifdef debug\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВо-вторых, GPP просто так не обладает концепцией «строк». Поэтому если мы хотим макросу \u003Ccode\u003Ecython\u003C\u002Fcode\u003E передавать аргумент именно как единственный строковый компонент, который при раскрытии должен не печатать сами кавычки, мы должны указать соответствующую настройку в GPP. Последние правки…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython\r\n\r\ndef cython(text):\r\n    pass\r\n#ifndef debug\r\n#mode string QQQ \"\\\"\" \"\\\"\"\r\n#define cython(x) x\r\n#endif\r\n\r\ncython(\"cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\")\r\n#ifdef debug\r\ndef sum_even_fibo_le(upb):\r\n#endif\r\n    cython(\"cdef unsigned long long f1, f2, res\")\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот теперь всё в порядке. Такой код не страшно и в продакшн. Главное — не забывать не использовать двойные кавычки внутри аргумента \u003Ccode\u003Ecython()\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch1\u003EИтог\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\nЧто же, научились мы многому. Писать программы на Python и Cython одновременно. Убирать debug-код в релиз-билде. Немножко познакомились с особенностями оптимизатора Python-а. Теперь представим, как может выглядеть наша функция в режиме all included, в окончательном коде:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ctable\u003E\r\n\u003Ctr\u003E\r\n\u003Ctd\u003E\u003Cpre\u003E\r\n#!\u002Fusr\u002Fbin\u002Fpython\r\n\r\n#include debug.py\r\nfrom debug import cython, log\r\n\r\ncython(\"cpdef unsigned long long sum_even_fibo_le(unsigned long long upb):\")\r\n#ifdef debug\r\ndef sum_even_fibo_le(upb):\r\n#endif\r\n    cython(\"cdef unsigned long long f1, f2, res\")\r\n    log(\"Calculating sum_even_fibo_le\")\r\n    assert upb \u003E 2\r\n    f1, f2 = 1, 2\r\n    res = 2\r\n    while f2 &lt; upb:\r\n        f2, f1 = f1 + f2, f2\r\n        if f2 % 2 == 0:\r\n            res += f2\r\n    log(res)    \r\n    return res\r\n\u003C\u002Fpre\u003E\u003C\u002Ftd\u003E\r\n\u003C\u002Ftr\u003E\r\n\u003C\u002Ftable\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот с этим уже можно жить.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"Python"},{"titleHtml":"Cython"},{"titleHtml":"GPP"},{"titleHtml":"препроцессор"},{"titleHtml":"оптимизация"},{"titleHtml":"ненормальное программирование"},{"titleHtml":"полиглоты"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F63109\u002Fcbb3a2d19ed1f98e6e505bd583df10aa\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F63109\u002Fcbb3a2d19ed1f98e6e505bd583df10aa\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F63109\\\u002F\"},\"headline\":\"Полиглоты в продакшн Питона\",\"datePublished\":\"2009-06-29T00:19:40+04:00\",\"dateModified\":\"2009-06-29T10:16:41+04:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Honeyman\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F63109\\\u002F#post-content-body\",\"about\":[\"h_python\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F63109\\\u002Fcbb3a2d19ed1f98e6e505bd583df10aa\\\u002F\"]}","metaDescription":"Сразу, в порядке завлекалочки. Нашей целью будет научиться писать программы-полиглоты, способные интерпретироваться сразу на нескольких языках программирования (одним, «базовым» из которых является...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false},"572164":{"id":"572164","timePublished":"2021-09-27T11:37:23+00:00","isCorporative":false,"lang":"ru","titleHtml":"Первые шаги в ОТО: прецессия орбиты Меркурия","editorVersion":"2.0","postType":"article","postLabels":[{"type":"tutorial","data":null}],"author":{"id":"1832999","alias":"Yermack","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F690\u002F140\u002F823\u002F690140823f555d03574a59d46f648d24.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":2,"favoritesCount":16,"readingCount":2135,"score":12,"votesCount":12},"hubs":[{"relatedData":null,"id":"18840","alias":"julia","type":"collective","title":"Julia","titleHtml":"Julia","isProfiled":true},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21968","alias":"physics","type":"collective","title":"Физика","titleHtml":"Физика","isProfiled":false},{"relatedData":null,"id":"22022","alias":"astronomy","type":"collective","title":"Астрономия","titleHtml":"Астрономия","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКогда речь заходит о теории относительности, частенько на ровном месте разрастаются споры, которые были занесены в почву непонимания и обильно удобрены мифами, недосказанностью и недостаточной математической подготовкой. Даже на лекциях от некоторых профессоров можно услышать, что детище гения Эйнштейна не имеет практической пользы, а на робкие попытки пролепетать что-то про спутниковые системы навигации они пренебрежительно отмахиваются, дескать, там все сложно и двояко. \u003C\u002Fp\u003E\u003Cp\u003EТак что совершенно естественно желание попробовать провести некоторые расчеты самолично, потрогать формулы, покрутить параметры, чтобы постепенно заложить интуицию в столь горячей теме.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa9f\u002Ff59\u002Fb65\u002Fa9ff59b65da6e8b1e6f59314aadb8e3d.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"прецессия"},{"titleHtml":"меркурий"},{"titleHtml":"теория относительности"},{"titleHtml":"уравнения эйнштейна"},{"titleHtml":"метрики"},{"titleHtml":"спасибо scihub"},{"titleHtml":"спасибо mathpix"},{"titleHtml":"астрология_точная_наука"}]},"579542":{"id":"579542","timePublished":"2021-09-26T19:00:02+00:00","isCorporative":true,"lang":"ru","titleHtml":"Jetpack Compose — как легко построить UI на Android","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2713395","alias":"i15in","fullname":"Иван","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F25f\u002Fe4b\u002Ff94\u002F25fe4bf94867d9647a0ae809abf2e429.jpg","speciality":"Android developer"},"statistics":{"commentsCount":12,"favoritesCount":55,"readingCount":4249,"score":31,"votesCount":39},"hubs":[{"relatedData":null,"id":"18232","alias":"funcorp","type":"corporative","title":"Блог компании FUNCORP","titleHtml":"Блог компании FUNCORP","isProfiled":false},{"relatedData":null,"id":"6345","alias":"mobile_dev","type":"collective","title":"Разработка мобильных приложений","titleHtml":"Разработка мобильных приложений","isProfiled":true},{"relatedData":null,"id":"9188","alias":"ui","type":"collective","title":"Интерфейсы","titleHtml":"Интерфейсы","isProfiled":true},{"relatedData":null,"id":"17107","alias":"android_dev","type":"collective","title":"Разработка под Android","titleHtml":"Разработка под Android","isProfiled":true},{"relatedData":null,"id":"19441","alias":"kotlin","type":"collective","title":"Kotlin","titleHtml":"Kotlin","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"2","alias":"design","title":"Дизайн"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВ июле этого года вместе с Android Studio Arctic Fox вышла одна из долгожданных библиотек — Jetpack Compose. Она позволяет создавать пользовательский интерфейс в декларативном стиле и обещает быть революцией в построении UI.\u003C\u002Fp\u003E\u003Cp\u003EРазбираемся, так ли это на самом деле, какие у библиотеки преимущества и недостатки. Подробности — в статье.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5da\u002F63d\u002F3cb\u002F5da63d3cbeb8e38de3dde2792d851722.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5da\u002F63d\u002F3cb\u002F5da63d3cbeb8e38de3dde2792d851722.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"разработка мобильных приложений"},{"titleHtml":"jetpack compose"},{"titleHtml":"ui"},{"titleHtml":"интерфейсы"},{"titleHtml":"android"},{"titleHtml":"kotlin"},{"titleHtml":"android studio"},{"titleHtml":"arctic fox"},{"titleHtml":"пользовательские интерфейсы"}]},"579772":{"id":"579772","timePublished":"2021-09-27T05:32:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сливы процветают. Эксперт-«параноик» Майкл Баззель о защите личных данных","editorVersion":"2.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Michael Bazzell","originalUrl":"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F"}}],"author":{"id":"2297567","alias":"SearchInform_team","fullname":null,"avatarUrl":"","speciality":"Пользователь"},"statistics":{"commentsCount":0,"favoritesCount":7,"readingCount":2232,"score":9,"votesCount":9},"hubs":[{"relatedData":null,"id":"22418","alias":"searchinform","type":"corporative","title":"Блог компании SearchInform","titleHtml":"Блог компании SearchInform","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EНаш очередной пост из серии «интересное на иностранном языке» – рассказ Майкла Баззеля о том, как сберечь свои персональные данные от утечек. Майкл – знаковая фигура в сфере OSINT, работал в правительстве США и ФБР, его приглашали в качестве технического эксперта в сериал «Мистер Робот», который считают достойным с точки зрения достоверности. В личной жизни эксперт придерживается настолько жестких правил в отношении информационной гигиены, что некоторые считают его «неадекватом». Так ли это – может быть несколько мнений. \u003C\u002Fp\u003E\u003Cp\u003EОдин из факторов, который убеждает в правильном подходе Майкла, – что риски обнаружить свои данные в интернете стали существенно выше, потому что шифровальщики без разбору сливают в сеть все, до чего дотягиваются при атаках на бизнес. Приводим перевод \u003Ca href=\"https:\u002F\u002Finteltechniques.com\u002Fblog\u002F2021\u002F07\u002F23\u002Fpersonal-ransomware-exposure\u002F\"\u003Eпоста Майкла Баззеля\u003C\u002Fa\u003E. \u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EАтакуют корпорации, а страдают люди\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cp\u003EБольшинство людей не задумываются о том, как их касается проблема распространения вирусов-шифровальщиков. Логика такова: речь идет о проблемах компаний, это они вынуждены платить выкуп. При чем тут, казалось бы, обычные люди?! \u003C\u002Fp\u003E\u003Cp\u003EА при том, что преступники сменили тактику: сейчас они не просто шифруют данные, но и скачивают их, выкладывают в открытый доступ, если компании не платят им выкуп. Теперь давайте подумаем, что в этих слитых базах? Множество данных о сотрудниках, клиентах, контрагентах, с которыми компания-жертва работает.\u003C\u002Fp\u003E\u003Cp\u003EХочу сразу уточнить: я это пишу не потому что выступаю за уплату выкупа. Я за то, чтобы сопротивляться избыточному сбору данных там, где это не обязательно. Мы халатно относимся к своим ПДн, раздавая их по первому требованию.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3b\u002F3e1\u002F2c2\u002Fe3b3e12c2036d90018b804276e31ebea.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"персональные данные"},{"titleHtml":"пдн"},{"titleHtml":"сёрчинформ"},{"titleHtml":"Майкл Баззел"},{"titleHtml":"утечки информации"}]},"579854":{"id":"579854","timePublished":"2021-09-27T06:03:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"Видишь уязвимости? А они есть! Наше исследование популярных CMS-систем","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2684283","alias":"Solar_Pentest","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":8,"favoritesCount":19,"readingCount":3429,"score":25,"votesCount":27},"hubs":[{"relatedData":null,"id":"20826","alias":"solarsecurity","type":"corporative","title":"Блог компании Ростелеком-Солар","titleHtml":"Блог компании Ростелеком-Солар","isProfiled":false},{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛьвиная доля всех работ по анализу защищенности внешнего периметра – это тестирование веб-приложений. Здесь могут быть как корпоративные решения, так и «домашние» разработки на базе различных публичных систем управления контентом (CMS). Мы всегда проводим глубокий анализ подобных решений на тестовых стендах и зачастую находим уязвимости нулевого дня. Собственно, из опыта таких проектов и родилась идея собрать исследовательскую команду и провести глубокий анализ популярных CMS-систем и различных плагинов для них. В этом посте мы поделимся результатами нашего исследования, а также продемонстрируем примеры уязвимого кода наиболее интересных, на наш взгляд, уязвимостей и примеры их эксплуатации. Конечно все эти уязвимости уже исправлены и описываются здесь с разрешения владельцев систем.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","buttonTextHtml":"Не всё то в безопасности, что с Bug Bounty","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6df\u002F317\u002F4e6\u002F6df3174e60bbe263a70bcafdf9e51e6b.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"cms"},{"titleHtml":"уязвимости"},{"titleHtml":"уязвимости и их эксплуатация"},{"titleHtml":"уязвимость нулевого дня"}]},"580008":{"id":"580008","timePublished":"2021-09-27T06:30:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"Летний Магнитогорск","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2614609","alias":"city_scraper","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F8f8\u002Fd6c\u002F328\u002F8f8d6c328ec3a513103b6757c2c21610.png","speciality":"Пользователь"},"statistics":{"commentsCount":6,"favoritesCount":3,"readingCount":3445,"score":13,"votesCount":19},"hubs":[{"relatedData":null,"id":"22012","alias":"Ecology","type":"collective","title":"Экология","titleHtml":"Экология","isProfiled":false},{"relatedData":null,"id":"22024","alias":"urban","type":"collective","title":"Урбанизм","titleHtml":"Урбанизм","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EМагнитогорск Челябинской области – один из крупнейших мировых центров чёрной металлургии. В России это шестой из крупнейших городов, которые не являются центрами субъектов страны. \u003C\u002Fp\u003E\u003Cp\u003EСовсем недавно город был одним из наиболее неблагополучных с точки зрения загрязнения атмосферного воздуха, но в 2021 году был зафиксирован «повышенный» уровень – то есть не «высокий» или «очень высокий», как раньше. \u003C\u002Fp\u003E\u003Cp\u003EКак этот город выглядит летом? Где и как его жители могут проводить время?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F030\u002F0d1\u002Fcff\u002F0300d1cff2029948d33d803000331724.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Магнитогорск"},{"titleHtml":"промышленность"},{"titleHtml":"промышленные города"},{"titleHtml":"урбанизм\u002Fурбания"},{"titleHtml":"урбанистика"},{"titleHtml":"города России"},{"titleHtml":"города"}]},"580050":{"id":"580050","timePublished":"2021-09-27T10:23:25+00:00","isCorporative":false,"lang":"ru","titleHtml":"Один человек ответил на 85+ тысяч вопросов на Stack Overflow (24,1 ответа в день)","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1585037","alias":"sahsAGU","fullname":"Александр Гуреев","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F43c\u002F6c7\u002F0ab\u002F43c6c70ab024d45474e6abe8db797573.jpg","speciality":"Автор"},"statistics":{"commentsCount":30,"favoritesCount":8,"readingCount":9448,"score":10,"votesCount":16},"hubs":[{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"306","alias":"mysql","type":"collective","title":"MySQL","titleHtml":"MySQL","isProfiled":true},{"relatedData":null,"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true},{"relatedData":null,"id":"594","alias":"sql","type":"collective","title":"SQL","titleHtml":"SQL","isProfiled":true},{"relatedData":null,"id":"7152","alias":"data_mining","type":"collective","title":"Data Mining","titleHtml":"Data Mining","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cstrong\u003EВ среднем 24,1 ответа в день (если все 365 дней в году считать рабочими) на протяжении почти 10 лет.\u003C\u002Fstrong\u003E \u003C\u002Fp\u003E\u003Cp\u003EНесколько дней назад на некоторых англоязычных ресурсах началось обсуждение одного очень необычного пользователя Stack Overflow. Его зовут Гордон Линофф (Gordon Linoff), он из Нью-Йорка, и за 9 лет и 8 месяцев своего присутствия на платформе он дал 85,201 ответов на различные вопросы, в основном связанные с SQL и дата-майнингом (цифра актуальна на 27.09.2021). \u003C\u002Fp\u003E\u003Cp\u003EЧто это за маг?\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F396\u002F5ac\u002Fef4\u002F3965acef48ae14917c514fa091f60d1a.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F396\u002F5ac\u002Fef4\u002F3965acef48ae14917c514fa091f60d1a.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"sql"},{"titleHtml":"mysql"},{"titleHtml":"stackoverflow"},{"titleHtml":"базы данных"},{"titleHtml":"дата майнинг"},{"titleHtml":"data mining"}]},"580060":{"id":"580060","timePublished":"2021-09-27T09:00:04+00:00","isCorporative":true,"lang":"ru","titleHtml":"Арракис, который мы заслужили","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"238277","alias":"Zelenyikot","fullname":"Виталий Егоров","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F22b\u002F2d7\u002F7a5\u002F22b2d77a57b687aae24784a3e53089c9.jpg","speciality":"Популяризатор космонавтики"},"statistics":{"commentsCount":66,"favoritesCount":34,"readingCount":15845,"score":121,"votesCount":127},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21910","alias":"popular_science","type":"collective","title":"Научно-популярное","titleHtml":"Научно-популярное","isProfiled":false},{"relatedData":null,"id":"21962","alias":"space","type":"collective","title":"Космонавтика","titleHtml":"Космонавтика","isProfiled":false},{"relatedData":null,"id":"21984","alias":"sci-fi","type":"collective","title":"Научная фантастика","titleHtml":"Научная фантастика","isProfiled":false},{"relatedData":null,"id":"22014","alias":"futurenow","type":"collective","title":"Будущее здесь","titleHtml":"Будущее здесь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F580060\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fk0\u002Fds\u002Fy5\u002Fk0dsy5npxclyjdytiroqga7-leu.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nВо вселенной писателя-фантаста Фрэнка Герберта, Дюна, она же Арракис &mdash; это пустынная и маловодная планета с двумя лунами. По сюжету, она находится за пределами Солнечной системы, но если мы захотим поискать ближайшую схожую параллель,&nbsp;то больше всего подходит планета Марс. Предлагаю воспользоваться возможностями, которые даёт современная космонавтика, и совершить воображаемую прогулку на нашу Дюну.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Марс"},{"titleHtml":"Дюна"},{"titleHtml":"MRO"},{"titleHtml":"Curiosity"},{"titleHtml":"марсоход"},{"titleHtml":"ruvds_статьи"}]},"580080":{"id":"580080","timePublished":"2021-09-26T19:12:55+00:00","isCorporative":false,"lang":"ru","titleHtml":"Дайджест свежих материалов из мира фронтенда за последнюю неделю №486 (20 — 26 сентября 2021)","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"59347","alias":"alexzfort","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd2a\u002Fe8a\u002F5ac\u002Fd2ae8a5ac9876f838ebdd45f3ea3bc3b.png","speciality":""},"statistics":{"commentsCount":2,"favoritesCount":22,"readingCount":3717,"score":17,"votesCount":17},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"307","alias":"css","type":"collective","title":"CSS","titleHtml":"CSS","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"17103","alias":"html5","type":"collective","title":"HTML","titleHtml":"HTML","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"Предлагаем вашему вниманию подборку с ссылками на новые материалы из области фронтенда и около него.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fec\u002F0x\u002Fkx\u002Fec0xkxfr5jd-rci1wjo9bmr4cns.jpeg\"\u003E\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дайджест"},{"titleHtml":"фронтенд"},{"titleHtml":"css"},{"titleHtml":"js"},{"titleHtml":"es6"},{"titleHtml":"vue"},{"titleHtml":"react"},{"titleHtml":"angular"},{"titleHtml":"ember"},{"titleHtml":"html5"},{"titleHtml":"браузеры"},{"titleHtml":"ссылки"}]},"580086":{"id":"580086","timePublished":"2021-09-26T19:37:10+00:00","isCorporative":false,"lang":"ru","titleHtml":"Термо принтер и JavaScript","editorVersion":"2.0","postType":"article","postLabels":[{"type":"recovery","data":null}],"author":{"id":"1709955","alias":"IIIarp","fullname":"Сергей Шарпов","avatarUrl":"","speciality":"Веб разработчик"},"statistics":{"commentsCount":53,"favoritesCount":36,"readingCount":10454,"score":49,"votesCount":51},"hubs":[{"relatedData":null,"id":"84","alias":"crazydev","type":"collective","title":"Ненормальное программирование","titleHtml":"Ненормальное программирование","isProfiled":true},{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПриобрел я на днях термопринтер (кассовый аппарат, если изволите) жене для магазина и решил что смогу его обуздать как истинный программист и сделать свою веб кассу, вместо того, что-бы использовать платные решения, ведь задача простая, печатать чеки, но это оказалось не так то и просто...\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4f3\u002F259\u002Fe4e\u002F4f3259e4e73b5bfae82890fd3db512a0.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4f3\u002F259\u002Fe4e\u002F4f3259e4e73b5bfae82890fd3db512a0.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"термопринтер"},{"titleHtml":"javascript"},{"titleHtml":"webusb"}]},"580088":{"id":"580088","timePublished":"2021-09-26T21:17:27+00:00","isCorporative":false,"lang":"ru","titleHtml":"Запуск X-приложения в chroot на примере POSE (или «QEMU не нужен»)","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1481597","alias":"edo1h","fullname":null,"avatarUrl":"","speciality":"немного программист, немного админ"},"statistics":{"commentsCount":5,"favoritesCount":12,"readingCount":1170,"score":16,"votesCount":16},"hubs":[{"relatedData":null,"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true},{"relatedData":null,"id":"7289","alias":"nix","type":"collective","title":"*nix","titleHtml":"*nix","isProfiled":true}],"flows":[{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭта мини-статья родилась как ответ на статью \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F579296\" rel=\"noopener noreferrer nofollow\"\u003EУпрощаем эмуляцию X86 с помощью Live CD\u003C\u002Fa\u003E, в которой для запуска старых 32-битных приложений на 64-битных дистрибутивах Linux предлагалось использовать QEMU + Live CD — по моему мнению «из пушки по воробьям». Опишу своё решение на \u003Ccode\u003Echroot\u003C\u002Fcode\u003E + \u003Ccode\u003Edebootstrap\u003C\u002Fcode\u003E. \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"chroot"},{"titleHtml":"debootstrap"},{"titleHtml":"xwindow"}]},"580090":{"id":"580090","timePublished":"2021-09-26T21:19:11+00:00","isCorporative":false,"lang":"ru","titleHtml":"Сравнение подходов к реализации распределенных транзакций для микросервисов","editorVersion":"2.0","postType":"article","postLabels":[{"type":"sandbox","data":null},{"type":"translation","data":{"originalAuthorName":"Bilgin Ibryam","originalUrl":"https:\u002F\u002Fdevelopers.redhat.com\u002Farticles\u002F2021\u002F09\u002F21\u002Fdistributed-transaction-patterns-microservices-compared"}}],"author":{"id":"194270","alias":"sprosin","fullname":"Sergey Prosin","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fd67\u002F5d8\u002F1d6\u002Fd675d81d6fe5bf69493735cef4910eb5.jpg","speciality":"Веду команды к релизам, пишу статьи, выступаю."},"statistics":{"commentsCount":6,"favoritesCount":93,"readingCount":4909,"score":18,"votesCount":18},"hubs":[{"relatedData":null,"id":"7504","alias":"refactoring","type":"collective","title":"Проектирование и рефакторинг","titleHtml":"Проектирование и рефакторинг","isProfiled":true},{"relatedData":null,"id":"21482","alias":"distributed_systems","type":"collective","title":"Распределённые системы","titleHtml":"Распределённые системы","isProfiled":true},{"relatedData":null,"id":"22115","alias":"microservices","type":"collective","title":"Микросервисы","titleHtml":"Микросервисы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EКак архитектор-консультант в Red Hat, я имел возможность поработать над множеством проектов для наших клиентов. У каждого из них есть свои особенности, которые, однако, имеют некоторые общие черты. Большинство клиентов хотят знать, как скоординировать запись в несколько систем одновременно. Ответ на этот вопрос обычно включает подробное объяснение двойной записи, распределенных транзакций, современных альтернатив, а также возможных сценариев сбоев и недостатков каждого подхода. Как правило, именно в этот момент заказчик понимает, что разделение монолитного приложения на микросервисы - долгий и сложный путь, обычно требующий компромиссов.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc4\u002F35d\u002Fff3\u002Fbc435dff35d09143dacf29bbc1e470a7.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc4\u002F35d\u002Fff3\u002Fbc435dff35d09143dacf29bbc1e470a7.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"распределенные системы"},{"titleHtml":"микросервисы"},{"titleHtml":"транзакции"},{"titleHtml":"распределенные транзакции"},{"titleHtml":"оркестрация"},{"titleHtml":"оркестрация микросервисов"},{"titleHtml":"хореография"},{"titleHtml":"конвейеры"}]},"580092":{"id":"580092","timePublished":"2021-09-26T21:49:14+00:00","isCorporative":false,"lang":"ru","titleHtml":"30 сентября: Let's Encrypt и конец срока действия IdenTrust DST Root CA X3","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"805873","alias":"rantal","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":92,"favoritesCount":54,"readingCount":18035,"score":46,"votesCount":46},"hubs":[{"relatedData":null,"id":"50","alias":"infosecurity","type":"collective","title":"Информационная безопасность","titleHtml":"Информационная безопасность","isProfiled":true},{"relatedData":null,"id":"17350","alias":"s_admin","type":"collective","title":"Серверное администрирование","titleHtml":"Серверное администрирование","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E30 сентября 2021 14:01:15  GMT оканчивается срок действия корневого сертификата IdenTrust DST Root CA X3.\u003C\u002Fp\u003E\u003Cp\u003EЭто событие достойно вашего внимания по той причине, что после наступления этого момента ряд устаревших систем перестанут доверять сертификатам,&nbsp;выпущенным центром сертификации Let’s Encrypt. С учётом того, что на текущий момент Let's Encrypt предоставляет бесплатные криптографические сертификаты примерно для \u003Ca href=\"https:\u002F\u002Fletsencrypt.org\u002Fstats\u002F\" rel=\"noopener noreferrer nofollow\"\u003E250 миллионов доменных имен\u003C\u002Fa\u003E, а \"устаревшие системы\" - это порой системы возрастом всего 5-6 лет, вряд ли окончание срока действия сертификата&nbsp;DST Root CA X3 пройдёт для всех гладко и незаметно. В чём причина, кого конкретно это затронет, и что можно сделать?\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"let's encrypt"},{"titleHtml":"DST Root CA X3"},{"titleHtml":"корневой сертификат"},{"titleHtml":"https"},{"titleHtml":"tls"},{"titleHtml":"openssl"}]},"580094":{"id":"580094","timePublished":"2021-09-26T22:35:26+00:00","isCorporative":false,"lang":"ru","titleHtml":"Блокчейн нас подвёл? Почему ДЭГ — это плохо и можем ли мы адекватно контролировать процесс подсчёта голосов?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"206414","alias":"PoltoS","fullname":"Сергей Полторак","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F5cf\u002F03a\u002Fc7f\u002F5cf03ac7fe60ea8a6686bd4c57627ddc.png","speciality":""},"statistics":{"commentsCount":97,"favoritesCount":27,"readingCount":14269,"score":32,"votesCount":54},"hubs":[{"relatedData":null,"id":"118","alias":"crypto","type":"collective","title":"Криптография","titleHtml":"Криптография","isProfiled":true},{"relatedData":null,"id":"210","alias":"it_testing","type":"collective","title":"Тестирование IT-систем","titleHtml":"Тестирование IT-систем","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EИнтересно наблюдать, как дискредитируется термин блокчейна на выборах в госдуму. Вроде голосование было на блокчейне, но его якобы подделали. Т.е. блокчейн можно подделать или ЦИК и ДИТ нам подсунули какой-то лохчейн вместо блокчейна?!? И мало кто обсуждает происходящее по существу без эмоций, связанных с результатами партий и кандидатов.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e5\u002F82b\u002F9d0\u002F6e582b9d062dd29fa41c7842a8b76495.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e5\u002F82b\u002F9d0\u002F6e582b9d062dd29fa41c7842a8b76495.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Криптография"},{"titleHtml":"блокчейн"},{"titleHtml":"открытые данные"},{"titleHtml":"электронное голосование"},{"titleHtml":"выборы"},{"titleHtml":"выборы в госдуму"},{"titleHtml":"дэг"},{"titleHtml":"дэг 2021"}]},"580124":{"id":"580124","timePublished":"2021-09-27T13:03:14+00:00","isCorporative":true,"lang":"ru","titleHtml":"Электролюминесцентные индикаторы из прошлого","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"146371","alias":"radiolok","fullname":"Артем Кашканов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa46\u002Fc6a\u002F151\u002Fa46c6a15193f7c0cac79d2736b107358.jpg","speciality":"Релейно-декатронный маньяк"},"statistics":{"commentsCount":9,"favoritesCount":32,"readingCount":3203,"score":56,"votesCount":56},"hubs":[{"relatedData":null,"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false},{"relatedData":null,"id":"21484","alias":"electronics","type":"collective","title":"Производство и разработка электроники","titleHtml":"Производство и разработка электроники","isProfiled":true},{"relatedData":null,"id":"21906","alias":"history","type":"collective","title":"История IT","titleHtml":"История IT","isProfiled":false},{"relatedData":null,"id":"21930","alias":"antikvariat","type":"collective","title":"Старое железо","titleHtml":"Старое железо","isProfiled":false}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Сегодня речь пойдёт об электролюминесцентных индикаторах. Но, не о тех, которые окружают вас повсюду и к которым вы привыкли, а о других — получивших огромную популярность в 60-е годы прошлого века, и так же стремительно канувших в небытие. Заодно запущу свою коллекцию индикаторов, как серийно выпускавшихся, так и уникальных опытных и даже — лабораторных образцов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompany\u002Fruvds\u002Fblog\u002F523004\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F94e\u002F51f\u002F459\u002F94e51f459ae59c9d2fe6c448cb07bcca.gif\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"Индикатор"},{"titleHtml":"электролюминесцентность"},{"titleHtml":"ruvds_статьи"}]},"580150":{"id":"580150","timePublished":"2021-09-27T10:50:03+00:00","isCorporative":true,"lang":"ru","titleHtml":"Топ-5 когнитивных искажений при планировании в IT","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2794469","alias":"KM_QA","fullname":null,"avatarUrl":"","speciality":""},"statistics":{"commentsCount":6,"favoritesCount":34,"readingCount":3873,"score":30,"votesCount":32},"hubs":[{"relatedData":null,"id":"14332","alias":"oleg-bunin","type":"corporative","title":"Блог компании Конференции Олега Бунина (Онтико)","titleHtml":"Блог компании Конференции Олега Бунина (Онтико)","isProfiled":false},{"relatedData":null,"id":"19583","alias":"dev_management","type":"collective","title":"Управление разработкой","titleHtml":"Управление разработкой","isProfiled":true},{"relatedData":null,"id":"20736","alias":"hr_management","type":"collective","title":"Управление персоналом","titleHtml":"Управление персоналом","isProfiled":true},{"relatedData":null,"id":"20754","alias":"tech_events","type":"collective","title":"Конференции","titleHtml":"Конференции","isProfiled":false},{"relatedData":null,"id":"21990","alias":"brain","type":"collective","title":"Мозг","titleHtml":"Мозг","isProfiled":false}],"flows":[{"id":"3","alias":"management","title":"Менеджмент"},{"id":"4","alias":"marketing","title":"Маркетинг"},{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЭта статья подходит для тимлидов и их подопечных, а также для всех, кто оценивает проекты и задачи. Я расскажу, как и почему мы делаем ошибки из-за когнитивных искажений. Попадаем в них мы почти все, просто потому что мы живые люди. И на примере одного дня из жизни тимлида я хочу показать, в какие искажения чаще всего влетают в IT, и&nbsp; — самое полезное&nbsp; —&nbsp; как из них можно выходить.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EЗамечу, что искать когнитивные искажения стоит, в первую очередь, у себя, а не у коллег. \u003C\u002Fstrong\u003EИ что рассказывать про искажения намного проще, чем не влетать в их на практике, однако, если этому научиться, то в перспективе это изрядно окупается, потому что экономит и время, и деньги, помогая и нам, и команде.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb78\u002F76f\u002F001\u002Fb7876f0010e85c328462a735df0b76e8.jpg","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fb78\u002F76f\u002F001\u002Fb7876f0010e85c328462a735df0b76e8.jpg","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"когнитивные искажения"},{"titleHtml":"нейрофизиология"},{"titleHtml":"мозг"},{"titleHtml":"психология"},{"titleHtml":"тимлидство"},{"titleHtml":"тимлид"},{"titleHtml":"управление людьми"},{"titleHtml":"управление проектами и командой"},{"titleHtml":"управление командой"},{"titleHtml":"управление персоналом"}]},"580172":{"id":"580172","timePublished":"2021-09-27T11:45:49+00:00","isCorporative":true,"lang":"ru","titleHtml":"Небинарный ngIf*","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1050218","alias":"Waterplea","fullname":"Александр Инкин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fa70\u002F569\u002Ff31\u002Fa70569f31346559ce2b8b875e7f97480.jpg","speciality":"Google Developer Expert | Angular"},"statistics":{"commentsCount":0,"favoritesCount":10,"readingCount":709,"score":14,"votesCount":14},"hubs":[{"relatedData":null,"id":"17420","alias":"tinkoff","type":"corporative","title":"Блог компании TINKOFF","titleHtml":"Блог компании TINKOFF","isProfiled":false},{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"18109","alias":"angular","type":"collective","title":"Angular","titleHtml":"Angular","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EВам когда-нибудь хотелось отобразить состояние загрузки, пока \u003Ccode\u003EngIf\u003C\u002Fcode\u003E ждет ответа от \u003Ccode\u003Easync\u003C\u002Fcode\u003E-пайпа? Или, может, вы мечтали передать в \u003Ccode\u003EngFor\u003C\u002Fcode\u003E шаблон для пустого массива? Возможно, вы бросили это, потому что вам не хотелось реализовывать базовую логику этих директив самому. На самом деле в этом нет нужды! Один и тот же селектор может подцепить несколько директив, что позволяет расширить функциональность встроенных директив дополнительной логикой.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F846\u002F786\u002F3e2\u002F8467863e2df65db32cb31f4b16c822ef.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"template"},{"titleHtml":"directive"},{"titleHtml":"angular"},{"titleHtml":"structural"}]},"580194":{"id":"580194","timePublished":"2021-09-27T12:36:12+00:00","isCorporative":true,"lang":"ru","titleHtml":"Сотрудники на карте: отвечаем на 10 важных вопросов о трекинге","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"1254716","alias":"Axelus","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F118\u002Fc4f\u002F08f\u002F118c4f08ffa66438ad6be22e205d563d.png","speciality":"Разработчик"},"statistics":{"commentsCount":0,"favoritesCount":6,"readingCount":820,"score":13,"votesCount":15},"hubs":[{"relatedData":null,"id":"20758","alias":"regionsoft","type":"corporative","title":"Блог компании RegionSoft","titleHtml":"Блог компании RegionSoft","isProfiled":false},{"relatedData":null,"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true},{"relatedData":null,"id":"12365","alias":"saas","type":"collective","title":"SaaS \u002F S+S","titleHtml":"SaaS \u002F S+S","isProfiled":true},{"relatedData":null,"id":"17783","alias":"geo","type":"collective","title":"Геоинформационные сервисы","titleHtml":"Геоинформационные сервисы","isProfiled":true},{"relatedData":null,"id":"20736","alias":"hr_management","type":"collective","title":"Управление персоналом","titleHtml":"Управление персоналом","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент"},{"id":"6","alias":"admin","title":"Администрирование"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EЛюбой контроль сотрудников — опасный и болезненный вопрос, особенно в небольших компаниях. Часто в дружеские и открытые отношения компании не вписывается ни одна из форм контроля, рассчитывать можно только на доверие. Но пресловутый ковид и здесь внёс свои коррективы: расширение удалённой работы, увеличение штата мобильных сотрудников, частичная занятость пополнили ряды полевых сисадминов, аутсорсеров поддержки и остальных «разъездных» работников. Увы, люди разные и вслед за приятными плодами и бонусами удалёнки пришли негативные истории про поведение курьеров, опоздания и откровенные нарушения сотрудников на территории клиентов, неявки на работу или к заказчику и т.д. С этим столкнулись и ритейл, и ИТ, и любая сфера с мобильными сотрудниками. Очень хочется верить в лучшее, но без минимального контроля можно просто потерять бизнес — и тогда пострадают коллеги нерадивых сотрудников.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4a\u002F5b9\u002Fa9d\u002Fe4a5b9a9d62c342fa897f4531ec9301b.png","fit":"cover","positionY":0,"positionX":0}},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"geomonitor"},{"titleHtml":"геолокация"},{"titleHtml":"геозона"},{"titleHtml":"трекинг"}]},"580206":{"id":"580206","timePublished":"2021-09-27T12:51:03+00:00","isCorporative":false,"lang":"ru","titleHtml":"МТС отказался от скрытых мобильных подписок?","editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"2467147","alias":"Plusodin","fullname":"Владимир","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F343\u002Fb77\u002Fd12\u002F343b77d12f047368849a9880276f936e.jpg","speciality":"Пользователь"},"statistics":{"commentsCount":6,"favoritesCount":2,"readingCount":3188,"score":8,"votesCount":8},"hubs":[{"relatedData":null,"id":"22008","alias":"cellular","type":"collective","title":"Сотовая связь","titleHtml":"Сотовая связь","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EПривет, Хабр!\u003C\u002Fp\u003E\u003Cp\u003EНу что, подходит к концу первый сезон сериала «О скрытых мобильных подписках и операторах связи». Предыдущие три серии: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F550448\u002F\" rel=\"noopener noreferrer nofollow\"\u003EМегафон\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F563260\u002F\" rel=\"noopener noreferrer nofollow\"\u003EБилайн\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fpost\u002F571256\u002F\" rel=\"noopener noreferrer nofollow\"\u003ETele2\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\u003Cp\u003EНу и вишенка на этом торте – МТС.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"мтс"},{"titleHtml":"мобильные подписки"},{"titleHtml":"подписки"},{"titleHtml":"оператор связи"},{"titleHtml":"теле2"},{"titleHtml":"мегафон"},{"titleHtml":"билайн"}]},"580210":{"id":"580210","timePublished":"2021-09-27T12:53:02+00:00","isCorporative":false,"lang":"ru","titleHtml":"PHP Дайджест № 212 (13 – 27 сентября 2021)","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"100489","alias":"pronskiy","fullname":"Роман Пронский","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F27f\u002Fb99\u002Feb3\u002F27fb99eb3e30e3221c5839e88be02395.jpg","speciality":"PHP"},"statistics":{"commentsCount":0,"favoritesCount":8,"readingCount":2658,"score":29,"votesCount":29},"hubs":[{"relatedData":null,"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"relatedData":null,"id":"260","alias":"php","type":"collective","title":"PHP","titleHtml":"PHP","isProfiled":true},{"relatedData":null,"id":"477","alias":"symfony","type":"collective","title":"Symfony","titleHtml":"Symfony","isProfiled":true},{"relatedData":null,"id":"9554","alias":"yii","type":"collective","title":"Yii","titleHtml":"Yii","isProfiled":true},{"relatedData":null,"id":"18812","alias":"laravel","type":"collective","title":"Laravel","titleHtml":"Laravel","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fek\u002F6r\u002Fr1\u002Fek6rr1odvyzb89tfv0lq4cmfxi4.jpeg\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\nПодборка свежих новостей и материалов из мира PHP.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВышел PHP 8.1 RC2 и уже доступен первый пакет с использованием перечислений, будет сделан форк Magento, новый тип стандартов PER в дополнение к PSR, стартовала PhpStorm 2021.3 EAP, Symfony 6 будет полностью типизирован — как обновляться?\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nДля PHP 8.2 предложены новые оптимизированные структуры данных.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nТакже в выпуске порция инструментов, полезные статьи, видео и анонсы двух митапов.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nПриятного чтения!\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"дайджест"},{"titleHtml":"php-дайджест"},{"titleHtml":"PHP"},{"titleHtml":"Symfony"},{"titleHtml":"Laravel"},{"titleHtml":"Magento"},{"titleHtml":"PHPUnit"},{"titleHtml":"PHP 8.1"},{"titleHtml":"PHP 8.2"}]},"580228":{"id":"580228","timePublished":"2021-09-27T16:41:21+00:00","isCorporative":true,"lang":"ru","titleHtml":"Идеальная светодиодная лампа за 21 рубль","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"108988","alias":"AlexeyNadezhin","fullname":"Алексей Надежин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Ffdc\u002F3ac\u002F9a2\u002Ffdc3ac9a2dc0107cc956f1bd0cf5fc2b.jpg","speciality":"Блогер"},"statistics":{"commentsCount":13,"favoritesCount":10,"readingCount":2588,"score":22,"votesCount":22},"hubs":[{"relatedData":null,"id":"21646","alias":"lamptest","type":"corporative","title":"Блог компании LampTest","titleHtml":"Блог компании LampTest","isProfiled":false},{"relatedData":null,"id":"21894","alias":"gadgets","type":"collective","title":"Гаджеты","titleHtml":"Гаджеты","isProfiled":false}],"flows":[{"id":"7","alias":"popsci","title":"Научпоп"}],"relatedData":null,"leadData":{"textHtml":"Удивительно осознавать, что достаточно сложное электронное устройство, которым является светодиодная лампочка, может стоить 21 рубль. \u003Cbr\u003E\r\n\u003Cbr\u003E\r\nЕщё сложнее поверить, что эта лампочка безукоризненна по всем параметрам.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002F20f\u002F849\u002Ffcd\u002F20f849fcd6a3891f506676fc87223bdf.jpg\"\u003E\u003C\u002Fdiv\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null,"tags":[{"titleHtml":"led"},{"titleHtml":"светодиодные лампы"},{"titleHtml":"тест"}]}},"articlesIds":{"ARTICLES_LIST_TOP_PERIOD_DAILY":["580060","580124","580086","580092","580094","579542","580150","580210","579854","580228","580090","580080","580088","580172","580194","580008","572164","580050","579772","580206"]},"isLoading":false,"pagesCount":{"ARTICLES_LIST_TOP_PERIOD_DAILY":3},"route":{"name":"ARTICLES_LIST_TOP_PERIOD","params":{"period":"daily"},"query":{}},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":["531402","351772","273401"],"similarListRefs":{"273401":{"id":"273401","timePublished":"2015-12-17T21:33:21+00:00","isCorporative":false,"lang":"ru","titleHtml":"Python-&gt;Cython-&gt;C++, да и COM в придачу: написание фреймворка для автотестов","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"704591","alias":"grafalex","fullname":"Александр Маслюченко","avatarUrl":null,"speciality":"Руководитель Проекта, Программист"},"statistics":{"commentsCount":4,"favoritesCount":87,"readingCount":13553,"score":15,"votesCount":15},"hubs":[{"id":"210","alias":"it_testing","type":"collective","title":"Тестирование IT-систем","titleHtml":"Тестирование IT-систем","isProfiled":true},{"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true},{"id":"559","alias":"cpp","type":"collective","title":"C++","titleHtml":"C++","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"Я думаю все в курсе о пользе автотестов. Они помогают держать код в работоспособном состоянии даже при существенных изменениях. Так же это может избавить тестировщиков от нудной ручной работы и позволяет сосредоточиться на более интересных видах тестирования.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНесмотря на то, что отдельным частям нашего проекта более 25 лет, мы только в самом начале пути внедрения автоматического тестирования. Тем не менее, у нас уже есть некоторые успехи, о которых я хочу поведать в этой статье.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак писать хорошие автотесты – тема отдельной статьи. И, вероятно, не одной. Я же расскажу вам как мы внедрили тестирование отдельных компонентов. Компоненты написаны на С++ и имеют интерфейсы очень похожие на СОМ. В качестве языка для тестов мы выбрали python и используем очень мощный тестовый фреймворк PyTest. В статье я расскажу про сложности связки С++\u002FСОМ и питона, подводные камни, на которые мы наткнулись и как решали эти проблемы.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"status":"published","plannedPublishTime":null,"checked":null},"351772":{"id":"351772","timePublished":"2018-03-22T06:54:22+00:00","isCorporative":false,"lang":"ru","titleHtml":"Язык программирования, рассчитанный на минификацию","editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"381523","alias":"thewizardplusplus","fullname":null,"avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F9d6\u002Fc76\u002F43f\u002F9d6c7643f60d9dd93b519c87bd791048.png","speciality":"Пользователь"},"statistics":{"commentsCount":38,"favoritesCount":49,"readingCount":21454,"score":52,"votesCount":56},"hubs":[{"id":"84","alias":"crazydev","type":"collective","title":"Ненормальное программирование","titleHtml":"Ненормальное программирование","isProfiled":true},{"id":"91","alias":"webdev","type":"collective","title":"Разработка веб-сайтов","titleHtml":"Разработка веб-сайтов","isProfiled":true},{"id":"17188","alias":"compilers","type":"collective","title":"Компиляторы","titleHtml":"Компиляторы","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ffk\u002Ffa\u002Fxr\u002Ffkfaxrhgdymfpygnkkxtpdqek-e.png\"\u003E\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EОднажды я принял участие в конкурсе демо (программ, генерирующих аудио-визуальный ряд, основной особенностью которых является экстремально маленький размер — десятки или даже единицы кибибайт).\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВ процессе общего обсуждения кто-то предложил нестандартную для мира демо идею: написать программу на каком-либо скриптовом языке. Дело в том, что все демо сжимаются упаковщиком для уменьшения размера (а при исполнении распаковываются). И текст сжимается намного лучше бинарного кода. Если интерпретатор будет иметь очень маленький размер, это может дать существенное преимущество.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EИз-за опыта работы во фронтенде мне сразу пришла мысль дополнительно минифицировать код — удалить пробелы и необязательные элементы, сократить длину идентификаторов. Ведь сжатие сохраняет всю информацию, а многие элементы синтаксиса не являются необходимостью.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EНо даже так большинство существующих языков не предназначены для данной оптимизации — очевидно, они имеют множество элементов, которые нужны для понимания человеку, а не машине. А что, если разработать язык, специально рассчитанный на минификацию?\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВ том конкурсе, в итоге, участвовать я не стал. Однако, данная идея не покидала меня. Ведь она может быть полезна и для более практичных целей, чем демо — в мире фронтенда объём клиентских скриптов до сих пор крайне важен, если удастся сократить его, данное решение может оказаться оправданым хотя бы в некоторых случаях.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003EЯ решил провести эксперимент — сделать прототип языка и посмотреть, что из этого выйдет.\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"status":"published","plannedPublishTime":null,"checked":null},"531402":{"id":"531402","timePublished":"2020-12-04T18:03:25+00:00","isCorporative":false,"lang":"ru","titleHtml":"Python как компилируемый статически типизированный язык программирования","editorVersion":"2.0","postType":"news","postLabels":[],"author":{"id":"705763","alias":"alec_kalinin","fullname":"Alexander Kalinin","avatarUrl":null,"speciality":null},"statistics":{"commentsCount":38,"favoritesCount":31,"readingCount":11069,"score":16,"votesCount":28},"hubs":[{"id":"340","alias":"python","type":"collective","title":"Python","titleHtml":"Python","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"}],"relatedData":null,"leadData":{"textHtml":"\u003Cp\u003EPython как статически типизированный компилируемый язык\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать далее","image":null},"status":"published","plannedPublishTime":null,"checked":null}}},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{"honeyman":{"scoreStats":{"score":274,"votesCount":418},"rating":0,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"10407","alias":"Honeyman","fullname":"Honeyman","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F052\u002F337\u002Fdf7\u002F052337df79576c450527ce51a573d49e.png","speciality":null}},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.670ab961.js" defer></script><script src="https://assets.habr.com/habr-web/js/chunk-f458c7c4.6e221df6.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.76acc47b.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
